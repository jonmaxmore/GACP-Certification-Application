[{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\forgot-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\login\\AccountTypeSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\login\\LoginOverlays.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":68,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":21},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":108,"column":29,"nodeType":"JSXOpeningElement","endLine":108,"endColumn":131}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\login\\page.tsx:35:13\n  33 |         if (remembered) {\n  34 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 35 |             setAccountType(remembered.accountType || \"INDIVIDUAL\");\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |             setIdentifier(remembered.identifier || \"\");\n  37 |             setRememberMe(true);\n  38 |         }","line":35,"column":13,"nodeType":null,"endLine":35,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { IconLock, PersonIcon, Icons, EyeIcon, BuildingIcon, GroupIcon } from \"@/components/ui/icons\";\r\nimport { formatThaiId } from \"@/utils/thai-id-validator\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\n\r\nconst ACCOUNT_TYPES = [\r\n    { type: \"INDIVIDUAL\", label: \"บุคคลธรรมดา\", subtitle: \"Individual\", idLabel: \"เลขบัตรประชาชน\", idHint: \"x-xxxx-xxxxx-xx-x\", icon: PersonIcon },\r\n    { type: \"JURISTIC\", label: \"นิติบุคคล\", subtitle: \"Juristic\", idLabel: \"เลขทะเบียนนิติบุคคล\", idHint: \"0-0000-00000-00-0\", icon: BuildingIcon },\r\n    { type: \"COMMUNITY_ENTERPRISE\", label: \"วิสาหกิจชุมชน\", subtitle: \"Community\", idLabel: \"ทะเบียนวิสาหกิจชุมชน\", idHint: \"x-xx-xx-xx/x-xxxx\", icon: GroupIcon },\r\n];\r\n\r\nexport default function LoginPage() {\r\n    const router = useRouter();\r\n    const [accountType, setAccountType] = useState(\"INDIVIDUAL\");\r\n    const [identifier, setIdentifier] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [loginState, setLoginState] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\r\n    const [error, setError] = useState(\"\");\r\n    const [rememberMe, setRememberMe] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (AuthService.isAuthenticated()) {\r\n            window.location.href = \"/farmer/dashboard\";\r\n            return;\r\n        }\r\n        const remembered = AuthService.getRememberMe();\r\n        if (remembered) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setAccountType(remembered.accountType || \"INDIVIDUAL\");\r\n            setIdentifier(remembered.identifier || \"\");\r\n            setRememberMe(true);\r\n        }\r\n    }, []);\r\n\r\n    const currentConfig = ACCOUNT_TYPES.find((t) => t.type === accountType)!;\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setError(\"\");\r\n        setIsLoading(true);\r\n        setLoginState('loading');\r\n\r\n        const cleanIdentifier = identifier.replace(/-/g, \"\").replace(/[<>'\"&]/g, \"\");\r\n        const cleanPassword = password.trim();\r\n\r\n        try {\r\n            const result = await AuthService.login({ accountType, identifier: cleanIdentifier, password: cleanPassword });\r\n\r\n            if (!result.success) {\r\n                setError(result.error || 'ข้อมูลไม่ถูกต้อง กรุณาตรวจสอบอีกครั้ง');\r\n                setLoginState('error');\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            if (rememberMe) AuthService.saveRememberMe(accountType, cleanIdentifier);\r\n            else AuthService.clearRememberMe();\r\n\r\n            setLoginState('success');\r\n            setTimeout(() => { window.location.href = \"/farmer/dashboard\"; }, 1500);\r\n\r\n        } catch (err) {\r\n            setError(\"ไม่สามารถเชื่อมต่อระบบได้ กรุณาลองใหม่ภายหลัง\");\r\n            setLoginState('error');\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleThaIDLogin = () => {\r\n        // Construct Authorization URL for Mock ThaID\r\n        const backendUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api';\r\n        const clientId = 'gacp-web';\r\n        const redirectUri = `${window.location.origin}/auth/callback/thaid`;\r\n        const state = 'random_state_xyz'; // In prod, use proper CSRF state\r\n        const scope = 'openid profile offline_access';\r\n\r\n        const authUrl = `${backendUrl}/mock-thaid/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${scope}&state=${state}`;\r\n\r\n        window.location.href = authUrl;\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen w-full flex flex-col lg:flex-row bg-white overflow-hidden font-sans\">\r\n\r\n            {/* LEFT PANEL (Strategic Marketing & Value Prop) */}\r\n            <div className=\"hidden lg:flex lg:w-5/12 bg-[#006837] relative flex-col items-center justify-center overflow-hidden z-0 text-white p-12 text-center\">\r\n                {/* Background Effects */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-[#005c30] to-[#003820] opacity-100 z-0\"></div>\r\n                <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-[0.06] mix-blend-overlay bg-repeat bg-[length:300px] z-0\"></div>\r\n\r\n                {/* Decorative Glows for depth */}\r\n                <div className=\"absolute top-[-20%] left-[-20%] w-[80%] h-[80%] bg-emerald-400/10 rounded-full blur-[100px] pointer-events-none\"></div>\r\n                <div className=\"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-emerald-500/10 rounded-full blur-[80px] pointer-events-none\"></div>\r\n\r\n                {/* Content Container */}\r\n                <div className=\"relative z-10 flex flex-col items-center animate-fade-in-up w-full max-w-lg\">\r\n\r\n                    {/* Official Logo - High Contrast Container */}\r\n                    <div className=\"mb-12 relative group cursor-default\">\r\n                        <div className=\"absolute -inset-4 bg-emerald-500/20 rounded-full blur-xl group-hover:bg-emerald-400/30 transition-all duration-700\"></div>\r\n                        <div className=\"w-28 h-28 bg-white/10 backdrop-blur-md rounded-full p-4 flex items-center justify-center border border-white/20 shadow-2xl relative z-10 hover:scale-105 transition-transform duration-500\">\r\n                            <img src=\"/images/dtam-logo.png\" alt=\"MOPH\" className=\"w-full h-full object-contain drop-shadow-lg\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Headline: The \"Why\" (Marketing Hook) */}\r\n                    <h1 className=\"text-4xl xl:text-5xl font-bold leading-tight drop-shadow-lg mb-6 tracking-tight\">\r\n                        ยกระดับสมุนไพรไทย<br />\r\n                        <span className=\"text-emerald-300 bg-gradient-to-r from-emerald-200 to-emerald-400 bg-clip-text text-transparent\">สู่มาตรฐานสากล</span>\r\n                    </h1>\r\n\r\n                    {/* Subheader: The \"Value\" (Trust & Quality) */}\r\n                    <p className=\"text-emerald-50/90 text-lg font-light leading-relaxed mb-10 max-w-sm mx-auto\">\r\n                        <span className=\"font-semibold text-white\">สร้างความเชื่อมั่น เพิ่มมูลค่าผลผลิต</span><br />\r\n                        ด้วยระบบรับรองคุณภาพ GACP ที่ทันสมัย<br />\r\n                        โปร่งใส และตรวจสอบได้\r\n                    </p>\r\n\r\n                    {/* Trust Indicators / Badges */}\r\n                    <div className=\"flex items-center justify-center gap-4 opacity-80\">\r\n                        <div className=\"px-4 py-2 rounded-lg bg-emerald-900/40 border border-emerald-500/30 text-xs font-bold uppercase tracking-widest text-emerald-100 flex items-center gap-2\">\r\n                            <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.8)]\"></span>\r\n                            Quality\r\n                        </div>\r\n                        <div className=\"px-4 py-2 rounded-lg bg-emerald-900/40 border border-emerald-500/30 text-xs font-bold uppercase tracking-widest text-emerald-100 flex items-center gap-2\">\r\n                            <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.8)]\"></span>\r\n                            Trust\r\n                        </div>\r\n                        <div className=\"px-4 py-2 rounded-lg bg-emerald-900/40 border border-emerald-500/30 text-xs font-bold uppercase tracking-widest text-emerald-100 flex items-center gap-2\">\r\n                            <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.8)]\"></span>\r\n                            Export\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* Footer Credit */}\r\n                <div className=\"absolute bottom-8 text-emerald-200/40 text-[10px] uppercase tracking-[0.2em] font-medium\">\r\n                    Department of Thai Traditional and Alternative Medicine\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT PANEL (White Zone - Pure Action) */}\r\n            <div className=\"flex-1 flex flex-col justify-center items-center p-6 lg:p-12 xl:p-16 bg-white relative z-10\">\r\n\r\n                <div className=\"w-full max-w-[440px] animate-slide-up\">\r\n\r\n                    {/* Header - No Logo, Just Context */}\r\n                    <div className=\"text-left mb-8 pl-1\">\r\n                        <h2 className=\"text-4xl font-black text-slate-800 tracking-tight mb-3\">เข้าสู่ระบบ</h2>\r\n                        <p className=\"text-slate-500 text-lg font-medium\">จัดการข้อมูลแปลงเพาะปลูกของคุณ</p>\r\n                    </div>\r\n\r\n                    {/* Unified Toggle Tabs (Pill) */}\r\n                    <div className=\"bg-slate-50 p-1.5 rounded-full mb-8 flex relative border border-slate-100\">\r\n                        {ACCOUNT_TYPES.map((type) => {\r\n                            const isSelected = accountType === type.type;\r\n                            return (\r\n                                <button\r\n                                    key={type.type}\r\n                                    type=\"button\"\r\n                                    onClick={() => { setAccountType(type.type); setIdentifier(\"\"); setError(\"\"); }}\r\n                                    className={`\r\n                                        flex-1 py-2.5 rounded-full text-xs font-bold transition-all duration-300 relative z-10 flex items-center justify-center gap-2\r\n                                        ${isSelected ? 'text-[#006837] shadow-sm' : 'text-slate-400 hover:text-slate-600'}\r\n                                    `}\r\n                                >\r\n                                    {isSelected && (\r\n                                        <div className=\"absolute inset-0 bg-white rounded-full shadow-sm ring-1 ring-black/5 -z-10 animate-fade-in\"></div>\r\n                                    )}\r\n                                    <type.icon className={`w-4 h-4 ${isSelected ? 'fill-current' : ''}`} />\r\n                                    <span>{type.label}</span>\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n\r\n                    {/* ThaID Integration Button */}\r\n                    <div className=\"mb-6\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleThaIDLogin}\r\n                            className=\"w-full bg-[#1a237e] hover:bg-[#283593] text-white py-4 rounded-2xl shadow-lg shadow-blue-900/20 hover:shadow-xl hover:shadow-blue-900/30 transition-all flex items-center justify-center gap-4 group relative overflow-hidden\"\r\n                        >\r\n                            <div className=\"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity\"></div>\r\n                            <div className=\"w-8 h-8 bg-white rounded-full flex items-center justify-center\">\r\n                                <span className=\"text-[#1a237e] font-black text-xs\">ID</span>\r\n                            </div>\r\n                            <div className=\"text-left\">\r\n                                <span className=\"block text-[10px] uppercase tracking-widest text-blue-200 font-bold\">Recommended</span>\r\n                                <span className=\"block text-base font-bold leading-none\">เข้าสู่ระบบด้วย ThaID</span>\r\n                            </div>\r\n                            <Icons.ArrowRight className=\"w-5 h-5 opacity-50 group-hover:opacity-100 group-hover:translate-x-1 transition-all\" />\r\n                        </button>\r\n                        <div className=\"flex items-center gap-4 my-6\">\r\n                            <div className=\"flex-1 h-px bg-slate-200\"></div>\r\n                            <span className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">หรือเข้าสู่ระบบด้วยรหัสผ่าน</span>\r\n                            <div className=\"flex-1 h-px bg-slate-200\"></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Form Input Fields (Ecobi Roundness) */}\r\n                    <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"group\">\r\n                                <div className=\"relative transition-all duration-300 transform group-focus-within:-translate-y-1\">\r\n                                    <div className=\"absolute left-6 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-[#006837] transition-colors\">\r\n                                        <currentConfig.icon className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={identifier}\r\n                                        onChange={(e) => setIdentifier(formatThaiId(e.target.value))}\r\n                                        placeholder={currentConfig.idLabel}\r\n                                        maxLength={17}\r\n                                        className=\"w-full bg-slate-50 border-2 border-transparent focus:border-[#006837]/20 focus:bg-white hover:bg-slate-100 rounded-[2rem] py-4 pl-14 pr-6 text-slate-800 placeholder:text-slate-400 font-medium outline-none transition-all shadow-sm focus:shadow-md\"\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"group\">\r\n                                <div className=\"relative transition-all duration-300 transform group-focus-within:-translate-y-1\">\r\n                                    <div className=\"absolute left-6 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-[#006837] transition-colors\">\r\n                                        <IconLock className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <input\r\n                                        type={showPassword ? \"text\" : \"password\"}\r\n                                        value={password}\r\n                                        onChange={(e) => setPassword(e.target.value)}\r\n                                        placeholder=\"รหัสผ่าน\"\r\n                                        className=\"w-full bg-slate-50 border-2 border-transparent focus:border-[#006837]/20 focus:bg-white hover:bg-slate-100 rounded-[2rem] py-4 pl-14 pr-14 text-slate-800 placeholder:text-slate-400 font-medium outline-none transition-all shadow-sm focus:shadow-md\"\r\n                                        required\r\n                                    />\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setShowPassword(!showPassword)}\r\n                                        className=\"absolute right-5 top-1/2 -translate-y-1/2 text-slate-300 hover:text-[#006837] p-2 hover:bg-emerald-50 rounded-full transition-colors\"\r\n                                    >\r\n                                        <EyeIcon open={showPassword} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {error && (\r\n                            <div className=\"px-6 py-3 bg-red-50 border border-red-100 rounded-2xl flex items-center justify-center gap-2 text-red-600 animate-head-shake\">\r\n                                <Icons.Warning className=\"w-4 h-4\" />\r\n                                <span className=\"text-sm font-bold\">{error}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center justify-between px-4 pt-2\">\r\n                            <label className=\"flex items-center gap-2 cursor-pointer group select-none\">\r\n                                <div className=\"relative flex items-center\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"peer w-5 h-5 rounded-lg border-slate-300 text-[#006837] focus:ring-[#006837] cursor-pointer transition-all\"\r\n                                        checked={rememberMe}\r\n                                        onChange={(e) => setRememberMe(e.target.checked)}\r\n                                    />\r\n                                </div>\r\n                                <span className=\"text-sm text-slate-500 font-bold group-hover:text-[#006837] transition-colors\">จำรหัสผ่าน</span>\r\n                            </label>\r\n                            <Link href=\"/forgot-password\" className=\"text-sm font-bold text-[#006837] hover:text-[#004e32] hover:underline\">\r\n                                ลืมรหัสผ่าน?\r\n                            </Link>\r\n                        </div>\r\n\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={isLoading}\r\n                            className=\"w-full bg-[#006837] hover:bg-[#00522b] text-white text-lg font-bold py-4 rounded-full shadow-lg shadow-[#006837]/30 hover:shadow-xl hover:shadow-[#006837]/40 hover:-translate-y-1 active:translate-y-0 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none mt-4\"\r\n                        >\r\n                            {isLoading ? (\r\n                                <div className=\"w-6 h-6 border-3 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                            ) : (\r\n                                <>\r\n                                    เข้าสู่ระบบ\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </form>\r\n\r\n                    <div className=\"mt-8 text-center\">\r\n                        <p className=\"text-slate-400 text-sm mb-4 font-medium\">ยังไม่มีบัญชีสมาชิก?</p>\r\n                        <Link\r\n                            href=\"/register\"\r\n                            className=\"inline-block px-10 py-3 bg-white border-2 border-slate-100 hover:border-[#006837] text-slate-500 hover:text-[#006837] font-bold rounded-full transition-all hover:shadow-lg text-sm\"\r\n                        >\r\n                            ลงทะเบียนเกษตรกร\r\n                        </Link>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* Bottom Copyright */}\r\n                <div className=\"absolute bottom-6 text-center opacity-30\">\r\n                    <p className=\"text-[10px] text-slate-400 font-bold tracking-widest uppercase\">Official System by DTAM</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Success Overlay */}\r\n            {loginState === 'success' && (\r\n                <div className=\"fixed inset-0 bg-[#006837]/90 z-50 flex items-center justify-center animate-fade-in backdrop-blur-sm\">\r\n                    <div className=\"bg-white rounded-[2.5rem] p-12 flex flex-col items-center shadow-2xl animate-scale-in text-center max-w-sm mx-4\">\r\n                        <div className=\"w-24 h-24 bg-emerald-100 rounded-full flex items-center justify-center mb-6 text-[#006837] shadow-inner\">\r\n                            <Icons.CheckCircle className=\"w-12 h-12\" />\r\n                        </div>\r\n                        <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">ยินดีต้อนรับ</h3>\r\n                        <p className=\"text-slate-500 mb-6 font-medium\">เข้าสู่ระบบสำเร็จ<br />กำลังนำท่านไปยังหน้าหลัก...</p>\r\n                        <div className=\"w-full h-1.5 bg-slate-100 rounded-full overflow-hidden\">\r\n                            <div className=\"h-full bg-[#006837] animate-progress-bar rounded-full\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":124,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":21},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":148,"column":29,"nodeType":"JSXOpeningElement","endLine":148,"endColumn":131}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\register\\page.tsx:50:17\n  48 |                 const data = JSON.parse(savedData);\n  49 |                 // eslint-disable-next-line react-hooks/set-state-in-effect\n> 50 |                 setStep(data.step || 0);\n     |                 ^^^^^^^ Avoid calling setState() directly within an effect\n  51 |                 setAccountType(data.accountType || \"\");\n  52 |                 setIdentifier(data.identifier || \"\");\n  53 |                 setFirstName(data.firstName || \"\");","line":50,"column":17,"nodeType":null,"endLine":50,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { formatThaiId } from \"@/utils/thai-id-validator\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\nimport { Icons, PersonIcon, BuildingIcon, GroupIcon, EyeIcon } from \"@/components/ui/icons\";\r\nimport { useLanguage } from \"@/lib/i18n/LanguageContext\";\r\n\r\nconst ACCOUNT_TYPES = [\r\n    { type: \"INDIVIDUAL\", label: \"บุคคลธรรมดา\", subtitle: \"เกษตรกรรายยอด\", idLabel: \"เลขบัตรประชาชน 13 หลัก\", idHint: \"1-2345-67890-12-3\", icon: PersonIcon },\r\n    { type: \"JURISTIC\", label: \"นิติบุคคล\", subtitle: \"บริษัท / ห้างหุ้นส่วน\", idLabel: \"เลขทะเบียนนิติบุคคล 13 หลัก\", idHint: \"0-1055-12345-67-8\", icon: BuildingIcon },\r\n    { type: \"COMMUNITY_ENTERPRISE\", label: \"วิสาหกิจชุมชน\", subtitle: \"กลุ่มเกษตรกร\", idLabel: \"เลขทะเบียนวิสาหกิจชุมชน\", idHint: \"XXXX-XXXX-XXX\", icon: GroupIcon },\r\n];\r\n\r\nconst STEPS = [\"PDPA\", \"ACCOUNT\", \"IDENTITY\", \"PERSONAL\", \"SECURITY\"];\r\n\r\nexport default function RegisterPage() {\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n    const [step, setStep] = useState(0);\r\n    const [accountType, setAccountType] = useState(\"\");\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n\r\n    const [identifier, setIdentifier] = useState(\"\");\r\n    const [firstName, setFirstName] = useState(\"\");\r\n    const [lastName, setLastName] = useState(\"\");\r\n    const [companyName, setCompanyName] = useState(\"\");\r\n    const [representativeName, setRepresentativeName] = useState(\"\");\r\n    const [communityName, setCommunityName] = useState(\"\");\r\n    const [phone, setPhone] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n    const [acceptTerms, setAcceptTerms] = useState(false);\r\n    const [pdpaAccepted, setPdpaAccepted] = useState(false);\r\n    const [pdpaScrolled, setPdpaScrolled] = useState(false);\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n    const [email, setEmail] = useState(\"\");\r\n    const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});\r\n\r\n    useEffect(() => {\r\n        const savedData = localStorage.getItem(\"register_draft\");\r\n        if (savedData) {\r\n            try {\r\n                const data = JSON.parse(savedData);\r\n                // eslint-disable-next-line react-hooks/set-state-in-effect\r\n                setStep(data.step || 0);\r\n                setAccountType(data.accountType || \"\");\r\n                setIdentifier(data.identifier || \"\");\r\n                setFirstName(data.firstName || \"\");\r\n                setLastName(data.lastName || \"\");\r\n                setCompanyName(data.companyName || \"\");\r\n                setRepresentativeName(data.representativeName || \"\");\r\n                setCommunityName(data.communityName || \"\");\r\n                setPhone(data.phone || \"\");\r\n                setEmail(data.email || \"\");\r\n                setPdpaAccepted(data.pdpaAccepted || false);\r\n                setPdpaScrolled(data.pdpaScrolled || false);\r\n            } catch { }\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const data = { step, accountType, identifier, firstName, lastName, companyName, representativeName, communityName, phone, email, pdpaAccepted, pdpaScrolled };\r\n        localStorage.setItem(\"register_draft\", JSON.stringify(data));\r\n    }, [step, accountType, identifier, firstName, lastName, companyName, representativeName, communityName, phone, email, pdpaAccepted, pdpaScrolled]);\r\n\r\n    const validateField = (field: string, value: string) => {\r\n        const errors = { ...fieldErrors };\r\n        switch (field) {\r\n            case 'phone':\r\n                if (value.length > 0 && value.length < 10) errors.phone = `กรอกแล้ว ${value.length}/10 หลัก`;\r\n                else if (value.length === 10 && !/^0[689]\\d{8}$/.test(value)) errors.phone = \"เบอร์ต้องขึ้นต้นด้วย 06, 08, หรือ 09\";\r\n                else delete errors.phone;\r\n                break;\r\n            case 'confirmPassword':\r\n                if (value && value !== password) errors.confirmPassword = \"รหัสผ่านไม่ตรงกัน\";\r\n                else delete errors.confirmPassword;\r\n                break;\r\n        }\r\n        setFieldErrors(errors);\r\n    };\r\n\r\n    const currentConfig = ACCOUNT_TYPES.find((t) => t.type === accountType);\r\n\r\n    const canProceed = () => {\r\n        switch (step) {\r\n            case 0: return pdpaAccepted;\r\n            case 1: return accountType !== \"\";\r\n            case 2: return identifier.replace(/-/g, \"\").length >= 10;\r\n            case 3:\r\n                if (accountType === \"INDIVIDUAL\") return firstName && lastName && phone.length >= 10;\r\n                if (accountType === \"JURISTIC\") return companyName && representativeName && phone.length >= 10;\r\n                return communityName && representativeName && phone.length >= 10;\r\n            case 4: return password.length >= 8 && password === confirmPassword && acceptTerms;\r\n            default: return false;\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        setError(\"\");\r\n        setIsLoading(true);\r\n\r\n        const sanitize = (str: string) => str.trim().replace(/[<>'\"&]/g, \"\");\r\n        const cleanIdentifier = identifier.replace(/-/g, \"\").replace(/[<>'\"&]/g, \"\");\r\n        const cleanPhone = phone.replace(/[<>'\"&]/g, \"\");\r\n        const cleanPassword = password.trim();\r\n\r\n        const data: Record<string, string> = { accountType, identifier: cleanIdentifier, phoneNumber: cleanPhone, password: cleanPassword };\r\n        if (accountType === \"INDIVIDUAL\") { data.firstName = sanitize(firstName); data.lastName = sanitize(lastName); }\r\n        else if (accountType === \"JURISTIC\") { data.companyName = sanitize(companyName); data.representativeName = sanitize(representativeName); }\r\n        else { data.communityName = sanitize(communityName); data.representativeName = sanitize(representativeName); }\r\n\r\n        try {\r\n            const result = await AuthService.register(data);\r\n            if (!result.success) { setError(result.error || \"เกิดข้อผิดพลาดในการลงทะเบียน\"); setIsLoading(false); return; }\r\n\r\n            localStorage.removeItem(\"register_draft\");\r\n            const name = accountType === \"INDIVIDUAL\" ? `${firstName} ${lastName}` : accountType === \"JURISTIC\" ? companyName : communityName;\r\n            router.push(`/register/success?type=${accountType}&id=${encodeURIComponent(identifier)}&name=${encodeURIComponent(name)}`);\r\n        } catch (err) {\r\n            setError(\"ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์ได้\");\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen w-full flex flex-col lg:flex-row bg-white overflow-hidden font-sans\">\r\n\r\n            {/* LEFT PANEL (Marketing - Register Context) */}\r\n            <div className=\"hidden lg:flex lg:w-5/12 bg-[#006837] relative flex-col items-center justify-center overflow-hidden z-0 text-white p-12 text-center\">\r\n                {/* Background Effects */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-[#005c30] to-[#003820] opacity-100 z-0\"></div>\r\n                <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-[0.06] mix-blend-overlay bg-repeat bg-[length:300px] z-0\"></div>\r\n\r\n                {/* Decorative Glows */}\r\n                <div className=\"absolute top-[-20%] left-[-20%] w-[80%] h-[80%] bg-emerald-400/10 rounded-full blur-[100px] pointer-events-none\"></div>\r\n\r\n                {/* Content Container */}\r\n                <div className=\"relative z-10 flex flex-col items-center animate-fade-in-up w-full max-w-lg\">\r\n\r\n                    {/* Official Logo Container */}\r\n                    <div className=\"mb-10 relative cursor-default\">\r\n                        <div className=\"w-24 h-24 bg-white/10 backdrop-blur-md rounded-full p-4 flex items-center justify-center border border-white/20 shadow-xl\">\r\n                            <img src=\"/images/dtam-logo.png\" alt=\"MOPH\" className=\"w-full h-full object-contain drop-shadow-lg\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Headline */}\r\n                    <h1 className=\"text-4xl font-bold leading-tight drop-shadow-lg mb-4 tracking-tight\">\r\n                        ลงทะเบียนผู้ประกอบการ<br />\r\n                        <span className=\"text-emerald-300\">เข้าสู่ระบบ GACP</span>\r\n                    </h1>\r\n\r\n                    {/* Subheader */}\r\n                    <p className=\"text-emerald-50/90 text-base font-light leading-relaxed mb-10 max-w-sm mx-auto\">\r\n                        ร่วมเป็นส่วนหนึ่งในการยกระดับสมุนไพรไทย<br />\r\n                        เข้าถึงตลาดสากล ด้วยมาตรฐานที่ตรวจสอบได้\r\n                    </p>\r\n\r\n                    {/* Steps Indicator on Left Panel */}\r\n                    <div className=\"w-full max-w-xs space-y-4 text-left\">\r\n                        {STEPS.map((stepLabel, i) => (\r\n                            <div key={i} className={`flex items-center gap-4 transition-all duration-500 ${i === step ? 'opacity-100 scale-105' : i < step ? 'opacity-60' : 'opacity-30'}`}>\r\n                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold border ${i <= step ? 'bg-emerald-400 border-emerald-400 text-[#006837]' : 'border-white/30 text-white'}`}>\r\n                                    {i < step ? <Icons.CheckCircle className=\"w-5 h-5\" /> : i + 1}\r\n                                </div>\r\n                                <span className=\"font-bold tracking-wider text-sm\">{stepLabel}</span>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* Footer Credit */}\r\n                <div className=\"absolute bottom-8 text-emerald-200/40 text-[10px] uppercase tracking-[0.2em] font-medium\">\r\n                    Official Registration Portal\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT PANEL (Content) */}\r\n            <div className=\"flex-1 flex flex-col items-center justify-center p-6 lg:p-12 xl:p-16 bg-white relative z-10 overflow-auto\">\r\n                <div className=\"w-full max-w-[600px] animate-slide-up\">\r\n\r\n                    {/* Header Details */}\r\n                    <div className=\"flex items-center justify-between mb-8\">\r\n                        <div>\r\n                            <h2 className=\"text-3xl font-black text-slate-800 tracking-tight mb-1\">ลงทะเบียน</h2>\r\n                            <p className=\"text-slate-500 text-sm font-medium\">กรอกข้อมูลให้ครบถ้วนเพื่อสร้างบัญชี</p>\r\n                        </div>\r\n                        <span className=\"text-xs font-black text-[#006837] px-3 py-1 bg-[#006837]/10 rounded-full uppercase tracking-widest\">\r\n                            Step {step + 1} / {STEPS.length}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Progress Bar (Mobile Only) */}\r\n                    <div className=\"flex gap-2 mb-8 lg:hidden\">\r\n                        {STEPS.map((_, i) => (\r\n                            <div key={i} className=\"flex-1 overflow-hidden\">\r\n                                <div className={`h-1.5 rounded-full transition-all duration-500 ${i <= step ? 'bg-[#006837]' : 'bg-slate-100'}`} />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"mb-8 p-4 bg-rose-50 border border-rose-100 rounded-2xl text-rose-600 text-sm font-bold flex items-center gap-3\">\r\n                            <Icons.Warning className=\"w-5 h-5 flex-shrink-0\" />\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 0: PDPA */}\r\n                    {step === 0 && (\r\n                        <div className=\"animate-fade-in\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 mb-4\">นโยบายความเป็นส่วนตัว</h3>\r\n                            <div\r\n                                onScroll={(e) => {\r\n                                    const { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\r\n                                    if (scrollTop + clientHeight >= scrollHeight - 30) setPdpaScrolled(true);\r\n                                }}\r\n                                className=\"h-64 overflow-y-auto p-6 bg-slate-50 rounded-3xl mb-6 text-sm text-slate-500 leading-relaxed border border-slate-100\"\r\n                            >\r\n                                <p className=\"font-bold text-slate-700 mb-4 uppercase tracking-wider\">ข้อกำหนดและเงื่อนไขการใช้บริการ</p>\r\n                                <p className=\"mb-4\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก (DTAM) มีความจำเป็นต้องเก็บรวบรวมข้อมูลส่วนบุคคลของท่าน เพื่อใช้ในกระบวนการพิจารณารับรองมาตรฐาน GACP Thailand...</p>\r\n                                <div className=\"space-y-4\">\r\n                                    <div>\r\n                                        <h4 className=\"font-bold text-slate-700\">1. การจัดเก็บข้อมูล</h4>\r\n                                        <p>เราจัดเก็บข้อมูลชื่อ นามสกุล เลขบัตรประชาชน และพิกัดสถานประกอบการของท่าน...</p>\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 className=\"font-bold text-slate-700\">2. วัตถุประสงค์</h4>\r\n                                        <p>เพื่อระบุตัวตนและยืนยันสิทธิในการถือครองใบรับรองมาตรฐานเกษตรปลอดภัย...</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <label className={`\r\n                                flex items-start gap-4 p-6 rounded-3xl border-2 transition-all cursor-pointer\r\n                                ${pdpaAccepted ? 'bg-[#006837]/5 border-[#006837]' : 'bg-white border-slate-100 hover:border-slate-200'}\r\n                                ${!pdpaScrolled ? 'opacity-50 grayscale cursor-not-allowed' : ''}\r\n                            `}>\r\n                                <div className={`\r\n                                    w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all mt-0.5\r\n                                    ${pdpaAccepted ? 'bg-[#006837] border-[#006837]' : 'bg-white border-slate-200'}\r\n                                `}>\r\n                                    {pdpaAccepted && <Icons.CheckCircle className=\"w-4 h-4 text-white\" />}\r\n                                </div>\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    className=\"hidden\"\r\n                                    checked={pdpaAccepted}\r\n                                    disabled={!pdpaScrolled}\r\n                                    onChange={(e) => setPdpaAccepted(e.target.checked)}\r\n                                />\r\n                                <span className={`text-sm font-bold ${pdpaAccepted ? 'text-[#006837]' : 'text-slate-500'}`}>\r\n                                    {pdpaScrolled ? 'ฉันได้อ่านและยอมรับตามเงื่อนไขที่ระบุข้างต้น' : 'กรุณาเลื่อนอ่านข้อมูลให้จบเพื่อยอมรับเงื่อนไข'}\r\n                                </span>\r\n                            </label>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 1: Account Type */}\r\n                    {step === 1 && (\r\n                        <div className=\"animate-fade-in\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 mb-6\">เลือกประเภทบัญชีของคุณ</h3>\r\n                            <div className=\"space-y-4\">\r\n                                {ACCOUNT_TYPES.map((type) => {\r\n                                    const isSelected = accountType === type.type;\r\n                                    const Icon = type.icon;\r\n                                    return (\r\n                                        <button\r\n                                            key={type.type}\r\n                                            type=\"button\"\r\n                                            onClick={() => setAccountType(type.type)}\r\n                                            className={`\r\n                                                w-full flex items-center gap-6 p-6 rounded-3xl border-2 transition-all text-left\r\n                                                ${isSelected\r\n                                                    ? 'bg-[#006837] border-[#006837] text-white shadow-lg shadow-[#006837]/20'\r\n                                                    : 'bg-white border-slate-100 text-slate-400 hover:border-[#006837]/30'\r\n                                                }\r\n                                            `}\r\n                                        >\r\n                                            <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${isSelected ? 'bg-white/20' : 'bg-slate-50'}`}>\r\n                                                <Icon className=\"w-8 h-8\" color={isSelected ? 'white' : undefined} />\r\n                                            </div>\r\n                                            <div className=\"flex-1\">\r\n                                                <div className={`text-lg font-black uppercase tracking-tight ${isSelected ? 'text-white' : 'text-slate-800'}`}>{type.label}</div>\r\n                                                <div className={`text-xs font-bold ${isSelected ? 'text-emerald-100/70' : 'text-slate-400'}`}>{type.subtitle}</div>\r\n                                            </div>\r\n                                            {isSelected && <div className=\"w-6 h-6 bg-white rounded-full flex items-center justify-center\"><Icons.CheckCircle className=\"w-4 h-4 text-[#006837]\" /></div>}\r\n                                        </button>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 2: Identity */}\r\n                    {step === 2 && currentConfig && (\r\n                        <div className=\"animate-fade-in\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 mb-2\">ยืนยันตัวตน</h3>\r\n                            <p className=\"text-slate-500 text-sm mb-8 font-medium\">กรุณาระบุ{currentConfig.idLabel}</p>\r\n\r\n                            <div className=\"relative group mb-6\">\r\n                                <div className=\"absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-[#006837] transition-colors\">\r\n                                    <PersonIcon className=\"w-6 h-6\" />\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={identifier}\r\n                                    onChange={(e) => setIdentifier(formatThaiId(e.target.value))}\r\n                                    placeholder={currentConfig.idHint}\r\n                                    maxLength={17}\r\n                                    className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-[2rem] py-5 pl-14 pr-14 text-xl font-mono tracking-[0.1em] focus:bg-white focus:border-[#006837] outline-none transition-all placeholder:text-slate-200 text-slate-800\"\r\n                                />\r\n                                {identifier.replace(/-/g, '').length === 13 && (\r\n                                    <div className=\"absolute right-5 top-1/2 -translate-y-1/2 text-emerald-500 animate-scale-in\">\r\n                                        <Icons.CheckCircle className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"p-5 bg-[#006837]/5 rounded-3xl border border-[#006837]/10 flex items-start gap-3\">\r\n                                <div className=\"p-2 bg-[#006837]/10 rounded-xl text-[#006837] mt-0.5\"><Icons.Info className=\"w-4 h-4\" /></div>\r\n                                <p className=\"text-sm font-bold text-[#006837]/80 leading-snug\">หมายเลขประจำตัวนี้จะถูกใช้เป็นชื่อผู้ใช้งาน (Username) สำหรับเข้าสู่ระบบ และใช้ในการตรวจสอบสิทธิเบื้องต้น</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 3: Info */}\r\n                    {step === 3 && (\r\n                        <div className=\"animate-fade-in overflow-y-auto max-h-[500px] no-scrollbar px-1\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 mb-6\">{accountType === \"INDIVIDUAL\" ? \"ข้อมูลส่วนตัว\" : \"ข้อมูลสถานประกอบการ\"}</h3>\r\n                            <div className=\"space-y-6\">\r\n                                {accountType === \"INDIVIDUAL\" ? (\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">ชื่อ</label>\r\n                                            <input type=\"text\" value={firstName} onChange={(e) => setFirstName(e.target.value)} placeholder=\"สมชาย\" className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-3.5 px-5 focus:bg-white focus:border-[#006837] outline-none transition-all\" />\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">นามสกุล</label>\r\n                                            <input type=\"text\" value={lastName} onChange={(e) => setLastName(e.target.value)} placeholder=\"ใจดี\" className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-3.5 px-5 focus:bg-white focus:border-[#006837] outline-none transition-all\" />\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">{accountType === 'JURISTIC' ? 'ชื่อบริษัท' : 'ชื่อวิสาหกิจ'}</label>\r\n                                        <input type=\"text\" value={accountType === 'JURISTIC' ? companyName : communityName} onChange={(e) => accountType === 'JURISTIC' ? setCompanyName(e.target.value) : setCommunityName(e.target.value)} className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-3.5 px-5 focus:bg-white focus:border-[#006837] outline-none transition-all\" />\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">เบอร์โทรศัพท์ (10 หลัก)</label>\r\n                                    <input\r\n                                        type=\"tel\"\r\n                                        value={phone}\r\n                                        placeholder=\"08XXXXXXXX\"\r\n                                        onChange={(e) => { const val = e.target.value.replace(/\\D/g, \"\").slice(0, 10); setPhone(val); validateField('phone', val); }}\r\n                                        className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-3.5 px-5 font-mono text-lg focus:bg-white focus:border-[#006837] outline-none transition-all\"\r\n                                    />\r\n                                    {fieldErrors.phone && <p className=\"text-xs font-bold text-rose-500 px-1\">{fieldErrors.phone}</p>}\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">อีเมล (ถ้ามี)</label>\r\n                                    <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} placeholder=\"email@example.com\" className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-3.5 px-5 focus:bg-white focus:border-[#006837] outline-none transition-all\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 4: Security */}\r\n                    {step === 4 && (\r\n                        <div className=\"animate-fade-in\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 mb-6\">ตั้งรหัสผ่านที่ปลอดภัย</h3>\r\n                            <div className=\"space-y-6\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">กำหนดรหัสผ่านใหม่</label>\r\n                                    <div className=\"relative group\">\r\n                                        <input\r\n                                            type={showPassword ? \"text\" : \"password\"}\r\n                                            value={password} onChange={(e) => setPassword(e.target.value)}\r\n                                            placeholder=\"••••••••\"\r\n                                            className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-[2rem] py-4 px-6 focus:bg-white focus:border-[#006837] outline-none transition-all\"\r\n                                        />\r\n                                        <button type=\"button\" onClick={() => setShowPassword(!showPassword)} className=\"absolute right-5 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#006837] transition-colors\">\r\n                                            <EyeIcon open={showPassword} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-black uppercase text-slate-400 tracking-widest px-1\">ยืนยันรหัสผ่าน</label>\r\n                                    <div className=\"relative group\">\r\n                                        <input\r\n                                            type={showConfirmPassword ? \"text\" : \"password\"}\r\n                                            value={confirmPassword}\r\n                                            onChange={(e) => { setConfirmPassword(e.target.value); validateField('confirmPassword', e.target.value); }}\r\n                                            placeholder=\"••••••••\"\r\n                                            className={`w-full bg-slate-50 border-2 rounded-[2rem] py-4 px-6 focus:bg-white focus:border-[#006837] outline-none transition-all ${confirmPassword ? (password === confirmPassword ? 'border-emerald-500' : 'border-rose-500') : 'border-slate-50'}`}\r\n                                        />\r\n                                        <button type=\"button\" onClick={() => setShowConfirmPassword(!showConfirmPassword)} className=\"absolute right-5 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#006837] transition-colors\">\r\n                                            <EyeIcon open={showConfirmPassword} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <label className=\"flex items-center gap-4 p-6 rounded-3xl border-2 border-[#006837]/5 bg-[#006837]/5 cursor-pointer group hover:bg-[#006837]/10 transition-all\">\r\n                                    <div className={`\r\n                                        w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all mt-0.5\r\n                                        ${acceptTerms ? 'bg-[#006837] border-[#006837]' : 'bg-white border-[#006837]/20 group-hover:border-[#006837]/40'}\r\n                                    `}>\r\n                                        {acceptTerms && <Icons.CheckCircle className=\"w-4 h-4 text-white\" />}\r\n                                    </div>\r\n                                    <input type=\"checkbox\" className=\"hidden\" checked={acceptTerms} onChange={(e) => setAcceptTerms(e.target.checked)} />\r\n                                    <span className=\"text-sm font-bold text-[#006837]/80\">ข้าพเจ้ายอมรับเงื่อนไขการใช้งานและนโยบายความเป็นส่วนตัว</span>\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Navigation Buttons */}\r\n                    <div className=\"flex gap-4 mt-12 w-full\">\r\n                        {step > 0 && (\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setStep(step - 1)}\r\n                                className=\"flex-1 py-5 rounded-full border-2 border-slate-100 font-black text-slate-400 uppercase tracking-widest hover:bg-slate-50 transition-all\"\r\n                            >\r\n                                {dict?.common?.back || 'ย้อนกลับ'}\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => step < 4 ? setStep(step + 1) : handleSubmit()}\r\n                            disabled={!canProceed() || isLoading}\r\n                            className=\"flex-[2] bg-[#006837] text-white hover:bg-[#00502b] shadow-lg shadow-[#006837]/30 py-5 rounded-full font-black text-lg tracking-tight flex items-center justify-center gap-2 transition-all\"\r\n                        >\r\n                            {isLoading ? (\r\n                                <div className=\"w-6 h-6 border-3 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                            ) : (\r\n                                <>\r\n                                    {step < 4 ? 'ดำเนินการต่อ' : 'ยืนยันลงทะเบียน'}\r\n                                    <Icons.ArrowRight className=\"w-6 h-6 ml-2\" />\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n\r\n                    {step === 0 && (\r\n                        <div className=\"mt-8 pt-8 border-t border-slate-50 text-center\">\r\n                            <p className=\"text-slate-400 text-sm font-medium mb-4\">มีบัญชีผู้ใช้งานอยู่แล้ว?</p>\r\n                            <Link href=\"/login\" className=\"text-[#006837] font-black hover:underline uppercase tracking-widest text-xs\">เข้าสู่ระบบที่นี่</Link>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\register\\success\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\register\\success\\page.tsx:17:21\n  15 |\n  16 |     // eslint-disable-next-line react-hooks/set-state-in-effect\n> 17 |     useEffect(() => setMounted(true), []);\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |\n  19 |     const getAccountTypeThai = () => {\n  20 |         switch (accountType) {","line":17,"column":21,"nodeType":null,"endLine":17,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\(auth)\\verify-identity\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GroupIcon' is defined but never used.","line":6,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'retryCount' is assigned a value but never used.","line":20,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4112,4115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4112,4115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/lib/services/auth-provider';\r\nimport { Icons, PersonIcon, BuildingIcon, GroupIcon } from '@/components/ui/icons';\r\n\r\nexport default function VerifyIdentityPage() {\r\n    const { user, isAuthenticated, isLoading, updateUser } = useAuth();\r\n    const router = useRouter();\r\n\r\n    // Form State\r\n    const [laserCode, setLaserCode] = useState('');\r\n    const [taxId, setTaxId] = useState('');\r\n    const [idCardFile, setIdCardFile] = useState<File | null>(null);\r\n    const [companyCertFile, setCompanyCertFile] = useState<File | null>(null);\r\n\r\n    // Status State\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [retryCount, setRetryCount] = useState(0);\r\n    const [canManual, setCanManual] = useState(false);\r\n    const [isManualRequest, setManualRequest] = useState(false);\r\n    const [isLocked, setIsLocked] = useState(false);\r\n\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [success, setSuccess] = useState(false);\r\n\r\n    const [aiResult, setAiResult] = useState<{ confidence: number; message: string; extractedSnippet: string } | null>(null);\r\n\r\n    // Redirect if not logged in OR if already verified\r\n    useEffect(() => {\r\n        if (!isLoading) {\r\n            if (!isAuthenticated) {\r\n                router.push('/login');\r\n            } else if (user?.verificationStatus === 'APPROVED') {\r\n                router.push('/farmer/dashboard');\r\n            }\r\n        }\r\n    }, [isLoading, isAuthenticated, user, router]);\r\n\r\n    const isJuristic = user?.role === 'JURISTIC_FARMER' || user?.role === 'ENTREPRENEUR';\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>, type: 'id' | 'company') => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const file = e.target.files[0];\r\n            if (file.size > 10 * 1024 * 1024) {\r\n                setError('ขนาดไฟล์ต้องไม่เกิน 10MB');\r\n                return;\r\n            }\r\n            if (type === 'id') setIdCardFile(file);\r\n            else setCompanyCertFile(file);\r\n            setError(null);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setError(null);\r\n        setIsSubmitting(true);\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            if (laserCode) formData.append('laserCode', laserCode);\r\n            if (taxId) formData.append('taxId', taxId);\r\n            if (idCardFile) formData.append('idCardImage', idCardFile);\r\n            if (companyCertFile) formData.append('companyCertImage', companyCertFile);\r\n\r\n            if (isManualRequest) formData.append('forceManual', 'true');\r\n\r\n            if (!idCardFile && !companyCertFile) {\r\n                throw new Error('กรุณาอัปโหลดเอกสารยืนยันตัวตน');\r\n            }\r\n\r\n            const token = localStorage.getItem('accessToken');\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/identity/verify`, {\r\n                method: 'POST',\r\n                headers: { 'Authorization': `Bearer ${token}` },\r\n                body: formData\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (data.aiAnalysis) setAiResult(data.aiAnalysis);\r\n\r\n            if (res.ok) {\r\n                setSuccess(true);\r\n                if (user) {\r\n                    updateUser({\r\n                        ...user,\r\n                        verificationStatus: data.status === 'APPROVED' ? 'APPROVED' : 'PENDING',\r\n                        verificationSubmittedAt: new Date().toISOString()\r\n                    });\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (!data.success) {\r\n                if (data.attempts !== undefined) setRetryCount(data.attempts);\r\n                if (data.canManual) setCanManual(true);\r\n                if (data.isLocked) setIsLocked(true);\r\n                throw new Error(data.error || 'การยืนยันตัวตนล้มเหลว');\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || 'เกิดข้อผิดพลาดในการส่งข้อมูล');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n            setManualRequest(false);\r\n        }\r\n    };\r\n\r\n    if (isLoading) return (\r\n        <div className=\"auth-card flex flex-col items-center justify-center py-20\">\r\n            <div className=\"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin mb-4\"></div>\r\n            <p className=\"text-slate-400 font-bold uppercase tracking-widest text-xs\">Loading Security Context...</p>\r\n        </div>\r\n    );\r\n\r\n    // View: Pending Review\r\n    if (user?.verificationStatus === 'PENDING' || success) {\r\n        return (\r\n            <div className=\"auth-card animate-scale-in text-center\">\r\n                <div className=\"relative mb-10 inline-block\">\r\n                    <div className=\"absolute inset-0 bg-amber-400/20 rounded-full blur-2xl animate-pulse scale-150\"></div>\r\n                    <div className=\"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center relative z-10 shadow-premium\">\r\n                        <Icons.Clock className=\"w-12 h-12 text-white\" />\r\n                    </div>\r\n                </div>\r\n                <h2 className=\"text-3xl font-black text-slate-800 mb-2\">กำลังรอการตรวจสอบ</h2>\r\n                <p className=\"text-slate-500 font-medium mb-10\">ระบบได้รับเอกสารของท่านแล้ว และกำลังอยู่ในระหว่างการยืนยันความถูกต้อง</p>\r\n\r\n                <div className=\"bg-slate-50 border border-slate-100 rounded-[2rem] p-8 text-left mb-10 shadow-inner\">\r\n                    <div className=\"flex flex-col gap-4\">\r\n                        <div className=\"flex justify-between items-center border-b border-slate-200/50 pb-4\">\r\n                            <span className=\"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400\">Submission Date</span>\r\n                            <span className=\"text-sm font-black text-slate-700\">\r\n                                {new Date(user?.verificationSubmittedAt || new Date()).toLocaleDateString('th-TH', {\r\n                                    year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'\r\n                                })}\r\n                            </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <span className=\"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400\">Estimate Time</span>\r\n                            <span className=\"text-sm font-black text-primary\">1-2 วันทำการ</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-6 bg-primary/5 rounded-3xl border border-primary/10 mb-10 text-left flex gap-4\">\r\n                    <Icons.Info className=\"w-6 h-6 text-primary flex-shrink-0 mt-1\" />\r\n                    <p className=\"text-sm font-bold text-primary/80 leading-relaxed\">\r\n                        ระหว่างรอการตรวจสอบ ท่านยังสามารถสำรวจเมนูต่างๆ และเตรียมข้อมูลเบื้องต้นสำหรับเริ่มขอรับรองมาตรฐานได้\r\n                    </p>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => router.push('/farmer/dashboard')}\r\n                    className=\"gacp-btn-primary w-full py-5 rounded-2.5xl text-lg font-black\"\r\n                >\r\n                    เข้าสู่หน้าแดชบอร์ด\r\n                    <Icons.ArrowRight className=\"w-6 h-6 ml-2\" />\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const isRejected = user?.verificationStatus === 'REJECTED';\r\n\r\n    return (\r\n        <div className=\"auth-card animate-slide-up max-h-[85vh] overflow-y-auto no-scrollbar\">\r\n            <div className=\"mb-8\">\r\n                <h2 className=\"text-3xl font-black text-slate-800 leading-tight\">ยืนยันตัวตน (e-KYC)</h2>\r\n                <p className=\"text-slate-500 font-medium mt-2\">เพื่อความปลอดภัยและมาตรฐาน GACP โปรดยืนยันตัวตนเพื่อเริ่มใช้งานระบบอย่างเต็มรูปแบบ</p>\r\n            </div>\r\n\r\n            {isRejected && (\r\n                <div className=\"mb-8 p-6 bg-rose-50 border border-rose-100 rounded-3xl text-rose-600 animate-head-shake\">\r\n                    <div className=\"flex gap-4\">\r\n                        <Icons.Warning className=\"w-6 h-6 flex-shrink-0 mt-1\" />\r\n                        <div>\r\n                            <h4 className=\"font-black uppercase tracking-wider text-sm mb-1\">การยืนยันตัวตนไม่ผ่าน</h4>\r\n                            <p className=\"text-sm font-bold opacity-80\">{user?.verificationNote || 'เอกสารไม่ชัดเจนหรือไม่ถูกต้อง กรุณาอัปโหลดเอกสารใหม่อีกครั้ง'}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-8 pb-4\">\r\n                {/* Section 1: Data */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"w-8 h-8 bg-primary/10 rounded-xl flex items-center justify-center text-primary\">\r\n                            {isJuristic ? <BuildingIcon className=\"w-5 h-5\" /> : <PersonIcon className=\"w-5 h-5\" />}\r\n                        </div>\r\n                        <h3 className=\"text-lg font-black text-slate-700 tracking-tight\">{isJuristic ? 'ข้อมูลนิติบุคคล' : 'ข้อมูลรหัสหลังบัตร'}</h3>\r\n                    </div>\r\n\r\n                    {isJuristic ? (\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-black uppercase tracking-widest text-slate-400 px-1\">เลขประจำตัวผู้เสียภาษี</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={taxId}\r\n                                onChange={e => setTaxId(e.target.value)}\r\n                                className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-4 px-6 focus:bg-white focus:border-primary outline-none transition-all font-mono\"\r\n                                placeholder=\"01055XXXXXXXX\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-black uppercase tracking-widest text-slate-400 px-1\">Laser Code (รหัสหลังบัตร)</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={laserCode}\r\n                                onChange={e => setLaserCode(e.target.value)}\r\n                                className=\"w-full bg-slate-50 border-2 border-slate-50 rounded-2xl py-4 px-6 focus:bg-white focus:border-primary outline-none transition-all font-mono uppercase tracking-widest\"\r\n                                placeholder=\"ME0-1234567-89\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Section 2: Uploads */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"w-8 h-8 bg-primary/10 rounded-xl flex items-center justify-center text-primary\">\r\n                            <Icons.Document className=\"w-5 h-5\" />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-black text-slate-700 tracking-tight\">อัปโหลดเอกสาร</h3>\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-4\">\r\n                        {/* File Area */}\r\n                        <label className={`\r\n                            relative h-44 rounded-3xl border-2 border-dashed transition-all cursor-pointer flex flex-col items-center justify-center overflow-hidden\r\n                            ${idCardFile ? 'border-primary bg-primary/5' : 'border-slate-200 bg-slate-50/50 hover:border-primary/40 hover:bg-slate-100'}\r\n                         `}>\r\n                            {idCardFile ? (\r\n                                <div className=\"text-center animate-scale-in p-4\">\r\n                                    <div className=\"w-16 h-16 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg shadow-primary/20\">\r\n                                        <Icons.CheckCircle className=\"w-8 h-8 text-white\" />\r\n                                    </div>\r\n                                    <p className=\"text-sm font-black text-primary truncate max-w-[200px]\">{idCardFile.name}</p>\r\n                                    <p className=\"text-[10px] font-bold text-slate-400 mt-1\">ไฟล์ได้รับการเลือกแล้ว คลิกเพื่อเปลี่ยน</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center\">\r\n                                    <Icons.Upload className=\"w-10 h-10 text-slate-300 mx-auto mb-3\" />\r\n                                    <p className=\"text-sm font-black text-slate-500\">{isJuristic ? 'สำเนาบัตรประชาชนกรรมการ' : 'รูปถ่ายหน้าบัตรประชาชน'}</p>\r\n                                    <p className=\"text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest\">Supports JPG, PNG (Max 10MB)</p>\r\n                                </div>\r\n                            )}\r\n                            <input type=\"file\" className=\"hidden\" onChange={e => handleFileChange(e, 'id')} accept=\"image/*,.pdf\" />\r\n                        </label>\r\n\r\n                        {isJuristic && (\r\n                            <label className={`\r\n                                relative h-44 rounded-3xl border-2 border-dashed transition-all cursor-pointer flex flex-col items-center justify-center overflow-hidden\r\n                                ${companyCertFile ? 'border-primary bg-primary/5' : 'border-slate-200 bg-slate-50/50 hover:border-primary/40 hover:bg-slate-100'}\r\n                             `}>\r\n                                {companyCertFile ? (\r\n                                    <div className=\"text-center animate-scale-in p-4\">\r\n                                        <div className=\"w-16 h-16 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg shadow-primary/20\">\r\n                                            <Icons.CheckCircle className=\"w-8 h-8 text-white\" />\r\n                                        </div>\r\n                                        <p className=\"text-sm font-black text-primary truncate max-w-[200px]\">{companyCertFile.name}</p>\r\n                                        <p className=\"text-[10px] font-bold text-slate-400 mt-1\">ไฟล์ได้รับการเลือกแล้ว คลิกเพื่อเปลี่ยน</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center\">\r\n                                        <Icons.Upload className=\"w-10 h-10 text-slate-300 mx-auto mb-3\" />\r\n                                        <p className=\"text-sm font-black text-slate-500\">หนังสือรับรองบริษัท</p>\r\n                                        <p className=\"text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest\">Registration Document (Max 10MB)</p>\r\n                                    </div>\r\n                                )}\r\n                                <input type=\"file\" className=\"hidden\" onChange={e => handleFileChange(e, 'company')} accept=\"image/*,.pdf\" />\r\n                            </label>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* AI & Errors */}\r\n                {error && (\r\n                    <div className=\"p-4 bg-rose-50 border border-rose-100 rounded-2xl text-rose-600 text-sm font-bold flex flex-col gap-3\">\r\n                        <div className=\"flex gap-3\">\r\n                            <Icons.Warning className=\"w-5 h-5 flex-shrink-0\" />\r\n                            {error}\r\n                        </div>\r\n                        {canManual && !isLocked && (\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => {\r\n                                    setManualRequest(true);\r\n                                    setTimeout(() => {\r\n                                        const form = document.getElementById('verify-form') as HTMLFormElement;\r\n                                        if (form) form.requestSubmit();\r\n                                    }, 100);\r\n                                }}\r\n                                className=\"w-full py-3 bg-white border border-rose-200 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-rose-100 transition-all\"\r\n                            >\r\n                                ส่งให้เจ้าหน้าที่ตรวจสอบ (Manual Review)\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {aiResult && !success && (\r\n                    <div className=\"p-5 bg-indigo-50 border border-indigo-100 rounded-3xl animate-fade-in\">\r\n                        <h4 className=\"text-xs font-black uppercase tracking-widest text-indigo-400 mb-2 flex items-center gap-2\">\r\n                            <Icons.Search className=\"w-4 h-4\" />\r\n                            AI Analysis Engine\r\n                        </h4>\r\n                        <p className=\"text-sm font-bold text-indigo-700 leading-snug\">{aiResult.message}</p>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"pt-4\">\r\n                    {isLocked ? (\r\n                        <div className=\"w-full bg-slate-100 border border-slate-200 text-slate-400 py-5 rounded-3xl text-center font-black uppercase tracking-widest text-sm\">\r\n                            Account Temporarily Locked\r\n                        </div>\r\n                    ) : (\r\n                        <button\r\n                            type=\"submit\"\r\n                            id=\"verify-form-btn\"\r\n                            disabled={isSubmitting}\r\n                            className=\"w-full gacp-btn-primary py-5 rounded-3xl text-lg font-black tracking-tight\"\r\n                        >\r\n                            {isSubmitting ? (\r\n                                <div className=\"w-6 h-6 border-3 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                            ) : (\r\n                                <>\r\n                                    ยืนยันและส่งตรวจสอบ\r\n                                    <Icons.ArrowRight className=\"w-6 h-6 ml-2\" />\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\[...path]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2422,2425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2422,2425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { cookies } from 'next/headers';\r\n\r\n// Production Server - Always use this\r\n// Production Server - Always use this (Dev Override)\r\nconst BACKEND_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';\r\n\r\n/**\r\n * Generic API Proxy for all /api/* endpoints (excluding /api/v2, /api/auth-*, /api/health, /api/proxy)\r\n * Forwards requests to backend with auth_token from httpOnly cookie\r\n */\r\nasync function proxyRequest(request: NextRequest, path: string, method: string) {\r\n    try {\r\n        const cookieStore = await cookies();\r\n        const authToken = cookieStore.get('auth_token')?.value;\r\n\r\n        // Start with empty headers\r\n        const headers: Record<string, string> = {};\r\n\r\n        // 1. Copy Content-Type (Essential for multipart/form-data boundaries)\r\n        const contentType = request.headers.get('content-type');\r\n        if (contentType) {\r\n            headers['Content-Type'] = contentType;\r\n        }\r\n\r\n        // 2. Add Authorization header\r\n        if (authToken) {\r\n            headers['Authorization'] = `Bearer ${authToken}`;\r\n        }\r\n\r\n        // 3. Forward test headers if needed\r\n        const testUserId = request.headers.get('X-User-ID');\r\n        if (testUserId && !authToken) {\r\n            headers['X-User-ID'] = testUserId;\r\n        }\r\n\r\n        // Build the full backend URL\r\n        const backendUrl = `${BACKEND_URL}/api/${path}`;\r\n\r\n        console.log(`[API Proxy] ${method} ${backendUrl}`);\r\n\r\n        // 4. Forward Body as Stream (don't parse JSON)\r\n        // For GET/HEAD, body must be undefined/null\r\n        const body = (method === 'GET' || method === 'HEAD') ? undefined : request.body;\r\n\r\n        const response = await fetch(backendUrl, {\r\n            method,\r\n            headers,\r\n            body,\r\n            // @ts-expect-error - Required for Node.js fetch with ReadableStream body\r\n            duplex: 'half'\r\n        });\r\n\r\n        // 5. Return Response\r\n        // Use blob() to handle both JSON and Binary responses correctly\r\n        const responseBody = await response.blob();\r\n\r\n        return new NextResponse(responseBody, {\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            headers: {\r\n                'Content-Type': response.headers.get('Content-Type') || 'application/json'\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('[API Proxy] Error:', error);\r\n        return NextResponse.json(\r\n            { success: false, error: 'Proxy Error: ' + (error.message || 'Unknown') },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    const { path } = await params;\r\n    return proxyRequest(request, path.join('/'), 'GET');\r\n}\r\n\r\nexport async function POST(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    const { path } = await params;\r\n    return proxyRequest(request, path.join('/'), 'POST');\r\n}\r\n\r\nexport async function PUT(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    const { path } = await params;\r\n    return proxyRequest(request, path.join('/'), 'PUT');\r\n}\r\n\r\nexport async function DELETE(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    const { path } = await params;\r\n    return proxyRequest(request, path.join('/'), 'DELETE');\r\n}\r\n\r\nexport async function PATCH(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    const { path } = await params;\r\n    return proxyRequest(request, path.join('/'), 'PATCH');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth-dtam\\[...path]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth-farmer\\[...path]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\2fa\\disable\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":4,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/api/auth/2fa/disable/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    // TODO: Implement actual 2FA disable logic\r\n    // 1. Verify user authentication\r\n    // 2. Disable 2FA in database\r\n    // 3. Log the change for audit trail\r\n    // 4. Optionally require password confirmation\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      message: '2FA disabled successfully'\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('2FA disable error:', error);\r\n    return NextResponse.json({ \r\n      error: '2FA disable failed' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\2fa\\setup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":9,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/api/auth/2fa/setup/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport speakeasy from 'speakeasy';\r\nimport QRCode from 'qrcode';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    // TODO: Get user ID from authentication context\r\n    // For now, we'll use a mock user ID\r\n    const userId = 'mock-user-id';\r\n\r\n    // Generate TOTP secret\r\n    const secret = speakeasy.generateSecret({\r\n      name: `GACP Platform (${userId})`,\r\n      issuer: 'GACP Platform',\r\n      length: 32\r\n    });\r\n\r\n    // Generate QR code\r\n    const qrCodeUrl = await QRCode.toDataURL(secret.otpauth_url!);\r\n\r\n    // Generate backup codes\r\n    const backupCodes = Array.from({ length: 10 }, () => \r\n      Math.random().toString(36).substring(2, 10).toUpperCase()\r\n    );\r\n\r\n    // Store secret and backup codes in database (not yet enabled)\r\n    await prisma.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        twoFactorSecret: secret.base32,\r\n        twoFactorBackupCodes: backupCodes,\r\n        twoFactorEnabled: false // Will be enabled after verification\r\n      }\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      qrCode: qrCodeUrl,\r\n      backupCodes: backupCodes,\r\n      secret: secret.base32\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('2FA setup error:', error);\r\n    return NextResponse.json({ \r\n      error: '2FA setup failed' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\2fa\\verify\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\change-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\health\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/api/auth/health/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Test backend connection\r\n    const BACKEND_URL = process.env.BACKEND_URL || 'http://127.0.0.1:3000';\r\n\r\n    const response = await fetch(`${BACKEND_URL}/health`, {\r\n      method: 'GET',\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      frontend: 'healthy',\r\n      backend: data,\r\n      timestamp: new Date().toISOString(),\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Health check error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      frontend: 'healthy',\r\n      backend: 'unreachable',\r\n      error: (error as Error).message,\r\n      timestamp: new Date().toISOString(),\r\n    }, { status: 503 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":55,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/api/auth/notifications/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const settings = await request.json();\r\n    \r\n    // Validate input\r\n    const validKeys = ['email', 'sms', 'push', 'applicationStatus', 'paymentReminder', 'systemUpdates', 'marketingEmails'];\r\n    for (const key of validKeys) {\r\n      if (typeof settings[key] !== 'boolean') {\r\n        return NextResponse.json({ \r\n          error: `Invalid value for ${key}: must be boolean` \r\n        }, { status: 400 });\r\n      }\r\n    }\r\n\r\n    // TODO: Get user ID from authentication context\r\n    // For now, we'll use a mock user ID\r\n    const userId = 'mock-user-id';\r\n\r\n    // Update user notification settings in database\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        notificationSettings: {\r\n          email: settings.email,\r\n          sms: settings.sms,\r\n          push: settings.push,\r\n          applicationStatus: settings.applicationStatus,\r\n          paymentReminder: settings.paymentReminder,\r\n          systemUpdates: settings.systemUpdates,\r\n          marketingEmails: settings.marketingEmails,\r\n        }\r\n      }\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Notification settings updated successfully',\r\n      settings: updatedUser.notificationSettings\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Notification settings update error:', error);\r\n    return NextResponse.json({ \r\n      error: 'Failed to update notification settings' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // TODO: Get user ID from authentication context\r\n    // For now, we'll use a mock user ID\r\n    const userId = 'mock-user-id';\r\n\r\n    // Get user notification settings from database\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: { notificationSettings: true }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ \r\n        error: 'User not found' \r\n      }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      settings: user.notificationSettings || {\r\n        email: true,\r\n        sms: false,\r\n        push: true,\r\n        applicationStatus: true,\r\n        paymentReminder: true,\r\n        systemUpdates: false,\r\n        marketingEmails: false,\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Notification settings fetch error:', error);\r\n    return NextResponse.json({ \r\n      error: 'Failed to fetch notification settings' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\privacy\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":60,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/api/auth/privacy/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const settings = await request.json();\r\n    \r\n    // Validate input\r\n    const validKeys = ['profileVisibility', 'dataSharing', 'marketingCommunications', 'activityVisibility', 'locationSharing', 'analyticsTracking'];\r\n    for (const key of validKeys) {\r\n      if (key === 'profileVisibility') {\r\n        if (!['public', 'private', 'connections'].includes(settings[key])) {\r\n          return NextResponse.json({ \r\n            error: `Invalid value for ${key}: must be public, private, or connections` \r\n          }, { status: 400 });\r\n        }\r\n      } else if (typeof settings[key] !== 'boolean') {\r\n        return NextResponse.json({ \r\n          error: `Invalid value for ${key}: must be boolean` \r\n        }, { status: 400 });\r\n      }\r\n    }\r\n\r\n    // TODO: Get user ID from authentication context\r\n    // For now, we'll use a mock user ID\r\n    const userId = 'mock-user-id';\r\n\r\n    // Update user privacy settings in database\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        privacySettings: {\r\n          profileVisibility: settings.profileVisibility,\r\n          dataSharing: settings.dataSharing,\r\n          marketingCommunications: settings.marketingCommunications,\r\n          activityVisibility: settings.activityVisibility,\r\n          locationSharing: settings.locationSharing,\r\n          analyticsTracking: settings.analyticsTracking,\r\n        }\r\n      }\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Privacy settings updated successfully',\r\n      settings: updatedUser.privacySettings\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Privacy settings update error:', error);\r\n    return NextResponse.json({ \r\n      error: 'Failed to update privacy settings' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // TODO: Get user ID from authentication context\r\n    // For now, we'll use a mock user ID\r\n    const userId = 'mock-user-id';\r\n\r\n    // Get user privacy settings from database\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: { privacySettings: true }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ \r\n        error: 'User not found' \r\n      }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      settings: user.privacySettings || {\r\n        profileVisibility: 'public',\r\n        dataSharing: false,\r\n        marketingCommunications: false,\r\n        activityVisibility: true,\r\n        locationSharing: false,\r\n        analyticsTracking: true,\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Privacy settings fetch error:', error);\r\n    return NextResponse.json({ \r\n      error: 'Failed to fetch privacy settings' \r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\auth\\profile\\image\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\health\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\api\\proxy\\[...path]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\auth\\callback\\thaid\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'state' is assigned a value but never used.","line":16,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2197,2200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2197,2200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { AuthService } from '@/lib/services/auth-service';\r\n\r\nexport default function ThaIDCallbackPage() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const [status, setStatus] = useState('กำลังยืนยันตัวตนกับกรมการปกครอง...');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const handleCallback = async () => {\r\n            const code = searchParams.get('code');\r\n            const state = searchParams.get('state');\r\n\r\n            if (!code) {\r\n                setError('ไม่พบรหัสยืนยันตัวตน (Authorization Code)');\r\n                return;\r\n            }\r\n\r\n            try {\r\n                setStatus('กำลังเชื่อมต่อฐานข้อมูลประชากร...');\r\n\r\n                // Call Backend API directly to exchange code\r\n                const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api'}/auth-farmer/thaid-callback`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        code,\r\n                        redirectUri: window.location.origin + '/auth/callback/thaid'\r\n                    })\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    const errData = await response.json();\r\n                    throw new Error(errData.error || 'Identity Verification Failed');\r\n                }\r\n\r\n                const data = await response.json();\r\n\r\n                if (data.success && data.token) {\r\n                    setStatus('ยืนยันตัวตนสำเร็จ! กำลังเข้าสู่ระบบ...');\r\n                    // Manually save session\r\n                    AuthService.saveSession(data);\r\n\r\n                    // Delay slightly for UX\r\n                    setTimeout(() => {\r\n                        window.location.href = '/farmer/dashboard';\r\n                    }, 1000);\r\n                } else {\r\n                    throw new Error('Invalid Response from Server');\r\n                }\r\n\r\n            } catch (err: any) {\r\n                console.error('ThaID Login Error:', err);\r\n                setError(err.message || 'การเชื่อมต่อล้มเหลว');\r\n            }\r\n        };\r\n\r\n        handleCallback();\r\n    }, [searchParams, router]);\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-slate-50 p-4\">\r\n                <div className=\"bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center border border-red-100\">\r\n                    <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                        <svg className=\"w-10 h-10 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                        </svg>\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-bold text-slate-800 mb-2\">การยืนยันตัวตนล้มเหลว</h1>\r\n                    <p className=\"text-slate-500 mb-8\">{error}</p>\r\n                    <button\r\n                        onClick={() => router.push('/login')}\r\n                        className=\"w-full bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-900\"\r\n                    >\r\n                        กลับไปหน้าเข้าสู่ระบบ\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#1a237e] text-white p-4 relative overflow-hidden\">\r\n            {/* Decorative BG */}\r\n            <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-10\"></div>\r\n\r\n            <div className=\"relative z-10 text-center max-w-md\">\r\n                <div className=\"w-24 h-24 bg-white/10 backdrop-blur-md rounded-3xl flex items-center justify-center mx-auto mb-8 border border-white/20 shadow-2xl animate-bounce\">\r\n                    <span className=\"text-4xl\">🇹🇭</span>\r\n                </div>\r\n\r\n                <h1 className=\"text-3xl font-bold mb-4\">ThaID Digital ID</h1>\r\n                <p className=\"text-blue-200 text-lg mb-8 animate-pulse\">{status}</p>\r\n\r\n                <div className=\"w-full bg-white/20 rounded-full h-1.5 overflow-hidden\">\r\n                    <div className=\"h-full bg-white animate-progress-bar w-1/2\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadApplication' and 'router'. Either include them or remove the dependency array.","line":34,"column":213,"nodeType":"ArrayExpression","endLine":34,"endColumn":217,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadApplication, router]","fix":{"range":[2255,2259],"text":"[id, loadApplication, router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\nconst STATUS_CONFIG: Record<string, { label: string; color: string; step: number }> = {\r\n    DRAFT: { label: \"ร่าง\", color: \"#8A8A8A\", step: 1 },\r\n    PAYMENT_1_PENDING: { label: \"รอชำระเงินงวด 1\", color: \"#F59E0B\", step: 2 },\r\n    SUBMITTED: { label: \"รอตรวจเอกสาร\", color: \"#3B82F6\", step: 3 },\r\n    REVISION_REQ: { label: \"ต้องแก้ไขเอกสาร\", color: \"#EF4444\", step: 3 },\r\n    PAYMENT_2_PENDING: { label: \"รอชำระเงินงวด 2\", color: \"#F59E0B\", step: 4 },\r\n    AUDIT_PENDING: { label: \"รอตรวจประเมินสถานที่\", color: \"#8B5CF6\", step: 5 },\r\n    AUDIT_SCHEDULED: { label: \"นัดหมายตรวจแล้ว\", color: \"#06B6D4\", step: 5 },\r\n    CERTIFIED: { label: \"ได้รับการรับรอง\", color: \"#10B981\", step: 6 },\r\n};\r\n\r\nconst STEPS = [{ id: 1, label: \"ยื่นคำขอ\" }, { id: 2, label: \"ชำระงวด 1\" }, { id: 3, label: \"ตรวจเอกสาร\" }, { id: 4, label: \"ชำระงวด 2\" }, { id: 5, label: \"ตรวจสถานที่\" }, { id: 6, label: \"รับรอง\" }];\r\n\r\ninterface ApplicationDetail { _id: string; applicationNumber?: string; status: string; createdAt: string; updatedAt: string; applicantType?: string; applicantInfo?: { name?: string; firstName?: string; lastName?: string; phone?: string; email?: string }; siteInfo?: { siteName?: string; address?: string; province?: string; gpsLat?: string; gpsLng?: string; areaSize?: string }; formData?: { documents?: { id: string; uploaded?: boolean; name?: string }[] }; staffNotes?: string; }\r\n\r\nexport default function ApplicationDetailPage() {\r\n    const router = useRouter();\r\n    const params = useParams();\r\n    const id = params?.id as string;\r\n\r\n    const [application, setApplication] = useState<ApplicationDetail | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n\r\n    useEffect(() => { setMounted(true); setIsDark(localStorage.getItem(\"theme\") === \"dark\"); const userData = localStorage.getItem(\"user\"); if (!userData) { router.push(\"/login\"); return; } loadApplication(); }, [id]);\r\n\r\n    const loadApplication = async () => {\r\n        if (!id) return;\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const result = await api.get<{ data: ApplicationDetail }>(`/applications/${id}`);\r\n            if (result.success && result.data?.data) setApplication(result.data.data);\r\n            else setError(\"ไม่พบคำขอนี้ในระบบ\");\r\n        } catch { setError(\"เกิดข้อผิดพลาดในการโหลดข้อมูล\"); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const toggleTheme = () => { setIsDark(!isDark); localStorage.setItem(\"theme\", !isDark ? \"dark\" : \"light\"); };\r\n    const handleLogout = () => { localStorage.removeItem(\"user\"); window.location.href = \"/api/auth/logout\"; };\r\n    const getStatusInfo = (status: string) => STATUS_CONFIG[status] || { label: status, color: \"#8A8A8A\", step: 0 };\r\n    const formatDate = (date: string) => new Date(date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });\r\n\r\n    if (!mounted) return null;\r\n\r\n    const navItems = [{ href: \"/farmer/dashboard\", label: \"หน้าหลัก\" }, { href: \"/farmer/applications\", label: \"คำขอ\", active: true }, { href: \"/farmer/tracking\", label: \"ติดตาม\" }, { href: \"/farmer/payments\", label: \"การเงิน\" }, { href: \"/farmer/profile\", label: \"โปรไฟล์\" }];\r\n    const statusInfo = application ? getStatusInfo(application.status) : null;\r\n    const currentStep = statusInfo?.step || 0;\r\n\r\n    return (\r\n        <div className={`min-h-screen font-sans ${isDark ? 'bg-slate-900 text-surface-100' : 'bg-surface-100 text-slate-900'}`}>\r\n            {/* Sidebar */}\r\n            <aside className={`hidden lg:flex fixed left-0 top-0 bottom-0 w-[72px] flex-col items-center py-5 border-r z-50 ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <div className=\"w-11 h-11 rounded-2xl bg-gradient-to-br from-primary-600 to-primary-400 flex items-center justify-center text-xl font-semibold text-white mb-8\">G</div>\r\n                <nav className=\"flex-1 flex flex-col gap-1 w-full px-2\">\r\n                    {navItems.map(item => (\r\n                        <Link key={item.href} href={item.href} className={`flex flex-col items-center gap-1 py-2.5 rounded-xl relative ${item.active ? (isDark ? 'bg-primary-500/15 border border-primary-500/30' : 'bg-primary-50 border border-primary-500/30') : 'hover:bg-surface-100'}`}>\r\n                            {item.active && <div className=\"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-7 bg-primary-600 rounded-r\" />}\r\n                            <span className={`text-[10px] font-medium ${item.active ? 'text-primary-600' : 'text-slate-500'}`}>{item.label}</span>\r\n                        </Link>\r\n                    ))}\r\n                </nav>\r\n                <div className=\"flex flex-col gap-3\">\r\n                    <button onClick={toggleTheme} className={`w-10 h-10 rounded-xl flex items-center justify-center ${isDark ? 'bg-primary-500/15 border border-primary-500/30' : 'bg-primary-50 border border-primary-500/30'}`}>\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">{isDark ? <><circle cx=\"12\" cy=\"12\" r=\"5\" /><line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\" /><line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\" /><line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\" /><line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\" /><line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\" /><line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\" /><line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\" /><line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\" /></> : <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\" />}</svg>\r\n                    </button>\r\n                    <button onClick={handleLogout} className=\"w-10 h-10 rounded-xl flex items-center justify-center text-slate-500\">\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\" /><polyline points=\"16 17 21 12 16 7\" /><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\" /></svg>\r\n                    </button>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Mobile Nav */}\r\n            <nav className={`lg:hidden fixed bottom-0 inset-x-0 h-[72px] flex justify-around items-center z-50 border-t ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                {navItems.map(item => <Link key={item.href} href={item.href} className=\"flex flex-col items-center gap-1 py-2 px-3\"><span className={`text-[10px] font-medium ${item.active ? 'text-primary-600' : 'text-slate-500'}`}>{item.label}</span></Link>)}\r\n            </nav>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"lg:ml-[72px] p-6 lg:p-10 pb-24 lg:pb-10 max-w-6xl\">\r\n                <Link href=\"/farmer/applications\" className={`inline-flex items-center gap-2 text-sm mb-6 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>← กลับไปรายการคำขอ</Link>\r\n\r\n                {loading ? (\r\n                    <div className={`rounded-2xl p-16 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <div className={`w-10 h-10 border-[3px] rounded-full animate-spin mx-auto ${isDark ? 'border-slate-700 border-t-primary-500' : 'border-surface-200 border-t-primary-600'}`} />\r\n                        <p className={`mt-4 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>กำลังโหลดข้อมูลคำขอ...</p>\r\n                    </div>\r\n                ) : error ? (\r\n                    <div className=\"rounded-2xl p-6 text-center bg-red-50 border border-red-200\">\r\n                        <p className=\"text-red-500 font-medium\">{error}</p>\r\n                        <Link href=\"/applications\" className=\"inline-block mt-4 px-5 py-2.5 rounded-lg bg-red-500 text-white\">กลับไปรายการคำขอ</Link>\r\n                    </div>\r\n                ) : application ? (\r\n                    <>\r\n                        {/* Header */}\r\n                        <div className=\"flex justify-between items-start mb-7 flex-wrap gap-4\">\r\n                            <div>\r\n                                <h1 className=\"text-2xl lg:text-3xl font-medium\">คำขอ {application.applicationNumber || `#${application._id.slice(-6).toUpperCase()}`}</h1>\r\n                                <p className={`text-sm mt-1 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>ยื่นเมื่อ {formatDate(application.createdAt)}</p>\r\n                            </div>\r\n                            <div className=\"flex gap-3 items-center\">\r\n                                <span className=\"px-5 py-2 rounded-full text-sm font-semibold\" style={{ backgroundColor: `${statusInfo?.color}20`, color: statusInfo?.color, border: `1px solid ${statusInfo?.color}40` }}>{statusInfo?.label}</span>\r\n                                {application.status === \"REVISION_REQ\" && <Link href={`/farmer/applications/${application._id}/edit`} className=\"flex items-center gap-1.5 px-5 py-2.5 rounded-xl bg-secondary-500 text-white font-medium\">แก้ไขคำขอ</Link>}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Progress Steps */}\r\n                        <div className={`rounded-2xl p-6 mb-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                            <h3 className={`text-base font-semibold mb-5 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ความคืบหน้า</h3>\r\n                            <div className=\"relative mb-5\">\r\n                                <div className={`h-1 rounded ${isDark ? 'bg-slate-700' : 'bg-surface-200'}`} />\r\n                                <div className=\"absolute top-0 left-0 h-1 rounded bg-gradient-to-r from-primary-600 to-primary-400 transition-all\" style={{ width: `${((currentStep - 1) / (STEPS.length - 1)) * 100}%` }} />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-6 gap-2\">\r\n                                {STEPS.map(step => {\r\n                                    const isDone = step.id < currentStep;\r\n                                    const isCurrent = step.id === currentStep;\r\n                                    return (\r\n                                        <div key={step.id} className=\"text-center\">\r\n                                            <div className={`w-10 h-10 rounded-xl mx-auto mb-2 flex items-center justify-center ${isDone ? 'bg-primary-600' : isCurrent ? (isDark ? 'bg-primary-500/20 border-2 border-primary-500' : 'bg-primary-50 border-2 border-primary-600') : (isDark ? 'bg-slate-700' : 'bg-surface-200')}`}>\r\n                                                {isDone ? <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" strokeWidth=\"3\"><path d=\"M20 6L9 17L4 12\" /></svg> : isCurrent ? <span className=\"text-primary-600 text-xs\">•</span> : <span className={`text-sm font-medium ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>{step.id}</span>}\r\n                                            </div>\r\n                                            <span className={`text-[11px] ${isCurrent ? 'text-primary-600 font-semibold' : isDark ? 'text-slate-500' : 'text-slate-400'}`}>{step.label}</span>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Staff Notes */}\r\n                        {application.staffNotes && (\r\n                            <div className=\"rounded-2xl p-5 mb-6 bg-secondary-50 border border-secondary-200\">\r\n                                <h4 className=\"text-sm font-semibold text-secondary-600 mb-2\">หมายเหตุจากเจ้าหน้าที่</h4>\r\n                                <p className=\"text-sm leading-relaxed\">{application.staffNotes}</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Action for Payment */}\r\n                        {application.status === \"PAYMENT_1_PENDING\" && (\r\n                            <div className=\"rounded-2xl p-6 mb-6 bg-secondary-50 border border-secondary-200\">\r\n                                <div className=\"flex justify-between items-center flex-wrap gap-4\">\r\n                                    <div><h4 className=\"text-base font-semibold text-secondary-600 mb-1\">รอชำระเงินงวดที่ 1</h4><p className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ค่าตรวจสอบเอกสารเบื้องต้น 5,000 บาท</p></div>\r\n                                    <Link href={`/payments?app=${application._id}&phase=1`} className=\"px-6 py-3 rounded-xl bg-secondary-500 text-white font-semibold\">ชำระเงิน</Link>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Content Grid */}\r\n                        <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6\">\r\n                            {/* Left Column */}\r\n                            <div className=\"lg:col-span-3 flex flex-col gap-6\">\r\n                                {/* Applicant Info */}\r\n                                <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                    <h3 className={`text-base font-semibold mb-4 flex items-center gap-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ข้อมูลผู้ยื่นคำขอ</h3>\r\n                                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                                        <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>ชื่อ:</span> <strong>{application.applicantInfo?.name || `${application.applicantInfo?.firstName || ''} ${application.applicantInfo?.lastName || ''}`}</strong></div>\r\n                                        <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>ประเภท:</span> {application.applicantType === 'INDIVIDUAL' ? 'บุคคลธรรมดา' : application.applicantType === 'COMMUNITY' ? 'วิสาหกิจชุมชน' : 'นิติบุคคล'}</div>\r\n                                        <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>โทร:</span> {application.applicantInfo?.phone || '-'}</div>\r\n                                        <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>อีเมล:</span> {application.applicantInfo?.email || '-'}</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Site Info */}\r\n                                {application.siteInfo && (\r\n                                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                        <h3 className={`text-base font-semibold mb-4 flex items-center gap-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>สถานที่ปลูก/เก็บเกี่ยว</h3>\r\n                                        <div className=\"grid gap-3 text-sm\">\r\n                                            <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>ชื่อสถานที่:</span> <strong>{application.siteInfo.siteName}</strong></div>\r\n                                            <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>ที่อยู่:</span> {application.siteInfo.address}, {application.siteInfo.province}</div>\r\n                                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                                <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>พื้นที่:</span> {application.siteInfo.areaSize} ไร่</div>\r\n                                                <div><span className={isDark ? 'text-slate-500' : 'text-slate-400'}>พิกัด GPS:</span> {application.siteInfo.gpsLat}, {application.siteInfo.gpsLng}</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        {application.siteInfo.gpsLat && application.siteInfo.gpsLng && (\r\n                                            <div className={`mt-4 rounded-xl overflow-hidden border ${isDark ? 'border-slate-700' : 'border-surface-200'}`}>\r\n                                                <iframe src={`https://www.openstreetmap.org/export/embed.html?bbox=${parseFloat(application.siteInfo.gpsLng) - 0.01}%2C${parseFloat(application.siteInfo.gpsLat) - 0.006}%2C${parseFloat(application.siteInfo.gpsLng) + 0.01}%2C${parseFloat(application.siteInfo.gpsLat) + 0.006}&layer=mapnik&marker=${application.siteInfo.gpsLat}%2C${application.siteInfo.gpsLng}`} className=\"w-full h-44 border-none\" loading=\"lazy\" />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Right Column */}\r\n                            <div className=\"lg:col-span-2 flex flex-col gap-6\">\r\n                                {/* Documents */}\r\n                                <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                    <h3 className={`text-base font-semibold mb-4 flex items-center gap-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>เอกสารประกอบ</h3>\r\n                                    <div className=\"flex flex-col gap-2\">\r\n                                        {application.formData?.documents?.filter(d => d.uploaded).slice(0, 5).map((doc, i) => (\r\n                                            <div key={i} className={`flex items-center justify-between p-3 rounded-lg ${isDark ? 'bg-slate-700/50' : 'bg-surface-100'}`}>\r\n                                                <div className=\"flex items-center gap-2.5\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"1.5\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" /><polyline points=\"14 2 14 8 20 8\" /></svg><span className=\"text-sm\">{doc.name || `เอกสาร ${i + 1}`}</span></div>\r\n                                                <button className={`px-3 py-1.5 rounded-lg text-xs font-medium border flex items-center gap-1 ${isDark ? 'border-primary-500 text-primary-400' : 'border-primary-600 text-primary-600'}`}>\r\n                                                    <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"7 10 12 15 17 10\" /><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" /></svg>\r\n                                                    ดาวน์โหลด\r\n                                                </button>\r\n                                            </div>\r\n                                        )) || <p className={`text-sm text-center py-5 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>ยังไม่มีเอกสาร</p>}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Quick Actions */}\r\n                                <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                    <h3 className=\"text-base font-semibold mb-4\">ดำเนินการ</h3>\r\n                                    <div className=\"flex flex-col gap-2.5\">\r\n                                        <Link href={`/tracking?app=${application._id}`} className={`flex items-center gap-2.5 p-3.5 rounded-xl border ${isDark ? 'border-slate-700' : 'border-surface-200'}`}>\r\n                                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><circle cx=\"12\" cy=\"12\" r=\"10\" /><polygon points=\"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76\" /></svg>\r\n                                            <span>ติดตามสถานะ</span>\r\n                                        </Link>\r\n                                        <Link href={`/payments?app=${application._id}`} className={`flex items-center gap-2.5 p-3.5 rounded-xl border ${isDark ? 'border-slate-700' : 'border-surface-200'}`}>\r\n                                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><rect x=\"1\" y=\"4\" width=\"22\" height=\"16\" rx=\"2\" ry=\"2\" /><line x1=\"1\" y1=\"10\" x2=\"23\" y2=\"10\" /></svg>\r\n                                            <span>ประวัติการชำระเงิน</span>\r\n                                        </Link>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                ) : null}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\amendment\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCertificate'. Either include it or remove the dependency array.","line":22,"column":110,"nodeType":"ArrayExpression","endLine":22,"endColumn":118,"suggestions":[{"desc":"Update the dependencies array to be: [certId, loadCertificate]","fix":{"range":[1023,1031],"text":"[certId, loadCertificate]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1174,1177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1174,1177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2587,2590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2587,2590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Suspense, useEffect, useState } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ninterface EditableField { key: string; label: string; value: string; originalValue: string; isModified: boolean; }\r\n\r\nfunction AmendmentContent() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const certId = searchParams.get('certId');\r\n\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [step, setStep] = useState<'select' | 'edit' | 'confirm' | 'submitted'>('select');\r\n    const [certificate, setCertificate] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [fields, setFields] = useState<EditableField[]>([]);\r\n    const [changeDescription, setChangeDescription] = useState('');\r\n\r\n    useEffect(() => { setIsDark(localStorage.getItem(\"theme\") === \"dark\"); if (certId) loadCertificate(); }, [certId]);\r\n\r\n    const loadCertificate = async () => {\r\n        if (!certId) return;\r\n        setLoading(true);\r\n        const result = await api.get<any>(`/certificates/${certId}`);\r\n        if (result.success && result.data?.data) {\r\n            const cert = result.data.data;\r\n            setCertificate(cert);\r\n            setFields([\r\n                { key: 'siteName', label: 'ชื่อสถานประกอบการ', value: cert.siteName || '', originalValue: cert.siteName || '', isModified: false },\r\n                { key: 'address', label: 'ที่อยู่', value: cert.address || '', originalValue: cert.address || '', isModified: false },\r\n                { key: 'contactPhone', label: 'เบอร์โทรศัพท์', value: cert.contactPhone || '', originalValue: cert.contactPhone || '', isModified: false },\r\n                { key: 'contactEmail', label: 'อีเมล', value: cert.contactEmail || '', originalValue: cert.contactEmail || '', isModified: false },\r\n            ]);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleFieldChange = (key: string, newValue: string) => setFields(prev => prev.map(f => f.key === key ? { ...f, value: newValue, isModified: newValue !== f.originalValue } : f));\r\n    const modifiedFields = fields.filter(f => f.isModified);\r\n\r\n    const handleSubmit = async () => {\r\n        setSubmitting(true);\r\n        try {\r\n            const changes = modifiedFields.reduce((acc, f) => { acc[f.key] = { from: f.originalValue, to: f.value }; return acc; }, {} as Record<string, { from: string; to: string }>);\r\n            const result = await api.post<any>('/api/applications', { serviceType: 'amendment', originalCertificateId: certId, data: { changes, changeDescription, applicantInfo: certificate?.applicantInfo } });\r\n            if (result.success) setStep('submitted');\r\n        } catch { } finally { setSubmitting(false); }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n            <div className=\"text-center\">\r\n                <div className=\"w-10 h-10 border-[3px] border-surface-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4\" />\r\n                <p className=\"text-slate-500\">กำลังโหลดข้อมูลใบรับรอง...</p>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const stepLabels = ['เลือกข้อมูล', 'แก้ไข', 'ยืนยัน', 'เสร็จสิ้น'];\r\n    const stepKeys = ['select', 'edit', 'confirm', 'submitted'];\r\n    const stepIndex = stepKeys.indexOf(step);\r\n\r\n    return (\r\n        <div className={`min-h-screen p-6 font-sans ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n            <div className=\"max-w-2xl mx-auto\">\r\n                <button onClick={() => router.back()} className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border mb-6 ${isDark ? 'border-slate-700 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n                <h1 className={`text-2xl font-semibold mb-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>แก้ไขข้อมูลในใบรับรอง</h1>\r\n                <p className={`text-sm mb-8 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ใบรับรองเลขที่: <strong>{certificate?.certificateNumber || '-'}</strong></p>\r\n\r\n                {/* Progress Steps */}\r\n                <div className=\"flex gap-2 mb-8\">\r\n                    {stepLabels.map((label, idx) => (\r\n                        <div key={label} className=\"flex-1 text-center\">\r\n                            <div className={`w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center text-sm font-semibold ${idx < stepIndex ? 'bg-primary-600 text-white' : idx === stepIndex ? 'bg-blue-600 text-white' : isDark ? 'bg-slate-700 text-slate-400' : 'bg-surface-200 text-slate-500'}`}>{idx + 1}</div>\r\n                            <div className={`text-xs ${idx === stepIndex ? 'text-blue-600' : isDark ? 'text-slate-500' : 'text-slate-400'}`}>{label}</div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Step: Edit */}\r\n                {(step === 'select' || step === 'edit') && (\r\n                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <h3 className={`text-base font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>แก้ไขข้อมูลที่ต้องการเปลี่ยนแปลง</h3>\r\n                        <div className=\"space-y-4 mb-6\">\r\n                            {fields.map(field => (\r\n                                <div key={field.key}>\r\n                                    <label className={`block text-sm mb-1.5 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{field.label} {field.isModified && <span className=\"text-secondary-500 ml-2\">● แก้ไขแล้ว</span>}</label>\r\n                                    <input type=\"text\" value={field.value} onChange={(e) => handleFieldChange(field.key, e.target.value)} className={`w-full px-3.5 py-3 rounded-lg text-sm outline-none ${field.isModified ? 'border-2 border-secondary-500' : (isDark ? 'border border-slate-600 bg-slate-700 text-surface-100' : 'border border-surface-200 text-slate-900')}`} />\r\n                                    {field.isModified && <p className={`text-xs mt-1 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>เดิม: {field.originalValue}</p>}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"mb-6\">\r\n                            <label className={`block text-sm mb-1.5 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>เหตุผลในการแก้ไข <span className=\"text-red-500\">*</span></label>\r\n                            <textarea value={changeDescription} onChange={(e) => setChangeDescription(e.target.value)} placeholder=\"อธิบายสาเหตุ...\" className={`w-full px-3.5 py-3 rounded-lg text-sm outline-none resize-y min-h-[100px] ${isDark ? 'border border-slate-600 bg-slate-700 text-surface-100' : 'border border-surface-200 text-slate-900'}`} />\r\n                        </div>\r\n                        <button onClick={() => setStep('confirm')} disabled={modifiedFields.length === 0 || !changeDescription.trim()} className={`w-full py-3.5 rounded-xl text-sm font-semibold ${modifiedFields.length > 0 && changeDescription.trim() ? 'bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40' : 'bg-surface-200 text-slate-400 cursor-not-allowed'}`}>ตรวจสอบการแก้ไข ({modifiedFields.length} รายการ) →</button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step: Confirm */}\r\n                {step === 'confirm' && (\r\n                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <h3 className={`text-base font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ยืนยันการแก้ไข</h3>\r\n                        <div className=\"bg-secondary-50 border border-secondary-500 rounded-xl p-4 mb-6\"><p className=\"text-sm text-secondary-800\">หลังจากส่งคำขอ ทีมงานจะประเมินและส่งใบเสนอราคาให้ท่านผ่านระบบ</p></div>\r\n                        <h4 className={`text-sm font-semibold mb-3 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>รายการที่แก้ไข:</h4>\r\n                        <div className=\"space-y-2 mb-6\">\r\n                            {modifiedFields.map(field => (\r\n                                <div key={field.key} className={`p-3 rounded-lg border ${isDark ? 'border-slate-600' : 'border-surface-200'}`}>\r\n                                    <div className={`font-medium mb-1 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{field.label}</div>\r\n                                    <div className=\"text-sm\"><span className=\"text-red-500 line-through\">{field.originalValue}</span><span className={`mx-2 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>→</span><span className=\"text-primary-600 font-medium\">{field.value}</span></div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className={`p-3 rounded-lg mb-6 ${isDark ? 'bg-blue-500/10' : 'bg-blue-50'}`}>\r\n                            <div className={`text-xs mb-1 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>เหตุผล:</div>\r\n                            <div className={`text-sm ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{changeDescription}</div>\r\n                        </div>\r\n                        <div className=\"flex gap-3\">\r\n                            <button onClick={() => setStep('edit')} className={`flex-1 py-3.5 rounded-xl text-sm font-medium border ${isDark ? 'border-slate-600 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← แก้ไขเพิ่มเติม</button>\r\n                            <button onClick={handleSubmit} disabled={submitting} className={`flex-1 py-3.5 rounded-xl text-sm font-semibold bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40 ${submitting ? 'opacity-70' : ''}`}>{submitting ? 'กำลังส่ง...' : 'ส่งคำขอแก้ไข'}</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step: Submitted */}\r\n                {step === 'submitted' && (\r\n                    <div className={`rounded-2xl p-8 border text-center ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <div className=\"w-16 h-16 rounded-full bg-primary-600 flex items-center justify-center mx-auto mb-4\"><svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" strokeWidth=\"3\"><polyline points=\"20 6 9 17 4 12\" /></svg></div>\r\n                        <h3 className={`text-xl font-semibold mb-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ส่งคำขอแก้ไขเรียบร้อย</h3>\r\n                        <p className={`text-sm mb-6 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ทีมงานจะตรวจสอบและส่งใบเสนอราคาให้ท่าน<br />กรุณาตรวจสอบในหน้า &quot;การเงิน&quot; เพื่อดูสถานะ</p>\r\n                        <div className=\"flex gap-3 justify-center\">\r\n                            <button onClick={() => router.push('/farmer/applications')} className={`px-6 py-3.5 rounded-xl text-sm font-medium border ${isDark ? 'border-slate-600 text-slate-400' : 'border-surface-200 text-slate-600'}`}>กลับหน้าคำขอ</button>\r\n                            <button onClick={() => router.push('/payments')} className=\"px-6 py-3.5 rounded-xl text-sm font-semibold bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40\">ไปหน้าการเงิน</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction AmendmentLoadingFallback() {\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-surface-100\">\r\n            <div className=\"text-center\">\r\n                <div className=\"w-10 h-10 border-[3px] border-surface-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4\" />\r\n                <p className=\"text-slate-500 text-sm\">กำลังโหลด...</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default function AmendmentApplicationPage() { return <Suspense fallback={<AmendmentLoadingFallback />}><AmendmentContent /></Suspense>; }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\context\\wizard-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\hooks\\useWizardState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\hooks\\useWizardStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11337,11340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11337,11340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'get' is defined but never used.","line":454,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":454,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\n\r\n// Types\r\nexport type PlantId = 'cannabis' | 'kratom' | 'turmeric' | 'ginger' | 'black_galangal' | 'plai';\r\nexport type ServiceType = 'NEW' | 'RENEWAL' | 'MODIFY' | 'REPLACEMENT';\r\nexport type PlantGroup = 'HIGH_CONTROL' | 'GENERAL';\r\nexport type CertificationPurpose = 'RESEARCH' | 'COMMERCIAL' | 'EXPORT';\r\nexport type SiteType = 'OUTDOOR' | 'INDOOR' | 'GREENHOUSE';\r\nexport type CultivationMethod = 'outdoor' | 'greenhouse' | 'indoor' | 'vertical' | 'hydroponic';\r\n\r\nexport interface Plant {\r\n    id: PlantId;\r\n    name: string;\r\n    icon: string;\r\n    group: PlantGroup;\r\n}\r\n\r\nexport const PLANTS: Plant[] = [\r\n    { id: 'cannabis', name: 'กัญชา', icon: '', group: 'HIGH_CONTROL' },\r\n    { id: 'kratom', name: 'กระท่อม', icon: '', group: 'HIGH_CONTROL' },\r\n    { id: 'turmeric', name: 'ขมิ้นชัน', icon: '', group: 'GENERAL' },\r\n    { id: 'ginger', name: 'ขิง', icon: '', group: 'GENERAL' },\r\n    { id: 'black_galangal', name: 'กระชายดำ', icon: '', group: 'GENERAL' },\r\n    { id: 'plai', name: 'ไพล', icon: '', group: 'GENERAL' },\r\n];\r\n\r\n// Expanded ApplicantData with all fields for INDIVIDUAL, JURISTIC, COMMUNITY\r\nexport interface ApplicantData {\r\n    applicantType: 'INDIVIDUAL' | 'JURISTIC' | 'COMMUNITY';\r\n\r\n    // บุคคลธรรมดา (Individual)\r\n    firstName?: string;\r\n    lastName?: string;\r\n    fullName?: string;\r\n    idCard?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    lineId?: string;\r\n    address?: string;\r\n    province?: string;\r\n    district?: string;\r\n    subdistrict?: string;\r\n    postalCode?: string;\r\n\r\n    // วิสาหกิจชุมชน (Community Enterprise)\r\n    communityName?: string;           // ชื่อวิสาหกิจชุมชน\r\n    communityAddress?: string;        // ที่อยู่วิสาหกิจชุมชน\r\n    communityRegDate?: string;        // วันที่จดทะเบียน\r\n    presidentName?: string;           // ชื่อประธาน\r\n    presidentIdCard?: string;         // เลขบัตรประชาชนประธาน\r\n    presidentPhone?: string;          // โทรศัพท์ประธาน\r\n    memberCount?: number;             // จำนวนสมาชิก\r\n    registrationSVC01?: string;       // รหัส สวช.01\r\n    registrationTVC3?: string;        // รหัส ท.ว.ช.3\r\n    houseRegistrationCode?: string;   // เลขรหัสประจำบ้าน\r\n    registeredAddress?: string;       // ที่อยู่ตามทะเบียนบ้าน\r\n\r\n    // นิติบุคคล (Juristic Person)\r\n    companyName?: string;             // ชื่อสถานประกอบการ/บริษัท\r\n    companyAddress?: string;          // ที่อยู่สถานที่จัดตั้ง\r\n    companyPhone?: string;            // โทรศัพท์สถานที่จัดตั้ง\r\n    companyType?: string;             // ประเภทนิติบุคคล\r\n    taxId?: string;                   // เลขประจำตัวผู้เสียภาษี\r\n    registeredCapital?: string;       // ทุนจดทะเบียน\r\n    directorName?: string;            // ชื่อประธานกรรมการ\r\n    directorIdCard?: string;          // เลขบัตรประชาชนกรรมการ\r\n    directorPhone?: string;           // โทรศัพท์ประธานกรรมการ\r\n    directorEmail?: string;           // อีเมลประธาน\r\n    directorPosition?: string;        // ตำแหน่ง\r\n    registrationNumber?: string;      // เลขทะเบียนนิติบุคคล/เลขผู้เสียภาษี\r\n    powerOfAttorneyUrl?: string;      // หนังสือมอบอำนาจ (PDF URL)\r\n    coordinatorName?: string;         // ชื่อผู้ประสานงาน (กรณีมอบอำนาจ)\r\n    coordinatorPhone?: string;        // โทรศัพท์ผู้ประสานงาน\r\n    coordinatorLineId?: string;       // Line ID ผู้ประสานงาน\r\n    contactName?: string;             // ชื่อผู้ติดต่อ\r\n    contactPhone?: string;            // โทรศัพท์ผู้ติดต่อ\r\n    contactEmail?: string;            // อีเมลผู้ติดต่อ\r\n\r\n    // เพิ่มเติม (Documents)\r\n    idCardDoc?: string;\r\n    houseRegDoc?: string;\r\n    communityRegDoc?: string;\r\n    communityMeetingDoc?: string;\r\n    companyRegDoc?: string;\r\n    directorListDoc?: string;\r\n    contact?: string; // Adding to match potential usage\r\n\r\n    // Legacy fields\r\n    responsibleName?: string;\r\n    qualification?: string;\r\n    plantingStatus?: 'NOTIFY' | 'LICENSED';\r\n    licenseNumber?: string;\r\n    licenseType?: 'BHT11' | 'BHT13' | 'BHT16';\r\n\r\n    // [GACP] Personnel Hygiene (หมวด 3: บุคลากร)\r\n    personnelHygiene?: {\r\n        trainingProvided: boolean; // การอบรม\r\n        healthCheck: boolean;      // ตรวจสุขภาพ\r\n        protectiveGear: boolean;   // อุปกรณ์ป้องกัน (PPE)\r\n    };\r\n}\r\n\r\n// [NEW] General Information\r\nexport interface GeneralInfo {\r\n    projectName: string;\r\n    certType: string;\r\n}\r\n\r\n// [NEW] Plot Definition\r\nexport interface Plot {\r\n    id: string; // uuid or temp-id\r\n    name: string; // e.g., \"Greenhouse A\"\r\n    areaSize: string; // e.g., \"2\"\r\n    areaUnit: string; // e.g., \"Rai\"\r\n    solarSystem: 'OUTDOOR' | 'INDOOR' | 'GREENHOUSE';\r\n    latitude?: number;\r\n    longitude?: number;\r\n    // [NEW] Dynamic cultivation config fields\r\n    farmLayoutId?: string; // e.g., \"row_cultivation\", \"raised_bed\"\r\n    growingStyleId?: string; // e.g., \"sog\", \"scrog\", \"vertical\" (indoor only)\r\n    tiers?: number; // For vertical farming (1-5)\r\n    estimatedPlants?: number; // Calculated plant count\r\n    plantDensity?: number; // plants per sqm\r\n\r\n    // [GACP] Soil Analysis (หมวด 4: วัสดุปลูก)\r\n    soilType?: string; // ประเภทดิน\r\n    soilAnalysisStatus?: 'none' | 'pending' | 'passed' | 'failed';\r\n    hasHeavyMetalTest?: boolean;\r\n    hasPesticideTest?: boolean;\r\n\r\n    // [GACP] Seed/Material Source (หมวด 4)\r\n    seedSource?: string; // แหล่งเมล็ดพันธุ์\r\n    seedCertificate?: boolean; // มีใบรับรองเมล็ดพันธุ์\r\n    seedProviderName?: string;\r\n\r\n    // [GACP] IPM Plan (หมวด 6)\r\n    hasIPMPlan?: boolean;\r\n    ipmMethods?: string[]; // วิธีการป้องกันศัตรูพืช\r\n}\r\n\r\n// [NEW] Farm Data - สถานประกอบการ\r\nexport interface FarmData {\r\n    id?: string;\r\n    farmName: string; // ชื่อฟาร์ม\r\n    address: string;\r\n    province: string;\r\n    district: string;\r\n    subdistrict: string;\r\n    postalCode: string;\r\n    // GPS จุดศูนย์กลาง\r\n    gpsLat?: string;\r\n    gpsLng?: string;\r\n    // พื้นที่รวม\r\n    totalAreaSize: string;\r\n    totalAreaUnit: 'Rai' | 'Ngan' | 'Sqm';\r\n    // กรรมสิทธิ์\r\n    landOwnership: 'OWN' | 'RENT' | 'CONSENT';\r\n    // อาณาเขต\r\n    northBorder?: string;\r\n    southBorder?: string;\r\n    eastBorder?: string;\r\n    westBorder?: string;\r\n    // โครงสร้างพื้นฐาน\r\n    waterSource?: string;\r\n    electricitySource?: string;\r\n\r\n    // [GACP] Soil Information\r\n    soilType?: string;          // e.g., \"Clay\", \"Loam\"\r\n    soilPH?: string;            // [NEW]\r\n    soilHistory?: string;       // [NEW] History of land use\r\n\r\n    // ระบบรักษาความปลอดภัย\r\n    hasFence?: boolean;\r\n    hasCCTV?: boolean;\r\n    hasAccessControl?: boolean;\r\n    hasWarningSign?: boolean;\r\n    // เอกสารฟาร์ม\r\n    documents?: StepDocument[];\r\n    environmentChecks?: Record<string, boolean>;\r\n    securityChecks?: Record<string, boolean>;\r\n}\r\n\r\n// [NEW] Lot - ล็อตการผลิต\r\nexport interface Lot {\r\n    id: string;\r\n    lotCode: string; // e.g., \"LOT-67-001\"\r\n    plotId: string; // เชื่อมกับแปลง\r\n    plotName?: string; // for display\r\n    plantCount: number; // จำนวนต้นที่จะปลูก\r\n    estimatedPlantingDate?: string; // ISO date\r\n    estimatedHarvestDate?: string; // ISO date\r\n    estimatedYieldKg?: number; // [NEW] Added for GACP\r\n    status: 'PLANNED' | 'ACTIVE' | 'HARVESTED' | 'CANCELLED';\r\n    notes?: string;\r\n    // เอกสารล็อต\r\n    documents?: StepDocument[];\r\n}\r\n\r\n// Expanded SiteData with all fields from original Step6SiteSecurity\r\nexport interface SiteData {\r\n    siteName: string;\r\n    siteAddress?: string;\r\n    address: string;\r\n    province: string;\r\n    district: string;\r\n    subdistrict: string;\r\n    postalCode: string;\r\n    gpsLat?: string;\r\n    gpsLng?: string;\r\n    latitude?: number;\r\n    longitude?: number;\r\n    areaSize?: string;\r\n    areaUnit?: string;\r\n    northBorder?: string;\r\n    southBorder?: string;\r\n    eastBorder?: string;\r\n    westBorder?: string;\r\n    landOwnership?: 'OWN' | 'RENT' | 'CONSENT';\r\n    soilType?: string;          // Added for GACP\r\n    waterSource?: string;       // Added for GACP\r\n    hasCCTV?: boolean;\r\n    hasFence2m?: boolean;\r\n    hasAccessLog?: boolean;\r\n    hasBiometric?: boolean;\r\n    hasAnimalFence?: boolean;\r\n    hasZoneSign?: boolean;\r\n\r\n    // [NEW] Plot Management\r\n    plots?: Plot[];\r\n}\r\n\r\n// [NEW] Plant Variety Detail\r\nexport interface PlantVariety {\r\n    id: string;\r\n    name: string;\r\n    sourceType: 'SELF' | 'BUY' | 'IMPORT';\r\n    sourceName?: string; // Shop name or location\r\n    quantity?: number;\r\n}\r\n\r\n// Expanded ProductionData with all fields from original Step5Production\r\nexport interface ProductionData {\r\n    plantParts?: string[];\r\n    plantPartsOther?: string;\r\n    propagationType?: 'SEED' | 'CUTTING' | 'TISSUE' | 'OTHER';\r\n    cultivationMethod?: 'OUTDOOR' | 'INDOOR' | 'GREENHOUSE'; // Added for GACP\r\n    irrigationType?: 'DRIP' | 'SPRINKLER' | 'MANUAL' | 'FLOOD'; // Added for GACP\r\n\r\n    // Varieties (Upgraded from single varietyName)\r\n    varieties?: PlantVariety[]; // [NEW]\r\n    varietyName?: string;       // Deprecated but kept for compatibility\r\n\r\n    seedSource?: string;\r\n    varietySource?: string;\r\n    treeCount?: number;\r\n    areaSizeRai?: number;\r\n    quantityWithUnit?: string;\r\n    harvestCycles?: number;\r\n    estimatedYield?: number;\r\n    sourceType?: 'SELF' | 'BUY' | 'IMPORT';\r\n    sourceDetail?: string;\r\n    hasGAPCert?: boolean;\r\n    hasOrganicCert?: boolean;\r\n    cultivationArea?: string;\r\n    annualProduction?: string;\r\n    harvestMethod?: string;\r\n    storageMethod?: string;\r\n    qualityControl?: string;\r\n    spacing?: string;\r\n    plantCount?: string;\r\n}\r\n\r\nexport interface SecurityData {\r\n    hasFence: boolean;\r\n    hasCCTV: boolean;\r\n    hasGuard: boolean;\r\n    hasAccessControl: boolean;\r\n    securityNotes?: string;\r\n}\r\n\r\n// [NEW] Harvest & Post-Harvest\r\nexport interface HarvestData {\r\n    harvestMethod: 'MANUAL' | 'MACHINE' | '';\r\n    dryingMethod: 'SUN' | 'OVEN' | 'DEHYDRATOR' | 'OTHER' | '';\r\n    dryingDetail?: string; // If OTHER\r\n    storageSystem: 'CONTROLLED' | 'AMBIENT' | '';\r\n    packaging: string;\r\n}\r\n\r\n// [NEW] Cultivation Details for dynamic form based on method\r\nexport interface CultivationDetails {\r\n    method: CultivationMethod;\r\n    strainId: string;\r\n    strainName?: string;\r\n    // For outdoor/ground\r\n    plantsPerRai?: number;\r\n    plantSpacing?: string;\r\n    // For greenhouse\r\n    greenhouseCount?: number;\r\n    greenhouseSize?: string;\r\n    // For vertical/rack\r\n    rackLayers?: number;\r\n    racksPerLayer?: number;\r\n    plantsPerRack?: number;\r\n    // For hydroponic\r\n    hydroSystem?: 'NFT' | 'DWC' | 'DRIP';\r\n    potCount?: number;\r\n    // Common\r\n    totalPlants: number;\r\n    plantingDate: string; // ISO date\r\n    estimatedHarvestDate?: string; // ISO date\r\n    harvestCyclesPerYear?: number;\r\n    estimatedYieldPerCycle?: number; // kg\r\n}\r\n\r\n// [NEW] QR Tracking Data per plant\r\nexport interface PlantTrackingData {\r\n    plantId: string;\r\n    qrCode?: string;\r\n    plantingDate: string;\r\n    actualHarvestDate?: string;\r\n    status: 'PLANTED' | 'GROWING' | 'HARVESTED' | 'DESTROYED';\r\n}\r\n\r\n// [NEW] Per-step documents (inline uploads)\r\nexport interface StepDocument {\r\n    stepNumber: number;\r\n    docType: string;\r\n    fileName?: string;\r\n    fileUrl?: string;\r\n    uploadedAt?: string;\r\n    required: boolean;\r\n}\r\n\r\nexport interface DocumentUpload {\r\n    id: string;\r\n    name?: string;\r\n    type?: string;\r\n    url?: string;\r\n    uploaded: boolean;\r\n    metadata?: any; // [NEW] For storing extracted data (e.g., Land Area)\r\n}\r\n\r\nexport interface WizardState {\r\n    currentStep: number;\r\n    plantId: PlantId | null;\r\n    serviceType: ServiceType | null;\r\n    certificationPurpose: CertificationPurpose | null;\r\n    siteTypes: SiteType[];\r\n    licensePdfUrl: string | null;\r\n    consentedPDPA: boolean;\r\n    acknowledgedStandards: boolean;\r\n    applicantData: ApplicantData | null;\r\n    siteData: SiteData | null;\r\n    productionData: ProductionData | null;\r\n    harvestData: HarvestData | null;\r\n    securityData: SecurityData | null;\r\n    documents: DocumentUpload[];\r\n    youtubeUrl?: string;\r\n    locationType: SiteType | null;\r\n    generalInfo: GeneralInfo | null;\r\n    applicationId?: string;\r\n    createdAt?: string;\r\n    updatedAt?: string;\r\n    // [NEW] V4 Fields for 9-step redesign\r\n    cultivationMethod: CultivationMethod | null;\r\n    cultivationDetails: CultivationDetails | null;\r\n    stepDocuments: StepDocument[];\r\n    plantTracking: PlantTrackingData[];\r\n    qrCount: number;\r\n    estimatedQRCost: number;\r\n    // [NEW] Farm-Plot-Lot structure\r\n    farmData: FarmData | null;\r\n    plots: Plot[];\r\n    lots: Lot[];\r\n    // [NEW] Quote Data\r\n    milestone1?: {\r\n        dtamQuote: { number: string; amount: number; accepted: boolean };\r\n        platformQuote: { number: string; amount: number; accepted: boolean };\r\n    };\r\n}\r\n\r\ninterface WizardActions {\r\n    // State update actions\r\n    updateState: (updates: Partial<WizardState>) => void;\r\n    setPlant: (plantId: PlantId) => void;\r\n    setServiceType: (serviceType: ServiceType) => void;\r\n    setCertificationPurpose: (purpose: CertificationPurpose) => void;\r\n    setSiteTypes: (siteTypes: SiteType[]) => void;\r\n    setLicensePdfUrl: (url: string | null) => void;\r\n    setApplicantData: (applicantData: ApplicantData) => void;\r\n    setSiteData: (siteData: SiteData) => void;\r\n    setProductionData: (productionData: ProductionData) => void;\r\n    setHarvestData: (harvestData: HarvestData) => void;\r\n    setSecurityData: (securityData: SecurityData) => void;\r\n    setDocuments: (documents: DocumentUpload[]) => void;\r\n    setLocationType: (locationType: SiteType) => void;\r\n    setYoutubeUrl: (youtubeUrl: string) => void;\r\n    setGeneralInfo: (generalInfo: GeneralInfo) => void;\r\n    setCurrentStep: (step: number) => void;\r\n    consentPDPA: () => void;\r\n    acknowledgeStandards: () => void;\r\n    resetWizard: () => void;\r\n    setApplicationId: (applicationId: string) => void;\r\n    // [NEW] Farm-Plot-Lot actions\r\n    setFarmData: (farmData: FarmData) => void;\r\n    setPlots: (plots: Plot[]) => void;\r\n    setLots: (lots: Lot[]) => void;\r\n    addPlot: (plot: Plot) => void;\r\n    removePlot: (plotId: string) => void;\r\n    addLot: (lot: Lot) => void;\r\n    removeLot: (lotId: string) => void;\r\n}\r\n\r\nconst initialState: WizardState = {\r\n    currentStep: 0,\r\n    plantId: null,\r\n    serviceType: null,\r\n    certificationPurpose: null,\r\n    siteTypes: [],\r\n    licensePdfUrl: null,\r\n    consentedPDPA: false,\r\n    acknowledgedStandards: false,\r\n    applicantData: null,\r\n    siteData: null,\r\n    productionData: null,\r\n    harvestData: null,\r\n    securityData: null,\r\n    documents: [],\r\n    youtubeUrl: '',\r\n    locationType: null,\r\n    generalInfo: null,\r\n    // [NEW] V4 Fields\r\n    cultivationMethod: null,\r\n    cultivationDetails: null,\r\n    stepDocuments: [],\r\n    plantTracking: [],\r\n    qrCount: 0,\r\n    estimatedQRCost: 0,\r\n    // [NEW] Farm-Plot-Lot\r\n    farmData: null,\r\n    plots: [],\r\n    lots: [],\r\n};\r\n\r\nconst STORAGE_KEY = 'gacp_wizard_state_v3'; // Bumped version for Zustand migration\r\n\r\n// Create the Zustand store with persistence\r\nconst useWizardStoreBase = create<WizardState & WizardActions>()(\r\n    persist(\r\n        (set, get) => ({\r\n            // Initial state\r\n            ...initialState,\r\n\r\n            // Actions\r\n            updateState: (updates) => set((state) => ({ ...state, ...updates })),\r\n\r\n            setPlant: (plantId) => set((state) => ({\r\n                plantId,\r\n                currentStep: Math.max(state.currentStep, 0)\r\n            })),\r\n\r\n            setServiceType: (serviceType) => set({ serviceType }),\r\n\r\n            setCertificationPurpose: (purpose) => set({ certificationPurpose: purpose }),\r\n\r\n            setSiteTypes: (siteTypes) => set({ siteTypes }),\r\n\r\n            setLicensePdfUrl: (url) => set({ licensePdfUrl: url }),\r\n\r\n            setApplicantData: (applicantData) => set({ applicantData }),\r\n\r\n            setSiteData: (siteData) => set({ siteData }),\r\n\r\n            setProductionData: (productionData) => set({ productionData }),\r\n\r\n            setHarvestData: (harvestData) => set({ harvestData }),\r\n\r\n            setSecurityData: (securityData) => set({ securityData }),\r\n\r\n            setDocuments: (documents) => set({ documents }),\r\n\r\n            setLocationType: (locationType) => set({ locationType }),\r\n\r\n            setYoutubeUrl: (youtubeUrl) => set({ youtubeUrl }),\r\n\r\n            setGeneralInfo: (generalInfo) => set({ generalInfo }),\r\n\r\n            setCurrentStep: (step) => set({ currentStep: step }),\r\n\r\n            consentPDPA: () => set({ consentedPDPA: true }),\r\n\r\n            acknowledgeStandards: () => set({ acknowledgedStandards: true }),\r\n\r\n            resetWizard: () => set(initialState),\r\n\r\n            setApplicationId: (applicationId) => set({ applicationId }),\r\n\r\n            // [NEW] Farm-Plot-Lot actions\r\n            setFarmData: (farmData) => set({ farmData }),\r\n            setPlots: (plots) => set({ plots }),\r\n            setLots: (lots) => set({ lots }),\r\n            addPlot: (plot) => set((state) => ({ plots: [...state.plots, plot] })),\r\n            removePlot: (plotId) => set((state) => ({\r\n                plots: state.plots.filter(p => p.id !== plotId),\r\n                lots: state.lots.filter(l => l.plotId !== plotId)\r\n            })),\r\n            addLot: (lot) => set((state) => ({ lots: [...state.lots, lot] })),\r\n            removeLot: (lotId) => set((state) => ({ lots: state.lots.filter(l => l.id !== lotId) })),\r\n        }),\r\n        {\r\n            name: STORAGE_KEY,\r\n            // Enable automatic hydration from localStorage\r\n            skipHydration: false,\r\n        }\r\n    )\r\n);\r\n\r\n// Validation helpers - Updated for 9-step flow\r\nexport function canProceedFromStep(state: WizardState, step: number): boolean {\r\n    switch (step) {\r\n        case 0: return !!state.plantId && !!state.certificationPurpose && !!state.cultivationMethod; // Plant & Purpose\r\n        case 1: return !!state.applicantData?.applicantType; // Applicant\r\n        case 2: return !!state.siteData?.siteName && !!state.siteData?.gpsLat; // Site\r\n        case 3: return !!state.cultivationDetails?.totalPlants; // Cultivation\r\n        case 4: return !!state.securityData; // Security\r\n        case 5: return !!state.harvestData?.harvestMethod; // Harvest\r\n        case 6: return state.documents.filter(d => d.uploaded).length >= 1; // Additional Documents\r\n        case 7: return true; // Review\r\n        case 8: return true; // Submit & Payment\r\n        default: return false;\r\n    }\r\n}\r\n\r\nexport function getCompletedSteps(state: WizardState): number[] {\r\n    const completed: number[] = [];\r\n    for (let i = 0; i <= 8; i++) { // 9 steps (0-8)\r\n        if (canProceedFromStep(state, i)) {\r\n            completed.push(i);\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return completed;\r\n}\r\n\r\n// Wrapper hook for compatibility with existing code\r\nexport function useWizardStore() {\r\n    const store = useWizardStoreBase();\r\n\r\n    // Extract state object for compatibility\r\n    const state: WizardState = {\r\n        currentStep: store.currentStep,\r\n        plantId: store.plantId,\r\n        serviceType: store.serviceType,\r\n        certificationPurpose: store.certificationPurpose,\r\n        siteTypes: store.siteTypes,\r\n        licensePdfUrl: store.licensePdfUrl,\r\n        consentedPDPA: store.consentedPDPA,\r\n        acknowledgedStandards: store.acknowledgedStandards,\r\n        applicantData: store.applicantData,\r\n        siteData: store.siteData,\r\n        productionData: store.productionData,\r\n        harvestData: store.harvestData,\r\n        securityData: store.securityData,\r\n        documents: store.documents,\r\n        youtubeUrl: store.youtubeUrl,\r\n        locationType: store.locationType,\r\n        generalInfo: store.generalInfo,\r\n        applicationId: store.applicationId,\r\n        createdAt: store.createdAt,\r\n        updatedAt: store.updatedAt,\r\n        // V4 Fields\r\n        cultivationMethod: store.cultivationMethod,\r\n        cultivationDetails: store.cultivationDetails,\r\n        stepDocuments: store.stepDocuments,\r\n        plantTracking: store.plantTracking,\r\n        qrCount: store.qrCount,\r\n        estimatedQRCost: store.estimatedQRCost,\r\n        // Farm-Plot-Lot\r\n        farmData: store.farmData,\r\n        plots: store.plots,\r\n        lots: store.lots,\r\n    };\r\n\r\n    return {\r\n        state,\r\n        isLoaded: true, // Zustand handles hydration\r\n        updateState: store.updateState,\r\n        setPlant: store.setPlant,\r\n        setServiceType: store.setServiceType,\r\n        setCertificationPurpose: store.setCertificationPurpose,\r\n        setSiteTypes: store.setSiteTypes,\r\n        setLicensePdfUrl: store.setLicensePdfUrl,\r\n        setApplicantData: store.setApplicantData,\r\n        setSiteData: store.setSiteData,\r\n        setProductionData: store.setProductionData,\r\n        setHarvestData: store.setHarvestData,\r\n        setSecurityData: store.setSecurityData,\r\n        setDocuments: store.setDocuments,\r\n        setYoutubeUrl: store.setYoutubeUrl,\r\n        setGeneralInfo: store.setGeneralInfo,\r\n        setCurrentStep: store.setCurrentStep,\r\n        consentPDPA: store.consentPDPA,\r\n        acknowledgeStandards: store.acknowledgeStandards,\r\n        resetWizard: store.resetWizard,\r\n        setApplicationId: store.setApplicationId,\r\n        setLocationType: store.setLocationType,\r\n        // Farm-Plot-Lot actions\r\n        setFarmData: store.setFarmData,\r\n        setPlots: store.setPlots,\r\n        setLots: store.setLots,\r\n        addPlot: store.addPlot,\r\n        removePlot: store.removePlot,\r\n        addLot: store.addLot,\r\n        removeLot: store.removeLot,\r\n        canProceedFromStep: (step: number) => canProceedFromStep(state, step),\r\n        getCompletedSteps: () => getCompletedSteps(state),\r\n    };\r\n}\r\n\r\n// Export the base store for direct access if needed\r\nexport { useWizardStoreBase };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\step\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'setCurrentStep' and 'stepIndex'. Either include them or remove the dependency array.","line":77,"column":8,"nodeType":"ArrayExpression","endLine":77,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [setCurrentStep, stepIndex]","fix":{"range":[3373,3375],"text":"[setCurrentStep, stepIndex]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { notFound, useParams } from 'next/navigation';\r\nimport { useWizardStore } from '../../hooks/useWizardStore';\r\n\r\n// Step Components - Mapped to 11-step GACP flow (consolidated Land+Farm)\r\n// 14-Step GACP Application Flow (Architected for Licensing, Traceability, Payment)\r\n// Pillar 1: Licensing\r\nimport { StepPlantSelection } from '../../steps/StepPlantSelection';    // 1: Plant & Objective\r\nimport { StepGeneral } from '../../steps/StepGeneral';                  // 2: Farmer Profile\r\nimport { StepFarm } from '../../steps/StepFarm';                        // 3: Land & Location\r\nimport { StepPlots } from '../../steps/StepPlots';                      // 4: Farm Layout\r\n\r\n// Pillar 2: Traceability (The \"Engine\")\r\nimport { StepProduction } from '../../steps/StepProduction';            // 5: Production Method (Propagation)\r\nimport { StepLots } from '../../steps/StepLots';                        // 6: Lots Tracking Setup\r\nimport { StepProductionEstimate } from '../../steps/StepProductionEstimate'; // 7: Yield Logic (Calculation)\r\nimport { StepHarvest } from '../../steps/StepHarvest';                  // 8: Harvest Process\r\n\r\n// Pillar 3: Compliance & Submission\r\nimport { StepDocuments } from '../../steps/StepDocuments';              // 9: Evidence\r\nimport { StepPreCheck } from '../../steps/StepPreCheck';                // 10: Self-Audit\r\nimport { StepPreview } from '../../steps/StepPreview';                  // 11: Review\r\nimport { StepSubmit } from '../../steps/StepSubmit';                    // 12: Legal Submission\r\n\r\n// Pillar 4: Payment (Gateway)\r\nimport { StepQuote } from '../../steps/StepQuote';                      // 13: Fee Acceptance\r\nimport { StepInvoice } from '../../steps/StepInvoice';                  // 14: Payment Processing\r\nimport { StepSuccess } from '../../steps/StepSuccess';                  // Success State\r\n\r\n// 14-Step Flow Configuration\r\nconst STEPS_COMPONENTS = [\r\n    StepPlantSelection,     // 1\r\n    StepGeneral,            // 2\r\n    StepFarm,               // 3\r\n    StepPlots,              // 4\r\n    StepProduction,         // 5 (Restored)\r\n    StepLots,               // 6 (New Integration)\r\n    StepProductionEstimate, // 7\r\n    StepHarvest,            // 8 (Restored)\r\n    StepDocuments,          // 9\r\n    StepPreCheck,           // 10 (Restored)\r\n    StepPreview,            // 11\r\n    StepSubmit,             // 12\r\n    StepQuote,              // 13 (Was 10)\r\n    StepInvoice,            // 14 (Was 11)\r\n    StepSuccess,            // Success (Post-14)\r\n];\r\n\r\n\r\nexport default function StepPage() {\r\n    const params = useParams();\r\n\r\n    // Parse ID from URL\r\n    const idStr = Array.isArray(params?.id) ? params.id[0] : params?.id;\r\n    const stepId = parseInt(idStr || '0', 10);\r\n\r\n    // Validate ID (1-12)\r\n    if (isNaN(stepId) || stepId < 1 || stepId > STEPS_COMPONENTS.length) {\r\n        notFound();\r\n    }\r\n\r\n    // Convert to 0-based index\r\n    const stepIndex = stepId - 1;\r\n    const StepComponent = STEPS_COMPONENTS[stepIndex];\r\n\r\n    const { setCurrentStep } = useWizardStore();\r\n    const hasSynced = React.useRef(false);\r\n\r\n    // Sync Store Step with URL Step - only once on mount\r\n    React.useEffect(() => {\r\n        if (!hasSynced.current) {\r\n            hasSynced.current = true;\r\n            setCurrentStep(stepIndex);\r\n        }\r\n    }, []); // Empty deps - only run on mount\r\n\r\n    return (\r\n        <div className=\"p-8\">\r\n            <StepComponent />\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\InvoicePDF.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[416,419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[416,419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":42,"column":29,"nodeType":"JSXOpeningElement","endLine":42,"endColumn":114}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useWizardStore } from \"../hooks/useWizardStore\";\r\n\r\ninterface InvoicePDFProps {\r\n    invoiceNumber: string;\r\n    quoteNumber: string;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const InvoicePDF = ({ invoiceNumber, quoteNumber, onClose }: InvoicePDFProps) => {\r\n    const { state } = useWizardStore();\r\n    const currentDate = new Date();\r\n\r\n    const applicant = (state.applicantData || {}) as any;\r\n    const name = applicant.firstName ? `${applicant.firstName} ${applicant.lastName || ''}` : \"บริษัท สโมก ครูว จำกัด\";\r\n    const address = applicant.address || \"88/23 หมู่ 4 ถนนติวานนท์ ตำบลตลาดขวัญ อำเภอเมือง จังหวัดนนทบุรี 11000\";\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 z-[1100] flex items-center justify-center p-4 print:p-0 print:bg-white print:fixed print:inset-0 overflow-y-auto\" onClick={onClose}>\r\n            <div className=\"w-full max-w-[210mm] my-8 bg-white shadow-2xl animate-scale-in print:shadow-none print:w-full print:my-0\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Print/Close Actions */}\r\n                <div className=\"flex justify-between items-center p-4 bg-slate-100 border-b border-slate-200 print:hidden sticky top-0 z-20\">\r\n                    <h3 className=\"font-bold text-slate-700\">ใบวางบิล / ใบแจ้งหนี้ (Official Template Preview)</h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <button onClick={() => window.print()} className=\"px-4 py-2 bg-primary hover:bg-primary-600 text-white rounded-lg text-sm font-bold transition-all shadow-sm\">\r\n                            พิมพ์เอกสาร / Print\r\n                        </button>\r\n                        <button onClick={onClose} className=\"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-bold transition-all\">\r\n                            ปิด / Close\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* A4 Content Context */}\r\n                <div className=\"p-[15mm] md:p-[20mm] font-serif text-black bg-white min-h-[297mm] leading-tight\">\r\n\r\n                    {/* Header Row */}\r\n                    <div className=\"flex justify-between items-start mb-6\">\r\n                        <div className=\"flex gap-4 items-center\">\r\n                            <img src=\"/dtam_logo_new.png\" alt=\"DTAM Logo\" className=\"w-20 h-20 object-contain\" />\r\n                            <div className=\"space-y-1\">\r\n                                <h1 className=\"text-[16pt] font-bold text-slate-900\">กองกัญชาทางการแพทย์</h1>\r\n                                <h2 className=\"text-[14pt] font-bold text-slate-800\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</h2>\r\n                                <p className=\"text-[10pt] text-slate-600 leading-tight\">\r\n                                    88/23 หมู่ 4 ถนนติวานนท์ ตำบลตลาดขวัญ อำเภอเมือง จังหวัดนนทบุรี 11000<br />\r\n                                    โทรศัพท์ (02) 5647889 หรือ 061-4219701 อีเมล์ tdc.cannabis.gacp@gmail.com\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"border-2 border-black px-4 py-2 text-center min-w-[180px]\">\r\n                            <h3 className=\"text-lg font-bold\">ใบวางบิล/ใบแจ้งหนี้</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-right text-[10pt] mb-4\">\r\n                        กนช. 18 ธันวาคม 2568\r\n                    </div>\r\n\r\n                    {/* Meta Section */}\r\n                    <div className=\"border-2 border-black grid grid-cols-12 mb-2\">\r\n                        <div className=\"col-span-8 p-4 border-r-2 border-black space-y-2\">\r\n                            <p className=\"font-bold\">เรียน ประธานกรรมการ {name}</p>\r\n                            <div className=\"grid grid-cols-12 text-[10.5pt] gap-y-1\">\r\n                                <span className=\"col-span-4\">หน่วยงานผู้รับบริการ:</span>\r\n                                <span className=\"col-span-8 font-bold\">{name}</span>\r\n                                <span className=\"col-span-4\">เลขประจำตัวผู้เสียภาษี:</span>\r\n                                <span className=\"col-span-8\">{applicant.taxId || \"0835566002415\"}</span>\r\n                                <span className=\"col-span-4\">ที่อยู่:</span>\r\n                                <span className=\"col-span-8\">{address}</span>\r\n                                <span className=\"col-span-4\">ผู้ประสานงาน:</span>\r\n                                <span className=\"col-span-8\">คุณ{applicant.firstName || \"นุชจรินทร์\"} {applicant.lastName || \"บัวศรี\"} โทรศัพท์: {applicant.phone || \"-\"}</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"col-span-4 p-4 text-[10.5pt]\">\r\n                            <p>เลขที่เอกสาร: {invoiceNumber}</p>\r\n                            <p>วันที่: {currentDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' })}</p>\r\n                            <p className=\"mt-2 text-blue-700 font-bold\">ใบเสนอราคาเลขที่: {quoteNumber}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <p className=\"text-[10.5pt] mb-4 font-bold\">\r\n                        กองกัญชาทางการแพทย์ขอนำส่งใบวางบิล/ใบแจ้งหนี้ ดังรายการต่อไปนี้\r\n                    </p>\r\n\r\n                    {/* Table */}\r\n                    <table className=\"w-full border-2 border-black text-[10.5pt] mb-6\">\r\n                        <thead>\r\n                            <tr className=\"border-b-2 border-black bg-slate-50\">\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">ลำดับที่</th>\r\n                                <th className=\"border-r-2 border-black py-2 text-center\">รายการ</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">จำนวน</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">หน่วย</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-24 text-center\">ราคา/หน่วย</th>\r\n                                <th className=\"py-2 w-28 text-center\">จำนวนเงิน (บาท)</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr className=\"border-b border-black/20\">\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1.</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-4 text-left\">ค่าตรวจสอบและประเมินคำขอรับการรับรองมาตรฐานเบื้องต้น</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">ต่อคำขอ</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-right px-2\">5,000.00</td>\r\n                                <td className=\"py-3 text-right px-2\">5,000.00</td>\r\n                            </tr>\r\n                            <tr className=\"border-b border-black\">\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">2.</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-4 text-left\">ค่ารับรองผลการประเมินและจัดทำหนังสือรับรองมาตรฐาน</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">ต่อคำขอ</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-right px-2\">25,000.00</td>\r\n                                <td className=\"py-3 text-right px-2\">25,000.00</td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr className=\"font-bold border-t-2 border-black italic\">\r\n                                <td colSpan={4} className=\"border-r-2 border-black py-3 px-4\">(สามหมื่นบาทถ้วน)</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-2 text-center\">จำนวนเงินทั้งสิ้น</td>\r\n                                <td className=\"py-3 text-right px-2\">30,000.00</td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                    <div className=\"text-[10pt] mb-6 space-y-1\">\r\n                        <p><span className=\"font-bold\">หมายเหตุ:</span> 1. การชำระเงิน : ภายใน 3 วัน หลังจากได้รับใบวางบิล/ใบแจ้งหนี้</p>\r\n                        <p className=\"font-bold pl-4\">โอนเงินเข้าบัญชี</p>\r\n                        <p className=\"pl-6\">ชื่อบัญชี เงินบำรุงศูนย์พัฒนายาแผนไทยและสมุนไพร</p>\r\n                        <p className=\"pl-6\">บัญชีธนาคารกรุงไทย เลขที่ 4750134376 สาขามหาวิทยาลัยธรรมศาสตร์ รังสิต</p>\r\n                        <p className=\"pl-6\">เลขประจำตัวผู้เสียภาษี 0994000036540</p>\r\n                        <p className=\"pl-12 font-bold underline\">กรณีทำเช็คสั่งจ่ายในนาม : เงินบำรุงศูนย์พัฒนายาแผนไทยและสมุนไพร</p>\r\n                        <p className=\"pt-2\"><span className=\"font-bold\">2. ชื่อ-ที่อยู่ในการออกใบเสร็จรับเงิน และการส่งหลักฐานชำระเงิน :</span></p>\r\n                        <p className=\"pl-6\">เมื่อชำระเงินแล้วกรุณาส่ง ชื่อ-ที่อยู่ในการออกใบเสร็จ พร้อมแนบเอกสารหลักฐานการชำระเงิน</p>\r\n                        <p className=\"pl-6\">มายังกองพัฒนายาแผนไทยและสมุนไพรทาง Google Form</p>\r\n\r\n                        <div className=\"flex justify-end pr-10\">\r\n                            <div className=\"text-center text-[8pt]\">\r\n                                <div className=\"w-16 h-16 border-2 border-black mx-auto flex items-center justify-center mb-1\">\r\n                                    <div className=\"w-12 h-12 bg-black\"></div>\r\n                                </div>\r\n                                <span className=\"font-bold\">กรุณาสแกนคิวอาร์โค้ด</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Signatures */}\r\n                    <div className=\"grid grid-cols-3 gap-0 border-2 border-black mb-8\">\r\n                        <div className=\"p-4 border-r-2 border-black text-center space-y-4 pb-16\">\r\n                            <p className=\"font-bold\">ผู้รับบริการ</p>\r\n                            <div className=\"mt-12 text-center\">\r\n                                <p className=\"mb-2\">(......................................................)</p>\r\n                                <p>ตำแหน่ง......................................................</p>\r\n                                <p className=\"mt-1\">วันที่............/............/............</p>\r\n                                <p className=\"font-bold text-xs mt-4\">{name}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 border-r-2 border-black text-center space-y-4 pb-16\">\r\n                            <p className=\"font-bold\">ผู้ให้บริการ</p>\r\n                            <div className=\"mt-12 text-center text-[9pt]\">\r\n                                <p className=\"font-bold\">( นายรชต โมกขพันธ์ )</p>\r\n                                <p>ตำแหน่ง นักวิชาการสาธารณสุข</p>\r\n                                <p className=\"mt-1\">วันที่............/............/............</p>\r\n                                <p className=\"font-bold text-xs mt-4\">กองกัญชาทางการแพทย์</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 text-center space-y-4 pb-16\">\r\n                            <p className=\"font-bold\">ผู้มีอำนาจลงนาม</p>\r\n                            <div className=\"mt-12 text-center text-[9pt]\">\r\n                                <p className=\"font-bold\">( นายปรีชา หนูทิม )</p>\r\n                                <p>ตำแหน่ง ผู้อำนวยการกองกัญชาทางการแพทย์</p>\r\n                                <p>ปฏิบัติราชการแทน อธิบดีกรมการแพทย์แผนไทยและการแพทย์ทางเลือก</p>\r\n                                <p className=\"mt-1\">วันที่............/............/............</p>\r\n                                <p className=\"font-bold text-xs mt-4\">กองกัญชาทางการแพทย์</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\MockInvoicePDF.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":42,"column":29,"nodeType":"JSXOpeningElement","endLine":42,"endColumn":114}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\ninterface MockInvoiceProps {\r\n    onClose: () => void;\r\n}\r\n\r\nexport const MockInvoicePDF = ({ onClose }: MockInvoiceProps) => {\r\n    const [invoiceNumber] = useState(() => `INV-${new Date().getFullYear()}${(Math.random() * 10000).toFixed(0)}`);\r\n    const [currentDate] = useState(() => new Date());\r\n    const [dueDate] = useState(() => {\r\n        const date = new Date();\r\n        date.setDate(date.getDate() + 7);\r\n        return date;\r\n    });\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 z-[1100] flex items-center justify-center p-4 print:p-0 print:bg-white print:fixed print:inset-0\" onClick={onClose}>\r\n            <div className=\"w-full max-w-[210mm] max-h-[90vh] overflow-y-auto bg-white shadow-2xl animate-scale-in print:shadow-none print:w-full print:max-h-full print:overflow-visible\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Print/Close Actions */}\r\n                <div className=\"flex justify-between items-center p-4 bg-slate-100 border-b border-slate-200 print:hidden sticky top-0 z-10\">\r\n                    <h3 className=\"font-bold text-slate-700\">ตัวอย่างเอกสาร (Preview)</h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <button onClick={() => window.print()} className=\"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition-colors\">\r\n                            พิมพ์ / Print\r\n                        </button>\r\n                        <button onClick={onClose} className=\"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors\">\r\n                            ปิด (Close)\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* A4 Content */}\r\n                <div className=\"p-[20mm] font-[Sarabun] text-black bg-white min-h-[297mm]\">\r\n\r\n                    {/* Header */}\r\n                    <div className=\"flex items-start justify-between border-b-2 border-blue-600 pb-6 mb-8\">\r\n                        <div className=\"flex items-start gap-4\">\r\n                            <img src=\"/dtam_logo_new.png\" alt=\"DTAM Logo\" className=\"w-16 h-16 object-contain\" />\r\n                            <div>\r\n                                <h1 className=\"text-xl font-bold text-blue-900\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</h1>\r\n                                <p className=\"text-xs text-slate-600 mt-1\">Department of Thai Traditional and Alternative Medicine</p>\r\n                                <p className=\"text-[10px] text-slate-500\">88/23 หมู่ 4 ถนนติวานนท์ ตำบลตลาดขวัญ อำเภอเมือง จังหวัดนนทบุรี 11000</p>\r\n                                <p className=\"text-[10px] text-slate-500\">เลขประจำตัวผู้เสียภาษี: 0994000165xx</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"inline-block px-4 py-1 bg-blue-100 text-blue-800 text-sm font-bold border border-blue-200 rounded mb-2\">\r\n                                ใบวางบิล/แจ้งหนี้ (INVOICE)\r\n                            </div>\r\n                            <p className=\"text-sm\">เลขที่: <span className=\"font-mono font-bold\">{invoiceNumber}</span></p>\r\n                            <p className=\"text-sm\">วันที่: {currentDate.toLocaleDateString('th-TH')}</p>\r\n                            <p className=\"text-sm text-red-600 font-bold\">วันครบกำหนด: {dueDate.toLocaleDateString('th-TH')}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Customer Info */}\r\n                    <div className=\"flex gap-8 mb-8\">\r\n                        <div className=\"flex-1 p-4 border border-slate-200 rounded bg-slate-50\">\r\n                            <p className=\"text-xs text-slate-500 mb-1\">เรียกเก็บเงินจาก (Bill To):</p>\r\n                            <p className=\"font-bold text-lg\">ผู้ยื่นคำขอรับรองมาตรฐาน GACP</p>\r\n                            <p className=\"text-sm text-slate-700\">ที่อยู่: ตามที่ระบุในคำขอ</p>\r\n                        </div>\r\n                        <div className=\"flex-1 p-4 border border-slate-200 rounded bg-slate-50\">\r\n                            <div className=\"flex justify-between items-start\">\r\n                                <div>\r\n                                    <p className=\"text-xs text-slate-500 mb-1\">สถานะเอกสาร (Status):</p>\r\n                                    <span className=\"inline-flex items-center gap-1.5 px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold border border-amber-200\">\r\n                                        รอการชำระเงิน (Waiting for Payment)\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <p className=\"text-xs text-slate-500 mb-1\">ช่องทางชำระเงิน:</p>\r\n                                    <p className=\"text-sm font-bold\">QR Payment / Transfer</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Table */}\r\n                    <table className=\"w-full text-sm mb-8\">\r\n                        <thead>\r\n                            <tr className=\"bg-blue-800 text-white\">\r\n                                <th className=\"py-3 px-4 text-center w-16 border border-blue-900\">ลำดับ</th>\r\n                                <th className=\"py-3 px-4 text-left border border-blue-900\">รายการ (Description)</th>\r\n                                <th className=\"py-3 px-4 text-right w-32 border border-blue-900\">จำนวนเงิน (บาท)</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-200 border border-slate-200\">\r\n                            <tr>\r\n                                <td className=\"py-4 px-4 text-center align-top border-r border-slate-200\">1</td>\r\n                                <td className=\"py-4 px-4 align-top border-r border-slate-200\">\r\n                                    <p className=\"font-bold\">ค่าธรรมเนียมคำขอรับรองมาตรฐาน GACP</p>\r\n                                    <p className=\"text-xs text-slate-500 mt-1\">Application Fee for GACP Certification</p>\r\n                                </td>\r\n                                <td className=\"py-4 px-4 text-right align-top\">100.00</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td className=\"py-4 px-4 text-center align-top border-r border-slate-200\">2</td>\r\n                                <td className=\"py-4 px-4 align-top border-r border-slate-200\">\r\n                                    <p className=\"font-bold\">ค่าธรรมเนียมแปลงปลูก (Plot Fee)</p>\r\n                                    <p className=\"text-xs text-slate-500 mt-1\">Additional Zones Calculation (1 Unit)</p>\r\n                                </td>\r\n                                <td className=\"py-4 px-4 text-right align-top\">50.00</td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot className=\"border-t-2 border-slate-300\">\r\n                            <tr>\r\n                                <td colSpan={2} className=\"py-3 px-4 text-right font-bold text-slate-700\">รวมเป็นเงิน (Total)</td>\r\n                                <td className=\"py-3 px-4 text-right font-bold text-slate-900 border border-slate-200 bg-slate-50\">150.00</td>\r\n                            </tr>\r\n                            <tr className=\"bg-blue-50\">\r\n                                <td colSpan={2} className=\"py-4 px-4 text-right font-bold text-blue-900 text-lg\">ยอดชำระสุทธิ (Net Amount)</td>\r\n                                <td className=\"py-4 px-4 text-right font-bold text-blue-900 text-lg border border-slate-200\">150.00</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <td colSpan={3} className=\"py-2 text-center text-xs italic text-slate-500 bg-slate-50\">\r\n                                    (หนึ่งร้อยห้าสิบบาทถ้วน)\r\n                                </td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                    {/* Payment Info */}\r\n                    <div className=\"bg-slate-50 border border-slate-200 rounded-lg p-6 mb-8 flex gap-6 items-center\">\r\n                        <div className=\"w-24 h-24 bg-white border border-slate-300 flex items-center justify-center shrink-0\">\r\n                            <div className=\"text-center\">\r\n                                <span className=\"text-[10px] text-slate-400\">QR</span>\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"font-bold text-blue-900 mb-1\">ชำระเงินผ่าน QR Code (Scan to Pay)</p>\r\n                            <p className=\"text-xs text-slate-600 mb-2\">สามารถสแกนได้ด้วยแอปพลิเคชันธนาคารทุกธนาคาร</p>\r\n                            <div className=\"text-xs text-slate-500\">\r\n                                OR Transfer: <strong>Krungthai Bank</strong> | Account: <strong>067-0-xxxxx-5</strong><br />\r\n                                Name: <strong>Dept of Thai Traditional Medicine</strong>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer / Notes */}\r\n                    <div className=\"grid grid-cols-2 gap-12 mt-4\">\r\n                        <div></div>\r\n                        <div className=\"text-center\">\r\n                            <div className=\"h-16 flex items-center justify-center mb-2\">\r\n                                {/* Digital Signature Placeholder */}\r\n                                <div className=\"text-blue-500 opacity-50 font-script text-2xl\">Digital Signed</div>\r\n                            </div>\r\n                            <p className=\"text-sm font-bold border-t border-slate-400 pt-2 inline-block min-w-[200px]\">เจ้าหน้าที่การเงิน</p>\r\n                            <p className=\"text-xs text-slate-500 mt-1\">ผู้ได้รับมอบอำนาจ</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\MockQuotePDF.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":42,"column":29,"nodeType":"JSXOpeningElement","endLine":42,"endColumn":114}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useWizardStore } from \"../hooks/useWizardStore\";\r\n\r\ninterface MockQuoteProps {\r\n    onClose: () => void;\r\n}\r\n\r\nexport const MockQuotePDF = ({ onClose }: MockQuoteProps) => {\r\n    const { state } = useWizardStore();\r\n    const [currentDate] = useState(() => new Date());\r\n    const [quoteNumber] = useState(() => `G-${String(Math.floor(Math.random() * 900000000) + 100000000)}`);\r\n\r\n    const applicant = (state.applicantData || {}) as any;\r\n    const name = applicant.firstName ? `${applicant.firstName} ${applicant.lastName || ''}` : \"บริษัท สโมก ครูว จำกัด\";\r\n    const address = applicant.address || \"88/23 หมู่ 4 ถนนติวานนท์ ตำบลตลาดขวัญ อำเภอเมือง จังหวัดนนทบุรี 11000\";\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/70 z-[1100] flex items-center justify-center p-4 print:p-0 print:bg-white print:fixed print:inset-0 overflow-y-auto\" onClick={onClose}>\r\n            <div className=\"w-full max-w-[210mm] my-8 bg-white shadow-2xl animate-scale-in print:shadow-none print:w-full print:my-0\" onClick={e => e.stopPropagation()}>\r\n\r\n                {/* Print/Close Actions */}\r\n                <div className=\"flex justify-between items-center p-4 bg-slate-100 border-b border-slate-200 print:hidden sticky top-0 z-20\">\r\n                    <h3 className=\"font-bold text-slate-700\">ใบเสนอราคา (Official Template Preview)</h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <button onClick={() => window.print()} className=\"px-4 py-2 bg-primary hover:bg-primary-600 text-white rounded-lg text-sm font-bold transition-all shadow-sm\">\r\n                            พิมพ์เอกสาร / Print\r\n                        </button>\r\n                        <button onClick={onClose} className=\"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-bold transition-all\">\r\n                            ปิด / Close\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* A4 Content Context */}\r\n                <div className=\"p-[15mm] md:p-[20mm] font-serif text-black bg-white min-h-[297mm] leading-tight\">\r\n\r\n                    {/* Header Row */}\r\n                    <div className=\"flex justify-between items-start mb-6\">\r\n                        <div className=\"flex gap-4 items-center\">\r\n                            <img src=\"/dtam_logo_new.png\" alt=\"DTAM Logo\" className=\"w-20 h-20 object-contain\" />\r\n                            <div className=\"space-y-1\">\r\n                                <h1 className=\"text-[16pt] font-bold text-slate-900\">กองกัญชาทางการแพทย์</h1>\r\n                                <h2 className=\"text-[14pt] font-bold text-slate-800\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</h2>\r\n                                <p className=\"text-[10pt] text-slate-600 leading-tight\">\r\n                                    88/23 หมู่ 4 ถนนติวานนท์ ตำบลตลาดขวัญ อำเภอเมือง จังหวัดนนทบุรี 11000<br />\r\n                                    โทรศัพท์ (02) 5647889 หรือ 061-4219701 อีเมล์ tdc.cannabis.gacp@gmail.com\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"border-2 border-black px-6 py-2\">\r\n                            <h3 className=\"text-xl font-bold\">ใบเสนอราคา</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-right text-[10pt] mb-4\">\r\n                        กนช. 18 ธันวาคม 2568\r\n                    </div>\r\n\r\n                    {/* Meta Section */}\r\n                    <div className=\"border-2 border-black grid grid-cols-12 mb-6\">\r\n                        <div className=\"col-span-8 p-4 border-r-2 border-black space-y-2\">\r\n                            <p className=\"font-bold\">เรียน ประธานกรรมการ {name}</p>\r\n                            <div className=\"grid grid-cols-12 text-[10.5pt] gap-y-1\">\r\n                                <span className=\"col-span-4\">หน่วยงานผู้รับบริการ:</span>\r\n                                <span className=\"col-span-8 font-bold\">{name}</span>\r\n                                <span className=\"col-span-4\">เลขประจำตัวผู้เสียภาษี:</span>\r\n                                <span className=\"col-span-8\">{applicant.taxId || \"0835566002415\"}</span>\r\n                                <span className=\"col-span-4\">ที่อยู่:</span>\r\n                                <span className=\"col-span-8\">{address}</span>\r\n                                <span className=\"col-span-4\">ผู้ประสานงาน:</span>\r\n                                <span className=\"col-span-8\">คุณ{applicant.firstName || \"นุชจรินทร์\"} {applicant.lastName || \"บัวศรี\"} โทรศัพท์: {applicant.phone || \"-\"}</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"col-span-4 p-4 text-[10.5pt]\">\r\n                            <p>เลขที่เอกสาร: {quoteNumber}</p>\r\n                            <p>วันที่เอกสาร: {currentDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' })}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <p className=\"text-[10.5pt] mb-6\">\r\n                        กรมการแพทย์แผนไทยและการแพทย์ทางเลือก โดยกองกัญชาทางการแพทย์\r\n                        มีความยินดีที่จะเสนอราคาค่าบริการตรวจประเมินและรับรองมาตรฐานการเพาะปลูกและเก็บเกี่ยวที่ดีของพืชกัญชา\r\n                        (Good Agricultural and Collection Practices) ดังรายการต่อไปนี้\r\n                    </p>\r\n\r\n                    {/* Table */}\r\n                    <table className=\"w-full border-2 border-black text-[10.5pt] mb-6\">\r\n                        <thead>\r\n                            <tr className=\"border-b-2 border-black\">\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">ลำดับที่</th>\r\n                                <th className=\"border-r-2 border-black py-2 text-center\">รายการ</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">จำนวน</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-16 text-center\">หน่วย</th>\r\n                                <th className=\"border-r-2 border-black py-2 w-24 text-center\">ราคา/หน่วย</th>\r\n                                <th className=\"py-2 w-28 text-center\">จำนวนเงิน (บาท)</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr className=\"border-b border-black/20\">\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1.</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-4 text-left\">ค่าตรวจสอบและประเมินคำขอรับการรับรองมาตรฐานเบื้องต้น</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">ต่อคำขอ</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-right px-2\">5,000.00</td>\r\n                                <td className=\"py-3 text-right px-2\">5,000.00</td>\r\n                            </tr>\r\n                            <tr className=\"border-b border-black\">\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">2.</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-4 text-left\">ค่ารับรองผลการประเมินและจัดทำหนังสือรับรองมาตรฐาน</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">1</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-center\">ต่อคำขอ</td>\r\n                                <td className=\"border-r-2 border-black py-3 text-right px-2\">25,000.00</td>\r\n                                <td className=\"py-3 text-right px-2\">25,000.00</td>\r\n                            </tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr className=\"font-bold border-t-2 border-black italic\">\r\n                                <td colSpan={4} className=\"border-r-2 border-black py-3 px-4\">(สามหมื่นบาทถ้วน)</td>\r\n                                <td className=\"border-r-2 border-black py-3 px-2 text-center\">จำนวนเงินทั้งสิ้น</td>\r\n                                <td className=\"py-3 text-right px-2\">30,000.00</td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                    <p className=\"text-[10pt] font-bold mb-8\">ทั้งนี้ท่านได้ตรวจสอบรายการจำนวนและราคาข้างต้นเรียบร้อยแล้ว</p>\r\n\r\n                    {/* Signatures */}\r\n                    <div className=\"grid grid-cols-2 gap-0 border-2 border-black mb-8\">\r\n                        <div className=\"p-4 border-r-2 border-black text-center space-y-4 pb-12\">\r\n                            <p className=\"font-bold\">ยืนยันคำขอรับการตรวจสอบและประเมิน</p>\r\n                            <div className=\"mt-12 text-center\">\r\n                                <p className=\"mb-2\">(......................................................)</p>\r\n                                <p>ตำแหน่ง......................................................</p>\r\n                                <p className=\"mt-2\">วันที่............/............/............</p>\r\n                                <p className=\"font-bold text-xs mt-4\">ผู้อนุมัติคำขอ</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 text-center space-y-4 pb-12\">\r\n                            <p className=\"font-bold\">ในนาม กองกัญชาทางการแพทย์</p>\r\n                            <div className=\"mt-12 text-center text-[10pt]\">\r\n                                <p className=\"font-bold\">( นายปรีชา หนูทิม )</p>\r\n                                <p>ตำแหน่ง ผู้อำนวยการกองกัญชาทางการแพทย์</p>\r\n                                <p>ปฏิบัติราชการแทน อธิบดีกรมการแพทย์แผนไทยและการแพทย์ทางเลือก</p>\r\n                                <p className=\"mt-2\">วันที่............/............/............</p>\r\n                                <p className=\"font-bold text-xs mt-4\">(ผู้เสนอราคา)</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bank & Footer */}\r\n                    <div className=\"text-[9pt] space-y-1\">\r\n                        <p><span className=\"font-bold\">หมายเหตุ:</span> เนื่องจากบริษัท {name} ยื่นเอกสารเมื่อวันที่ {new Date().toLocaleDateString('th-TH')} จึงเสนอราคาตามประกาศอัตราค่าบริการ กองพัฒนายาแผนไทยและสมุนไพร</p>\r\n                        <p><span className=\"font-bold\">เงื่อนไขการชำระเงิน :</span> กรุณาชำระเงินภายใน 3 วัน</p>\r\n                        <ul className=\"list-disc list-inside pl-4\">\r\n                            <li>ส่งเอกสารชุดคำขอผ่าน 2 ช่องทาง ทางไปรษณีย์หรือยื่นด้วยตนเอง</li>\r\n                            <li>ชื่อบัญชี เงินบำรุงศูนย์พัฒนายาแผนไทยและสมุนไพร</li>\r\n                            <li>บัญชีธนาคารกรุงไทย เลขที่ 4750134376 สาขามหาวิทยาลัยธรรมศาสตร์ รังสิต</li>\r\n                            <li>เลขประจำตัวผู้เสียภาษี 0994000036540</li>\r\n                            <li>เมื่อชำระเงินแล้วกรุณาส่ง ชื่อ-ที่อยู่ในการออกใบเสร็จรับเงิน พร้อมเอกสารหลักฐานการชำระเงิน มายังกองพัฒนายาแผนไทยและสมุนไพรทาง Google Form</li>\r\n                        </ul>\r\n\r\n                        <div className=\"flex justify-end mt-4\">\r\n                            <div className=\"text-center text-[8pt]\">\r\n                                <div className=\"w-16 h-16 bg-slate-100 border border-slate-200 mx-auto flex items-center justify-center mb-1\">\r\n                                    <div className=\"w-12 h-12 bg-black\"></div>\r\n                                </div>\r\n                                <span>กรุณาสแกนคิวอาร์โค้ด</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\PlatformInvoicePDF.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\PlatformQuotePDF.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepDocuments.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoIcon' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7708,7711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7708,7711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18240,18243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18240,18243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport {\r\n    CheckIcon,\r\n    UploadIcon,\r\n    WarningIcon,\r\n    InfoIcon,\r\n    DocIcon\r\n} from '@/components/icons/WizardIcons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\nimport { Icons } from '@/components/ui/icons';\r\n\r\n// Mapping slotId to ExpectedType for AI Analysis\r\nconst AI_DOC_TYPES: Record<string, string> = {\r\n    'id_card': 'ID_CARD',\r\n    'house_reg': 'HOUSE_REGISTRATION',\r\n    'land_deed': 'LAND_TITLE_DEED',\r\n    'company_reg': 'COMPANY_REGISTRATION',\r\n    'license_bt11': 'LICENSE_BT11',\r\n};\r\n\r\ninterface DocRequirement {\r\n    slotId: string;\r\n    nameKey: keyof import('@/lib/i18n/types').Dictionary['wizard']['documents']['docNames'];\r\n    required: boolean;\r\n    conditionalRequired?: boolean;\r\n    helperText?: string;\r\n    templateUrl?: string;\r\n}\r\n\r\nexport const StepDocuments = () => {\r\n    const { state, setDocuments, setYoutubeUrl: saveToStoreYoutubeUrl } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict, language } = useLanguage();\r\n\r\n    // State\r\n    const [requirements, setRequirements] = useState<DocRequirement[]>([]);\r\n    const [loadingReqs, setLoadingReqs] = useState(true);\r\n    const [youtubeUrl, setYoutubeUrl] = useState(state.youtubeUrl || '');\r\n    const [uploading, setUploading] = useState<Record<string, boolean>>({});\r\n    const [aiResults, setAiResults] = useState<Record<string, { valid: boolean; message: string; confidence?: number }>>({});\r\n\r\n    // Sync store state to local state on mount\r\n    useEffect(() => {\r\n        if (state.youtubeUrl) setYoutubeUrl(state.youtubeUrl);\r\n    }, [state.youtubeUrl]);\r\n\r\n    // Fetch Requirements\r\n    useEffect(() => {\r\n        const fetchRequirements = async () => {\r\n            setLoadingReqs(true);\r\n            try {\r\n                // Determine requirements based on state\r\n                const isHighControl = ['cannabis', 'kratom'].includes(state.plantId || '');\r\n                const isExport = state.certificationPurpose === 'EXPORT';\r\n\r\n                const coreReqs: DocRequirement[] = [\r\n                    {\r\n                        slotId: 'APP_FORM',\r\n                        nameKey: 'APP_FORM',\r\n                        required: true,\r\n                        templateUrl: '/templates/application_form_v2.pdf'\r\n                    },\r\n                    { slotId: 'house_reg', nameKey: 'house_reg', required: true },\r\n                    { slotId: 'land_deed', nameKey: 'land_deed', required: true },\r\n                    {\r\n                        slotId: 'land_consent',\r\n                        nameKey: 'land_consent',\r\n                        required: false,\r\n                        conditionalRequired: state.siteData?.landOwnership === 'RENT' || state.siteData?.landOwnership === 'CONSENT',\r\n                        templateUrl: '/templates/land_consent_form.pdf'\r\n                    },\r\n                    { slotId: 'site_map', nameKey: 'site_map', required: true },\r\n                    { slotId: 'building_plan', nameKey: 'building_plan', required: true },\r\n                    { slotId: 'photos_exterior', nameKey: 'photos_exterior', required: true },\r\n                    { slotId: 'photos_interior', nameKey: 'photos_interior', required: true },\r\n                    { slotId: 'production_plan', nameKey: 'production_plan', required: true, templateUrl: '/templates/production_plan_template.xlsx' },\r\n                    { slotId: 'security_measures', nameKey: 'security_measures', required: true },\r\n                    { slotId: 'medical_cert', nameKey: 'medical_cert', required: false },\r\n                ];\r\n\r\n                if (isHighControl) {\r\n                    coreReqs.push({ slotId: 'elearning_cert', nameKey: 'elearning_cert', required: true });\r\n                    coreReqs.push({ slotId: 'strain_cert', nameKey: 'strain_cert', required: true });\r\n                }\r\n\r\n                const exportReqs: DocRequirement[] = [\r\n                    { slotId: 'sop_thai', nameKey: 'sop_thai', required: true, templateUrl: '/templates/sop_guideline.pdf' },\r\n                    { slotId: 'training_records', nameKey: 'training_records', required: true },\r\n                    { slotId: 'staff_test', nameKey: 'staff_test', required: true },\r\n                    { slotId: 'soil_water_test', nameKey: 'soil_water_test', required: true },\r\n                    { slotId: 'flower_test', nameKey: 'flower_test', required: true },\r\n                    { slotId: 'input_report', nameKey: 'input_report', required: true },\r\n                    { slotId: 'cp_ccp_plan', nameKey: 'cp_ccp_plan', required: true },\r\n                    { slotId: 'calibration_cert', nameKey: 'calibration_cert', required: true },\r\n                ];\r\n\r\n                const finalReqs = [...coreReqs];\r\n                if (isExport) {\r\n                    finalReqs.push(...exportReqs);\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    setRequirements(finalReqs);\r\n                    setLoadingReqs(false);\r\n                }, 800);\r\n\r\n            } catch (err) {\r\n                console.error(err);\r\n                setLoadingReqs(false);\r\n            }\r\n        };\r\n        fetchRequirements();\r\n    }, [state.plantId, state.siteData?.landOwnership, state.certificationPurpose]);\r\n\r\n    // Derived State\r\n    const uploadedDocIds = state.documents.filter(doc => doc.uploaded && doc.id).map(doc => doc.id!);\r\n    const missingRequirements = requirements.filter(req => !uploadedDocIds.includes(req.slotId));\r\n    const completedRequirements = requirements.filter(req => uploadedDocIds.includes(req.slotId));\r\n    const mandatoryDocs = requirements.filter(r => r.required || r.conditionalRequired);\r\n    const optionalDocs = requirements.filter(r => !r.required && !r.conditionalRequired);\r\n\r\n    // Handlers\r\n    const handleFileUpload = async (slotId: string, file: File) => {\r\n        setUploading(prev => ({ ...prev, [slotId]: true }));\r\n        setAiResults(prev => {\r\n            const n = { ...prev }; delete n[slotId]; return n;\r\n        });\r\n\r\n        try {\r\n            // Mock API call\r\n            await new Promise(resolve => setTimeout(resolve, 1500));\r\n\r\n            const isMatch = true;\r\n            const confidence = 98;\r\n\r\n            if (isMatch) {\r\n                setAiResults(prev => ({\r\n                    ...prev,\r\n                    [slotId]: {\r\n                        valid: isMatch,\r\n                        message: language === 'th' ? 'เอกสารถูกต้อง (AI Verified)' : 'Document Valid (AI Verified)',\r\n                        confidence\r\n                    }\r\n                }));\r\n            }\r\n\r\n            const newDocs = [...state.documents.filter(d => d.id !== slotId)];\r\n            newDocs.push({\r\n                id: slotId,\r\n                name: file.name,\r\n                uploaded: true,\r\n                url: URL.createObjectURL(file),\r\n                metadata: { manualEntry: false }\r\n            });\r\n            setDocuments(newDocs);\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            setAiResults(prev => ({\r\n                ...prev,\r\n                [slotId]: { valid: false, message: language === 'th' ? 'เกิดข้อผิดพลาดในการอัปโหลด' : 'Upload Error' }\r\n            }));\r\n        } finally {\r\n            setUploading(prev => ({ ...prev, [slotId]: false }));\r\n        }\r\n    };\r\n\r\n    const handleUpdateMetadata = (slotId: string, updates: any) => {\r\n        const newDocs = state.documents.map(d => {\r\n            if (d.id === slotId) {\r\n                return { ...d, metadata: { ...d.metadata, ...updates } };\r\n            }\r\n            return d;\r\n        });\r\n        setDocuments(newDocs);\r\n    };\r\n\r\n    const handleAreaChange = (slotId: string, field: 'rai' | 'ngan' | 'sqWa', value: string) => {\r\n        const numVal = parseFloat(value) || 0;\r\n        const currentDoc = state.documents.find(d => d.id === slotId);\r\n        const currentArea = currentDoc?.metadata?.area || { rai: 0, ngan: 0, sqWa: 0 };\r\n\r\n        handleUpdateMetadata(slotId, {\r\n            area: { ...currentArea, [field]: numVal },\r\n            manualEntry: true\r\n        });\r\n    };\r\n\r\n    // Render Helpers\r\n    const renderDocCard = (req: DocRequirement) => {\r\n        const doc = state.documents.find(d => d.id === req.slotId);\r\n        const isUploading = uploading[req.slotId];\r\n        const aiResult = aiResults[req.slotId];\r\n        const isAiSupported = !!AI_DOC_TYPES[req.slotId];\r\n        const displayName = dict.wizard.documents.docNames[req.nameKey] || req.nameKey;\r\n\r\n        return (\r\n            <div key={req.slotId} className={`\r\n                relative bg-white rounded-2xl transition-all duration-300 overflow-hidden group\r\n                ${doc\r\n                    ? 'border-2 border-primary/20 shadow-sm'\r\n                    : 'border border-gray-200 shadow-sm hover:shadow-lg hover:border-primary/40'\r\n                }\r\n            `}>\r\n                <div className=\"p-6\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <div className=\"flex-1 min-w-0 pr-4\">\r\n                            <h4 className={`font-bold text-sm mb-1 flex flex-wrap items-center gap-2 ${doc ? 'text-primary-900' : 'text-gray-700'}`}>\r\n                                {displayName}\r\n                                {(req.required || req.conditionalRequired) && !doc && (\r\n                                    <span className=\"text-[10px] text-red-600 bg-red-50 px-2 py-0.5 rounded-full border border-red-100 font-bold\">\r\n                                        * {language === 'th' ? 'จำเป็น' : 'Required'}\r\n                                    </span>\r\n                                )}\r\n                            </h4>\r\n                            <p className=\"text-[10px] text-text-tertiary flex items-center gap-1\">\r\n                                {isAiSupported && <span className=\"text-primary-600 font-bold bg-primary-50 px-1.5 py-0.5 rounded-md\">✨ AI Smart Scan</span>}\r\n                                {req.helperText || (language === 'th' ? 'รองรับ PDF, JPG, PNG' : 'Supports PDF, JPG, PNG')}\r\n                            </p>\r\n                        </div>\r\n                        {doc && (\r\n                            <div className=\"w-7 h-7 rounded-full bg-primary text-white flex items-center justify-center shadow-lg animate-scale-in\">\r\n                                <CheckIcon className=\"w-4 h-4\" />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {req.templateUrl && !doc && (\r\n                        <div className=\"mb-4\">\r\n                            <a href={req.templateUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"inline-flex items-center gap-1.5 text-[10px] text-primary font-bold hover:bg-primary hover:text-white bg-primary-50 px-3 py-1.5 rounded-xl border border-primary-100 transition-all\">\r\n                                <Icons.Download className=\"w-3 h-3\" />\r\n                                {dict.wizard.documents.downloadForm}\r\n                            </a>\r\n                        </div>\r\n                    )}\r\n\r\n                    {!doc ? (\r\n                        <label className={`\r\n                            relative h-32 w-full rounded-2xl border-2 border-dashed flex flex-col items-center justify-center cursor-pointer transition-all duration-300 overflow-hidden bg-gray-50/50\r\n                            ${isUploading\r\n                                ? 'border-primary bg-primary-50'\r\n                                : 'border-gray-200 hover:border-primary-300 hover:bg-primary-50/30'\r\n                            }\r\n                        `}>\r\n                            {isUploading ? (\r\n                                <div className=\"flex flex-col items-center animate-pulse\">\r\n                                    <div className=\"w-8 h-8 border-[3px] border-primary border-t-transparent rounded-full animate-spin mb-2\"></div>\r\n                                    <span className=\"text-[10px] font-bold text-primary\">{dict.wizard.documents.messages.analyzing}</span>\r\n                                </div>\r\n                            ) : (\r\n                                <>\r\n                                    <div className=\"w-12 h-12 rounded-2xl bg-white text-gray-400 flex items-center justify-center mb-2 group-hover:scale-110 group-hover:text-primary group-hover:shadow-md transition-all shadow-sm border border-gray-100\">\r\n                                        <UploadIcon className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                    <span className=\"text-[10px] font-bold text-gray-500 group-hover:text-primary transition-colors\">{dict.wizard.documents.upload}</span>\r\n                                </>\r\n                            )}\r\n                            <input\r\n                                type=\"file\"\r\n                                className=\"hidden\"\r\n                                accept=\"image/*,application/pdf\"\r\n                                disabled={isUploading}\r\n                                onChange={(e) => {\r\n                                    const file = e.target.files?.[0];\r\n                                    if (file) handleFileUpload(req.slotId, file);\r\n                                }}\r\n                            />\r\n                        </label>\r\n                    ) : (\r\n                        <div className=\"bg-gradient-to-br from-gray-50 to-white rounded-2xl p-4 border border-gray-100 group-hover:border-primary-100 transition-all shadow-inner\">\r\n                            <div className=\"flex items-center justify-between gap-3\">\r\n                                <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                                    <div className=\"w-10 h-10 bg-white rounded-xl border border-gray-100 flex items-center justify-center text-primary shadow-sm\">\r\n                                        <DocIcon className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"text-xs font-bold text-gray-900 truncate\">{doc.name}</div>\r\n                                        <div className=\"text-[10px] text-emerald-600 font-bold flex items-center gap-1 mt-0.5\">\r\n                                            <CheckIcon className=\"w-3 h-3\" />\r\n                                            {dict.wizard.documents.messages.valid}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setDocuments(state.documents.filter(d => d.id !== req.slotId));\r\n                                        setAiResults(prev => { const n = { ...prev }; delete n[req.slotId]; return n; });\r\n                                    }}\r\n                                    className=\"p-1.5 rounded-xl text-gray-300 hover:text-danger hover:bg-danger-50 transition-all\"\r\n                                >\r\n                                    <Icons.Trash className=\"w-4 h-4\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Specialized Fields: Land Deed */}\r\n                            {req.slotId === 'land_deed' && (\r\n                                <div className=\"mt-4 pt-4 border-t border-dashed border-gray-200 animate-slide-up\">\r\n                                    <div className=\"flex justify-between items-center mb-2 px-1\">\r\n                                        <span className=\"text-[10px] font-bold text-gray-500 uppercase tracking-wider\">{language === 'th' ? 'ข้อมูลขนาดพื้นที่ (โฉนด)' : 'Title Deed Area'}</span>\r\n                                        {!doc.metadata?.manualEntry && (\r\n                                            <button\r\n                                                onClick={() => handleUpdateMetadata(req.slotId, { manualEntry: true })}\r\n                                                className=\"text-[10px] text-primary hover:underline font-black\"\r\n                                            >\r\n                                                {language === 'th' ? 'แก้ไข' : 'Edit'}\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {['rai', 'ngan', 'sqWa'].map((unit) => (\r\n                                            <div key={unit} className=\"bg-white rounded-xl border border-gray-100 p-2 text-center shadow-sm\">\r\n                                                <label className=\"block text-[8px] text-gray-400 uppercase font-bold mb-0.5\">\r\n                                                    {unit === 'sqWa' ? (language === 'th' ? 'ตร.ว.' : 'Sq.Wa') :\r\n                                                        (unit === 'rai' ? (language === 'th' ? 'ไร่' : 'Rai') :\r\n                                                            (language === 'th' ? 'งาน' : 'Ngan'))}\r\n                                                </label>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    className=\"w-full text-center text-xs font-black text-gray-900 bg-transparent outline-none\"\r\n                                                    value={doc.metadata?.area?.[unit as keyof typeof doc.metadata.area] ?? ''}\r\n                                                    placeholder=\"0\"\r\n                                                    onChange={(e) => handleAreaChange(req.slotId, unit as any, e.target.value)}\r\n                                                    readOnly={!doc.metadata?.manualEntry && !!doc.metadata?.area}\r\n                                                />\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* AI Result Feedback */}\r\n                            {aiResult && (\r\n                                <div className={`mt-3 text-[10px] p-2.5 rounded-xl flex items-center justify-between font-bold animate-slide-down ${aiResult.valid ? 'bg-emerald-50 text-emerald-700 border border-emerald-100' : 'bg-red-50 text-red-700 border border-red-100'\r\n                                    }`}>\r\n                                    <span className=\"flex items-center gap-1.5 leading-none\">\r\n                                        {aiResult.valid ? <CheckIcon className=\"w-3.5 h-3.5\" /> : <WarningIcon className=\"w-3.5 h-3.5\" />}\r\n                                        {aiResult.message}\r\n                                    </span>\r\n                                    {aiResult.confidence && aiResult.valid && (\r\n                                        <span className=\"bg-white/60 px-1.5 py-0.5 rounded-lg shadow-sm font-black\">\r\n                                            {Math.round(aiResult.confidence)}%\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    9\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.documents.title}</h2>\r\n                    <p className=\"text-text-secondary\">{dict.wizard.documents.subtitle}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {loadingReqs ? (\r\n                <div className=\"flex flex-col items-center justify-center h-80 gap-6 bg-white rounded-[2rem] border border-gray-100 shadow-premium\">\r\n                    <div className=\"relative\">\r\n                        <div className=\"w-16 h-16 border-4 border-primary/10 border-t-primary rounded-full animate-spin\"></div>\r\n                        <div className=\"absolute inset-x-0 -bottom-8 flex justify-center\">\r\n                            <span className=\"w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:-0.3s]\"></span>\r\n                            <span className=\"w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:-0.15s] mx-1\"></span>\r\n                            <span className=\"w-2 h-2 rounded-full bg-primary animate-bounce\"></span>\r\n                        </div>\r\n                    </div>\r\n                    <span className=\"text-gray-400 font-bold uppercase tracking-widest text-xs\">{language === 'th' ? 'กำลังเตรียมรายการเอกสาร...' : 'Preparing document list...'}</span>\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {/* Dashboard Status Card */}\r\n                    <div className=\"gacp-card bg-gradient-to-br from-primary shadow-soft relative overflow-hidden border-none text-white p-8 animate-slide-up\">\r\n                        <div className=\"absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none\"></div>\r\n                        <div className=\"absolute bottom-0 left-0 w-64 h-64 bg-black/10 rounded-full blur-3xl -ml-20 -mb-20 pointer-events-none\"></div>\r\n\r\n                        <div className=\"relative z-10 flex flex-col md:flex-row justify-between items-center gap-8\">\r\n                            <div className=\"flex items-center gap-8 w-full md:w-auto\">\r\n                                <div className=\"text-center md:text-left\">\r\n                                    <p className=\"text-[10px] text-white/60 font-black uppercase tracking-widest mb-1\">{dict.wizard.documents.status.mandatory}</p>\r\n                                    <p className=\"text-4xl font-black\">{mandatoryDocs.length}</p>\r\n                                </div>\r\n                                <div className=\"h-12 w-px bg-white/20\"></div>\r\n                                <div className=\"text-center md:text-left\">\r\n                                    <p className=\"text-[10px] text-white/60 font-black uppercase tracking-widest mb-1\">{dict.wizard.documents.status.uploaded}</p>\r\n                                    <p className=\"text-4xl font-black text-emerald-300\">{completedRequirements.length}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex flex-col items-center md:items-end gap-3\">\r\n                                {missingRequirements.length === 0 ? (\r\n                                    <div className=\"inline-flex items-center gap-2 px-6 py-3 bg-white/20 backdrop-blur-md text-white rounded-2xl text-sm font-black shadow-lg border border-white/30 animate-pulse-soft\">\r\n                                        <CheckIcon className=\"w-5 h-5 text-emerald-300\" />\r\n                                        {dict.wizard.documents.status.complete}\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"inline-flex items-center gap-2 px-6 py-3 bg-white text-primary rounded-2xl text-sm font-black shadow-lg\">\r\n                                        <Icons.Info className=\"w-5 h-5 text-amber-500\" />\r\n                                        {dict.wizard.documents.status.missingCount.replace('{n}', missingRequirements.length.toString())}\r\n                                    </div>\r\n                                )}\r\n                                <p className=\"text-[10px] text-white/50 font-medium italic\">* แนะนำให้อัปโหลดไฟล์ PDF เพื่อความชัดเจนสูงสุด</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Missing Documents Section */}\r\n                    {missingRequirements.length > 0 && (\r\n                        <div className=\"space-y-6 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"w-2 h-8 bg-amber-400 rounded-full\"></div>\r\n                                <h3 className=\"font-black text-xl text-gray-800 tracking-tight\">\r\n                                    {dict.wizard.documents.headers.todo}\r\n                                </h3>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                {missingRequirements.map((req) => renderDocCard(req))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Completed Documents Section */}\r\n                    {completedRequirements.length > 0 && (\r\n                        <div className=\"space-y-6 animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"w-2 h-8 bg-emerald-500 rounded-full\"></div>\r\n                                <h3 className=\"font-black text-xl text-gray-800 tracking-tight\">\r\n                                    {dict.wizard.documents.headers.done}\r\n                                </h3>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n                                {completedRequirements.map((req) => {\r\n                                    const doc = state.documents.find(d => d.id === req.slotId);\r\n                                    const displayName = String(dict.wizard.documents.docNames[req.nameKey as keyof typeof dict.wizard.documents.docNames] || req.nameKey);\r\n                                    if (!doc) return null;\r\n                                    return (\r\n                                        <div key={req.slotId} className=\"bg-white border border-gray-100 rounded-2xl p-4 flex items-center gap-4 shadow-sm hover:shadow-md transition-all group relative overflow-hidden\">\r\n                                            <div className=\"absolute top-0 left-0 w-1 h-full bg-emerald-500\"></div>\r\n                                            <div className=\"w-10 h-10 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center flex-shrink-0 border border-emerald-100\">\r\n                                                <Icons.CheckCircle className=\"w-6 h-6\" />\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"text-[10px] font-black text-emerald-500 uppercase mb-0.5 tracking-wider\">Completed</div>\r\n                                                <div className=\"text-xs font-bold text-gray-900 truncate\" title={displayName}>{displayName}</div>\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setDocuments(state.documents.filter(d => d.id !== req.slotId));\r\n                                                    setAiResults(prev => { const n = { ...prev }; delete n[req.slotId]; return n; });\r\n                                                }}\r\n                                                className=\"text-gray-300 hover:text-danger opacity-0 group-hover:opacity-100 transition-all p-1\"\r\n                                            >\r\n                                                <Icons.Trash className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Optional / Extra Links */}\r\n                    <div className=\"gacp-card p-8 mt-12 animate-slide-up bg-gradient-to-br from-white to-blue-50/30 border-blue-100\" style={{ animationDelay: '300ms' }}>\r\n                        <div className=\"flex items-center gap-3 mb-8\">\r\n                            <div className=\"p-3 bg-blue-100 text-blue-600 rounded-2xl shadow-sm\">\r\n                                <Icons.Video className=\"w-6 h-6\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-xl font-black text-gray-800 tracking-tight\">{dict.wizard.documents.extra.video}</h3>\r\n                                <p className=\"text-xs text-gray-500\">{dict.wizard.documents.extra.hint}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mb-10 max-w-2xl\">\r\n                            <FormLabelWithHint label={dict.wizard.documents.extra.video} hint={dict.wizard.documents.extra.hint} />\r\n                            <div className=\"relative group\">\r\n                                <div className=\"absolute inset-y-0 left-4 flex items-center text-gray-400 group-focus-within:text-primary transition-colors\">\r\n                                    <Icons.Link className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"https://youtube.com/watch?v=...\"\r\n                                    className=\"gacp-input pl-12 bg-white\"\r\n                                    value={youtubeUrl}\r\n                                    onChange={(e) => setYoutubeUrl(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {optionalDocs.length > 0 && (\r\n                            <div className=\"space-y-6\">\r\n                                <h4 className=\"font-bold text-sm text-gray-600 uppercase tracking-widest px-1\">เอกสารเพิ่มเติม (Optional)</h4>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                    {optionalDocs.map((req) => renderDocCard(req))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </>\r\n            )}\r\n\r\n            <WizardNavigation\r\n                onNext={() => {\r\n                    saveToStoreYoutubeUrl(youtubeUrl);\r\n                    router.push('/farmer/applications/new/step/10');\r\n                }}\r\n                onBack={() => router.push('/farmer/applications/new/step/8')}\r\n                isNextDisabled={false}\r\n                nextLabel={dict.wizard.navigation.next}\r\n                backLabel={dict.wizard.navigation.back}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepDocuments;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepFarm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WarningIcon' is defined but never used.","line":11,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PlantIcon' is defined but never used.","line":11,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoIcon' is defined but never used.","line":11,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore, FarmData, StepDocument } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport dynamic from 'next/dynamic';\r\nimport { useGACPData } from '@/hooks/useGACPData';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport { InlineDocumentUpload } from '@/components/InlineDocumentUpload';\r\nimport { CheckIcon, WarningIcon, PlantIcon, InfoIcon, SecureIcon } from '@/components/icons/WizardIcons';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\n// Dynamically import map to avoid SSR issues\r\nconst InteractiveMap = dynamic(() => import('@/components/InteractiveMap'), {\r\n    ssr: false,\r\n    loading: () => <div className=\"h-64 bg-slate-50 rounded-[2rem] animate-pulse flex items-center justify-center text-slate-400 font-bold\">กำลังโหลดแผนภาพพื้นที่...</div>\r\n});\r\n\r\ninterface FarmDoc {\r\n    id: string;\r\n    name: string;\r\n    nameEn: string;\r\n    required: boolean;\r\n    condition?: string;\r\n}\r\n\r\nconst FARM_DOCUMENTS: FarmDoc[] = [\r\n    { id: 'land_title', name: 'เอกสารสิทธิ์ที่ดิน (โฉนด/น.ส.4/ส.ป.ก.)', nameEn: 'Land Title Document', required: true },\r\n    { id: 'rental_contract', name: 'สัญญาเช่า (กรณีเช่าที่ดิน)', nameEn: 'Rental Contract', required: false, condition: 'landOwnership === \"RENT\"' },\r\n    { id: 'consent_letter', name: 'หนังสือยินยอมใช้ที่ดิน', nameEn: 'Land Use Consent Letter', required: false, condition: 'landOwnership === \"CONSENT\"' },\r\n    { id: 'farm_map', name: 'แผนที่ฟาร์ม/ผังบริเวณ', nameEn: 'Farm Layout Map', required: true },\r\n    { id: 'water_quality_report', name: 'ผลวิเคราะห์คุณภาพน้ำ', nameEn: 'Water Quality Analysis Report', required: false },\r\n];\r\n\r\nexport const StepFarm = () => {\r\n    const { state, setFarmData } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    // API-First: Fetch GACP data\r\n    const {\r\n        environmentChecklist,\r\n        waterSources,\r\n        securityRequirements,\r\n        loading: gacpLoading,\r\n    } = useGACPData(4);\r\n\r\n    const [formData, setFormData] = useState<Partial<FarmData> & { environmentChecks?: Record<string, boolean>; securityChecks?: Record<string, boolean> }>(state.farmData || {\r\n        farmName: '',\r\n        address: '',\r\n        province: '',\r\n        totalAreaSize: '',\r\n        totalAreaUnit: 'Rai',\r\n        landOwnership: 'OWN',\r\n        waterSource: '',\r\n        hasFence: false,\r\n        hasCCTV: false,\r\n        documents: [],\r\n    });\r\n\r\n    const [envChecks, setEnvChecks] = useState<Record<string, boolean>>(state.farmData?.environmentChecks || {});\r\n    const [securityChecks, setSecurityChecks] = useState<Record<string, boolean>>(state.farmData?.securityChecks || {});\r\n    const [uploadedDocs, setUploadedDocs] = useState<StepDocument[]>((state.farmData?.documents || []) as StepDocument[]);\r\n\r\n    // Auto-save to store\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            if (formData.farmName) {\r\n                setFarmData({\r\n                    ...formData,\r\n                    documents: uploadedDocs,\r\n                    environmentChecks: envChecks,\r\n                    securityChecks: securityChecks\r\n                } as FarmData);\r\n            }\r\n        }, 500);\r\n        return () => clearTimeout(timeout);\r\n    }, [formData, uploadedDocs, envChecks, securityChecks, setFarmData]);\r\n\r\n    const handleChange = (field: keyof FarmData, value: any) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleLocationSelect = (lat: number, lng: number) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            gpsLat: lat.toFixed(6),\r\n            gpsLng: lng.toFixed(6)\r\n        }));\r\n    };\r\n\r\n    const handleDocUpload = (docId: string, url: string | null, fileName?: string) => {\r\n        if (!url) {\r\n            setUploadedDocs(prev => prev.filter(d => d.docType !== docId));\r\n            return;\r\n        }\r\n\r\n        const newDoc: StepDocument = {\r\n            stepNumber: 4,\r\n            docType: docId,\r\n            fileName: fileName || 'Uploaded Document',\r\n            fileUrl: url,\r\n            uploadedAt: new Date().toISOString(),\r\n            required: FARM_DOCUMENTS.find(d => d.id === docId)?.required || false,\r\n        };\r\n\r\n        setUploadedDocs(prev => {\r\n            const filtered = prev.filter(d => d.docType !== docId);\r\n            return [...filtered, newDoc];\r\n        });\r\n    };\r\n\r\n    // Validation\r\n    const requiredEnvChecksPassed = environmentChecklist.filter(e => e.required).every(e => envChecks[e.id]);\r\n    const hasBasicInfo = formData.farmName && formData.address && formData.province && formData.totalAreaSize;\r\n    const isFormValid = hasBasicInfo && requiredEnvChecksPassed;\r\n\r\n    if (gacpLoading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-6 animate-pulse\">\r\n                <div className=\"w-16 h-16 rounded-full border-4 border-primary border-t-transparent animate-spin ring-8 ring-primary/10\"></div>\r\n                <div className=\"text-center\">\r\n                    <p className=\"text-primary-900 font-black text-lg\">กำลังโหลดมาตรฐาน GACP</p>\r\n                    <p className=\"text-slate-400 text-sm\">กรุณารอสักครู่เพื่อดึงข้อมูลเกณฑ์การตรวจประเมิน...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n\r\n            {/* Step Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    3\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.farm.title}</h2>\r\n                    <p className=\"text-text-secondary\">{dict.wizard.farm.subtitle}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Section 1: Basic Info */}\r\n            <section className=\"gacp-card p-10 animate-slide-up\">\r\n                <div className=\"flex items-center gap-4 mb-10\">\r\n                    <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                        1\r\n                    </div>\r\n                    <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.farm.sections.general}</h3>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                    <div className=\"md:col-span-2 space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.fields.farmName} required />\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"gacp-input\"\r\n                            placeholder=\"เช่น ไร่สมุนไพรสุขใจ\"\r\n                            value={formData.farmName}\r\n                            onChange={(e) => handleChange('farmName', e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"md:col-span-2 space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.fields.address} required />\r\n                        <textarea\r\n                            className=\"gacp-input min-h-[120px] resize-none py-4\"\r\n                            placeholder=\"บ้านเลขที่, หมู่, ถนน...\"\r\n                            value={formData.address}\r\n                            onChange={(e) => handleChange('address', e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.fields.province} required />\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"gacp-input\"\r\n                            value={formData.province}\r\n                            onChange={(e) => handleChange('province', e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.fields.totalArea} required />\r\n                        <div className=\"flex gap-4\">\r\n                            <input\r\n                                type=\"number\"\r\n                                className=\"gacp-input flex-1\"\r\n                                placeholder=\"จำนวน\"\r\n                                value={formData.totalAreaSize}\r\n                                onChange={(e) => handleChange('totalAreaSize', e.target.value)}\r\n                            />\r\n                            <select\r\n                                className=\"gacp-input w-40\"\r\n                                value={formData.totalAreaUnit}\r\n                                onChange={(e) => handleChange('totalAreaUnit', e.target.value)}\r\n                            >\r\n                                <option value=\"Rai\">ไร่</option>\r\n                                <option value=\"Ngan\">งาน</option>\r\n                                <option value=\"Sqm\">ตร.ม.</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.fields.ownership} />\r\n                        <select\r\n                            className=\"gacp-input\"\r\n                            value={formData.landOwnership}\r\n                            onChange={(e) => handleChange('landOwnership', e.target.value)}\r\n                        >\r\n                            <option value=\"OWN\">{dict.wizard.farm.fields.ownershipOptions.owner}</option>\r\n                            <option value=\"RENT\">{dict.wizard.farm.fields.ownershipOptions.rented}</option>\r\n                            <option value=\"CONSENT\">{dict.wizard.farm.fields.ownershipOptions.consent}</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <FormLabelWithHint label={dict.wizard.farm.water.source} />\r\n                        <select\r\n                            className=\"gacp-input\"\r\n                            value={formData.waterSource}\r\n                            onChange={(e) => handleChange('waterSource', e.target.value)}\r\n                        >\r\n                            <option value=\"\">-- เลือกแหล่งน้ำ --</option>\r\n                            {waterSources.map(ws => (\r\n                                <option key={ws.id} value={ws.id}>{ws.nameTH}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* GPS Section */}\r\n                <div className=\"mt-12 pt-10 border-t border-slate-100 space-y-8\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <h4 className=\"font-black text-slate-800 flex items-center gap-3\">\r\n                            <Icons.MapPin className=\"w-5 h-5 text-primary\" />\r\n                            ตำแหน่งพิกัดแปลง (GPS)\r\n                        </h4>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => {\r\n                                if (navigator.geolocation) {\r\n                                    navigator.geolocation.getCurrentPosition(\r\n                                        (pos) => handleLocationSelect(pos.coords.latitude, pos.coords.longitude),\r\n                                        () => alert('ไม่สามารถระบุตำแหน่งได้')\r\n                                    );\r\n                                }\r\n                            }}\r\n                            className=\"bg-primary/5 hover:bg-primary/10 text-primary px-4 py-2 rounded-xl text-xs font-black transition-all flex items-center gap-2\"\r\n                        >\r\n                            <Icons.Target className=\"w-4 h-4\" />\r\n                            ใช้ตำแหน่งปัจจุบัน\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"h-96 w-full rounded-[2.5rem] overflow-hidden shadow-inner border-[6px] border-slate-50 relative z-0 group\">\r\n                        <InteractiveMap\r\n                            initialLat={formData.gpsLat ? parseFloat(formData.gpsLat) : 13.736717}\r\n                            initialLng={formData.gpsLng ? parseFloat(formData.gpsLng) : 100.523186}\r\n                            onLocationSelect={handleLocationSelect}\r\n                        />\r\n                        <div className=\"absolute bottom-6 left-6 flex gap-3 z-10\">\r\n                            <div className=\"px-4 py-3 bg-white/90 backdrop-blur-md rounded-2xl border border-white shadow-premium flex items-center gap-3\">\r\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest border-r border-slate-200 pr-3\">Lat</span>\r\n                                <span className=\"font-mono text-primary-900 font-black\">{formData.gpsLat || '-'}</span>\r\n                            </div>\r\n                            <div className=\"px-4 py-3 bg-white/90 backdrop-blur-md rounded-2xl border border-white shadow-premium flex items-center gap-3\">\r\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest border-r border-slate-200 pr-3\">Lng</span>\r\n                                <span className=\"font-mono text-primary-900 font-black\">{formData.gpsLng || '-'}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Section 2: GACP Environment & Security */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n\r\n                {/* Environment Checks */}\r\n                <section className=\"gacp-card p-10 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                    <div className=\"flex items-center gap-4 mb-8\">\r\n                        <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                            2\r\n                        </div>\r\n                        <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.farm.sections.environment}</h3>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        {environmentChecklist.map(item => {\r\n                            const isChecked = envChecks[item.id] || false;\r\n                            return (\r\n                                <button\r\n                                    key={item.id}\r\n                                    onClick={() => setEnvChecks(prev => ({ ...prev, [item.id]: !prev[item.id] }))}\r\n                                    className={`\r\n                                        w-full p-5 rounded-[2rem] text-left border-2 transition-all duration-300 flex items-center gap-5 group\r\n                                        ${isChecked\r\n                                            ? 'border-primary bg-primary-50/50 shadow-soft'\r\n                                            : 'border-slate-50 bg-white hover:border-primary/20 hover:shadow-premium-hover'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${isChecked ? 'bg-primary text-white shadow-lg' : 'bg-slate-50 text-slate-300'}`}>\r\n                                        <CheckIcon className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <p className={`text-sm font-black leading-snug ${isChecked ? 'text-primary-900' : 'text-slate-600'}`}>{item.nameTH}</p>\r\n                                        {item.required && <span className=\"text-[9pt] font-black text-rose-500 uppercase tracking-tighter mt-1 block\">จำเป็นตามมาตรฐาน GACP</span>}\r\n                                    </div>\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Security Checks */}\r\n                <section className=\"gacp-card p-10 animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                    <div className=\"flex items-center gap-4 mb-8\">\r\n                        <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                            3\r\n                        </div>\r\n                        <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.farm.sections.security}</h3>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        {securityRequirements.map(item => {\r\n                            const isChecked = securityChecks[item.id] || false;\r\n                            return (\r\n                                <button\r\n                                    key={item.id}\r\n                                    onClick={() => setSecurityChecks(prev => ({ ...prev, [item.id]: !prev[item.id] }))}\r\n                                    className={`\r\n                                        w-full p-5 rounded-[2rem] text-left border-2 transition-all duration-300 flex items-center gap-5 group\r\n                                        ${isChecked\r\n                                            ? 'border-primary bg-primary-50/50 shadow-soft'\r\n                                            : 'border-slate-50 bg-white hover:border-primary/20 hover:shadow-premium-hover'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${isChecked ? 'bg-primary text-white shadow-lg' : 'bg-slate-50 text-slate-300'}`}>\r\n                                        <SecureIcon className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <p className={`text-sm font-black ${isChecked ? 'text-primary-900' : 'text-slate-600'}`}>{item.nameTH}</p>\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </section>\r\n            </div>\r\n\r\n            {/* Section 4: Documents */}\r\n            <section className=\"gacp-card p-10 animate-slide-up\" style={{ animationDelay: '300ms' }}>\r\n                <div className=\"flex items-center gap-4 mb-10\">\r\n                    <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                        4\r\n                    </div>\r\n                    <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.farm.sections.documents}</h3>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                    {FARM_DOCUMENTS.map(doc => {\r\n                        // Check conditions\r\n                        if (doc.condition) {\r\n                            if (doc.condition === 'landOwnership === \"RENT\"' && formData.landOwnership !== 'RENT') return null;\r\n                            if (doc.condition === 'landOwnership === \"CONSENT\"' && formData.landOwnership !== 'CONSENT') return null;\r\n                        }\r\n                        const currentDoc = uploadedDocs.find(d => d.docType === doc.id);\r\n\r\n                        return (\r\n                            <InlineDocumentUpload\r\n                                key={doc.id}\r\n                                id={doc.id}\r\n                                label={doc.name}\r\n                                labelEn={doc.nameEn}\r\n                                required={doc.required}\r\n                                value={currentDoc?.fileUrl}\r\n                                onChange={(file, url) => handleDocUpload(doc.id, url, file?.name)}\r\n                            />\r\n                        );\r\n                    })}\r\n                </div>\r\n            </section>\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/4')}\r\n                onBack={() => router.push('/farmer/applications/new/step/2')}\r\n                isNextDisabled={!isFormValid}\r\n                showBack={true}\r\n                nextLabel={dict.wizard.navigation.next}\r\n                backLabel={dict.wizard.navigation.back}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepFarm;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepGeneral.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.firstName'. Either include it or remove the dependency array.","line":159,"column":8,"nodeType":"ArrayExpression","endLine":159,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [formData.firstName, user]","fix":{"range":[6311,6317],"text":"[formData.firstName, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6525,6528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6525,6528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7218,7221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7218,7221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8032,8035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8032,8035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepGeneral.tsx:137:13\n  135 |         if (existing) {\n  136 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 137 |             setIdCardDoc(existing.idCardDoc || null);\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  138 |             setHouseRegDoc(existing.houseRegDoc || null);\n  139 |             setCommunityRegDoc(existing.communityRegDoc || null);\n  140 |             setCommunityMeetingDoc(existing.communityMeetingDoc || null);","line":137,"column":13,"nodeType":null,"endLine":137,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepGeneral.tsx:149:13\n  147 |         if (user && !formData.firstName) {\n  148 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 149 |             setFormData(prev => ({\n      |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  150 |                 ...prev,\n  151 |                 firstName: user.firstName || prev.firstName,\n  152 |                 lastName: user.lastName || prev.lastName,","line":149,"column":13,"nodeType":null,"endLine":149,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useAuth } from '@/lib/services/auth-provider';\r\nimport { InlineDocumentUpload } from '@/components/InlineDocumentUpload';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\nimport { Icons } from '@/components/ui/icons';\r\n\r\n// Local Icons to avoid build crash\r\nconst CheckIcon = ({ className = \"w-6 h-6\" }: { className?: string }) => (\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" className={className} stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <polyline points=\"20 6 9 17 4 12\" />\r\n    </svg>\r\n);\r\n\r\nconst PersonIcon = ({ className = \"w-6 h-6\" }: { className?: string }) => (\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" className={className} stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\" />\r\n        <circle cx=\"12\" cy=\"7\" r=\"4\" />\r\n    </svg>\r\n);\r\n\r\nconst BuildingIcon = ({ className = \"w-6 h-6\" }: { className?: string }) => (\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" className={className} stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <rect x=\"4\" y=\"2\" width=\"16\" height=\"20\" rx=\"2\" ry=\"2\" />\r\n        <path d=\"M9 22v-4h6v4\" />\r\n        <path d=\"M8 6h.01\" />\r\n        <path d=\"M16 6h.01\" />\r\n        <path d=\"M8 10h.01\" />\r\n        <path d=\"M16 10h.01\" />\r\n        <path d=\"M8 14h.01\" />\r\n        <path d=\"M16 14h.01\" />\r\n        <path d=\"M12 6h.01\" />\r\n        <path d=\"M12 10h.01\" />\r\n        <path d=\"M12 14h.01\" />\r\n    </svg>\r\n);\r\n\r\nconst GroupIcon = ({ className = \"w-6 h-6\" }: { className?: string }) => (\r\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" className={className} stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\r\n        <circle cx=\"9\" cy=\"7\" r=\"4\" />\r\n        <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\" />\r\n        <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\r\n    </svg>\r\n);\r\n\r\n// Local interface definition to prevent import mismatches\r\ninterface LocalApplicantData {\r\n    applicantType: 'INDIVIDUAL' | 'JURISTIC' | 'COMMUNITY';\r\n    firstName?: string;\r\n    lastName?: string;\r\n    idCard?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    address?: string;\r\n    province?: string;\r\n    district?: string;\r\n    subdistrict?: string;\r\n    postalCode?: string;\r\n    communityName?: string;\r\n    communityAddress?: string;\r\n    communityRegDate?: string;\r\n    presidentName?: string;\r\n    presidentIdCard?: string;\r\n    presidentPhone?: string;\r\n    memberCount?: number;\r\n    registrationSVC01?: string;\r\n    registrationTVC3?: string;\r\n    houseRegistrationCode?: string;\r\n    registeredAddress?: string;\r\n    companyName?: string;\r\n    companyAddress?: string;\r\n    companyPhone?: string;\r\n    companyType?: string;\r\n    taxId?: string;\r\n    registeredCapital?: string;\r\n    directorName?: string;\r\n    directorIdCard?: string;\r\n    directorPhone?: string;\r\n    directorEmail?: string;\r\n    directorPosition?: string;\r\n    registrationNumber?: string;\r\n    powerOfAttorneyUrl?: string;\r\n    coordinatorName?: string;\r\n    coordinatorPhone?: string;\r\n    coordinatorLineId?: string;\r\n    contactName?: string;\r\n    contactPhone?: string;\r\n    contactEmail?: string;\r\n    idCardDoc?: string;\r\n    houseRegDoc?: string;\r\n    communityRegDoc?: string;\r\n    communityMeetingDoc?: string;\r\n    companyRegDoc?: string;\r\n    directorListDoc?: string;\r\n    contact?: string;\r\n}\r\n\r\nconst StepGeneralComponent = () => {\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n    const { state, setApplicantData } = useWizardStore();\r\n    const { dict } = useLanguage();\r\n\r\n    const [formData, setFormData] = useState<Partial<LocalApplicantData>>(() => {\r\n        const existingData = state.applicantData as unknown as LocalApplicantData | null;\r\n        if (existingData?.applicantType) return existingData;\r\n\r\n        return {\r\n            applicantType: 'INDIVIDUAL',\r\n            firstName: user?.firstName ?? '',\r\n            lastName: user?.lastName ?? '',\r\n            idCard: user?.idCard ?? '',\r\n            phone: user?.phone ?? '',\r\n            address: user?.address ?? '',\r\n            email: user?.email ?? '',\r\n        };\r\n    });\r\n\r\n    const [idCardDoc, setIdCardDoc] = useState<string | null>(null);\r\n    const [houseRegDoc, setHouseRegDoc] = useState<string | null>(null);\r\n    const [communityRegDoc, setCommunityRegDoc] = useState<string | null>(null);\r\n    const [communityMeetingDoc, setCommunityMeetingDoc] = useState<string | null>(null);\r\n    const [companyRegDoc, setCompanyRegDoc] = useState<string | null>(null);\r\n    const [directorListDoc, setDirectorListDoc] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Hydrate docs from state if available\r\n        const existing = state.applicantData as unknown as LocalApplicantData | null;\r\n        if (existing) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setIdCardDoc(existing.idCardDoc || null);\r\n            setHouseRegDoc(existing.houseRegDoc || null);\r\n            setCommunityRegDoc(existing.communityRegDoc || null);\r\n            setCommunityMeetingDoc(existing.communityMeetingDoc || null);\r\n            setCompanyRegDoc(existing.companyRegDoc || null);\r\n            setDirectorListDoc(existing.directorListDoc || null);\r\n        }\r\n    }, [state.applicantData]);\r\n\r\n    useEffect(() => {\r\n        if (user && !formData.firstName) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                firstName: user.firstName || prev.firstName,\r\n                lastName: user.lastName || prev.lastName,\r\n                idCard: user.idCard || prev.idCard,\r\n                phone: user.phone || prev.phone,\r\n                address: user.address || prev.address,\r\n                email: user.email || prev.email,\r\n            }));\r\n        }\r\n    }, [user]); // Removed formData.firstName to prevent cyclic dependency\r\n\r\n    const handleTypeChange = (typeId: string) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            applicantType: typeId as any\r\n        }));\r\n    };\r\n\r\n    const handleChange = (field: string, value: string) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleNext = () => {\r\n        const completeData: LocalApplicantData = {\r\n            ...formData as LocalApplicantData,\r\n            idCardDoc: idCardDoc || undefined,\r\n            houseRegDoc: houseRegDoc || undefined,\r\n            communityRegDoc: communityRegDoc || undefined,\r\n            communityMeetingDoc: communityMeetingDoc || undefined,\r\n            companyRegDoc: companyRegDoc || undefined,\r\n            directorListDoc: directorListDoc || undefined,\r\n        };\r\n\r\n        setApplicantData(completeData as any);\r\n        router.push('/farmer/applications/new?step=2');\r\n    };\r\n\r\n    const renderInput = (id: string, label: string, value?: string, required = false, placeholder = '') => (\r\n        <div className=\"space-y-2\">\r\n            <FormLabelWithHint label={label} required={required} />\r\n            <input\r\n                type=\"text\"\r\n                value={value || ''}\r\n                onChange={(e) => handleChange(id, e.target.value)}\r\n                placeholder={placeholder}\r\n                className=\"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all font-medium text-slate-700 placeholder:text-slate-400\"\r\n            />\r\n        </div>\r\n    );\r\n\r\n    const isUserType = user && (user as any).applicantType;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    2\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.general.title}</h2>\r\n                    <p className=\"text-text-secondary\">{dict.wizard.general.subtitle}</p>\r\n                </div>\r\n            </div>\r\n\r\n            <section className=\"gacp-card p-10 space-y-8\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                        1\r\n                    </div>\r\n                    <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.general.typeHeader || 'เลือกประเภทผู้ยื่นคำขอ'}</h3>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col md:flex-row gap-6\">\r\n                    {/* INDIVIDUAL BUTTON */}\r\n                    <button\r\n                        onClick={() => !(isUserType && isUserType !== 'INDIVIDUAL') && handleTypeChange('INDIVIDUAL')}\r\n                        disabled={!!(isUserType && isUserType !== 'INDIVIDUAL')}\r\n                        className={`\r\n                            relative p-6 rounded-[1.5rem] border-2 text-left transition-all duration-300 group\r\n                            ${formData.applicantType === 'INDIVIDUAL'\r\n                                ? 'border-primary-500 bg-primary-50/50 shadow-md ring-4 ring-primary-500/10'\r\n                                : isUserType && isUserType !== 'INDIVIDUAL'\r\n                                    ? 'border-slate-100 bg-slate-50 opacity-60 cursor-not-allowed'\r\n                                    : 'border-slate-100 bg-white hover:border-primary-200 hover:shadow-lg hover:-translate-y-1'\r\n                            }\r\n                        `}\r\n                    >\r\n                        <div className={`\r\n                            w-14 h-14 rounded-2xl flex items-center justify-center mb-4 transition-colors duration-300\r\n                            ${formData.applicantType === 'INDIVIDUAL' ? 'bg-primary text-white shadow-lg shadow-primary/30' : 'bg-slate-100 text-slate-400 group-hover:bg-primary-50 group-hover:text-primary-600'}\r\n                        `}>\r\n                            <PersonIcon className=\"w-7 h-7\" />\r\n                        </div>\r\n                        <h4 className={`font-bold text-lg mb-1 ${formData.applicantType === 'INDIVIDUAL' ? 'text-primary-900' : 'text-slate-700'}`}>\r\n                            บุคคลธรรมดา\r\n                        </h4>\r\n                        <p className=\"text-xs text-slate-400 font-medium tracking-wide uppercase\">Individual</p>\r\n                        {formData.applicantType === 'INDIVIDUAL' && (\r\n                            <div className=\"absolute top-4 right-4 text-primary animate-scale-in\">\r\n                                <CheckIcon className=\"w-6 h-6\" />\r\n                            </div>\r\n                        )}\r\n                    </button>\r\n\r\n                    {/* COMMUNITY BUTTON */}\r\n                    <button\r\n                        onClick={() => !(isUserType && isUserType !== 'COMMUNITY') && handleTypeChange('COMMUNITY')}\r\n                        disabled={!!(isUserType && isUserType !== 'COMMUNITY')}\r\n                        className={`\r\n                            relative p-6 rounded-[1.5rem] border-2 text-left transition-all duration-300 group\r\n                            ${formData.applicantType === 'COMMUNITY'\r\n                                ? 'border-primary-500 bg-primary-50/50 shadow-md ring-4 ring-primary-500/10'\r\n                                : isUserType && isUserType !== 'COMMUNITY'\r\n                                    ? 'border-slate-100 bg-slate-50 opacity-60 cursor-not-allowed'\r\n                                    : 'border-slate-100 bg-white hover:border-primary-200 hover:shadow-lg hover:-translate-y-1'\r\n                            }\r\n                        `}\r\n                    >\r\n                        <div className={`\r\n                            w-14 h-14 rounded-2xl flex items-center justify-center mb-4 transition-colors duration-300\r\n                            ${formData.applicantType === 'COMMUNITY' ? 'bg-primary text-white shadow-lg shadow-primary/30' : 'bg-slate-100 text-slate-400 group-hover:bg-primary-50 group-hover:text-primary-600'}\r\n                        `}>\r\n                            <GroupIcon className=\"w-7 h-7\" />\r\n                        </div>\r\n                        <h4 className={`font-bold text-lg mb-1 ${formData.applicantType === 'COMMUNITY' ? 'text-primary-900' : 'text-slate-700'}`}>\r\n                            วิสาหกิจชุมชน\r\n                        </h4>\r\n                        <p className=\"text-xs text-slate-400 font-medium tracking-wide uppercase\">Community Enterprise</p>\r\n                        {formData.applicantType === 'COMMUNITY' && (\r\n                            <div className=\"absolute top-4 right-4 text-primary animate-scale-in\">\r\n                                <CheckIcon className=\"w-6 h-6\" />\r\n                            </div>\r\n                        )}\r\n                    </button>\r\n\r\n                    {/* JURISTIC BUTTON */}\r\n                    <button\r\n                        onClick={() => !(isUserType && isUserType !== 'JURISTIC') && handleTypeChange('JURISTIC')}\r\n                        disabled={!!(isUserType && isUserType !== 'JURISTIC')}\r\n                        className={`\r\n                            relative p-6 rounded-[1.5rem] border-2 text-left transition-all duration-300 group\r\n                            ${formData.applicantType === 'JURISTIC'\r\n                                ? 'border-primary-500 bg-primary-50/50 shadow-md ring-4 ring-primary-500/10'\r\n                                : isUserType && isUserType !== 'JURISTIC'\r\n                                    ? 'border-slate-100 bg-slate-50 opacity-60 cursor-not-allowed'\r\n                                    : 'border-slate-100 bg-white hover:border-primary-200 hover:shadow-lg hover:-translate-y-1'\r\n                            }\r\n                        `}\r\n                    >\r\n                        <div className={`\r\n                            w-14 h-14 rounded-2xl flex items-center justify-center mb-4 transition-colors duration-300\r\n                            ${formData.applicantType === 'JURISTIC' ? 'bg-primary text-white shadow-lg shadow-primary/30' : 'bg-slate-100 text-slate-400 group-hover:bg-primary-50 group-hover:text-primary-600'}\r\n                        `}>\r\n                            <BuildingIcon className=\"w-7 h-7\" />\r\n                        </div>\r\n                        <h4 className={`font-bold text-lg mb-1 ${formData.applicantType === 'JURISTIC' ? 'text-primary-900' : 'text-slate-700'}`}>\r\n                            นิติบุคคล\r\n                        </h4>\r\n                        <p className=\"text-xs text-slate-400 font-medium tracking-wide uppercase\">Juristic Person</p>\r\n                        {formData.applicantType === 'JURISTIC' && (\r\n                            <div className=\"absolute top-4 right-4 text-primary animate-scale-in\">\r\n                                <CheckIcon className=\"w-6 h-6\" />\r\n                            </div>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </section>\r\n\r\n            <section className=\"gacp-card p-10 space-y-8\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-10 h-10 rounded-2xl bg-primary/10 text-primary flex items-center justify-center font-black\">\r\n                        2\r\n                    </div>\r\n                    <h3 className=\"text-xl font-black text-slate-800\">{dict.wizard.general.infoHeader || 'ข้อมูลผู้สมัคร'}</h3>\r\n                </div>\r\n\r\n                {formData.applicantType === 'INDIVIDUAL' && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in\">\r\n                        {renderInput('firstName', 'ชื่อ', formData.firstName, true)}\r\n                        {renderInput('lastName', 'นามสกุล', formData.lastName, true)}\r\n                        {renderInput('idCard', 'เลขบัตรประชาชน', formData.idCard, true)}\r\n                        {renderInput('phone', 'เบอร์โทรศัพท์', formData.phone, true)}\r\n                        <div className=\"md:col-span-2\">\r\n                            {renderInput('address', 'ที่อยู่ตามทะเบียนบ้าน', formData.address, true)}\r\n                        </div>\r\n                        <div className=\"md:col-span-2 bg-slate-50/50 rounded-[2rem] p-8 border border-slate-100 mt-4\">\r\n                            <h4 className=\"font-black text-slate-800 mb-6 flex items-center gap-3\">\r\n                                <Icons.FileText className=\"w-5 h-5 text-primary\" />\r\n                                เอกสารยืนยันตัวตน\r\n                            </h4>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <InlineDocumentUpload\r\n                                    id=\"id-card\"\r\n                                    label=\"สำเนาบัตรประชาชน\"\r\n                                    labelEn=\"ID Card Copy\"\r\n                                    required={true}\r\n                                    value={idCardDoc || undefined}\r\n                                    onChange={(file, url) => setIdCardDoc(url)}\r\n                                />\r\n                                <InlineDocumentUpload\r\n                                    id=\"house-reg\"\r\n                                    label=\"สำเนาทะเบียนบ้าน\"\r\n                                    labelEn=\"House Registration\"\r\n                                    required={true}\r\n                                    value={houseRegDoc || undefined}\r\n                                    onChange={(file, url) => setHouseRegDoc(url)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {formData.applicantType === 'COMMUNITY' && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                        <div className=\"md:col-span-2 space-y-2\">\r\n                            <FormLabelWithHint label=\"ชื่อวิสาหกิจชุมชน\" required />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"gacp-input\"\r\n                                placeholder=\"วิสาหกิจชุมชนกลุ่มผู้ปลูกสมุนไพร...\"\r\n                                value={formData.communityName || ''}\r\n                                onChange={(e) => handleChange('communityName', e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <FormLabelWithHint label=\"รหัสทะเบียน ทว.ช.3\" required />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"gacp-input font-mono\"\r\n                                placeholder=\"00-00-00-00-00\"\r\n                                value={formData.registrationSVC01 || ''}\r\n                                onChange={(e) => handleChange('registrationSVC01', e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <FormLabelWithHint label=\"ชื่อ-นามสกุล ประธาน\" required />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"gacp-input\"\r\n                                value={formData.presidentName || ''}\r\n                                onChange={(e) => handleChange('presidentName', e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"md:col-span-2 space-y-2\">\r\n                            <FormLabelWithHint label=\"ที่อยู่วิสาหกิจชุมชน\" required />\r\n                            <textarea\r\n                                className=\"gacp-input min-h-[120px] resize-none py-4\"\r\n                                placeholder=\"ที่ตั้งวิสาหกิจ...\"\r\n                                value={formData.communityAddress || ''}\r\n                                onChange={(e) => handleChange('communityAddress', e.target.value)}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2 bg-slate-50/50 rounded-[2rem] p-8 border border-slate-100 mt-4\">\r\n                            <h4 className=\"font-black text-slate-800 mb-6 flex items-center gap-3\">\r\n                                <Icons.FileText className=\"w-5 h-5 text-primary\" />\r\n                                เอกสารประกอบวิสาหกิจชุมชน\r\n                            </h4>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <InlineDocumentUpload\r\n                                    id=\"community-reg\"\r\n                                    label=\"สำเนาทะเบียน ทว.ช.3\"\r\n                                    labelEn=\"Certificate\"\r\n                                    required={true}\r\n                                    value={communityRegDoc || undefined}\r\n                                    onChange={(file, url) => setCommunityRegDoc(url)}\r\n                                />\r\n                                <InlineDocumentUpload\r\n                                    id=\"community-meeting\"\r\n                                    label=\"รายงานการประชุม\"\r\n                                    labelEn=\"Meeting Minutes\"\r\n                                    required={true}\r\n                                    value={communityMeetingDoc || undefined}\r\n                                    onChange={(file, url) => setCommunityMeetingDoc(url)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {formData.applicantType === 'JURISTIC' && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                        <div className=\"md:col-span-2 space-y-2\">\r\n                            <FormLabelWithHint label=\"ชื่อบริษัท/ห้างหุ้นส่วน\" required />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"gacp-input\"\r\n                                value={formData.companyName || ''}\r\n                                onChange={(e) => handleChange('companyName', e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <FormLabelWithHint label=\"เลขทะเบียนนิติบุคคล\" required hint=\"13 หลัก\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"gacp-input font-mono tracking-widest\"\r\n                                value={formData.registrationNumber || ''}\r\n                                onChange={(e) => handleChange('registrationNumber', e.target.value)}\r\n                                maxLength={13}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <FormLabelWithHint label=\"ประเภทนิติบุคคล\" required />\r\n                            <select\r\n                                className=\"gacp-input\"\r\n                                value={formData.companyType || ''}\r\n                                onChange={(e) => handleChange('companyType', e.target.value)}\r\n                            >\r\n                                <option value=\"\">-- เลือกประเภท --</option>\r\n                                <option value=\"COMPANY_LIMITED\">บริษัทจำกัด</option>\r\n                                <option value=\"PUBLIC_COMPANY_LIMITED\">บริษัทมหาชนจำกัด</option>\r\n                                <option value=\"LIMITED_PARTNERSHIP\">ห้างหุ้นส่วนจำกัด</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2 bg-slate-50/50 rounded-[2rem] p-8 border border-slate-100 mt-4\">\r\n                            <h4 className=\"font-black text-slate-800 mb-6 flex items-center gap-3\">\r\n                                <Icons.FileText className=\"w-5 h-5 text-primary\" />\r\n                                เอกสารประกอบนิติบุคคล\r\n                            </h4>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <InlineDocumentUpload\r\n                                    id=\"company-reg\"\r\n                                    label=\"หนังสือรับรองบริษัท\"\r\n                                    labelEn=\"Company Registration\"\r\n                                    required={true}\r\n                                    value={companyRegDoc || undefined}\r\n                                    onChange={(file, url) => setCompanyRegDoc(url)}\r\n                                />\r\n                                <InlineDocumentUpload\r\n                                    id=\"director-list\"\r\n                                    label=\"รายชื่อผู้ถือหุ้น (บอจ.5)\"\r\n                                    labelEn=\"Shareholder List\"\r\n                                    required={true}\r\n                                    value={directorListDoc || undefined}\r\n                                    onChange={(file, url) => setDirectorListDoc(url)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </section>\r\n\r\n            <WizardNavigation\r\n                onNext={handleNext}\r\n                onBack={() => router.push('/farmer/dashboard')}\r\n                isNextDisabled={!formData.firstName || !formData.lastName || !formData.phone}\r\n                nextLabel={dict.wizard.navigation.next}\r\n                backLabel={dict.wizard.navigation.back}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const StepGeneral = StepGeneralComponent;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepHarvest.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dict' is assigned a value but never used.","line":16,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1295,1298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1295,1298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { PlantQRCalculator } from '@/components/PlantQRCalculator';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport { InfoIcon, WarningIcon, CheckIcon } from '@/components/icons/WizardIcons';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\nexport const StepHarvest = () => {\r\n    const { state, setHarvestData, updateState } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    const [formData, setFormData] = useState(state.harvestData || {\r\n        harvestMethod: '',\r\n        dryingMethod: '',\r\n        dryingDetail: '',\r\n        storageSystem: '',\r\n        packaging: '',\r\n    });\r\n\r\n    const [touched, setTouched] = useState<Record<string, boolean>>({});\r\n\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            setHarvestData(formData as any);\r\n        }, 500);\r\n        return () => clearTimeout(timeout);\r\n    }, [formData, setHarvestData]);\r\n\r\n    const handleChange = (field: string, value: any) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n        setTouched(prev => ({ ...prev, [field]: true }));\r\n    };\r\n\r\n    const validate = () => {\r\n        const errors: Record<string, string> = {};\r\n        if (!formData.harvestMethod) errors.harvestMethod = 'กรุณาเลือกวิธีการเก็บเกี่ยว';\r\n        if (!formData.dryingMethod) errors.dryingMethod = 'กรุณาเลือกวิธีการลดความชื้น';\r\n        if (formData.dryingMethod === 'OTHER' && !formData.dryingDetail?.trim()) {\r\n            errors.dryingDetail = 'กรุณาระบุรายละเอียดวิธีการตากแห้ง';\r\n        }\r\n        if (!formData.storageSystem) errors.storageSystem = 'กรุณาเลือกสถานที่เก็บรักษา';\r\n        if (!formData.packaging?.trim()) errors.packaging = 'กรุณาระบุข้อมูลบรรจุภัณฑ์';\r\n        return errors;\r\n    };\r\n\r\n    const errors = validate();\r\n    const isValid = Object.keys(errors).length === 0;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    8\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">การเก็บเกี่ยวและจัดการ (Harvest & Post-Harvest)</h2>\r\n                    <p className=\"text-text-secondary\">ระบุวิธีการเก็บเกี่ยว การลดความชื้น และการเก็บรักษาตามมาตรฐาน GACP</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info Banner */}\r\n            <div className=\"p-6 bg-blue-50/80 backdrop-blur-sm border border-blue-200 rounded-2xl flex gap-4 text-blue-900 shadow-sm animate-slide-up\">\r\n                <div className=\"p-2 bg-white rounded-xl shadow-sm h-fit\">\r\n                    <InfoIcon className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-bold text-blue-900 text-sm\">ข้อกำหนดการจัดการหลังเก็บเกี่ยว</p>\r\n                    <p className=\"text-xs leading-relaxed text-blue-800/80\">\r\n                        การจัดการผลผลิตหลังเก็บเกี่ยวมีความสำคัญอย่างยิ่งต่อคุณภาพของสารสำคัญในสมุนไพร\r\n                        กรุณาระบุข้อมูลให้ตรงกับความเป็นจริงเพื่อการประเมินความเสี่ยงที่ถูกต้อง\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                {/* 1. Harvest & Drying */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"gacp-card p-6 space-y-5 border-emerald-100 bg-gradient-to-br from-emerald-50/30 to-white\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                            <span className=\"text-2xl\">🌾</span>\r\n                            <h3 className=\"font-bold text-gray-900\">วิธีการเก็บเกี่ยว (Harvesting)</h3>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <FormLabelWithHint label=\"วิธีการเก็บเกี่ยว\" required />\r\n                            <select\r\n                                className={`gacp-input bg-white ${touched.harvestMethod && errors.harvestMethod ? 'border-danger ring-danger/10' : ''}`}\r\n                                value={formData.harvestMethod}\r\n                                onChange={(e) => handleChange('harvestMethod', e.target.value)}\r\n                            >\r\n                                <option value=\"\">-- กรุณาเลือก --</option>\r\n                                <option value=\"MANUAL\">เก็บด้วยมือ (Manual)</option>\r\n                                <option value=\"MACHINE\">ใช้เครื่องจักร (Machine)</option>\r\n                            </select>\r\n                            {touched.harvestMethod && errors.harvestMethod && (\r\n                                <p className=\"text-xs text-danger mt-1.5 flex items-center gap-1 font-medium italic\">\r\n                                    <WarningIcon className=\"w-3 h-3\" /> {errors.harvestMethod}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-emerald-50/50 rounded-xl border border-emerald-100 flex gap-3 text-xs text-emerald-700\">\r\n                            <div className=\"mt-0.5\">💡</div>\r\n                            <p>เลือก &quot;Machine&quot; หากใช้รถเกี่ยวข้าวหรืออุปกรณ์ทุ่นแรงขนาดใหญ่ หากใช้แรงงานคนและอุปกรณ์ขนาดเล็ก ให้เลือก &quot;Manual&quot;</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"gacp-card p-6 space-y-5 border-orange-100 bg-gradient-to-br from-orange-50/30 to-white\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                            <span className=\"text-2xl\">☀️</span>\r\n                            <h3 className=\"font-bold text-gray-900\">การลดความชื้น (Drying)</h3>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <FormLabelWithHint label=\"วิธีการลดความชื้น\" required />\r\n                            <select\r\n                                className={`gacp-input bg-white ${touched.dryingMethod && errors.dryingMethod ? 'border-danger ring-danger/10' : ''}`}\r\n                                value={formData.dryingMethod}\r\n                                onChange={(e) => handleChange('dryingMethod', e.target.value)}\r\n                            >\r\n                                <option value=\"\">-- กรุณาเลือก --</option>\r\n                                <option value=\"SUN\">ตากแดดธรรมชาติ (Sun Dry)</option>\r\n                                <option value=\"OVEN\">ตู้อบความร้อน (Hot Air Oven)</option>\r\n                                <option value=\"DEHYDRATOR\">เครื่องลดความชื้น (Dehydrator)</option>\r\n                                <option value=\"OTHER\">อื่นๆ (Other)</option>\r\n                            </select>\r\n                            {touched.dryingMethod && errors.dryingMethod && (\r\n                                <p className=\"text-xs text-danger mt-1.5 flex items-center gap-1 font-medium italic\">\r\n                                    <WarningIcon className=\"w-3 h-3\" /> {errors.dryingMethod}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {formData.dryingMethod === 'OTHER' && (\r\n                            <div className=\"animate-slide-down\">\r\n                                <FormLabelWithHint label=\"โปรดระบุรายละเอียด\" required />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className={`gacp-input bg-white ${touched.dryingDetail && errors.dryingDetail ? 'border-danger ring-danger/10' : ''}`}\r\n                                    placeholder=\"เช่น ตากในห้องควบคุมความชื้น...\"\r\n                                    value={formData.dryingDetail}\r\n                                    onChange={(e) => handleChange('dryingDetail', e.target.value)}\r\n                                />\r\n                                {touched.dryingDetail && errors.dryingDetail && (\r\n                                    <p className=\"text-xs text-danger mt-1.5 flex items-center gap-1 font-medium italic\">\r\n                                        <WarningIcon className=\"w-3 h-3\" /> {errors.dryingDetail}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"p-4 bg-orange-50/50 rounded-xl border border-orange-100 flex gap-3 text-xs text-orange-700\">\r\n                            <div className=\"mt-0.5\">📋</div>\r\n                            <p><strong>Requirement:</strong> ความชื้นที่เหมาะสมของผลผลิตแห้งควรต่ำกว่า 10-12% เพื่อป้องกันการเกิดเชื้อราและสาร Aflatoxin</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 2. Storage & Packaging */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"gacp-card p-6 space-y-6 border-blue-100 bg-gradient-to-br from-blue-50/30 to-white h-full relative overflow-hidden\">\r\n                        <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-100/20 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none\"></div>\r\n\r\n                        <div className=\"flex items-center gap-2 mb-2 relative z-10\">\r\n                            <span className=\"text-2xl\">📦</span>\r\n                            <h3 className=\"font-bold text-gray-900\">การเก็บรักษา (Storage)</h3>\r\n                        </div>\r\n\r\n                        <div className=\"relative z-10\">\r\n                            <FormLabelWithHint label=\"สถานที่เก็บรักษา\" required />\r\n                            <select\r\n                                className={`gacp-input bg-white ${touched.storageSystem && errors.storageSystem ? 'border-danger ring-danger/10' : ''}`}\r\n                                value={formData.storageSystem}\r\n                                onChange={(e) => handleChange('storageSystem', e.target.value)}\r\n                            >\r\n                                <option value=\"\">-- กรุณาเลือก --</option>\r\n                                <option value=\"CONTROLLED\">ห้องควบคุมอุณหภูมิ (Controlled Temp)</option>\r\n                                <option value=\"AMBIENT\">ห้องอุณหภูมิปกติ (Ambient Temp)</option>\r\n                            </select>\r\n                            {touched.storageSystem && errors.storageSystem && (\r\n                                <p className=\"text-xs text-danger mt-1.5 flex items-center gap-1 font-medium italic\">\r\n                                    <WarningIcon className=\"w-3 h-3\" /> {errors.storageSystem}\r\n                                </p>\r\n                            )}\r\n                            <p className=\"text-[10px] text-slate-400 mt-2 italic px-1\">\r\n                                * สถานที่เก็บต้องแยกจากสารเคมี ปุ๋ย และทำความสะอาดง่าย\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"relative z-10\">\r\n                            <FormLabelWithHint label=\"บรรจุภัณฑ์ (Packaging)\" required />\r\n                            <textarea\r\n                                className={`gacp-input bg-white h-32 resize-none ${touched.packaging && errors.packaging ? 'border-danger ring-danger/10' : ''}`}\r\n                                placeholder=\"ระบุชนิดถุง/ภาชนะที่ใช้บรรจุ เช่น ถุงสูญญากาศ Food Grade, กระสอบป่านใหม่...\"\r\n                                value={formData.packaging}\r\n                                onChange={(e) => handleChange('packaging', e.target.value)}\r\n                            />\r\n                            {touched.packaging && errors.packaging && (\r\n                                <p className=\"text-xs text-danger mt-1.5 flex items-center gap-1 font-medium italic\">\r\n                                    <WarningIcon className=\"w-3 h-3\" /> {errors.packaging}\r\n                                </p>\r\n                            )}\r\n                            <div className=\"flex items-start gap-2 mt-3 p-3 bg-blue-50/50 rounded-xl border border-blue-100 text-xs text-blue-700\">\r\n                                <span className=\"text-blue-500\">💡</span>\r\n                                <p>ควรใช้วัสดุที่สะอาด แห้ง และเป็น Food Grade เพื่อป้องกันการปนเปื้อนซ้ำ</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Warning Alert for GACP */}\r\n            <div className=\"gacp-card border-amber-200 bg-amber-50/50 p-6 flex items-start gap-4 animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                <div className=\"p-2 bg-white rounded-xl shadow-sm text-2xl\">⚠️</div>\r\n                <div>\r\n                    <h4 className=\"font-bold text-amber-900 mb-2\">ข้อสำคัญตามมาตรฐาน GACP</h4>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                        <div className=\"flex items-center gap-2 text-xs text-amber-800\">\r\n                            <div className=\"w-1.5 h-1.5 rounded-full bg-amber-400\"></div>\r\n                            <span>ไม่วางผลผลิตสัมผัสพื้นดินโดยตรง</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 text-xs text-amber-800\">\r\n                            <div className=\"w-1.5 h-1.5 rounded-full bg-amber-400\"></div>\r\n                            <span>ภาชนะบรรจุต้องสะอาดและแห้งสนิท</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 text-xs text-amber-800\">\r\n                            <div className=\"w-1.5 h-1.5 rounded-full bg-amber-400\"></div>\r\n                            <span>ความชื้นควรต่ำกว่า 10-12%</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 3. QR Tracking Preview */}\r\n            <div className=\"gacp-card border-teal-200 bg-gradient-to-br from-teal-50/50 to-white p-8 space-y-6 animate-slide-up relative overflow-hidden\" style={{ animationDelay: '300ms' }}>\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-emerald-100/20 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none\"></div>\r\n\r\n                <div className=\"flex items-center gap-3 relative z-10\">\r\n                    <div className=\"p-3 bg-teal-100 text-teal-600 rounded-2xl shadow-sm\">\r\n                        <Icons.QrCode className=\"w-6 h-6\" />\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"text-lg font-bold text-gray-900 tracking-tight\">QR Traceability (ตรวจสอบย้อนกลับ)</h3>\r\n                        <p className=\"text-xs text-gray-500\">วางแผนการติดตามผลผลิตตั้งแต่เริ่มปลูกจนถึงวันเก็บเกี่ยว</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10\">\r\n                    <div>\r\n                        <FormLabelWithHint label=\"วันที่คาดว่าจะเริ่มปลูก\" />\r\n                        <input\r\n                            type=\"date\"\r\n                            className=\"gacp-input bg-white font-bold text-primary-900\"\r\n                            value={state.cultivationDetails?.plantingDate || ''}\r\n                            onChange={(e) => {\r\n                                const plantingDate = e.target.value;\r\n                                const harvestDate = plantingDate ?\r\n                                    new Date(new Date(plantingDate).getTime() + 120 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : '';\r\n                                updateState({\r\n                                    cultivationDetails: {\r\n                                        ...(state.cultivationDetails || { method: 'outdoor', strainId: '', totalPlants: 0, plantingDate: '' }),\r\n                                        plantingDate,\r\n                                        estimatedHarvestDate: harvestDate\r\n                                    }\r\n                                });\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <FormLabelWithHint label=\"วันที่คาดว่าจะเก็บเกี่ยว (เฉลี่ย 120 วัน)\" />\r\n                        <div className=\"relative\">\r\n                            <input\r\n                                type=\"date\"\r\n                                className=\"gacp-input bg-gray-50 text-gray-400 font-bold border-gray-100\"\r\n                                value={state.cultivationDetails?.estimatedHarvestDate || ''}\r\n                                readOnly\r\n                            />\r\n                            <div className=\"absolute right-4 top-1/2 -translate-y-1/2\">\r\n                                <span className=\"text-[10px] font-bold text-primary-500 bg-primary-50 px-2 py-1 rounded-md\">Auto-calc</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white/70 backdrop-blur-sm rounded-3xl p-6 border border-teal-100 shadow-inner relative z-10\">\r\n                    <PlantQRCalculator\r\n                        plantCount={state.cultivationDetails?.totalPlants || state.lots?.reduce((s, l) => s + l.plantCount, 0) || 100}\r\n                        plantingDate={state.cultivationDetails?.plantingDate || new Date().toISOString().split('T')[0]}\r\n                        showPreview={true}\r\n                        onChange={(count, cost) => updateState({ qrCount: count, estimatedQRCost: cost })}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"flex items-start gap-4 p-5 bg-teal-50/80 rounded-2xl border border-teal-100 relative z-10\">\r\n                    <div className=\"p-2 bg-white rounded-xl shadow-sm h-fit\">\r\n                        <CheckIcon className=\"w-5 h-5 text-teal-600\" />\r\n                    </div>\r\n                    <p className=\"text-xs text-teal-800 leading-relaxed\">\r\n                        <strong>หมายเหตุ:</strong> ระบบจะออก QR Code ประจำต้นให้หลังจากที่คำขอได้รับการอนุมัติพื้นฐานแล้ว โดยรหัสจะถูกนำไปใช้ในขั้นตอนการติดตามดูแลรักษาและการเก็บเกี่ยวต่อไป\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={() => {\r\n                    const allTouched = Object.keys(formData).reduce((acc, key) => ({ ...acc, [key]: true }), {});\r\n                    setTouched(allTouched);\r\n                    if (isValid) router.push('/farmer/applications/new/step/9');\r\n                }}\r\n                onBack={() => router.push('/farmer/applications/new/step/7')}\r\n                isNextDisabled={!isValid}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepHarvest;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepInvoice.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'language' is assigned a value but never used.","line":18,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport Image from 'next/image';\r\nimport { ApplicationService, Application } from '@/lib/services/application-service';\r\nimport { apiClient } from '@/lib/api/api-client';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { SecureIcon, InfoIcon, CheckIcon } from '@/components/icons/WizardIcons';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\nimport { InvoicePDF } from './InvoicePDF';\r\n\r\nexport const StepInvoice = () => {\r\n    const { setCurrentStep, state } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict, language } = useLanguage();\r\n    const [showQrModal, setShowQrModal] = useState(false);\r\n    const [showInvoicePdf, setShowInvoicePdf] = useState(false);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [appData, setAppData] = useState<Application | null>(null);\r\n    const [phase, setPhase] = useState<1 | 2>(1);\r\n\r\n    const [invoiceNumber] = useState(() => `INV-${new Date().getFullYear()}${(Math.random() * 10000).toFixed(0)}`);\r\n    const [currentDate] = useState(() => new Date());\r\n    const [dueDate] = useState(() => {\r\n        const d = new Date();\r\n        d.setDate(d.getDate() + 7);\r\n        return d;\r\n    });\r\n\r\n    const [invoiceItems, setInvoiceItems] = useState<{ label: string; amount: number }[]>([]);\r\n\r\n    useEffect(() => {\r\n        const fetchApp = async () => {\r\n            const res = await ApplicationService.getMyApplications();\r\n            if (res.success && res.data) {\r\n                const apps: Application[] = Array.isArray(res.data)\r\n                    ? res.data\r\n                    : (res.data as unknown as { data: Application[] })?.data || [];\r\n                const activeApp = apps[0];\r\n                if (activeApp) {\r\n                    setAppData(activeApp);\r\n                    let currentPhase: 1 | 2 = 1;\r\n                    if (activeApp.status === 'PAYMENT_2_PENDING') {\r\n                        currentPhase = 2;\r\n                    }\r\n                    setPhase(currentPhase);\r\n\r\n                    const feeData = activeApp.fees || {};\r\n                    const phaseData = currentPhase === 1 ? feeData.phase1 : feeData.phase2;\r\n\r\n                    if (phaseData && phaseData.items) {\r\n                        setInvoiceItems(phaseData.items.map((i) => ({\r\n                            label: i.description,\r\n                            amount: i.amount\r\n                        })));\r\n                    } else {\r\n                        // Use values from state.milestone1 if available (from StepQuote)\r\n                        if (currentPhase === 1 && state.milestone1) {\r\n                            const items = [];\r\n                            if (state.milestone1.dtamQuote) items.push({ label: dict.wizard.quote.dtam.title, amount: state.milestone1.dtamQuote.amount });\r\n                            if (state.milestone1.platformQuote) items.push({ label: dict.wizard.quote.platform.title, amount: state.milestone1.platformQuote.amount });\r\n                            setInvoiceItems(items);\r\n                        } else {\r\n                            // Fallback\r\n                            if (currentPhase === 1) {\r\n                                setInvoiceItems([\r\n                                    { label: dict.wizard.invoice.items.standardFee, amount: 5000 },\r\n                                    { label: 'Platform Service Fee', amount: 500 }\r\n                                ]);\r\n                            } else {\r\n                                setInvoiceItems([\r\n                                    { label: dict.wizard.invoice.items.auditFee, amount: 25000 }\r\n                                ]);\r\n                            }\r\n                        }\r\n                    }\r\n                    setCurrentStep(13); // Step 14 = index 13\r\n                }\r\n            }\r\n        };\r\n        fetchApp();\r\n    }, [setCurrentStep, dict, state.milestone1]);\r\n\r\n    const handlePayClick = () => {\r\n        setIsProcessing(true);\r\n        setTimeout(() => {\r\n            setIsProcessing(false);\r\n            setShowQrModal(true);\r\n        }, 800);\r\n    };\r\n\r\n    const handlePaymentSuccess = async () => {\r\n        setIsProcessing(true);\r\n        try {\r\n            if (appData && appData._id) {\r\n                const total = invoiceItems.reduce((acc, item) => acc + item.amount, 0);\r\n                await apiClient.post(`/applications/${appData._id}/payment`, {\r\n                    phase: phase,\r\n                    amount: total,\r\n                    method: 'QR_CASH'\r\n                });\r\n            }\r\n\r\n            setTimeout(() => {\r\n                if (phase === 2) {\r\n                    router.push('/farmer/dashboard');\r\n                } else {\r\n                    router.push('/farmer/applications/new/step/15');\r\n                }\r\n            }, 1000);\r\n        } catch (error) {\r\n            console.error(\"Payment Error\", error);\r\n            alert(\"Payment failed\");\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    const totalAmount = invoiceItems.reduce((acc, item) => acc + item.amount, 0);\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in pb-20 max-w-5xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    14\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">\r\n                        {phase === 1 ? dict.wizard.invoice.phase1Title : dict.wizard.invoice.phase2Title}\r\n                    </h2>\r\n                    <p className=\"text-text-secondary\">ใบแจ้งชำระเงินสำหรับการพิจารณามาตรฐาน GACP</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Content Area */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start\">\r\n\r\n                {/* Left Column: The Invoice Paper */}\r\n                <div className=\"lg:col-span-8 group\">\r\n                    <div className=\"relative\">\r\n                        {/* Shadow Decor */}\r\n                        <div className=\"absolute inset-0 bg-primary-900/5 rounded-[2rem] blur-3xl -z-10 translate-y-4 scale-95 opacity-0 group-hover:opacity-100 transition-opacity\"></div>\r\n\r\n                        <div className=\"bg-white rounded-[2rem] shadow-premium overflow-hidden border border-gray-100 relative z-10 animate-slide-up\">\r\n                            {/* Paper Texture/Pattern */}\r\n                            <div className=\"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/natural-paper.png')]\"></div>\r\n\r\n                            {/* Color Bar */}\r\n                            <div className=\"h-3 bg-gradient-to-r from-primary-400 via-primary to-primary-800\"></div>\r\n\r\n                            <div className=\"p-8 md:p-12\">\r\n                                {/* Letterhead */}\r\n                                <div className=\"flex flex-col md:flex-row justify-between items-start border-b border-gray-100 pb-10 mb-10 gap-8\">\r\n                                    <div className=\"flex items-start gap-5\">\r\n                                        <div className=\"w-20 h-20 bg-white rounded-2xl shadow-premium-hover border border-gray-50 flex items-center justify-center p-2 relative overflow-hidden\">\r\n                                            <Image src=\"/dtam_logo_new.png\" alt=\"DTAM\" fill className=\"object-contain p-2\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h1 className=\"text-xl font-black text-primary-900 leading-tight\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</h1>\r\n                                            <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-wider mt-1\">Ministry of Public Health, Thailand</p>\r\n                                            <p className=\"text-[10px] text-gray-500 mt-2 leading-relaxed max-w-xs\">{dict.wizard.invoice.paper.orgAddress}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right w-full md:w-auto space-y-4\">\r\n                                        <div className=\"inline-block px-5 py-2 bg-primary-900 text-white text-sm font-black rounded-2xl shadow-lg uppercase tracking-widest\">\r\n                                            {dict.wizard.invoice.paper.invoiceTitle}\r\n                                        </div>\r\n                                        <div className=\"space-y-1.5 bg-gray-50 p-5 rounded-2xl border border-gray-200/50 min-w-[220px]\">\r\n                                            <p className=\"flex justify-between items-center text-[10px] font-black uppercase text-gray-400\">\r\n                                                <span>{dict.wizard.invoice.paper.no}</span>\r\n                                                <span className=\"text-gray-900\">{invoiceNumber}</span>\r\n                                            </p>\r\n                                            <p className=\"flex justify-between items-center text-[10px] font-black uppercase text-gray-400\">\r\n                                                <span>{dict.wizard.invoice.paper.date}</span>\r\n                                                <span className=\"text-gray-900\">{currentDate.toLocaleDateString('th-TH')}</span>\r\n                                            </p>\r\n                                            <p className=\"flex justify-between items-center text-[10px] font-black uppercase text-gray-400\">\r\n                                                <span>{dict.wizard.invoice.paper.dueDate}</span>\r\n                                                <span className=\"text-danger font-black\">{dueDate.toLocaleDateString('th-TH')}</span>\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Billing Info */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-10 mb-12\">\r\n                                    <div className=\"space-y-3\">\r\n                                        <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">{dict.wizard.invoice.paper.customer}</p>\r\n                                        <div className=\"p-4 rounded-2xl bg-gray-50 border border-gray-100\">\r\n                                            <p className=\"font-black text-gray-900 text-lg\">\r\n                                                {appData?.applicantData?.firstName || 'ผู้ยื่นคำขอ GACP'} {appData?.applicantData?.lastName || ''}\r\n                                            </p>\r\n                                            <p className=\"text-xs text-gray-500 mt-1 leading-relaxed\">\r\n                                                {appData?.applicantData?.address || '-'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">สถานที่ปลูก / แปลง</p>\r\n                                        <div className=\"p-4 rounded-2xl bg-gray-50 border border-gray-100\">\r\n                                            <p className=\"font-bold text-gray-800 text-sm\">{state.farmData?.farmName || '-'}</p>\r\n                                            <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-wider mt-1\">{state.plantId?.toUpperCase() || '-'} Certification</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Items Table */}\r\n                                <div className=\"border border-gray-100 rounded-[2rem] overflow-hidden shadow-inner mb-10\">\r\n                                    <table className=\"w-full text-sm\">\r\n                                        <thead>\r\n                                            <tr className=\"bg-primary text-white\">\r\n                                                <th className=\"py-5 px-6 text-left text-[10px] font-black uppercase tracking-widest\">{dict.wizard.invoice.table.description}</th>\r\n                                                <th className=\"py-5 px-6 text-right text-[10px] font-black uppercase tracking-widest w-40\">{dict.wizard.invoice.table.amount}</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-gray-50\">\r\n                                            {invoiceItems.map((item, idx) => (\r\n                                                <tr key={idx} className=\"group/row hover:bg-primary-50/30 transition-colors\">\r\n                                                    <td className=\"py-6 px-6\">\r\n                                                        <p className=\"font-black text-gray-800\">{item.label}</p>\r\n                                                        <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-tight mt-1\">GACP Standard Compliance Audit</p>\r\n                                                    </td>\r\n                                                    <td className=\"py-6 px-6 text-right font-black text-gray-900 text-lg\">฿{item.amount.toLocaleString()}.00</td>\r\n                                                </tr>\r\n                                            ))}\r\n                                            {/* Empty rows to maintain height */}\r\n                                            {invoiceItems.length < 3 && [...Array(3 - invoiceItems.length)].map((_, i) => (\r\n                                                <tr key={i}><td className=\"py-8 px-6\"></td><td className=\"py-8 px-6\"></td></tr>\r\n                                            ))}\r\n                                        </tbody>\r\n                                        <tfoot className=\"bg-primary-900 text-white\">\r\n                                            <tr>\r\n                                                <td className=\"py-8 px-8 text-right font-black uppercase tracking-widest text-white/60\">\r\n                                                    {dict.wizard.invoice.table.total}\r\n                                                </td>\r\n                                                <td className=\"py-8 px-8 text-right font-black text-4xl tracking-tighter shadow-xl\">\r\n                                                    ฿{totalAmount.toLocaleString()}.00\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tfoot>\r\n                                    </table>\r\n                                </div>\r\n\r\n                                {/* Note */}\r\n                                <div className=\"flex flex-col md:flex-row justify-between items-center gap-6 text-[10px] text-gray-400 font-bold uppercase tracking-widest\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-8 h-px bg-gray-200\"></div>\r\n                                        <span>Digital Signature Authenticated</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <span>Generated at {new Date().toLocaleTimeString()}</span>\r\n                                        <div className=\"w-8 h-px bg-gray-200\"></div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Payment Actions */}\r\n                <div className=\"lg:col-span-4 space-y-6\">\r\n                    <div className=\"gacp-card p-8 bg-white border-primary shadow-premium animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                        <h3 className=\"text-xl font-black text-primary-900 mb-6 flex items-center gap-3\">\r\n                            <div className=\"p-2 bg-primary/10 rounded-xl\">\r\n                                <SecureIcon className=\"w-6 h-6 text-primary\" />\r\n                            </div>\r\n                            ชำระเงินทันที\r\n                        </h3>\r\n\r\n                        <div className=\"space-y-4 mb-8\">\r\n                            <div className=\"p-5 rounded-2xl bg-gray-50 border border-gray-200/50 space-y-1\">\r\n                                <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest leading-none\">Net Amount Due</p>\r\n                                <p className=\"text-4xl font-black text-gray-900\">฿{totalAmount.toLocaleString()}</p>\r\n                            </div>\r\n\r\n                            <div className=\"p-4 rounded-xl bg-blue-50/50 border border-blue-100 flex gap-3 text-blue-900\">\r\n                                <InfoIcon className=\"w-5 h-5 shrink-0 text-blue-500 mt-0.5\" />\r\n                                <p className=\"text-[10px] font-bold leading-relaxed opacity-80\">\r\n                                    รองรับการชำระผ่าน Thai QR Payment, Mobile Banking และบัตรเครดิตทุกธนาคาร\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handlePayClick}\r\n                            disabled={isProcessing}\r\n                            className={`\r\n                                w-full py-4 rounded-2xl font-black text-white shadow-lg transition-all flex items-center justify-center gap-3\r\n                                ${isProcessing\r\n                                    ? 'bg-gray-400 cursor-not-allowed'\r\n                                    : 'bg-primary hover:bg-primary-600 hover:shadow-primary/30 hover:-translate-y-1 active:scale-95'\r\n                                }\r\n                            `}\r\n                        >\r\n                            {isProcessing ? (\r\n                                <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                            ) : (\r\n                                <Icons.CreditCard className=\"w-6 h-6\" />\r\n                            )}\r\n                            {isProcessing ? 'กำลังตรวจสอบ...' : 'ชำระผ่าน Mobile Banking'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"gacp-card p-6 bg-gradient-to-br from-gray-900 to-black border-none text-white animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                        <div className=\"flex gap-4 items-start\">\r\n                            <div className=\"p-3 bg-white/10 rounded-2xl backdrop-blur-md\">\r\n                                <Icons.FileText className=\"w-6 h-6 text-primary-300\" />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <h4 className=\"font-bold text-sm\">ดาวน์โหลดใบแจ้งหนี้</h4>\r\n                                <p className=\"text-[10px] text-white/50 leading-relaxed\">ท่านสามารถดาวน์โหลดไฟล์ PDF เก็บไว้เป็นหลักฐานการทำรายการ</p>\r\n                                <button\r\n                                    onClick={() => setShowInvoicePdf(true)}\r\n                                    className=\"text-[10px] font-black uppercase text-primary-300 hover:underline pt-2\"\r\n                                >\r\n                                    View Official PDF\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={handlePayClick}\r\n                onBack={() => phase === 2 ? router.push('/farmer/dashboard') : router.push('/farmer/applications/new/step/13')}\r\n                isNextDisabled={isProcessing}\r\n                nextLabel={dict.wizard.invoice.modal.simulate}\r\n            />\r\n\r\n            {/* Simulated Payment Modal */}\r\n            {showQrModal && (\r\n                <div className=\"fixed inset-0 z-[1200] flex items-center justify-center bg-gray-900/80 backdrop-blur-sm p-4 animate-fade-in\">\r\n                    <div className=\"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden animate-scale-in relative border border-white/20\">\r\n                        <div className=\"bg-[#E60000] p-8 text-white text-center relative overflow-hidden\">\r\n                            <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none\"></div>\r\n                            <h3 className=\"text-3xl font-black relative z-10 tracking-tight\">Ksher Pay</h3>\r\n                            <p className=\"text-white/60 text-[10px] font-black uppercase tracking-widest mt-1 relative z-10\">Gateway Transaction</p>\r\n                        </div>\r\n\r\n                        <div className=\"p-10 text-center space-y-8\">\r\n                            <div>\r\n                                <p className=\"text-gray-400 font-black uppercase tracking-widest text-[10px] mb-2\">{dict.wizard.invoice.modal.scanQr}</p>\r\n                                <p className=\"text-5xl font-black text-gray-900 tracking-tighter\">฿{totalAmount.toLocaleString()}</p>\r\n                            </div>\r\n\r\n                            <div className=\"w-64 h-64 bg-white mx-auto rounded-3xl border-4 border-gray-100 p-4 shadow-inner relative group cursor-pointer hover:border-primary transition-all\">\r\n                                <div className=\"absolute inset-0 bg-gradient-to-b from-primary/5 to-transparent animate-pulse rounded-2xl overflow-hidden pointer-events-none\"></div>\r\n                                <div className=\"w-full h-full bg-gray-900 rounded-2xl flex items-center justify-center relative overflow-hidden shadow-premium\">\r\n                                    <div className=\"grid grid-cols-2 grid-rows-2 w-full h-full p-4 bg-white relative\">\r\n                                        <div className=\"border-[8px] border-black m-2 rounded-xl\"></div>\r\n                                        <div className=\"border-[8px] border-black m-2 rounded-xl\"></div>\r\n                                        <div className=\"border-[8px] border-black m-2 rounded-xl\"></div>\r\n                                        <div className=\"flex items-center justify-center\">\r\n                                            <div className=\"w-12 h-12 bg-primary rounded-xl flex items-center justify-center text-white\">\r\n                                                <Icons.CheckCircle className=\"w-8 h-8\" />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 pt-4\">\r\n                                <button\r\n                                    onClick={handlePaymentSuccess}\r\n                                    className=\"w-full py-4 bg-emerald-500 text-white font-black rounded-2xl shadow-xl shadow-emerald-200 hover:bg-emerald-600 hover:-translate-y-1 transition-all flex items-center justify-center gap-3\"\r\n                                >\r\n                                    <CheckIcon className=\"w-6 h-6\" />\r\n                                    {dict.wizard.invoice.modal.simulate}\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowQrModal(false)}\r\n                                    className=\"text-gray-400 font-bold hover:text-gray-600 transition-colors text-sm\"\r\n                                >\r\n                                    {dict.wizard.invoice.modal.cancel}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {showInvoicePdf && (\r\n                <InvoicePDF\r\n                    invoiceNumber={invoiceNumber}\r\n                    quoteNumber={state.milestone1?.dtamQuote?.number || \"G-011268017\"}\r\n                    onClose={() => setShowInvoicePdf(false)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepInvoice;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepLots.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckIcon' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore, Lot } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { CheckIcon, InfoIcon } from '@/components/icons/WizardIcons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\nexport const StepLots = () => {\r\n    const { state, setLots } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    // Local lots state (sync with store)\r\n    const [lots, setLotsLocal] = useState<Lot[]>(state.lots || []);\r\n\r\n    // Modal state\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [currentLot, setCurrentLot] = useState<Partial<Lot>>({\r\n        lotCode: '',\r\n        plotId: '',\r\n        plantCount: 0,\r\n        estimatedPlantingDate: '',\r\n        status: 'PLANNED',\r\n        notes: '',\r\n    });\r\n\r\n    // Sync with store when lots change\r\n    useEffect(() => {\r\n        setLots(lots);\r\n    }, [lots, setLots]);\r\n\r\n    // Generate lot code\r\n    const generateLotCode = () => {\r\n        const year = new Date().getFullYear() % 100; // เอา 2 หลักท้าย เช่น 67\r\n        const count = lots.length + 1;\r\n        return `LOT-${year}-${String(count).padStart(3, '0')}`;\r\n    };\r\n\r\n    // Get available plots from state (check both locations for compatibility)\r\n    const availablePlots = (state.siteData?.plots && state.siteData.plots.length > 0)\r\n        ? state.siteData.plots\r\n        : (state.plots || []);\r\n\r\n    // Handle add lot\r\n    const handleAddLot = () => {\r\n        if (!currentLot.plotId || !currentLot.plantCount) return;\r\n\r\n        const selectedPlot = availablePlots.find(p => p.id === currentLot.plotId);\r\n\r\n        const newLot: Lot = {\r\n            id: crypto.randomUUID(),\r\n            lotCode: currentLot.lotCode || generateLotCode(),\r\n            plotId: currentLot.plotId,\r\n            plotName: selectedPlot?.name || '',\r\n            plantCount: currentLot.plantCount || 0,\r\n            estimatedPlantingDate: currentLot.estimatedPlantingDate,\r\n            status: 'PLANNED',\r\n            notes: currentLot.notes,\r\n        };\r\n\r\n        setLotsLocal([...lots, newLot]);\r\n        setIsModalOpen(false);\r\n        setCurrentLot({\r\n            lotCode: '',\r\n            plotId: '',\r\n            plantCount: 0,\r\n            estimatedPlantingDate: '',\r\n            status: 'PLANNED',\r\n            notes: '',\r\n        });\r\n    };\r\n\r\n    // Handle remove lot\r\n    const handleRemoveLot = (id: string) => {\r\n        setLotsLocal(lots.filter(l => l.id !== id));\r\n    };\r\n\r\n    // Calculate total plants across all lots\r\n    const totalPlants = lots.reduce((sum, lot) => sum + (lot.plantCount || 0), 0);\r\n\r\n    // Get status badge color\r\n    const getStatusBadge = (status: Lot['status']) => {\r\n        switch (status) {\r\n            case 'PLANNED': return 'gacp-badge-warning';\r\n            case 'ACTIVE': return 'gacp-badge-success';\r\n            case 'HARVESTED': return 'gacp-badge-neutral';\r\n            case 'CANCELLED': return 'gacp-badge-danger';\r\n            default: return 'gacp-badge-neutral';\r\n        }\r\n    };\r\n\r\n    // Get status label\r\n    const getStatusLabel = (status: Lot['status']) => {\r\n        switch (status) {\r\n            case 'PLANNED': return 'วางแผน';\r\n            case 'ACTIVE': return 'กำลังปลูก';\r\n            case 'HARVESTED': return 'เก็บเกี่ยวแล้ว';\r\n            case 'CANCELLED': return 'ยกเลิก';\r\n            default: return status;\r\n        }\r\n    };\r\n\r\n    // Validation\r\n    const canProceed = lots.length > 0;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    6\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.steps.lots || 'จัดการล็อตการผลิต (Lots Management)'}</h2>\r\n                    <p className=\"text-text-secondary\">วางแผนและจัดการล็อตการปลูกเพื่อการติดตามย้อนกลับ (Traceability)</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Card */}\r\n            <div className=\"gacp-card bg-gradient-to-br from-teal-50 to-white border-teal-100 relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-teal-100/30 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none\"></div>\r\n                <div className=\"flex justify-between items-center relative z-10\">\r\n                    <div>\r\n                        <p className=\"text-xs font-bold text-teal-600 uppercase tracking-wider mb-1\">จำนวนล็อตทั้งหมด</p>\r\n                        <p className=\"text-3xl font-bold text-teal-700\">{lots.length} <span className=\"text-lg text-teal-600/70 font-medium\">ล็อต</span></p>\r\n                    </div>\r\n                    <div className=\"h-12 w-px bg-teal-100 hidden md:block\"></div>\r\n                    <div>\r\n                        <p className=\"text-xs font-bold text-teal-600 uppercase tracking-wider mb-1\">จำนวนต้นพืชรวม</p>\r\n                        <p className=\"text-3xl font-bold text-emerald-700\">{totalPlants.toLocaleString()} <span className=\"text-lg text-emerald-600/70 font-medium\">ต้น</span></p>\r\n                    </div>\r\n                    <div className=\"h-12 w-px bg-teal-100 hidden md:block\"></div>\r\n                    <div>\r\n                        <p className=\"text-xs font-bold text-teal-600 uppercase tracking-wider mb-1\">แปลงปลูกที่มี</p>\r\n                        <p className=\"text-3xl font-bold text-primary-900\">{availablePlots.length} <span className=\"text-lg text-primary-600/70 font-medium\">แปลง</span></p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Lots List */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {/* Add New Button */}\r\n                <button\r\n                    onClick={() => {\r\n                        setCurrentLot({\r\n                            lotCode: generateLotCode(),\r\n                            plotId: '',\r\n                            plantCount: 0,\r\n                            estimatedPlantingDate: '',\r\n                            status: 'PLANNED',\r\n                            notes: '',\r\n                        });\r\n                        setIsModalOpen(true);\r\n                    }}\r\n                    disabled={availablePlots.length === 0}\r\n                    className={`h-48 rounded-2xl border-2 border-dashed flex flex-col items-center justify-center transition-all group relative overflow-hidden\r\n                        ${availablePlots.length === 0\r\n                            ? 'border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed'\r\n                            : 'border-primary-300 bg-primary-50/30 text-primary-700 hover:border-primary-500 hover:bg-primary-50 hover:shadow-lg'\r\n                        }`}\r\n                >\r\n                    <div className=\"w-14 h-14 rounded-full bg-white shadow-sm flex items-center justify-center mb-3 group-hover:scale-110 transition-transform text-2xl text-primary-600\">\r\n                        +\r\n                    </div>\r\n                    <span className=\"font-bold text-lg\">เพิ่มล็อตใหม่</span>\r\n                    {availablePlots.length === 0 ? (\r\n                        <span className=\"text-xs text-gray-400 mt-2 bg-white px-2 py-1 rounded-md\">กรุณาเพิ่มแปลงปลูกก่อน</span>\r\n                    ) : (\r\n                        <span className=\"text-xs text-primary-600/70 mt-1 opacity-0 group-hover:opacity-100 transition-opacity\">คลิกเพื่อสร้างล็อต</span>\r\n                    )}\r\n                </button>\r\n\r\n                {/* Existing Lots */}\r\n                {lots.map((lot) => (\r\n                    <div key={lot.id} className=\"gacp-card group hover:border-primary-300 hover:shadow-premium-hover transition-all duration-300 animate-slide-up relative\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div>\r\n                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                    <span className=\"px-2 py-0.5 rounded-md bg-gray-100 text-gray-600 text-[10px] font-mono font-medium\">\r\n                                        {lot.lotCode}\r\n                                    </span>\r\n                                </div>\r\n                                <h3 className=\"font-bold text-lg text-gray-900 line-clamp-1\" title={lot.plotName}>\r\n                                    {lot.plotName || 'ไม่ระบุแปลง'}\r\n                                </h3>\r\n                            </div>\r\n                            <span className={`gacp-badge ${getStatusBadge(lot.status)}`}>\r\n                                {getStatusLabel(lot.status)}\r\n                            </span>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3 pt-2 border-t border-gray-100\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-sm text-text-secondary\">จำนวนต้น</span>\r\n                                <span className=\"font-bold text-xl text-primary-700\">{lot.plantCount.toLocaleString()}</span>\r\n                            </div>\r\n                            {lot.estimatedPlantingDate && (\r\n                                <div className=\"flex justify-between items-center text-sm\">\r\n                                    <span className=\"text-text-secondary\">วันที่ปลูก</span>\r\n                                    <span className=\"font-medium text-gray-900\">{new Date(lot.estimatedPlantingDate).toLocaleDateString('th-TH')}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => handleRemoveLot(lot.id)}\r\n                            className=\"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-all p-2 text-danger hover:bg-danger-bg rounded-full hover:shadow-sm\"\r\n                            title=\"ลบล็อต\"\r\n                        >\r\n                            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" /><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Info Banner */}\r\n            <div className=\"p-6 bg-blue-50/80 backdrop-blur-sm border border-blue-200 rounded-2xl flex gap-4 text-blue-900 text-sm shadow-sm animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                <div className=\"p-2 bg-white rounded-xl shadow-sm h-fit\">\r\n                    <InfoIcon className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-bold text-blue-900\">เกร็ดความรู้: ล็อตการผลิต (Lot)</p>\r\n                    <p className=\"leading-relaxed text-blue-800/80\">\r\n                        ล็อตการผลิตคือหน่วยสำคัญในการตรวจสอบย้อนกลับ (Traceability) ตามมาตรฐาน GACP ระบบจะสร้าง QR Code ประจำต้นเมื่อได้รับการอนุมัติ เพื่อใช้ในการติดตาทสถานะจนถึงการเก็บเกี่ยว\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            {isModalOpen && (\r\n                <div className=\"fixed inset-0 bg-black/40 backdrop-blur-md flex items-center justify-center z-50 p-4 animate-fade-in\">\r\n                    <div className=\"bg-white/95 backdrop-blur-xl rounded-[2rem] max-w-md w-full p-8 shadow-2xl border border-white/50 animate-scale-in\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <h3 className=\"text-2xl font-bold text-primary-900\">เพิ่มล็อตการผลิตใหม่</h3>\r\n                            <button onClick={() => setIsModalOpen(false)} className=\"w-10 h-10 flex items-center justify-center rounded-xl bg-gray-50 text-gray-400 hover:text-gray-600 transition-colors\">\r\n                                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-5\">\r\n                            {/* Lot Code */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-1.5\">รหัสล็อต (Auto-generated)</label>\r\n                                <div className=\"w-full border border-gray-100 rounded-2xl px-4 py-4 bg-gray-50/50 text-gray-500 font-mono text-xl font-bold tracking-widest text-center shadow-inner\">\r\n                                    {currentLot.lotCode}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Plot Selection */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-1.5\">เลือกแปลงปลูก <span className=\"text-danger\">*</span></label>\r\n                                <select\r\n                                    className=\"gacp-input bg-white\"\r\n                                    value={currentLot.plotId || ''}\r\n                                    onChange={e => setCurrentLot({ ...currentLot, plotId: e.target.value })}\r\n                                >\r\n                                    <option value=\"\">-- กรุณาเลือกแปลง --</option>\r\n                                    {availablePlots.map(plot => (\r\n                                        <option key={plot.id} value={plot.id}>\r\n                                            {plot.name} ({plot.areaSize} {plot.areaUnit})\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Plant Count */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-1.5\">จำนวนต้น <span className=\"text-danger\">*</span></label>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className=\"gacp-input bg-white pr-12 text-lg font-bold\"\r\n                                        placeholder=\"0\"\r\n                                        value={currentLot.plantCount || ''}\r\n                                        onChange={e => setCurrentLot({ ...currentLot, plantCount: parseInt(e.target.value) || 0 })}\r\n                                    />\r\n                                    <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 font-bold\">ต้น</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Estimated Planting Date */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-1.5\">วันที่คาดว่าจะปลูก</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    className=\"gacp-input bg-white\"\r\n                                    value={currentLot.estimatedPlantingDate || ''}\r\n                                    onChange={e => setCurrentLot({ ...currentLot, estimatedPlantingDate: e.target.value })}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Notes */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-1.5\">หมายเหตุ</label>\r\n                                <textarea\r\n                                    className=\"gacp-input bg-white h-24 resize-none text-sm\"\r\n                                    placeholder=\"ข้อมูลเพิ่มเติม เช่น รายละเอียดสายพันธุ์ย่อย หรือเทคนิคพิเศษ...\"\r\n                                    value={currentLot.notes || ''}\r\n                                    onChange={e => setCurrentLot({ ...currentLot, notes: e.target.value })}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Modal Actions */}\r\n                        <div className=\"flex gap-4 mt-8 pt-4\">\r\n                            <button\r\n                                onClick={() => setIsModalOpen(false)}\r\n                                className=\"flex-1 px-4 py-3.5 border border-gray-200 text-gray-600 rounded-2xl font-bold hover:bg-gray-50 transition-colors\"\r\n                            >\r\n                                {dict?.wizard?.navigation?.back || 'ยกเลิก'}\r\n                            </button>\r\n                            <button\r\n                                onClick={handleAddLot}\r\n                                disabled={!currentLot.plotId || !currentLot.plantCount}\r\n                                className={`flex-1 px-4 py-3.5 rounded-2xl font-bold shadow-lg transition-all ${currentLot.plotId && currentLot.plantCount\r\n                                    ? 'bg-primary text-white hover:bg-primary-700 hover:shadow-primary/30 hover:-translate-y-1'\r\n                                    : 'bg-gray-200 text-gray-400 cursor-not-allowed shadow-none'\r\n                                    }`}\r\n                            >\r\n                                ยืนยันสร้างล็อต\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/7')}\r\n                onBack={() => router.push('/farmer/applications/new/step/5')}\r\n                isNextDisabled={!canProceed}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepLots;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepPlantSelection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepPlots.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepPreCheck.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCurrentStep' is assigned a value but never used.","line":11,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dict' is assigned a value but never used.","line":13,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { CheckIcon, InfoIcon, WarningIcon } from '@/components/icons/WizardIcons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\nexport const StepPreCheck = () => {\r\n    const { setCurrentStep } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    const [checks, setChecks] = useState({\r\n        confirmTruth: false,\r\n        acceptAudit: false,\r\n        acknowledgePenalty: false,\r\n        consentData: false\r\n    });\r\n\r\n    const allChecked = Object.values(checks).every(Boolean);\r\n\r\n    const toggle = (key: keyof typeof checks) => {\r\n        setChecks(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    const checkItems = [\r\n        {\r\n            key: 'confirmTruth' as const,\r\n            title: 'ยืนยันความถูกต้องของข้อมูล',\r\n            desc: 'ข้าพเจ้ายืนยันว่าเอกสารและข้อมูลทั้งหมดที่แนบมาเป็นความจริงทุกประการ',\r\n            icon: '📝'\r\n        },\r\n        {\r\n            key: 'acceptAudit' as const,\r\n            title: 'ยินยอมให้เข้าตรวจสถานประกอบการ',\r\n            desc: 'ข้าพเจ้ายินยอมให้เจ้าหน้าที่เข้าตรวจสอบพื้นที่แปลงปลูกและโรงเรือนตามนัดหมาย',\r\n            icon: '🛡️'\r\n        },\r\n        {\r\n            key: 'acknowledgePenalty' as const,\r\n            title: 'รับทราบบทลงโทษ',\r\n            desc: 'หากตรวจสอบพบว่ามีการปลอมแปลงเอกสาร หรือให้ข้อมูลเท็จ คำขอจะถูกยกเลิกและอาจถูกดำเนินคดีตามกฎหมาย',\r\n            icon: '⚠️'\r\n        },\r\n        {\r\n            key: 'consentData' as const,\r\n            title: 'ยินยอมเปิดเผยข้อมูล (PDPA)',\r\n            desc: 'ข้าพเจ้ายินยอมให้หน่วยงานรัฐจัดเก็บและเปิดเผยข้อมูลเพื่อประโยชน์ในการรับรองมาตรฐาน GACP',\r\n            icon: '🔒'\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-3xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    10\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">ตรวจสอบความเรียบร้อย (Self-Audit)</h2>\r\n                    <p className=\"text-text-secondary\">ขั้นตอนสุดท้ายก่อนส่งคำขอ กรุณาตรวจสอบและกดยืนยันข้อกำหนด</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Warning Banner */}\r\n            <div className=\"p-6 bg-amber-50/80 backdrop-blur-sm border border-amber-200 rounded-3xl flex gap-4 text-amber-900 shadow-sm animate-slide-up\">\r\n                <div className=\"p-2 bg-white rounded-2xl shadow-sm h-fit\">\r\n                    <WarningIcon className=\"w-6 h-6 text-amber-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-bold text-amber-900 text-sm\">โปรดตรวจสอบข้อมูลอย่างละเอียด</p>\r\n                    <p className=\"text-xs leading-relaxed text-amber-800/80\">\r\n                        การให้ข้อมูลที่เป็นเท็จอาจส่งผลต่อการพิจารณาใบรับรองในอนาคตและมีบทลงโทษตามกฎหมาย\r\n                        ท่านสามารถย้อนกลับไปแก้ไขข้อมูลในขั้นตอนก่อนหน้าได้ในหน้ารวมสรุป (Step 11)\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Checklist Container */}\r\n            <div className=\"gacp-card p-4 space-y-3 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                {checkItems.map((item, index) => (\r\n                    <div\r\n                        key={item.key}\r\n                        onClick={() => toggle(item.key)}\r\n                        className={`\r\n                            group flex items-start gap-5 p-5 rounded-2xl cursor-pointer transition-all duration-300 border\r\n                            ${checks[item.key]\r\n                                ? 'bg-primary/5 border-primary/20 shadow-sm'\r\n                                : 'bg-white border-gray-100 hover:border-primary/30 hover:bg-gray-50/50 hover:shadow-md'\r\n                            }\r\n                        `}\r\n                        style={{ animationDelay: `${150 + index * 50}ms` }}\r\n                    >\r\n                        {/* Custom Checkbox Design */}\r\n                        <div className=\"relative mt-1\">\r\n                            <div className={`\r\n                                w-7 h-7 rounded-xl border-2 flex items-center justify-center transition-all duration-500\r\n                                ${checks[item.key]\r\n                                    ? 'bg-primary border-primary rotate-0 scale-100'\r\n                                    : 'bg-white border-gray-300 rotate-45 scale-90 group-hover:rotate-0 group-hover:scale-100 group-hover:border-primary'\r\n                                }\r\n                            `}>\r\n                                {checks[item.key] && (\r\n                                    <CheckIcon className=\"w-4 h-4 text-white animate-scale-in\" />\r\n                                )}\r\n                            </div>\r\n                            {/* Decorative ring when checked */}\r\n                            {checks[item.key] && (\r\n                                <div className=\"absolute inset-0 rounded-xl ring-4 ring-primary/20 animate-pulse\"></div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                                <span className=\"text-lg grayscale group-hover:grayscale-0 transition-all duration-500\">{item.icon}</span>\r\n                                <h4 className={`font-bold text-base transition-colors ${checks[item.key] ? 'text-primary-900' : 'text-gray-700'}`}>\r\n                                    {item.title}\r\n                                </h4>\r\n                            </div>\r\n                            <p className={`text-xs leading-relaxed transition-colors ${checks[item.key] ? 'text-primary-700/70' : 'text-gray-500'}`}>\r\n                                {item.desc}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Bottom Info */}\r\n            <div className=\"p-6 bg-blue-50/50 rounded-3xl border border-blue-100 flex items-center gap-4 animate-slide-up\" style={{ animationDelay: '400ms' }}>\r\n                <div className=\"p-2 bg-white rounded-xl shadow-sm\">\r\n                    <InfoIcon className=\"w-5 h-5 text-blue-500\" />\r\n                </div>\r\n                <p className=\"text-xs text-blue-800/80 font-medium\">\r\n                    หลังจากยืนยันครบทุกข้อ ท่านจะเข้าสู่หน้า <strong>&quot;ตรวจสอบข้อมูลทั้งหมด&quot;</strong> เพื่อรีวิวความถูกต้องก่อนกดส่งคำขออย่างเป็นทางการ\r\n                </p>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/11')}\r\n                onBack={() => router.push('/farmer/applications/new/step/9')}\r\n                isNextDisabled={!allChecked}\r\n                nextLabel=\"รับทราบและดำเนินการต่อ\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepPreCheck;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DocIcon' is defined but never used.","line":8,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WarningIcon' is defined but never used.","line":8,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dict' is assigned a value but never used.","line":75,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3943,3946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3943,3946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { CheckIcon, InfoIcon, DocIcon, WarningIcon } from '@/components/icons/WizardIcons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\ninterface SectionHeaderProps {\r\n    title: string;\r\n    icon: React.ReactNode;\r\n    isOpen: boolean;\r\n    onToggle: () => void;\r\n    editStep: number;\r\n    router: ReturnType<typeof useRouter>;\r\n}\r\n\r\nconst SectionHeader = ({ title, icon, isOpen, onToggle, editStep, router }: SectionHeaderProps) => (\r\n    <div className={`flex flex-col border-b last:border-0 transition-all duration-500 ${isOpen ? 'bg-white' : 'bg-gray-50/30'}`}>\r\n        <div className=\"flex items-center justify-between p-6\">\r\n            <button\r\n                onClick={onToggle}\r\n                className=\"flex items-center gap-4 group text-left\"\r\n            >\r\n                <div className={`\r\n                    w-12 h-12 rounded-2xl flex items-center justify-center text-xl transition-all duration-300 shadow-sm\r\n                    ${isOpen ? 'bg-primary text-white shadow-md scale-100' : 'bg-white border border-gray-100 text-gray-400 scale-95'}\r\n                `}>\r\n                    {icon}\r\n                </div>\r\n                <div>\r\n                    <h3 className=\"font-black text-gray-900 tracking-tight\">{title}</h3>\r\n                    <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-widest\">\r\n                        {isOpen ? 'Click to collapse' : 'Click to expand'}\r\n                    </p>\r\n                </div>\r\n            </button>\r\n            <div className=\"flex items-center gap-3\">\r\n                <button\r\n                    onClick={() => router.push(`/farmer/applications/new/step/${editStep}`)}\r\n                    className=\"p-2.5 rounded-xl bg-gray-100 text-gray-400 hover:bg-primary/10 hover:text-primary transition-all flex items-center gap-2 group/btn\"\r\n                >\r\n                    <Icons.Edit className=\"w-4 h-4\" />\r\n                    <span className=\"text-[10px] font-bold uppercase tracking-wider hidden md:inline\">Edit</span>\r\n                </button>\r\n                <button\r\n                    onClick={onToggle}\r\n                    className={`w-10 h-10 rounded-xl border flex items-center justify-center transition-all ${isOpen ? 'bg-primary-50 border-primary-100 text-primary rotate-180' : 'bg-white border-gray-200 text-gray-400 rotate-0'}`}\r\n                >\r\n                    <Icons.ChevronDown className=\"w-5 h-5\" />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\ninterface InfoItemProps {\r\n    label: string;\r\n    value?: string | number | null;\r\n    fullWidth?: boolean;\r\n}\r\n\r\nconst InfoItem = ({ label, value, fullWidth }: InfoItemProps) => (\r\n    <div className={`space-y-1.5 ${fullWidth ? 'col-span-1 md:col-span-2' : ''}`}>\r\n        <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">{label}</p>\r\n        <p className=\"text-sm font-bold text-gray-900 bg-gray-50/50 px-3 py-2 rounded-xl border border-gray-100/50\">{value || '-'}</p>\r\n    </div>\r\n);\r\n\r\nexport const StepPreview = () => {\r\n    const { state } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({\r\n        applicant: true,\r\n        farm: true,\r\n        production: true,\r\n        documents: true,\r\n    });\r\n\r\n    const toggleSection = (key: string) => {\r\n        setExpandedSections(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    // Data extraction\r\n    const applicant = state.applicantData;\r\n    const farm = state.farmData;\r\n    const plots = (state as any).siteData?.plots || [];\r\n    const lots = state.lots || [];\r\n    const documents = state.documents || [];\r\n\r\n    // Summary calculations\r\n    const totalPlants = lots.reduce((sum, lot) => sum + (Number(lot.plantCount) || 0), 0);\r\n    const totalArea = parseFloat(farm?.totalAreaSize || '0');\r\n    const totalDocs = documents.filter(d => d.uploaded).length;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-4\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                        11\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-primary-900\">ตรวจสอบข้อมูลสรุป (Application Review)</h2>\r\n                        <p className=\"text-text-secondary\">ตรวจสอบความถูกต้องทั้งหมดอีกครั้งก่อนยืนยันส่งคำขอ</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"px-5 py-2.5 rounded-2xl border border-gray-200 text-gray-600 font-bold text-sm bg-white hover:bg-gray-50 transition-all shadow-sm flex items-center gap-2\"\r\n                    >\r\n                        <Icons.Printer className=\"w-4 h-4\" />\r\n                        พิมพ์ PDF\r\n                    </button>\r\n                    <div className=\"h-10 w-px bg-gray-200 hidden md:block\"></div>\r\n                    <div className=\"bg-emerald-50 px-4 py-2 rounded-2xl border border-emerald-100 text-emerald-700 flex items-center gap-2 shadow-sm\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\"></div>\r\n                        <span className=\"text-xs font-black uppercase tracking-wider\">Ready to Submit</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary KPI Cards */}\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 animate-slide-up\">\r\n                <div className=\"gacp-card bg-white p-6 border-gray-100 flex flex-col items-center justify-center group overflow-hidden relative\">\r\n                    <div className=\"absolute top-0 right-0 w-16 h-16 bg-primary/5 rounded-full -mr-8 -mt-8\"></div>\r\n                    <p className=\"text-3xl font-black text-primary group-hover:scale-110 transition-transform\">{plots.length}</p>\r\n                    <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1\">แปลงปลูก</p>\r\n                </div>\r\n                <div className=\"gacp-card bg-white p-6 border-gray-100 flex flex-col items-center justify-center group overflow-hidden relative\">\r\n                    <div className=\"absolute top-0 right-0 w-16 h-16 bg-primary/5 rounded-full -mr-8 -mt-8\"></div>\r\n                    <p className=\"text-3xl font-black text-primary group-hover:scale-110 transition-transform\">{totalPlants.toLocaleString()}</p>\r\n                    <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1\">จำนวนต้นรวม</p>\r\n                </div>\r\n                <div className=\"gacp-card bg-white p-6 border-gray-100 flex flex-col items-center justify-center group overflow-hidden relative\">\r\n                    <div className=\"absolute top-0 right-0 w-16 h-16 bg-primary/5 rounded-full -mr-8 -mt-8\"></div>\r\n                    <p className=\"text-3xl font-black text-primary group-hover:scale-110 transition-transform\">{totalArea}</p>\r\n                    <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1\">พื้นที่ปลูก (ไร่)</p>\r\n                </div>\r\n                <div className=\"gacp-card bg-white p-6 border-gray-100 flex flex-col items-center justify-center group overflow-hidden relative\">\r\n                    <div className=\"absolute top-0 right-0 w-16 h-16 bg-primary/5 rounded-full -mr-8 -mt-8\"></div>\r\n                    <p className=\"text-3xl font-black text-primary group-hover:scale-110 transition-transform\">{totalDocs}</p>\r\n                    <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1\">เอกสารแนบ</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Content Sections */}\r\n            <div className=\"gacp-card border-gray-200 shadow-premium overflow-hidden animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n\r\n                {/* 1. Applicant */}\r\n                <SectionHeader\r\n                    title=\"ข้อมูลผู้ยื่นคำขอ\"\r\n                    icon={<Icons.User className=\"w-6 h-6\" />}\r\n                    isOpen={expandedSections.applicant}\r\n                    onToggle={() => toggleSection('applicant')}\r\n                    editStep={2}\r\n                    router={router}\r\n                />\r\n                {expandedSections.applicant && (\r\n                    <div className=\"p-8 grid grid-cols-1 md:grid-cols-2 gap-8 animate-slide-down bg-white\">\r\n                        <InfoItem label=\"ชื่อ-นามสกุล\" value={`${applicant?.firstName || ''} ${applicant?.lastName || ''}`} />\r\n                        <InfoItem label=\"เลขบัตรประชาชน / นิติบุคคล\" value={applicant?.idCard} />\r\n                        <InfoItem label=\"เบอร์โทรศัพท์\" value={applicant?.phone} />\r\n                        <InfoItem label=\"อีเมล\" value={applicant?.email} />\r\n                        <InfoItem label=\"ที่อยู่\" fullWidth value={`${applicant?.address || ''} ${applicant?.subdistrict || ''} ${applicant?.district || ''} ${applicant?.province || ''} ${applicant?.postalCode || ''}`} />\r\n                    </div>\r\n                )}\r\n\r\n                {/* 2. Farm */}\r\n                <SectionHeader\r\n                    title=\"ข้อมูลสถานที่และระบบ\"\r\n                    icon={<Icons.Home className=\"w-6 h-6\" />}\r\n                    isOpen={expandedSections.farm}\r\n                    onToggle={() => toggleSection('farm')}\r\n                    editStep={3}\r\n                    router={router}\r\n                />\r\n                {expandedSections.farm && (\r\n                    <div className=\"p-8 grid grid-cols-1 md:grid-cols-2 gap-8 animate-slide-down bg-white\">\r\n                        <InfoItem label=\"ชื่อสถานที่ผลิต\" value={farm?.farmName} />\r\n                        <InfoItem label=\"จังหวัด\" value={farm?.province} />\r\n                        <InfoItem label=\"ขนาดพื้นที่รวม\" value={`${farm?.totalAreaSize || '0'} ไร่`} />\r\n                        <InfoItem label=\"กรรมสิทธิ์\" value={farm?.landOwnership} />\r\n                        <InfoItem label=\"แหล่งน้ำ\" value={farm?.waterSource} />\r\n                        <InfoItem label=\"พิกัด GPS\" value={`${farm?.gpsLat || '-'}, ${farm?.gpsLng || '-'}`} />\r\n                    </div>\r\n                )}\r\n\r\n                {/* 3. Production & Plots */}\r\n                <SectionHeader\r\n                    title=\"แผนการผลิตและแปลงปลูก\"\r\n                    icon={<Icons.Leaf className=\"w-6 h-6\" />}\r\n                    isOpen={expandedSections.production}\r\n                    onToggle={() => toggleSection('production')}\r\n                    editStep={6}\r\n                    router={router}\r\n                />\r\n                {expandedSections.production && (\r\n                    <div className=\"p-8 space-y-8 animate-slide-down bg-white\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            <InfoItem label=\"ระบบการเพาะปลูก\" value={state.cultivationMethod} />\r\n                            <InfoItem label=\"วัตถุประสงค์\" value={state.certificationPurpose} />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4\">รายการล็อตการผลิต ({lots.length})</p>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {lots.map((lot, idx) => (\r\n                                    <div key={idx} className=\"p-4 rounded-2xl border border-gray-100 bg-gray-50 flex justify-between items-center group hover:border-primary/30 transition-all\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"w-8 h-8 rounded-lg bg-white border border-gray-100 flex items-center justify-center text-primary font-bold shadow-sm\">\r\n                                                {idx + 1}\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-xs font-bold text-gray-900\">{lot.lotCode}</p>\r\n                                                <p className=\"text-[10px] text-gray-400\">{lot.plotName || 'Plot'} • {lot.plantCount} ต้น</p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"text-[10px] font-bold text-primary bg-primary-50 px-2 py-0.5 rounded-md\">ID: {lot.id}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 4. Documents */}\r\n                <SectionHeader\r\n                    title=\"เอกสารประกอบคำขอ\"\r\n                    icon={<Icons.FileText className=\"w-6 h-6\" />}\r\n                    isOpen={expandedSections.documents}\r\n                    onToggle={() => toggleSection('documents')}\r\n                    editStep={9}\r\n                    router={router}\r\n                />\r\n                {expandedSections.documents && (\r\n                    <div className=\"p-8 space-y-6 animate-slide-down bg-white\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                            {documents.filter(d => d.uploaded).map((doc, idx) => (\r\n                                <div key={idx} className=\"p-3 bg-white border border-gray-100 rounded-2xl flex items-center gap-3 shadow-sm group hover:shadow-md transition-all\">\r\n                                    <div className=\"w-9 h-9 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center border border-emerald-100\">\r\n                                        <CheckIcon className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0 pr-2\">\r\n                                        <p className=\"text-xs font-bold text-gray-900 truncate\" title={doc.name}>{doc.name}</p>\r\n                                        <p className=\"text-[9px] text-emerald-500 font-bold uppercase tracking-tighter\">Verified</p>\r\n                                    </div>\r\n                                    <button className=\"opacity-0 group-hover:opacity-100 transition-opacity p-2 text-primary hover:bg-primary-50 rounded-lg\">\r\n                                        <Icons.Eye className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        {documents.filter(d => d.uploaded).length === 0 && (\r\n                            <div className=\"p-12 text-center rounded-3xl bg-gray-50 border border-dashed border-gray-200\">\r\n                                <p className=\"text-gray-400 font-bold\">ไม่พบข้อมูลเอกสารแนบ</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Note Banner */}\r\n            <div className=\"p-6 bg-blue-50/80 backdrop-blur-sm border border-blue-200 rounded-3xl flex gap-4 text-blue-900 shadow-sm animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                <div className=\"p-3 bg-white rounded-2xl shadow-sm h-fit\">\r\n                    <InfoIcon className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-black text-blue-900 text-sm\">ขั้นตอนต่อไป</p>\r\n                    <p className=\"text-xs leading-relaxed text-blue-800/80\">\r\n                        หลังจากกดยืนยัน ระบบจะนำท่านไปสู่หน้าการลงนามดิจิทัล (E-Signature) เพื่อส่งคำขอเข้าสู่ระบบการตรวจสอบ\r\n                        กรุณาเตรียมบัตรประชาชนหรือรหัส OTP ให้พร้อม\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/12')}\r\n                onBack={() => router.push('/farmer/applications/new/step/10')}\r\n                nextLabel=\"ไปที่หน้าส่งคำขอ\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepPreview;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepProduction.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PlantIcon' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1949,1952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1949,1952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useMasterData } from '@/hooks/useMasterData';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport { PlantIcon, CheckIcon } from '@/components/icons/WizardIcons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\ninterface Variety {\r\n    id: string;\r\n    name: string;\r\n    sourceType: 'SELF' | 'BUY' | 'IMPORT';\r\n    sourceName?: string;\r\n    quantity?: number;\r\n}\r\n\r\ninterface ProductionInput {\r\n    id: string;\r\n    type: string;\r\n    name: string;\r\n    sourceType: string;\r\n    isOrganic: boolean;\r\n}\r\n\r\ninterface ProductionFormData {\r\n    plantParts: string[];\r\n    propagationType: string;\r\n    varieties: Variety[];\r\n    seedSource: string;\r\n    varietyName: string;\r\n    estimatedYield: string;\r\n    sourceType: string;\r\n    cultivationArea: string;\r\n    spacing: string;\r\n    plantCount: string;\r\n    productionInputs: ProductionInput[];\r\n}\r\n\r\nexport const StepProduction = () => {\r\n    const { state, setProductionData } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n    const { data: masterData } = useMasterData();\r\n\r\n    const [formData, setFormData] = useState<ProductionFormData>((state.productionData as unknown as ProductionFormData) || {\r\n        plantParts: [] as string[],\r\n        propagationType: '',\r\n        varieties: [] as Variety[],\r\n        seedSource: '',\r\n        varietyName: '',\r\n        estimatedYield: '',\r\n        sourceType: '',\r\n        cultivationArea: '',\r\n        spacing: '',\r\n        plantCount: '',\r\n        productionInputs: [] as ProductionInput[],\r\n    });\r\n\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            setProductionData(formData as unknown as any);\r\n        }, 500);\r\n        return () => clearTimeout(timeout);\r\n    }, [formData, setProductionData]);\r\n\r\n    const handleChange = (field: keyof ProductionFormData, value: string | string[] | Variety[] | ProductionInput[]) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const togglePlantPart = (partId: string) => {\r\n        setFormData(prev => {\r\n            const current = prev.plantParts || [];\r\n            if (current.includes(partId)) {\r\n                return { ...prev, plantParts: current.filter(id => id !== partId) };\r\n            } else {\r\n                return { ...prev, plantParts: [...current, partId] };\r\n            }\r\n        });\r\n    };\r\n\r\n    const isNextDisabled = !formData.plantParts?.length || !formData.propagationType || (!formData.varieties?.length);\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-2\">\r\n                <div className=\"w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-bold text-lg shadow-sm\">\r\n                    5\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary\">{dict.wizard.steps.production}</h2>\r\n                    <p className=\"text-text-secondary text-sm\">รายละเอียดส่วนที่นำมาใช้ แหล่งที่มา และปริมาณการผลิต</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* 1. Parts Used */}\r\n                <div className=\"gacp-card\">\r\n                    <h3 className=\"gacp-title text-lg mb-4 flex items-center gap-2\">\r\n                        <span>🌿</span> ส่วนของพืชที่ใช้\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        {masterData?.plantParts.map((part) => (\r\n                            <label\r\n                                key={part.id}\r\n                                className={`\r\n                                    flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all\r\n                                    ${formData.plantParts?.includes(part.id)\r\n                                        ? 'border-primary bg-primary-50 text-primary-700 shadow-sm'\r\n                                        : 'border-slate-200 bg-white hover:border-primary-200 hover:bg-slate-50'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    className=\"hidden\"\r\n                                    checked={formData.plantParts?.includes(part.id)}\r\n                                    onChange={() => togglePlantPart(part.id)}\r\n                                />\r\n                                <div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${formData.plantParts?.includes(part.id) ? 'bg-primary border-primary text-white' : 'border-slate-300 bg-white'\r\n                                    }`}>\r\n                                    {formData.plantParts?.includes(part.id) && <CheckIcon className=\"w-3 h-3\" />}\r\n                                </div>\r\n                                <span className=\"font-medium text-sm\">{part.label}</span>\r\n                            </label>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 2. Propagation Method */}\r\n                <div className=\"gacp-card\">\r\n                    <h3 className=\"gacp-title text-lg mb-4 flex items-center gap-2\">\r\n                        <span>🌱</span> วิธีการขยายพันธุ์\r\n                    </h3>\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        {[\r\n                            { id: 'SEED', label: 'เพาะเมล็ด', icon: '🌱' },\r\n                            { id: 'CUTTING', label: 'ปักชำ', icon: '🌿' },\r\n                            { id: 'TISSUE', label: 'เพาะเนื้อเยื่อ', icon: '🧪' },\r\n                            { id: 'OTHER', label: 'อื่น ๆ', icon: '❓' }\r\n                        ].map((method) => (\r\n                            <button\r\n                                key={method.id}\r\n                                onClick={() => handleChange('propagationType', method.id)}\r\n                                className={`\r\n                                    p-3 rounded-lg border text-left transition-all flex flex-col gap-2 relative overflow-hidden\r\n                                    ${formData.propagationType === method.id\r\n                                        ? 'border-primary bg-primary-50 ring-1 ring-primary shadow-sm'\r\n                                        : 'border-slate-200 bg-white hover:border-primary-300 hover:shadow-sm'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <span className=\"text-xl\">{method.icon}</span>\r\n                                <span className={`font-bold text-sm ${formData.propagationType === method.id ? 'text-primary-800' : 'text-slate-700'}`}>\r\n                                    {method.label}\r\n                                </span>\r\n                                {formData.propagationType === method.id && (\r\n                                    <div className=\"absolute top-2 right-2 text-primary animate-scale-in\">\r\n                                        <CheckIcon className=\"w-4 h-4\" />\r\n                                    </div>\r\n                                )}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 3. Plant Varieties */}\r\n            <div className=\"gacp-card\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h3 className=\"gacp-title text-lg flex items-center gap-2\">\r\n                        <span>📋</span> ข้อมูลสายพันธุ์\r\n                    </h3>\r\n                    <button\r\n                        onClick={() => {\r\n                            const newVariety = { id: Date.now().toString(), name: '', sourceType: 'SELF' as const, quantity: 0 };\r\n                            setFormData(prev => ({\r\n                                ...prev,\r\n                                varieties: [...(prev.varieties || []), newVariety]\r\n                            }));\r\n                        }}\r\n                        className=\"gacp-btn-primary\"\r\n                    >\r\n                        <span>+ เพิ่มสายพันธุ์</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {(!formData.varieties || formData.varieties.length === 0) ? (\r\n                    <div className=\"text-center py-8 bg-slate-50 rounded-lg border border-dashed border-slate-300 text-slate-400\">\r\n                        <p className=\"font-medium text-sm\">ยังไม่ได้เพิ่มข้อมูลสายพันธุ์</p>\r\n                        <p className=\"text-xs mt-1\">กดปุ่ม &quot;เพิ่มสายพันธุ์&quot; เพื่อระบุรายละเอียด</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {formData.varieties.map((item, index) => (\r\n                            <div key={item.id} className=\"p-4 rounded-lg border border-slate-200 bg-white hover:border-primary-200 transition-all relative group shadow-sm animate-slide-up\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setFormData(prev => ({\r\n                                            ...prev,\r\n                                            varieties: prev.varieties?.filter(v => v.id !== item.id)\r\n                                        }));\r\n                                    }}\r\n                                    className=\"absolute top-2 right-2 text-slate-400 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                    title=\"ลบรายการ\"\r\n                                >\r\n                                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                                </button>\r\n\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <span className=\"bg-primary-50 text-primary-700 text-xs font-bold px-2 py-1 rounded\">#{index + 1}</span>\r\n                                        <div className=\"flex-1\">\r\n                                            <FormLabelWithHint label=\"ชื่อสายพันธุ์\" required />\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"gacp-input mt-1\"\r\n                                                placeholder=\"เช่น หางกระรอก\"\r\n                                                value={item.name}\r\n                                                onChange={(e) => {\r\n                                                    const newVarieties = [...(formData.varieties || [])];\r\n                                                    newVarieties[index].name = e.target.value;\r\n                                                    setFormData(prev => ({ ...prev, varieties: newVarieties }));\r\n                                                }}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div>\r\n                                            <FormLabelWithHint label=\"แหล่งที่มา\" />\r\n                                            <select\r\n                                                className=\"gacp-input mt-1\"\r\n                                                value={item.sourceType}\r\n                                                onChange={(e) => {\r\n                                                    const newVarieties = [...(formData.varieties || [])];\r\n                                                    newVarieties[index].sourceType = e.target.value as Variety['sourceType'];\r\n                                                    setFormData(prev => ({ ...prev, varieties: newVarieties }));\r\n                                                }}\r\n                                            >\r\n                                                <option value=\"SELF\">เก็บเอง</option>\r\n                                                <option value=\"BUY\">ซื้อมา</option>\r\n                                                <option value=\"IMPORT\">นำเข้า</option>\r\n                                            </select>\r\n                                        </div>\r\n                                        {item.sourceType !== 'SELF' && (\r\n                                            <div className=\"animate-fade-in\">\r\n                                                <FormLabelWithHint label=\"ชื่อร้าน/แหล่งที่มา\" />\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    className=\"gacp-input mt-1\"\r\n                                                    placeholder=\"ระบุชื่อร้าน...\"\r\n                                                    value={item.sourceName || ''}\r\n                                                    onChange={(e) => {\r\n                                                        const newVarieties = [...(formData.varieties || [])];\r\n                                                        newVarieties[index].sourceName = e.target.value;\r\n                                                        setFormData(prev => ({ ...prev, varieties: newVarieties }));\r\n                                                    }}\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* 4. Cultivation Summary Card */}\r\n            <div className=\"gacp-card bg-primary-50/50 border-primary-100\">\r\n                <h3 className=\"gacp-title text-lg mb-6 flex items-center gap-3\">\r\n                    <span className=\"w-8 h-8 rounded bg-white shadow-sm flex items-center justify-center text-sm\">📊</span>\r\n                    ประมาณการการเพาะปลูก\r\n                </h3>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                    <div>\r\n                        <FormLabelWithHint label=\"ระยะปลูก (Spacing)\" />\r\n                        <select\r\n                            className=\"gacp-input mt-1 bg-white\"\r\n                            value={formData.spacing || ''}\r\n                            onChange={(e) => handleChange('spacing', e.target.value)}\r\n                        >\r\n                            <option value=\"\">-- เลือกระยะปลูก --</option>\r\n                            <option value=\"1x1\">1 x 1 เมตร (Standard)</option>\r\n                            <option value=\"1.5x1.5\">1.5 x 1.5 เมตร</option>\r\n                            <option value=\"2x2\">2 x 2 เมตร</option>\r\n                            <option value=\"4x4\">4 x 4 เมตร</option>\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <FormLabelWithHint label=\"จำนวนต้นรวม\" />\r\n                        <div className=\"relative\">\r\n                            <input\r\n                                type=\"number\"\r\n                                className=\"gacp-input mt-1 bg-white pr-10\"\r\n                                placeholder=\"0\"\r\n                                value={formData.plantCount || ''}\r\n                                onChange={(e) => handleChange('plantCount', e.target.value)}\r\n                            />\r\n                            <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs font-bold pt-1\">ต้น</span>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <FormLabelWithHint label=\"ผลผลิตคาดการณ์ (ต่อปี)\" />\r\n                        <div className=\"relative\">\r\n                            <input\r\n                                type=\"number\"\r\n                                className={`gacp-input mt-1 bg-white pr-10 ${Number(formData.estimatedYield) > 500 ? 'border-amber-300 focus:border-amber-500' : ''}`}\r\n                                placeholder=\"0\"\r\n                                value={formData.estimatedYield}\r\n                                onChange={(e) => handleChange('estimatedYield', e.target.value)}\r\n                            />\r\n                            <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs font-bold pt-1\">กก.</span>\r\n                        </div>\r\n                        {Number(formData.estimatedYield) > 500 && (\r\n                            <p className=\"text-xs text-amber-600 mt-1 font-medium flex items-center gap-1\">\r\n                                ⚠️ เกินค่าเฉลี่ยมาตรฐาน\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 5. Production Inputs */}\r\n            <div className=\"gacp-card\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <div>\r\n                        <h3 className=\"gacp-title text-lg flex items-center gap-2\">\r\n                            <span>🧴</span> ปัจจัยการผลิต\r\n                        </h3>\r\n                        <p className=\"text-xs text-slate-500 mt-1\">ปุ๋ย, วัสดุปรับปรุงดิน, และสารป้องกันกำจัดศัตรูพืช</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => {\r\n                            const newInput = {\r\n                                id: Date.now().toString(),\r\n                                type: 'FERTILIZER',\r\n                                name: '',\r\n                                sourceType: 'PURCHASED',\r\n                                isOrganic: false\r\n                            };\r\n                            setFormData(prev => ({\r\n                                ...prev,\r\n                                productionInputs: [...(prev.productionInputs || []), newInput]\r\n                            }));\r\n                        }}\r\n                        className=\"gacp-btn-secondary text-sm px-3 py-1.5\"\r\n                    >\r\n                        <span>+ เพิ่มรายการ</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {(!formData.productionInputs || formData.productionInputs.length === 0) ? (\r\n                    <div className=\"text-center py-6 bg-slate-50 rounded-lg border border-dashed border-slate-300 text-slate-400\">\r\n                        <p className=\"font-medium text-sm\">ยังไม่มีข้อมูลปัจจัยการผลิต</p>\r\n                        <p className=\"text-xs mt-1\">กดปุ่ม &quot;เพิ่มรายการ&quot; เพื่อระบุข้อมูล</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"space-y-3\">\r\n                        {formData.productionInputs.map((item: ProductionInput, index: number) => (\r\n                            <div key={item.id} className=\"p-4 rounded-lg border border-slate-200 bg-slate-50/30 hover:bg-white transition-all relative group animate-slide-up\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setFormData(prev => ({\r\n                                            ...prev,\r\n                                            productionInputs: prev.productionInputs?.filter((i: ProductionInput) => i.id !== item.id)\r\n                                        }));\r\n                                    }}\r\n                                    className=\"absolute top-2 right-2 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                >\r\n                                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                                </button>\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-12 gap-4 items-end\">\r\n                                    <div className=\"md:col-span-3\">\r\n                                        <FormLabelWithHint label=\"ประเภท\" />\r\n                                        <select\r\n                                            className=\"gacp-input mt-1 bg-white\"\r\n                                            value={item.type}\r\n                                            onChange={(e) => {\r\n                                                const inputs = [...(formData.productionInputs || [])];\r\n                                                inputs[index].type = e.target.value;\r\n                                                setFormData(prev => ({ ...prev, productionInputs: inputs }));\r\n                                            }}\r\n                                        >\r\n                                            <option value=\"FERTILIZER\">ปุ๋ย</option>\r\n                                            <option value=\"SOIL_AMENDMENT\">วัสดุปรับปรุงดิน</option>\r\n                                            <option value=\"PLANT_PROTECTION\">ศัตรูพืช/วัชพืช</option>\r\n                                            <option value=\"OTHER\">อื่นๆ</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"md:col-span-4\">\r\n                                        <FormLabelWithHint label=\"ชื่อเรียก / ยี่ห้อ\" />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"gacp-input mt-1 bg-white\"\r\n                                            placeholder=\"เช่น ปุ๋ยคอก\"\r\n                                            value={item.name}\r\n                                            onChange={(e) => {\r\n                                                const inputs = [...(formData.productionInputs || [])];\r\n                                                inputs[index].name = e.target.value;\r\n                                                setFormData(prev => ({ ...prev, productionInputs: inputs }));\r\n                                            }}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"md:col-span-3\">\r\n                                        <FormLabelWithHint label=\"แหล่งที่มา\" />\r\n                                        <select\r\n                                            className=\"gacp-input mt-1 bg-white\"\r\n                                            value={item.sourceType}\r\n                                            onChange={(e) => {\r\n                                                const inputs = [...(formData.productionInputs || [])];\r\n                                                inputs[index].sourceType = e.target.value;\r\n                                                setFormData(prev => ({ ...prev, productionInputs: inputs }));\r\n                                            }}\r\n                                        >\r\n                                            <option value=\"PURCHASED\">ซื้อจากร้านค้า</option>\r\n                                            <option value=\"SELF_MADE\">ผลิตเอง</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"md:col-span-2 flex items-center h-[2.75rem]\">\r\n                                        <label className=\"flex items-center cursor-pointer gap-2 select-none group/check\">\r\n                                            <div className={`w-5 h-5 rounded border flex items-center justify-center transition-all ${item.isOrganic ? 'bg-primary border-primary shadow-sm' : 'border-slate-300 bg-white group-hover/check:border-primary'}`}>\r\n                                                {item.isOrganic && <CheckIcon className=\"w-3 h-3 text-white\" />}\r\n                                            </div>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"hidden\"\r\n                                                checked={item.isOrganic || false}\r\n                                                onChange={(e) => {\r\n                                                    const inputs = [...(formData.productionInputs || [])];\r\n                                                    inputs[index].isOrganic = e.target.checked;\r\n                                                    setFormData(prev => ({ ...prev, productionInputs: inputs }));\r\n                                                }}\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">อินทรีย์</span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/6')}\r\n                onBack={() => router.push('/farmer/applications/new/step/4')}\r\n                isNextDisabled={isNextDisabled}\r\n                showBack={true}\r\n                nextLabel={dict.wizard.navigation.next}\r\n                backLabel={dict.wizard.navigation.back}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepProduction;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepProductionEstimate.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLots' is assigned a value but never used.","line":22,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":27}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepProductionEstimate.tsx:56:13\n  54 |         if (totalPlantsFromLots > 0) {\n  55 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 56 |             setEstimatedPlants(totalPlantsFromLots);\n     |             ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  57 |         }\n  58 |     }, [totalPlantsFromLots]);\n  59 |","line":56,"column":13,"nodeType":null,"endLine":56,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepProductionEstimate.tsx:64:13\n  62 |         if (estimatedPlants > recommendedMax * 1.5) {\n  63 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 64 |             setValidationWarning(`จำนวนต้นสูงกว่าค่าแนะนำมาก (สูงสุด ~${recommendedMax.toLocaleString()} ต้น สำหรับพื้นที่ ${totalAreaRai} ไร่)`);\n     |             ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  65 |         } else if (estimatedPlants < recommendedMin * 0.5 && estimatedPlants > 0) {\n  66 |             setValidationWarning(`จำนวนต้นต่ำกว่าค่าแนะนำมาก (ต่ำสุด ~${recommendedMin.toLocaleString()} ต้น)`);\n  67 |         } else {","line":64,"column":13,"nodeType":null,"endLine":64,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { FormLabelWithHint } from '@/components/FormHint';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\nimport { InfoIcon, PlantIcon, WarningIcon } from '@/components/icons/WizardIcons';\r\n\r\n// Density constants per cultivation system (plants per sq.m.)\r\nconst DENSITY_CONFIG = {\r\n    INDOOR: { min: 4, default: 8, max: 40, label: 'ฟาร์มปิด (Indoor)' },\r\n    OUTDOOR: { min: 0.5, default: 1.5, max: 4, label: 'ฟาร์มเปิด (Outdoor)' },\r\n    GREENHOUSE: { min: 6, default: 10, max: 20, label: 'โรงเรือน (Greenhouse)' },\r\n};\r\n\r\nconst LOSS_RATE = 0.15; // 15% estimated loss\r\n\r\nexport const StepProductionEstimate = () => {\r\n    const { state, setLots } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict } = useLanguage();\r\n\r\n    // Get cultivation system from state\r\n    const cultivationSystem = (state.cultivationMethod?.toUpperCase() || 'OUTDOOR') as keyof typeof DENSITY_CONFIG;\r\n    const systemConfig = DENSITY_CONFIG[cultivationSystem] || DENSITY_CONFIG.OUTDOOR;\r\n\r\n    // Get total area from farmData or siteData\r\n    const totalAreaRai = parseFloat(state.farmData?.totalAreaSize || state.siteData?.areaSize || '0');\r\n    const totalAreaSqm = totalAreaRai * 1600;\r\n\r\n    // Calculate recommended range\r\n    const recommendedMin = Math.floor(totalAreaSqm * systemConfig.min * (1 - LOSS_RATE));\r\n    const recommendedMax = Math.floor(totalAreaSqm * systemConfig.max * (1 - LOSS_RATE));\r\n    const recommendedDefault = Math.floor(totalAreaSqm * systemConfig.default * (1 - LOSS_RATE));\r\n\r\n    // Summary of plants from existing lots (Step 6)\r\n    const totalPlantsFromLots = state.lots?.reduce((sum, lot) => sum + (lot.plantCount || 0), 0) || 0;\r\n\r\n    // Local state - prioritize total from lots if available\r\n    const [estimatedPlants, setEstimatedPlants] = useState<number>(\r\n        totalPlantsFromLots > 0 ? totalPlantsFromLots : (state.lots?.[0]?.plantCount || recommendedDefault)\r\n    );\r\n    const [plantingDate, setPlantingDate] = useState<string>(\r\n        state.lots?.[0]?.estimatedPlantingDate || ''\r\n    );\r\n    const [notes, setNotes] = useState<string>(state.lots?.[0]?.notes || '');\r\n    const [validationWarning, setValidationWarning] = useState<string>('');\r\n\r\n    // Update estimated plants if lots change and were not manual\r\n    useEffect(() => {\r\n        if (totalPlantsFromLots > 0) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setEstimatedPlants(totalPlantsFromLots);\r\n        }\r\n    }, [totalPlantsFromLots]);\r\n\r\n    // Validate plant count\r\n    useEffect(() => {\r\n        if (estimatedPlants > recommendedMax * 1.5) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setValidationWarning(`จำนวนต้นสูงกว่าค่าแนะนำมาก (สูงสุด ~${recommendedMax.toLocaleString()} ต้น สำหรับพื้นที่ ${totalAreaRai} ไร่)`);\r\n        } else if (estimatedPlants < recommendedMin * 0.5 && estimatedPlants > 0) {\r\n            setValidationWarning(`จำนวนต้นต่ำกว่าค่าแนะนำมาก (ต่ำสุด ~${recommendedMin.toLocaleString()} ต้น)`);\r\n        } else {\r\n            setValidationWarning('');\r\n        }\r\n    }, [estimatedPlants, recommendedMin, recommendedMax, totalAreaRai]);\r\n\r\n    // Validation\r\n    const canProceed = estimatedPlants > 0;\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in max-w-5xl mx-auto pb-12\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    7\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.preview?.headers?.production || 'ประมาณการผลผลิต (Production Estimate)'}</h2>\r\n                    <p className=\"text-text-secondary\">ข้อมูลสำหรับประเมินศักยภาพการผลิตและตรวจสอบมาตรฐาน GACP</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info Banner */}\r\n            <div className=\"p-6 bg-blue-50/80 backdrop-blur-sm border border-blue-200 rounded-2xl flex gap-4 text-blue-900 text-sm shadow-sm animate-slide-up\">\r\n                <div className=\"p-2 bg-white rounded-xl shadow-sm h-fit\">\r\n                    <InfoIcon className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-bold text-blue-900\">คำแนะนำมาตรฐาน GACP</p>\r\n                    <p className=\"leading-relaxed text-blue-800/80\">\r\n                        กรุณาระบุจำนวนต้นพืชที่คาดว่าจะปลูก เพื่อใช้ประเมินความเหมาะสมของพื้นที่ (Density Check)\r\n                        {totalPlantsFromLots > 0 && \" ระบบสรุปยอดรวมจากแปลงที่คุณแบ่งไว้ในขั้นตอนก่อนหน้าโดยอัตโนมัติ\"}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                <div className=\"gacp-card bg-gradient-to-br from-primary-50/50 to-white text-center p-6 border-primary-100 hover:shadow-md transition-shadow\">\r\n                    <p className=\"text-xs font-bold text-primary-600 uppercase tracking-wider mb-2\">พื้นที่ปลูกทั้งหมด</p>\r\n                    <p className=\"text-4xl font-black text-primary-900\">{totalAreaRai} <span className=\"text-lg text-primary-600 font-medium\">ไร่</span></p>\r\n                </div>\r\n                <div className=\"gacp-card bg-gradient-to-br from-indigo-50/50 to-white text-center p-6 border-indigo-100 hover:shadow-md transition-shadow\">\r\n                    <p className=\"text-xs font-bold text-indigo-600 uppercase tracking-wider mb-2\">ระบบการปลูก</p>\r\n                    <div className=\"flex items-center justify-center gap-2\">\r\n                        <span className=\"text-2xl\">{cultivationSystem === 'INDOOR' ? '🏭' : cultivationSystem === 'GREENHOUSE' ? '🏠' : '🌿'}</span>\r\n                        <p className=\"text-2xl font-black text-indigo-900\">{systemConfig.label}</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"gacp-card bg-gradient-to-br from-teal-50/50 to-white text-center p-6 border-teal-100 hover:shadow-md transition-shadow\">\r\n                    <p className=\"text-xs font-bold text-teal-600 uppercase tracking-wider mb-2\">จำนวนล็อต/แปลง</p>\r\n                    <p className=\"text-4xl font-black text-teal-900\">{state.lots?.length || 0} <span className=\"text-lg text-teal-600 font-medium\">รายการ</span></p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Estimate Form */}\r\n            <div className=\"gacp-card p-8 space-y-8 animate-slide-up relative overflow-hidden\" style={{ animationDelay: '200ms' }}>\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-primary-100/20 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none\"></div>\r\n\r\n                {/* Estimated Plants Input */}\r\n                <div className=\"relative z-10\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-4 gap-2\">\r\n                        <FormLabelWithHint\r\n                            label={dict.wizard.preview?.labels?.totalPlants || \"จำนวนต้นพืชประมาณการ\"}\r\n                            hint=\"จำนวนต้นทั้งหมดที่คาดว่าจะปลูกในรอบนี้\"\r\n                            required\r\n                        />\r\n                        <div className=\"flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-xl border border-gray-100\">\r\n                            <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\r\n                            <span className=\"text-xs font-medium text-gray-500\">\r\n                                ช่วงแนะนำ: {recommendedMin.toLocaleString()} - {recommendedMax.toLocaleString()} ต้น\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"relative transition-all duration-300\">\r\n                        <input\r\n                            type=\"number\"\r\n                            readOnly={totalPlantsFromLots > 0}\r\n                            className={`w-full border rounded-2xl px-6 py-5 text-4xl font-black outline-none transition-all shadow-sm\r\n                                ${totalPlantsFromLots > 0 ? 'bg-gray-50 text-gray-400 border-gray-100' :\r\n                                    validationWarning ? 'border-amber-300 bg-amber-50 focus:ring-4 focus:ring-amber-100 text-amber-900' :\r\n                                        'border-gray-200 focus:border-primary focus:ring-4 focus:ring-primary-100 text-primary-900'}`}\r\n                            placeholder={`แนะนำ: ${recommendedDefault.toLocaleString()} ต้น`}\r\n                            value={estimatedPlants || ''}\r\n                            onChange={e => setEstimatedPlants(parseInt(e.target.value) || 0)}\r\n                        />\r\n                        <div className={`absolute right-6 top-1/2 -translate-y-1/2 font-black text-2xl pointer-events-none py-2 px-4 rounded-xl ${totalPlantsFromLots > 0 ? 'bg-gray-100 text-gray-300' : 'bg-primary-50 text-primary-500'}`}>\r\n                            ต้น\r\n                        </div>\r\n                    </div>\r\n\r\n                    {totalPlantsFromLots > 0 && (\r\n                        <p className=\"mt-3 text-sm text-primary-600 flex items-center gap-2 font-medium\">\r\n                            <Icons.CheckCircle className=\"w-4 h-4\" />\r\n                            ดึงข้อมูลจากรายการล็อตที่คุณสร้างไว้อัตโนมัติ\r\n                        </p>\r\n                    )}\r\n\r\n                    {validationWarning && (\r\n                        <div className=\"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-2xl flex gap-3 text-amber-800 animate-slide-down\">\r\n                            <WarningIcon className=\"w-6 h-6 shrink-0\" />\r\n                            <div className=\"text-sm\">\r\n                                <p className=\"font-bold mb-0.5\">ข้อควรระวัง</p>\r\n                                <p className=\"opacity-80\">{validationWarning}</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Density Analysis */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4\">\r\n                    <div className=\"p-6 rounded-2xl bg-gradient-to-br from-gray-50 to-white border border-gray-100 shadow-inner group transition-all hover:border-primary-200\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"p-2 bg-white rounded-xl shadow-sm\">\r\n                                <PlantIcon className=\"w-6 h-6 text-primary-600\" />\r\n                            </div>\r\n                            <span className=\"text-[10px] font-bold text-gray-400 uppercase tracking-widest bg-gray-100 px-2 py-1 rounded-md\">Analysis</span>\r\n                        </div>\r\n                        <p className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2\">ความหนาแน่น (Plant Density)</p>\r\n                        <div className=\"flex items-baseline gap-2\">\r\n                            <p className=\"text-3xl font-black text-gray-900\">\r\n                                {(estimatedPlants / (totalAreaSqm || 1)).toFixed(2)}\r\n                            </p>\r\n                            <span className=\"text-sm text-gray-400 font-bold\">ต้น / ตร.ม.</span>\r\n                        </div>\r\n                        <div className=\"mt-4 h-1.5 w-full bg-gray-100 rounded-full overflow-hidden\">\r\n                            <div\r\n                                className={`h-full transition-all duration-1000 ${estimatedPlants > recommendedMax ? 'bg-amber-400' : 'bg-primary'}`}\r\n                                style={{ width: `${Math.min(100, (estimatedPlants / (recommendedMax || 1)) * 100)}%` }}\r\n                            ></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        <div>\r\n                            <FormLabelWithHint label={dict.wizard.preview?.labels?.plantingDate || \"วันที่เริ่มปลูก / คาดว่าจะปลูก\"} />\r\n                            <input\r\n                                type=\"date\"\r\n                                className=\"gacp-input font-bold text-primary-900\"\r\n                                value={plantingDate}\r\n                                onChange={e => setPlantingDate(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <FormLabelWithHint label=\"หมายเหตุการผลิต\" hint=\"เช่น แผนการเก็บเกี่ยว หรือข้อมูลเพิ่มเติม...\" />\r\n                            <textarea\r\n                                className=\"gacp-input min-h-[100px] resize-none text-sm\"\r\n                                placeholder=\"ระบุข้อมูลเพิ่มเติม...\"\r\n                                value={notes}\r\n                                onChange={e => setNotes(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={() => router.push('/farmer/applications/new/step/8')}\r\n                onBack={() => router.push('/farmer/applications/new/step/6')}\r\n                isNextDisabled={!canProceed}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepProductionEstimate;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepQuote.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DocIcon' is defined but never used.","line":10,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoIcon' is defined but never used.","line":10,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'language' is assigned a value but never used.","line":24,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { MockQuotePDF } from './MockQuotePDF';\r\nimport { PlatformQuotePDF } from './PlatformQuotePDF';\r\nimport Image from 'next/image';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { CheckIcon, DocIcon, InfoIcon } from '@/components/icons/WizardIcons';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport { useLanguage } from '@/lib/i18n/LanguageContext';\r\n\r\nconst GACP_FEES = {\r\n    milestone1: 5000,\r\n    milestone2: 25000,\r\n};\r\n\r\nconst PLATFORM_FEE_PERCENT = 0.10;\r\n\r\nexport const StepQuote = () => {\r\n    const { state, updateState } = useWizardStore();\r\n    const router = useRouter();\r\n    const { dict, language } = useLanguage();\r\n\r\n    const [dtamQuoteAccepted, setDtamQuoteAccepted] = useState(false);\r\n    const [platformQuoteAccepted, setPlatformQuoteAccepted] = useState(false);\r\n    const [showDtamQuote, setShowDtamQuote] = useState(false);\r\n    const [showPlatformQuote, setShowPlatformQuote] = useState(false);\r\n\r\n    const [quoteDate] = useState(() => new Date().toISOString());\r\n    const [dtamQuoteNumber] = useState(() => `DTAM-QT-${new Date().getFullYear()}${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`);\r\n    const [platformQuoteNumber] = useState(() => `PLT-QT-${new Date().getFullYear()}${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`);\r\n\r\n    const dtamFee = GACP_FEES.milestone1;\r\n    const platformFee = Math.round(dtamFee * PLATFORM_FEE_PERCENT);\r\n    const totalMilestone1 = dtamFee + platformFee;\r\n\r\n    const allAccepted = dtamQuoteAccepted && platformQuoteAccepted;\r\n\r\n    const handleProceedToInvoice = () => {\r\n        if (allAccepted) {\r\n            updateState({\r\n                milestone1: {\r\n                    dtamQuote: { number: dtamQuoteNumber, amount: dtamFee, accepted: true },\r\n                    platformQuote: { number: platformQuoteNumber, amount: platformFee, accepted: true }\r\n                }\r\n            });\r\n            router.push('/farmer/applications/new/step/14');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in pb-12 max-w-5xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    13\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">{dict.wizard.quote.title}</h2>\r\n                    <p className=\"text-text-secondary\">{dict.wizard.quote.subtitle}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Instruction Banner */}\r\n            <div className=\"bg-gradient-to-br from-indigo-50 to-white border border-indigo-100 rounded-[2.5rem] p-10 shadow-soft relative overflow-hidden group animate-slide-up\">\r\n                <div className=\"absolute top-0 right-0 w-96 h-96 bg-primary/5 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none group-hover:bg-primary/10 transition-all duration-1000\"></div>\r\n\r\n                <div className=\"relative z-10 flex flex-col md:flex-row items-center md:items-start gap-8\">\r\n                    <div className=\"w-20 h-20 rounded-[2rem] bg-white text-primary flex items-center justify-center shadow-premium-hover shrink-0 scale-110 md:scale-100\">\r\n                        <Icons.Calculator className=\"w-10 h-10\" />\r\n                    </div>\r\n                    <div className=\"text-center md:text-left\">\r\n                        <h3 className=\"font-black text-primary-900 text-2xl mb-3 tracking-tight\">{dict.wizard.quote.milestone1Title}</h3>\r\n                        <p className=\"text-gray-500 text-sm leading-relaxed max-w-2xl\">\r\n                            {dict.wizard.quote.milestone1Desc}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Quote Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n\r\n                {/* DTAM Quote */}\r\n                <div className={`\r\n                    relative gacp-card p-8 transition-all duration-500 border-2 overflow-hidden group\r\n                    ${dtamQuoteAccepted\r\n                        ? 'border-emerald-500 bg-emerald-50/10 shadow-emerald-100'\r\n                        : 'border-white bg-white hover:border-primary/20 hover:shadow-premium'\r\n                    }\r\n                `}>\r\n                    {dtamQuoteAccepted && (\r\n                        <div className=\"absolute -right-6 -top-6 w-24 h-24 bg-emerald-500/10 rounded-full blur-2xl animate-pulse\"></div>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center justify-between mb-8\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-14 h-14 bg-white rounded-2xl border border-gray-100 flex items-center justify-center p-2 shadow-sm overflow-hidden relative\">\r\n                                <Image src=\"/dtam_logo_new.png\" alt=\"DTAM\" fill className=\"object-contain p-2\" />\r\n                            </div>\r\n                            <div>\r\n                                <h4 className=\"font-black text-gray-900 text-lg leading-none\">{dict.wizard.quote.dtam.title}</h4>\r\n                                <p className=\"text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-1\">Certification Body</p>\r\n                            </div>\r\n                        </div>\r\n                        {dtamQuoteAccepted && (\r\n                            <div className=\"w-8 h-8 rounded-xl bg-emerald-500 text-white flex items-center justify-center shadow-lg animate-scale-in\">\r\n                                <CheckIcon className=\"w-5 h-5\" />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50/50 rounded-2xl p-6 border border-gray-100/50 mb-8 space-y-4\">\r\n                        <div className=\"flex justify-between items-center text-xs\">\r\n                            <span className=\"text-gray-400 font-bold uppercase tracking-widest\">Fee Description</span>\r\n                            <span className=\"text-gray-400 font-bold uppercase tracking-widest\">Amount</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <p className=\"text-sm font-bold text-gray-700\">{dict.wizard.quote.dtam.feeLabel}</p>\r\n                            <p className=\"text-xl font-black text-gray-900\">฿{dtamFee.toLocaleString()}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-3\">\r\n                        <div className=\"flex justify-between items-baseline mb-2 px-1\">\r\n                            <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">Quote Total</span>\r\n                            <span className={`text-4xl font-black transition-colors ${dtamQuoteAccepted ? 'text-emerald-600' : 'text-gray-900'}`}>\r\n                                ฿{dtamFee.toLocaleString()}\r\n                            </span>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <button\r\n                                onClick={() => setShowDtamQuote(true)}\r\n                                className=\"px-4 py-3 rounded-2xl bg-white border border-gray-200 text-gray-500 font-bold text-xs hover:bg-gray-50 transition-all flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Icons.Eye className=\"w-4 h-4\" />\r\n                                {dict.wizard.quote.buttons.viewDetails}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setDtamQuoteAccepted(!dtamQuoteAccepted)}\r\n                                className={`\r\n                                    px-4 py-3 rounded-2xl font-black text-xs transition-all flex items-center justify-center gap-2 shadow-sm\r\n                                    ${dtamQuoteAccepted\r\n                                        ? 'bg-emerald-500 text-white hover:bg-emerald-600'\r\n                                        : 'bg-primary text-white hover:shadow-premium'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                {dtamQuoteAccepted ? <CheckIcon className=\"w-4 h-4\" /> : <Icons.CheckCircle className=\"w-4 h-4\" />}\r\n                                {dtamQuoteAccepted ? dict.wizard.quote.buttons.accepted : dict.wizard.quote.buttons.accept}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Platform Quote */}\r\n                <div className={`\r\n                    relative gacp-card p-8 transition-all duration-500 border-2 overflow-hidden group\r\n                    ${platformQuoteAccepted\r\n                        ? 'border-blue-500 bg-blue-50/10 shadow-blue-100'\r\n                        : 'border-white bg-white hover:border-primary/20 hover:shadow-premium'\r\n                    }\r\n                `}>\r\n                    {platformQuoteAccepted && (\r\n                        <div className=\"absolute -right-6 -top-6 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl animate-pulse\"></div>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center justify-between mb-8\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-blue-200\">\r\n                                GP\r\n                            </div>\r\n                            <div>\r\n                                <h4 className=\"font-black text-gray-900 text-lg leading-none\">{dict.wizard.quote.platform.title}</h4>\r\n                                <p className=\"text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-1\">Software Platform</p>\r\n                            </div>\r\n                        </div>\r\n                        {platformQuoteAccepted && (\r\n                            <div className=\"w-8 h-8 rounded-xl bg-blue-500 text-white flex items-center justify-center shadow-lg animate-scale-in\">\r\n                                <CheckIcon className=\"w-5 h-5\" />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50/50 rounded-2xl p-6 border border-gray-100/50 mb-8 space-y-4\">\r\n                        <div className=\"flex justify-between items-center text-xs\">\r\n                            <span className=\"text-gray-400 font-bold uppercase tracking-widest\">Fee Description</span>\r\n                            <span className=\"text-gray-400 font-bold uppercase tracking-widest\">Amount</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <p className=\"text-sm font-bold text-gray-700\">{dict.wizard.quote.platform.feeLabel}</p>\r\n                            <p className=\"text-xl font-black text-gray-900\">฿{platformFee.toLocaleString()}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-3\">\r\n                        <div className=\"flex justify-between items-baseline mb-2 px-1\">\r\n                            <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">Quote Total</span>\r\n                            <span className={`text-4xl font-black transition-colors ${platformQuoteAccepted ? 'text-blue-600' : 'text-gray-900'}`}>\r\n                                ฿{platformFee.toLocaleString()}\r\n                            </span>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <button\r\n                                onClick={() => setShowPlatformQuote(true)}\r\n                                className=\"px-4 py-3 rounded-2xl bg-white border border-gray-200 text-gray-500 font-bold text-xs hover:bg-gray-50 transition-all flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Icons.Eye className=\"w-4 h-4\" />\r\n                                {dict.wizard.quote.buttons.viewDetails}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setPlatformQuoteAccepted(!platformQuoteAccepted)}\r\n                                className={`\r\n                                    px-4 py-3 rounded-2xl font-black text-xs transition-all flex items-center justify-center gap-2 shadow-sm\r\n                                    ${platformQuoteAccepted\r\n                                        ? 'bg-blue-500 text-white hover:bg-blue-600'\r\n                                        : 'bg-primary text-white hover:shadow-premium'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                {platformQuoteAccepted ? <Icons.CheckCircle className=\"w-4 h-4\" /> : <Icons.CheckCircle className=\"w-4 h-4\" />}\r\n                                {platformQuoteAccepted ? dict.wizard.quote.buttons.accepted : dict.wizard.quote.buttons.accept}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Net Total Summary */}\r\n            <div className={`\r\n                transition-all duration-700 transform px-2\r\n                ${allAccepted ? 'translate-y-0 opacity-100' : 'translate-y-12 opacity-40 grayscale'}\r\n            `}>\r\n                <div className=\"bg-gray-900 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden group border border-white/5\">\r\n                    <div className=\"absolute top-0 right-0 w-96 h-96 bg-primary/20 rounded-full blur-[100px] -mr-40 -mt-40 pointer-events-none\"></div>\r\n\r\n                    <div className=\"relative z-10 flex flex-col md:flex-row justify-between items-center gap-10\">\r\n                        <div className=\"space-y-6 text-center md:text-left\">\r\n                            <div>\r\n                                <h4 className=\"text-2xl font-black tracking-tight mb-2\">{dict.wizard.quote.summary.netTotal}</h4>\r\n                                <p className=\"text-white/40 text-xs font-medium uppercase tracking-widest\">Milestone 1: Application & Document Audit</p>\r\n                            </div>\r\n                            <div className=\"flex flex-wrap justify-center md:justify-start items-center gap-4\">\r\n                                <div className={`flex items-center gap-3 px-4 py-2 rounded-2xl border transition-all ${dtamQuoteAccepted ? 'bg-emerald-500/10 border-emerald-500/30 text-emerald-400' : 'bg-white/5 border-white/10 text-white/30'}`}>\r\n                                    <Icons.CheckCircle className=\"w-4 h-4\" />\r\n                                    <span className=\"text-xs font-black uppercase tracking-widest\">DTAM Accepted</span>\r\n                                </div>\r\n                                <div className={`flex items-center gap-3 px-4 py-2 rounded-2xl border transition-all ${platformQuoteAccepted ? 'bg-blue-500/10 border-blue-500/30 text-blue-400' : 'bg-white/5 border-white/10 text-white/30'}`}>\r\n                                    <Icons.CheckCircle className=\"w-4 h-4\" />\r\n                                    <span className=\"text-xs font-black uppercase tracking-widest\">Platform Accepted</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col items-center md:items-end gap-2 bg-white/5 p-8 rounded-[2rem] border border-white/10 min-w-[280px]\">\r\n                            <p className=\"text-[10px] font-black text-white/40 uppercase tracking-[0.2em]\">{dict.wizard.quote.summary.totalLabel}</p>\r\n                            <p className=\"text-6xl font-black tracking-tighter shadow-primary drop-shadow-2xl\">฿{totalMilestone1.toLocaleString()}</p>\r\n                            <p className=\"text-[10px] text-white/30 font-medium\">* รวมภาษีมูลค่าเพิ่มแล้ว</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={handleProceedToInvoice}\r\n                onBack={() => router.push('/farmer/applications/new/step/12')}\r\n                isNextDisabled={!allAccepted}\r\n                nextLabel=\"ไปที่ขั้นตอนการชำระเงิน\"\r\n            />\r\n\r\n            {showDtamQuote && <MockQuotePDF onClose={() => setShowDtamQuote(false)} />}\r\n            {showPlatformQuote && (\r\n                <PlatformQuotePDF\r\n                    quoteNumber={platformQuoteNumber}\r\n                    date={quoteDate}\r\n                    customer={{\r\n                        name: state.applicantData?.firstName\r\n                            ? `${state.applicantData.firstName} ${state.applicantData.lastName || ''}`\r\n                            : 'ผู้ยื่นคำขอ GACP',\r\n                        address: state.applicantData?.address,\r\n                        phone: state.applicantData?.phone,\r\n                    }}\r\n                    items={[{ description: 'ค่าบริการดำเนินการ GACP (งวดที่ 1)', descriptionEN: 'Platform Service Fee - Milestone 1', amount: platformFee }]}\r\n                    total={platformFee}\r\n                    status=\"PENDING\"\r\n                    validDays={30}\r\n                    onClose={() => setShowPlatformQuote(false)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepQuote;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepSubmit.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WarningIcon' is defined but never used.","line":8,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useWizardStore } from '../hooks/useWizardStore';\r\nimport { useRouter } from 'next/navigation';\r\nimport { apiClient } from '@/lib/api/api-client';\r\nimport { WizardNavigation } from '@/components/wizard/WizardNavigation';\r\nimport { CheckIcon, InfoIcon, WarningIcon } from '@/components/icons/WizardIcons';\r\nimport { Icons } from '@/components/ui/icons';\r\n\r\nexport const StepSubmit = () => {\r\n    const { state, setApplicationId } = useWizardStore();\r\n    const router = useRouter();\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [confirmChecks, setConfirmChecks] = useState({\r\n        dataCorrect: false,\r\n        termsAccepted: false,\r\n        paymentUnderstood: false,\r\n    });\r\n\r\n    const allChecked = confirmChecks.dataCorrect && confirmChecks.termsAccepted && confirmChecks.paymentUnderstood;\r\n\r\n    const handleSubmit = async () => {\r\n        if (!allChecked) return;\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            const applicationData = {\r\n                applicantData: state.applicantData,\r\n                farmData: state.farmData,\r\n                siteData: state.siteData,\r\n                lots: state.lots,\r\n                documents: state.documents,\r\n                plantId: state.plantId,\r\n                certificationPurpose: state.certificationPurpose,\r\n                locationType: state.locationType,\r\n                fees: state.milestone1,\r\n            };\r\n\r\n            const response = await apiClient.post<{ _id: string; applicationNo: string }>('/applications/submit', applicationData);\r\n\r\n            if (response.success && response.data) {\r\n                setApplicationId(response.data.applicationNo || response.data._id);\r\n                router.push('/farmer/applications/new/step/13');\r\n            } else {\r\n                throw new Error('Submission failed');\r\n            }\r\n        } catch (error) {\r\n            console.error('Submit error:', error);\r\n            // In a real app, show a toast. For now, alert is okay but let's make it better if possible.\r\n            alert('เกิดข้อผิดพลาดในการส่งคำขอ กรุณาลองใหม่อีกครั้ง');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const toggleCheck = (key: keyof typeof confirmChecks) => {\r\n        setConfirmChecks(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in pb-12 max-w-5xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className=\"w-12 h-12 bg-primary gradient-mask rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg ring-4 ring-primary-50\">\r\n                    12\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-primary-900\">ยืนยันการส่งคำขอรับรอง GACP</h2>\r\n                    <p className=\"text-text-secondary\">กรุณายอมรับข้อกำหนดและเงื่อนไขทางกฎหมายก่อนส่งข้อมูลเข้าสู่ระบบ</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Final Confirmation Hero */}\r\n            <div className=\"gacp-card bg-gradient-to-br from-primary shadow-soft relative overflow-hidden border-none text-white p-10 animate-slide-up\">\r\n                <div className=\"absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none\"></div>\r\n                <div className=\"absolute bottom-0 left-0 w-64 h-64 bg-black/10 rounded-full blur-3xl -ml-20 -mb-20 pointer-events-none\"></div>\r\n\r\n                <div className=\"relative z-10 space-y-8\">\r\n                    <div className=\"flex items-start gap-6\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30 shadow-xl\">\r\n                            <Icons.ShieldCheck className=\"w-10 h-10 text-white\" />\r\n                        </div>\r\n                        <div className=\"space-y-2 max-w-2xl\">\r\n                            <h3 className=\"text-2xl font-black tracking-tight\">สรุปข้อมูลคำขอ</h3>\r\n                            <p className=\"text-white/70 text-sm leading-relaxed\">\r\n                                ท่านกำลังจะส่งคำขอรับรองมาตรฐาน GACP สำหรับ <strong>{state.plantId?.toUpperCase() || '-'}</strong>\r\n                                เพื่อวัตถุประสงค์ <strong>{state.certificationPurpose || '-'}</strong> กรุณาตรวจสอบความถูกต้องของข้อมูลผู้ยื่นคำขอและเงื่อนไขด้านล่าง\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4\">\r\n                        <div className=\"space-y-1\">\r\n                            <p className=\"text-[10px] text-white/50 font-black uppercase tracking-widest leading-none\">ผู้ยื่นคำขอ / องค์กร</p>\r\n                            <p className=\"text-2xl font-black font-noto\">\r\n                                {state.applicantData?.applicantType === 'INDIVIDUAL'\r\n                                    ? `${state.applicantData?.firstName} ${state.applicantData?.lastName}`\r\n                                    : state.applicantData?.applicantType === 'COMMUNITY'\r\n                                        ? state.applicantData?.communityName\r\n                                        : state.applicantData?.companyName || '-'\r\n                                }\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                            <p className=\"text-[10px] text-white/50 font-black uppercase tracking-widest leading-none\">สถานที่ผลิต (ฟาร์ม)</p>\r\n                            <p className=\"text-2xl font-black font-noto\">{state.farmData?.farmName || '-'}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Legal Checks */}\r\n            <div className=\"space-y-4 animate-slide-up\" style={{ animationDelay: '100ms' }}>\r\n                <div\r\n                    onClick={() => toggleCheck('dataCorrect')}\r\n                    className={`\r\n                        group flex items-start gap-5 p-6 rounded-3xl cursor-pointer transition-all duration-300 border-2\r\n                        ${confirmChecks.dataCorrect\r\n                            ? 'bg-primary/5 border-primary/20 shadow-sm'\r\n                            : 'bg-white border-gray-100 hover:border-primary/30 hover:bg-gray-50/50'\r\n                        }\r\n                    `}\r\n                >\r\n                    <div className={`\r\n                        w-8 h-8 rounded-xl border-2 flex items-center justify-center transition-all duration-500 flex-shrink-0 mt-0.5\r\n                        ${confirmChecks.dataCorrect\r\n                            ? 'bg-primary border-primary'\r\n                            : 'bg-white border-gray-300 group-hover:border-primary'\r\n                        }\r\n                    `}>\r\n                        {confirmChecks.dataCorrect && <CheckIcon className=\"w-5 h-5 text-white animate-scale-in\" />}\r\n                    </div>\r\n                    <div>\r\n                        <h4 className=\"font-black text-gray-800 text-lg mb-1 leading-tight\">ข้าพเจ้ายืนยันความถูกต้องของข้อมูล</h4>\r\n                        <p className=\"text-sm text-gray-500 leading-relaxed\">\r\n                            ข้อมูลและเอกสารประกอบคำขอทั้งหมดที่ระบุในคำขอนี้เป็นความจริงและเป็นปัจจุบันทุกประการ\r\n                            หากมีการตรวจพบว่าข้อมูลเป็นเท็จ ข้าพเจ้ายินยอมให้ยกเลิกคำขอทันที\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div\r\n                    onClick={() => toggleCheck('termsAccepted')}\r\n                    className={`\r\n                        group flex items-start gap-5 p-6 rounded-3xl cursor-pointer transition-all duration-300 border-2\r\n                        ${confirmChecks.termsAccepted\r\n                            ? 'bg-primary/5 border-primary/20 shadow-sm'\r\n                            : 'bg-white border-gray-100 hover:border-primary/30 hover:bg-gray-50/50'\r\n                        }\r\n                    `}\r\n                >\r\n                    <div className={`\r\n                        w-8 h-8 rounded-xl border-2 flex items-center justify-center transition-all duration-500 flex-shrink-0 mt-0.5\r\n                        ${confirmChecks.termsAccepted\r\n                            ? 'bg-primary border-primary'\r\n                            : 'bg-white border-gray-300 group-hover:border-primary'\r\n                        }\r\n                    `}>\r\n                        {confirmChecks.termsAccepted && <CheckIcon className=\"w-5 h-5 text-white animate-scale-in\" />}\r\n                    </div>\r\n                    <div>\r\n                        <h4 className=\"font-black text-gray-800 text-lg mb-1 leading-tight\">ข้าพเจ้าได้อ่านและยอมรับข้อกำหนด (GACP Standards)</h4>\r\n                        <p className=\"text-sm text-gray-500 leading-relaxed\">\r\n                            ข้าพเจ้าเข้าใจมาตรฐานการปฏิบัติทางการเกษตรที่ดีสำหรับพืชสมุนไพร (GACP)\r\n                            และตกลงที่จะปฏิบัติตามมาตรฐานอย่างเคร่งครัดตลอดระยะเวลาการรับรอง\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div\r\n                    onClick={() => toggleCheck('paymentUnderstood')}\r\n                    className={`\r\n                        group flex items-start gap-5 p-6 rounded-3xl cursor-pointer transition-all duration-300 border-2\r\n                        ${confirmChecks.paymentUnderstood\r\n                            ? 'bg-primary/5 border-primary/20 shadow-sm'\r\n                            : 'bg-white border-gray-100 hover:border-primary/30 hover:bg-gray-50/50'\r\n                        }\r\n                    `}\r\n                >\r\n                    <div className={`\r\n                        w-8 h-8 rounded-xl border-2 flex items-center justify-center transition-all duration-500 flex-shrink-0 mt-0.5\r\n                        ${confirmChecks.paymentUnderstood\r\n                            ? 'bg-primary border-primary'\r\n                            : 'bg-white border-gray-300 group-hover:border-primary'\r\n                        }\r\n                    `}>\r\n                        {confirmChecks.paymentUnderstood && <CheckIcon className=\"w-5 h-5 text-white animate-scale-in\" />}\r\n                    </div>\r\n                    <div>\r\n                        <h4 className=\"font-black text-gray-800 text-lg mb-1 leading-tight\">รับทราบเรื่องค่าธรรมเนียม</h4>\r\n                        <p className=\"text-sm text-gray-500 leading-relaxed\">\r\n                            ข้าพเจ้าเข้าใจว่าจะต้องชำระค่าธรรมเนียมการตรวจประเมินหลังจากได้รับใบแจ้งหนี้ (Invoice)\r\n                            และการไม่ชำระอาจส่งผลให้การพิจารณาคำขอหยุดชะงัก\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Submission Warning */}\r\n            <div className=\"p-6 bg-blue-50/50 border border-blue-100 rounded-[2rem] flex gap-4 animate-slide-up\" style={{ animationDelay: '200ms' }}>\r\n                <div className=\"p-3 bg-white rounded-2xl shadow-sm h-fit\">\r\n                    <InfoIcon className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                    <p className=\"font-black text-blue-900 text-sm italic\">คำแนะนำสำหรับการส่งคำขอ</p>\r\n                    <p className=\"text-xs leading-relaxed text-blue-800/80\">\r\n                        เมื่อท่านกดยืนยัน ข้อมูลจะถูกบันทึกเข้าสู่ระบบ และท่านจะไม่สามารถกลับมาแก้ไขข้อมูลได้ด้วยตนเองจนกว่าเจ้าหน้าที่จะทำการตรวจสอบ\r\n                        กรุณาตรวจสอบหน้า <strong>&quot;Preview&quot;</strong> อีกครั้งหากไม่มั่นใจ\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <WizardNavigation\r\n                onNext={handleSubmit}\r\n                onBack={() => router.push('/farmer/applications/new/step/11')}\r\n                isNextDisabled={!allChecked || isSubmitting}\r\n                nextLabel={isSubmitting ? 'กำลังส่งคำขอเข้าสู่ระบบ...' : 'ยืนยันและส่งคำขอ'}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StepSubmit;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\steps\\StepSuccess.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\success\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[939,942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[939,942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":120,"column":29,"nodeType":"JSXOpeningElement","endLine":120,"endColumn":173}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\success\\page.tsx:33:9\n  31 |         }));\n  32 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 33 |         setConfettiItems(items);\n     |         ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  34 |     }, []);\n  35 |\n  36 |     useEffect(() => {","line":33,"column":9,"nodeType":null,"endLine":33,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\new\\success\\page.tsx:38:9\n  36 |     useEffect(() => {\n  37 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 38 |         setIsDark(localStorage.getItem(\"theme\") === \"dark\");\n     |         ^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |         setAppId(localStorage.getItem('last_application_id') || `GACP-${Date.now().toString(36).toUpperCase()}`);\n  40 |         const savedData = localStorage.getItem('last_payment_data');\n  41 |         if (savedData) setPaymentData(JSON.parse(savedData));","line":38,"column":9,"nodeType":null,"endLine":38,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { PLANTS } from '../hooks/useWizardStore';\r\n\r\nconst SITE_TYPE_LABELS: Record<string, string> = { OUTDOOR: 'กลางแจ้ง', INDOOR: 'โรงเรือนระบบปิด', GREENHOUSE: 'โรงเรือนทั่วไป' };\r\nconst FEE_PER_SITE_TYPE = 5000;\r\n\r\ninterface PaymentData { applicantName: string; siteTypesCount: number; installment1Fee: number; invoiceId: string; paymentDate: string; plantId: string; siteTypes: string[]; }\r\n\r\nexport default function SuccessPage() {\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [appId, setAppId] = useState('');\r\n    const [showConfetti, setShowConfetti] = useState(true);\r\n    const [showReceipt, setShowReceipt] = useState(false);\r\n    const [paymentData, setPaymentData] = useState<PaymentData | null>(null);\r\n    const [countdown, setCountdown] = useState(60);\r\n\r\n    const [confettiItems, setConfettiItems] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        const items = [...Array(40)].map((_, i) => ({\r\n            width: `${8 + Math.random() * 8}px`,\r\n            height: `${8 + Math.random() * 8}px`,\r\n            background: ['#10B981', '#F59E0B', '#3B82F6', '#EC4899', '#8B5CF6', '#EF4444'][i % 6],\r\n            borderRadius: i % 3 === 0 ? '50%' : '2px',\r\n            left: `${Math.random() * 100}%`,\r\n            top: '-20px',\r\n            animationDelay: `${Math.random() * 0.8}s`\r\n        }));\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setConfettiItems(items);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        setAppId(localStorage.getItem('last_application_id') || `GACP-${Date.now().toString(36).toUpperCase()}`);\r\n        const savedData = localStorage.getItem('last_payment_data');\r\n        if (savedData) setPaymentData(JSON.parse(savedData));\r\n        setTimeout(() => setShowConfetti(false), 3000);\r\n    }, []);\r\n\r\n    useEffect(() => { if (countdown > 0) { const t = setTimeout(() => setCountdown(countdown - 1), 1000); return () => clearTimeout(t); } }, [countdown]);\r\n\r\n    const plant = paymentData?.plantId ? PLANTS.find(p => p.id === paymentData.plantId) : null;\r\n    const totalFee = paymentData?.installment1Fee || FEE_PER_SITE_TYPE;\r\n    const applicantName = paymentData?.applicantName || '-';\r\n    const siteTypes = paymentData?.siteTypes || ['OUTDOOR'];\r\n    const paymentDate = paymentData?.paymentDate ? new Date(paymentData.paymentDate) : new Date();\r\n\r\n    const handlePrint = () => window.print();\r\n\r\n    return (\r\n        <div className={`min-h-screen p-6 font-sans ${isDark ? 'bg-slate-900' : 'bg-gradient-to-b from-primary-50 to-surface-100'}`}>\r\n            {/* Confetti */}\r\n            {showConfetti && (\r\n                <div className=\"fixed inset-0 pointer-events-none overflow-hidden z-50\">\r\n                    {confettiItems.map((style, i) => (\r\n                        <div key={i} className=\"absolute animate-[confetti_2s_ease-out_forwards]\" style={style} />\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Success Header */}\r\n            <div className=\"text-center mb-6\">\r\n                <div className=\"w-[90px] h-[90px] bg-gradient-to-br from-primary-700 via-primary-600 to-primary-400 rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl shadow-primary-500/40 animate-[scaleIn_0.5s_ease-out]\">\r\n                    <svg width=\"45\" height=\"45\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M20 6L9 17L4 12\" /></svg>\r\n                </div>\r\n                <h1 className={`text-2xl font-bold mb-2 ${isDark ? 'text-surface-100' : 'text-primary-800'}`}>ยื่นคำขอสำเร็จ!</h1>\r\n                <p className={`text-sm mb-1 ${isDark ? 'text-slate-400' : 'text-primary-600'}`}>ชำระเงินเรียบร้อยแล้ว</p>\r\n                <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-full border-2 border-primary-600 shadow-sm ${isDark ? 'bg-slate-700' : 'bg-white'}`}>\r\n                    <span className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>หมายเลขคำขอ:</span>\r\n                    <strong className=\"text-sm text-primary-600 tracking-wide\">{appId}</strong>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Application Summary */}\r\n            <div className={`rounded-2xl p-5 mb-4 max-w-md mx-auto shadow-lg border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <h3 className={`text-sm font-semibold mb-4 flex items-center gap-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>สรุปข้อมูลคำขอ</h3>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                    {[{ label: 'ผู้ยื่นคำขอ', value: applicantName }, { label: 'ประเภทพืช', value: `${plant?.icon} ${plant?.name || 'กัญชา'}` }, { label: 'ลักษณะพื้นที่', value: siteTypes.map(t => SITE_TYPE_LABELS[t] || t).join(', ') }, { label: 'วันที่ชำระเงิน', value: paymentDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' }) }].map((item, i) => (\r\n                        <div key={i} className={`p-3 rounded-lg ${isDark ? 'bg-slate-700' : 'bg-surface-100'}`}>\r\n                            <div className={`text-[11px] mb-1 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{item.label}</div>\r\n                            <div className={`text-sm font-medium ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{item.value}</div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                <div className=\"flex justify-center gap-2 items-center p-3 bg-primary-50 border border-primary-600 rounded-lg mt-4\">\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"2\"><path d=\"M20 6L9 17L4 12\" /></svg>\r\n                    <span className=\"text-sm font-semibold text-primary-800\">ชำระเงินงวดที่ 1 เรียบร้อยแล้ว</span>\r\n                    <span className=\"text-base font-bold text-primary-600\">฿{totalFee.toLocaleString()}</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Email Notification */}\r\n            <div className={`rounded-xl px-4 py-3 mb-4 max-w-md mx-auto flex items-start gap-3 border ${isDark ? 'bg-blue-500/10 border-blue-500/30' : 'bg-blue-50 border-blue-200'}`}>\r\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\" /><polyline points=\"22,6 12,13 2,6\" /></svg>\r\n                <div>\r\n                    <p className={`text-sm font-medium mb-0.5 ${isDark ? 'text-blue-300' : 'text-blue-700'}`}>อีเมลยืนยันถูกส่งไปแล้ว</p>\r\n                    <p className={`text-xs ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>กรุณาตรวจสอบอีเมลของท่านสำหรับใบเสร็จและรายละเอียดคำขอ</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Receipt Toggle */}\r\n            <div className=\"text-center mb-4\">\r\n                <button onClick={() => setShowReceipt(!showReceipt)} className={`px-6 py-3 rounded-lg border-2 border-primary-600 text-sm font-semibold inline-flex items-center gap-2 shadow-lg shadow-primary-500/20 transition-all ${showReceipt ? 'bg-primary-600 text-white' : 'bg-white text-primary-600'}`}>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" /><polyline points=\"14 2 14 8 20 8\" /></svg>\r\n                    {showReceipt ? 'ซ่อนใบเสร็จ' : 'ดูใบเสร็จรับเงิน'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Official Receipt */}\r\n            {showReceipt && (\r\n                <div id=\"official-receipt\" className=\"bg-white text-slate-900 p-7 max-w-lg mx-auto mb-6 border-2 border-primary-600 rounded-xl shadow-xl font-sans print:border-0 print:shadow-none\">\r\n                    {/* Header */}\r\n                    <div className=\"text-center border-b-[3px] border-primary-600 pb-5 mb-5\">\r\n                        <div className=\"flex justify-center items-center gap-3 mb-3\">\r\n                            <img src=\"/images/logo-dtam.png\" alt=\"DTAM\" className=\"w-12 h-12 object-contain\" onError={(e) => { e.currentTarget.style.display = 'none'; }} />\r\n                            <div><div className=\"text-base font-bold text-primary-800\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div><div className=\"text-[11px] text-slate-500\">Department of Thai Traditional and Alternative Medicine</div></div>\r\n                        </div>\r\n                        <h2 className=\"text-xl font-bold text-primary-600 my-2\">ใบเสร็จรับเงิน</h2>\r\n                        <div className=\"text-xs text-slate-500\">เลขที่ใบเสร็จ: <strong className=\"text-slate-900\">{appId}-REC</strong></div>\r\n                    </div>\r\n\r\n                    {/* Applicant Info */}\r\n                    <table className=\"w-full text-sm mb-5\">\r\n                        <tbody>\r\n                            {[{ label: 'วันที่ชำระเงิน', value: paymentDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }) }, { label: 'ผู้ชำระเงิน', value: applicantName }, { label: 'เลขที่คำขอ', value: appId, highlight: true }, { label: 'ประเภทพืช', value: `${plant?.icon} ${plant?.name || 'กัญชา'}` }].map((row, i) => (\r\n                                <tr key={i} className=\"border-b border-surface-200\"><td className=\"py-2.5 text-slate-500 w-[35%]\">{row.label}</td><td className={`py-2.5 font-medium ${row.highlight ? 'text-primary-600 font-semibold' : ''}`}>{row.value}</td></tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n\r\n                    {/* Fee Breakdown */}\r\n                    <div className=\"bg-surface-100 rounded-lg p-4 mb-5\">\r\n                        <div className=\"text-xs font-semibold text-slate-700 mb-3\">รายการค่าธรรมเนียม (งวดที่ 1)</div>\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead><tr className=\"border-b-2 border-surface-200\"><th className=\"text-left py-2.5 text-slate-500\">รายการ</th><th className=\"text-center py-2.5 text-slate-500 w-[60px]\">จำนวน</th><th className=\"text-right py-2.5 text-slate-500 w-[100px]\">ราคา</th></tr></thead>\r\n                            <tbody>\r\n                                {siteTypes.map((type, i) => (<tr key={i} className=\"border-b border-surface-200\"><td className=\"py-3\">ค่าตรวจเอกสาร ({SITE_TYPE_LABELS[type] || type})</td><td className=\"text-center py-3\">1</td><td className=\"text-right py-3\">฿{FEE_PER_SITE_TYPE.toLocaleString()}</td></tr>))}\r\n                            </tbody>\r\n                            <tfoot><tr><td colSpan={2} className=\"py-3.5 font-bold text-sm\">รวมทั้งสิ้น</td><td className=\"text-right py-3.5 font-bold text-lg text-primary-600\">฿{totalFee.toLocaleString()}</td></tr></tfoot>\r\n                        </table>\r\n                    </div>\r\n\r\n                    {/* Success Badge */}\r\n                    <div className=\"flex justify-center gap-2 items-center p-3.5 bg-primary-50 border-2 border-primary-600 rounded-lg mb-5\">\r\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"2\"><path d=\"M20 6L9 17L4 12\" /></svg>\r\n                        <span className=\"text-base font-bold text-primary-800\">ชำระเงินเรียบร้อยแล้ว</span>\r\n                    </div>\r\n\r\n                    {/* Signature */}\r\n                    <div className=\"grid grid-cols-2 gap-6 pt-5 border-t-2 border-dashed border-surface-200\">\r\n                        {[{ title: 'ลงชื่อ ผู้รับเงิน' }, { title: 'วันที่' }].map((sig, i) => (<div key={i} className=\"text-center\"><div className=\"h-12 border-b border-slate-600 mb-1.5\"></div><div className=\"text-[11px] text-slate-500\">{sig.title}</div></div>))}\r\n                    </div>\r\n\r\n                    {/* Print Button */}\r\n                    <div className=\"text-center mt-5\">\r\n                        <button onClick={handlePrint} className=\"px-7 py-3 rounded-lg border-2 border-primary-600 bg-white text-primary-600 text-sm font-semibold inline-flex items-center gap-2\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><polyline points=\"6 9 6 2 18 2 18 9\" /><path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\" /><rect x=\"6\" y=\"14\" width=\"12\" height=\"8\" /></svg>\r\n                            พิมพ์ใบเสร็จ / ดาวน์โหลด PDF\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Next Steps */}\r\n            <div className={`rounded-2xl p-5 mb-4 max-w-md mx-auto shadow-lg border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <h3 className={`text-sm font-semibold mb-4 flex items-center gap-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ขั้นตอนถัดไป</h3>\r\n                {[{ text: 'ยื่นคำขอและชำระเงินงวดที่ 1 สำเร็จ', done: true, active: true }, { text: 'รอตรวจสอบเอกสาร (ใช้เวลา 3-5 วันทำการ)', done: false, active: true }, { text: 'นัดหมายและตรวจประเมินสถานที่', done: false, active: false }, { text: 'ชำระเงินงวดที่ 2 (หลังผ่านการประเมิน)', done: false, active: false }, { text: 'รับใบรับรองมาตรฐาน GACP', done: false, active: false }].map((step, i) => (\r\n                    <div key={i} className={`flex items-center gap-3.5 py-2.5 ml-3 pl-4 border-l-[3px] ${step.done ? 'border-primary-600' : step.active ? 'border-secondary-500' : isDark ? 'border-slate-600' : 'border-surface-200'} ${!step.done && !step.active ? 'opacity-60' : ''}`}>\r\n                        <span className={`w-5 h-5 rounded-full flex items-center justify-center ${step.done ? 'bg-primary-600 text-white' : step.active ? 'bg-secondary-100 text-secondary-600' : isDark ? 'bg-slate-700 text-slate-500' : 'bg-surface-200 text-slate-400'}`}>\r\n                            {step.done && <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\"><path d=\"M20 6L9 17L4 12\" /></svg>}\r\n                            {!step.done && <span className=\"text-[10px]\">{i + 1}</span>}\r\n                        </span>\r\n                        <span className={`text-sm ${step.done ? 'text-primary-600' : step.active ? 'text-secondary-600 font-semibold' : isDark ? 'text-slate-400' : 'text-slate-500'}`}>{step.text}</span>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"flex flex-col gap-3 max-w-md mx-auto\">\r\n                <Link href=\"/tracking\" className=\"py-4 px-6 rounded-xl bg-gradient-to-r from-primary-700 to-primary-600 text-white text-base font-semibold text-center flex items-center justify-center gap-2.5 shadow-xl shadow-primary-500/40\">\r\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\" /><circle cx=\"12\" cy=\"10\" r=\"3\" /></svg>\r\n                    ติดตามสถานะคำขอ\r\n                </Link>\r\n                <Link href=\"/farmer/dashboard\" className={`py-4 px-6 rounded-xl text-center text-sm font-medium flex items-center justify-center gap-2.5 border-2 ${isDark ? 'bg-slate-700 border-slate-600 text-surface-100' : 'bg-white border-surface-200 text-slate-700'}`}>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\" /><polyline points=\"9 22 9 12 15 12 15 22\" /></svg>\r\n                    กลับหน้าหลัก {countdown > 0 && <span className=\"text-xs text-slate-400\">(อัตโนมัติใน {countdown} วินาที)</span>}\r\n                </Link>\r\n            </div>\r\n\r\n            {/* Feedback */}\r\n            <div className=\"text-center mt-6\">\r\n                <a href=\"#feedback\" className={`text-sm underline flex items-center justify-center gap-1.5 ${isDark ? 'text-blue-400' : 'text-blue-600'}`}>\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z\" /></svg>\r\n                    แสดงความคิดเห็นเกี่ยวกับบริการ\r\n                </a>\r\n            </div>\r\n\r\n            {/* Styles */}\r\n            <style jsx global>{`\r\n                @keyframes scaleIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }\r\n                @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }\r\n                @media print { body * { visibility: hidden; } #official-receipt, #official-receipt * { visibility: visible; } #official-receipt { position: absolute; left: 0; top: 0; width: 100%; border: none !important; box-shadow: none !important; } }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\page.tsx:46:9\n  44 |     useEffect(() => {\n  45 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 46 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  47 |         setIsDark(localStorage.getItem(\"theme\") === \"dark\");\n  48 |\n  49 |         const user = AuthService.getUser();","line":46,"column":9,"nodeType":null,"endLine":46,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api/api-client\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\nimport {\r\n    IconDocument, IconPlus, IconChevronRight,\r\n    IconDraft, IconCreditCard as IconPayment, IconSearch, IconWarning,\r\n    IconBuilding, IconCalendar, IconCertificate, IconChart, IconClock, IconLeaf\r\n} from \"@/components/ui/icons\";\r\n\r\ninterface Application { _id: string; applicationNumber?: string; status: string; createdAt: string; plantType?: string; }\r\n\r\nconst STATUS_CONFIG: Record<string, { label: string; Icon: React.FC<{ size?: number; className?: string }>; bgClass: string }> = {\r\n    DRAFT: { label: \"ร่าง\", Icon: IconDraft, bgClass: \"bg-slate-500\" },\r\n    PAYMENT_1_PENDING: { label: \"รอชำระงวด 1\", Icon: IconPayment, bgClass: \"bg-amber-500\" },\r\n    SUBMITTED: { label: \"รอตรวจเอกสาร\", Icon: IconSearch, bgClass: \"bg-blue-500\" },\r\n    REVISION_REQ: { label: \"ต้องแก้ไข\", Icon: IconWarning, bgClass: \"bg-red-500\" },\r\n    PAYMENT_2_PENDING: { label: \"รอชำระงวด 2\", Icon: IconPayment, bgClass: \"bg-amber-500\" },\r\n    AUDIT_PENDING: { label: \"รอตรวจสถานที่\", Icon: IconBuilding, bgClass: \"bg-violet-500\" },\r\n    AUDIT_SCHEDULED: { label: \"นัดตรวจแล้ว\", Icon: IconCalendar, bgClass: \"bg-cyan-500\" },\r\n    CERTIFIED: { label: \"ได้รับการรับรอง\", Icon: IconCertificate, bgClass: \"bg-emerald-500\" },\r\n};\r\n\r\nexport default function ApplicationsPage() {\r\n    const router = useRouter();\r\n    const [applications, setApplications] = useState<Application[]>([]);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const loadApplications = async () => {\r\n        setLoading(true);\r\n        const result = await api.get<Application[]>(\"/applications/my\");\r\n        if (result.success && result.data) {\r\n            const apps = Array.isArray(result.data) ? result.data : (result.data as any).data || [];\r\n            setApplications(apps);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n\r\n        const user = AuthService.getUser();\r\n        if (!user) {\r\n            router.push(\"/login\");\r\n            return;\r\n        }\r\n\r\n        loadApplications();\r\n    }, [router]);\r\n\r\n    if (!mounted) return (\r\n        <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-slate-900' : 'bg-stone-50'}`}>\r\n            <div className=\"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin\" />\r\n        </div>\r\n    );\r\n\r\n    const stats = [\r\n        { label: \"ทั้งหมด\", value: applications.length, Icon: IconChart, color: \"bg-slate-600\" },\r\n        { label: \"กำลังดำเนินการ\", value: applications.filter(a => !['DRAFT', 'CERTIFIED'].includes(a.status)).length, Icon: IconClock, color: \"bg-amber-500\" },\r\n        { label: \"ได้รับรอง\", value: applications.filter(a => a.status === 'CERTIFIED').length, Icon: IconCertificate, color: \"bg-emerald-500\" },\r\n        { label: \"ร่าง\", value: applications.filter(a => a.status === 'DRAFT').length, Icon: IconDraft, color: \"bg-blue-500\" },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in\">\r\n            {/* Header with Official Gradient */}\r\n            <div className=\"bg-gradient-to-br from-[#006837] to-[#004d28] rounded-[2rem] p-8 lg:p-12 text-white relative overflow-hidden shadow-xl\">\r\n                <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-10 mix-blend-overlay\"></div>\r\n                <div className=\"absolute top-0 right-0 w-[50%] h-full bg-gradient-to-l from-emerald-400/20 to-transparent\"></div>\r\n\r\n                <div className=\"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-end gap-6\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl lg:text-4xl font-black mb-2 tracking-tight\">คำขอของฉัน</h1>\r\n                        <p className=\"text-emerald-100 font-medium\">จัดการและติดตามสถานะการรับรองมาตรฐาน GACP</p>\r\n                    </div>\r\n                    <Link href=\"/farmer/applications/new\" className=\"bg-white text-[#006837] px-6 py-3 rounded-xl font-bold hover:bg-emerald-50 shadow-lg shadow-black/10 transition-all flex items-center gap-2\">\r\n                        <IconPlus size={20} />\r\n                        ยื่นคำขอใหม่\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Grid */}\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                {stats.map((stat, i) => (\r\n                    <div key={i} className=\"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <span className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">{stat.label}</span>\r\n                            <div className={`w-10 h-10 rounded-xl ${stat.color.replace('bg-', 'bg-')}/10 flex items-center justify-center text-${stat.color.replace('bg-', '')}`}>\r\n                                <stat.Icon size={20} className={stat.color.replace('bg-', 'text-')} />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-3xl font-black text-slate-800 group-hover:scale-110 transition-transform origin-left\">{stat.value}</p>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Applications List */}\r\n            {loading ? (\r\n                <div className=\"text-center py-20\">\r\n                    <div className=\"w-10 h-10 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto mb-4\"></div>\r\n                    <p className=\"text-slate-400 font-bold animate-pulse\">กำลังโหลดข้อมูล...</p>\r\n                </div>\r\n            ) : applications.length > 0 ? (\r\n                <div className=\"space-y-4\">\r\n                    {applications.map((app) => {\r\n                        const statusInfo = STATUS_CONFIG[app.status] || { label: app.status, Icon: IconDocument, bgClass: 'bg-slate-500' };\r\n                        const StatusIcon = statusInfo.Icon;\r\n                        return (\r\n                            <div key={app._id} className=\"group bg-white rounded-2xl p-6 border border-slate-100 shadow-sm hover:shadow-lg hover:border-[#006837]/20 transition-all relative overflow-hidden\">\r\n                                <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-emerald-50 to-transparent rounded-bl-full opacity-0 group-hover:opacity-100 transition-opacity\"></div>\r\n\r\n                                <div className=\"flex flex-col md:flex-row justify-between items-center gap-6 relative z-10\">\r\n                                    <div className=\"flex items-center gap-6 w-full md:w-auto\">\r\n                                        <div className={`w-16 h-16 rounded-2xl ${statusInfo.bgClass} flex items-center justify-center shadow-lg transform group-hover:rotate-6 transition-transform`}>\r\n                                            <StatusIcon size={28} className=\"text-white\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"flex items-center gap-3 mb-1\">\r\n                                                <h3 className=\"text-xl font-black text-slate-800 tracking-tight\">\r\n                                                    {app.applicationNumber || `#${app._id.slice(-6).toUpperCase()}`}\r\n                                                </h3>\r\n                                                {app.plantType && (\r\n                                                    <span className=\"bg-emerald-50 text-[#006837] px-3 py-0.5 rounded-full text-xs font-bold flex items-center gap-1 border border-emerald-100\">\r\n                                                        <IconLeaf size={10} />\r\n                                                        {app.plantType}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                            <p className=\"text-sm text-slate-500 font-medium\">\r\n                                                ยื่นระเบียบ: {new Date(app.createdAt).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center gap-4 w-full md:w-auto justify-between md:justify-end\">\r\n                                        <div className={`px-4 py-2 rounded-xl text-sm font-bold ${statusInfo.bgClass.replace('bg-', 'bg-')}/10 ${statusInfo.bgClass.replace('bg-', 'text-')}`}>\r\n                                            {statusInfo.label}\r\n                                        </div>\r\n                                        <Link href={`/farmer/applications/${app._id}`} className=\"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:bg-[#006837] hover:text-white transition-all\">\r\n                                            <IconChevronRight size={20} />\r\n                                        </Link>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            ) : (\r\n                <div className=\"bg-white rounded-[2rem] p-16 text-center border-2 border-dashed border-slate-200\">\r\n                    <div className=\"w-20 h-20 mx-auto mb-6 rounded-3xl bg-emerald-50 flex items-center justify-center\">\r\n                        <IconFolderOpen size={40} className=\"text-[#006837]\" />\r\n                    </div>\r\n                    <h3 className=\"text-xl font-black text-slate-800 mb-2\">เริ่มสร้างคำขอแรกของคุณ</h3>\r\n                    <p className=\"text-slate-500 mb-8 max-w-md mx-auto\">\r\n                        ระบบจะช่วยแนะนำคุณทุกขั้นตอนในการขอรับรองมาตรฐาน GACP Thailand\r\n                    </p>\r\n                    <Link href=\"/farmer/applications/new\" className=\"inline-flex items-center gap-2 px-8 py-4 rounded-xl bg-[#006837] text-white font-bold hover:bg-[#00502b] shadow-lg shadow-emerald-600/30 transition-all\">\r\n                        <IconPlus size={20} />\r\n                        เริ่มยื่นคำขอ\r\n                    </Link>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n// Helper icon for empty state\r\nconst IconFolderOpen = ({ size, className }: { size: number, className: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"></path>\r\n    </svg>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\InvoiceStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\PaymentStep.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":29,"column":25,"nodeType":"JSXOpeningElement","endLine":34,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { RENEWAL_FEE } from './types';\r\n\r\ninterface PaymentStepProps {\r\n    renewalId: string | null;\r\n    isDark: boolean;\r\n    onBack: () => void;\r\n    onConfirm: () => void;\r\n}\r\n\r\nexport function PaymentStep({ renewalId, isDark, onBack, onConfirm }: PaymentStepProps) {\r\n    return (\r\n        <div className={`min-h-screen p-6 font-sans ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n            <div className=\"max-w-md mx-auto\">\r\n                <button onClick={onBack} className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border mb-6 ${isDark ? 'border-slate-700 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n\r\n                <h1 className={`text-2xl font-semibold mb-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ชำระเงินค่าต่อสัญญา</h1>\r\n                <p className={`mb-6 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>สแกน QR Code เพื่อชำระเงิน</p>\r\n\r\n                {/* QR Payment Card */}\r\n                <div className={`rounded-2xl p-7 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                    <div className=\"mb-5\">\r\n                        <span className=\"inline-block px-5 py-2 bg-[#00427A] rounded-lg text-white text-sm font-semibold\">พร้อมเพย์ | PromptPay</span>\r\n                    </div>\r\n\r\n                    {/* QR Code */}\r\n                    <div className=\"w-[220px] h-[220px] mx-auto mb-5 bg-white border-2 border-[#00427A] rounded-xl p-2.5 flex items-center justify-center\">\r\n                        <img\r\n                            src={`https://promptpay.io/0994566289/${RENEWAL_FEE}.png`}\r\n                            alt=\"PromptPay QR\"\r\n                            className=\"w-[200px] h-[200px]\"\r\n                            onError={(e) => { e.currentTarget.onerror = null; e.currentTarget.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=PROMPTPAY:${RENEWAL_FEE}`; }}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Amount */}\r\n                    <div className=\"p-4 bg-primary-50 rounded-xl mb-5\">\r\n                        <p className=\"text-sm text-slate-500 mb-1\">จำนวนเงินที่ต้องชำระ</p>\r\n                        <p className=\"text-3xl font-bold text-primary-600\">฿{RENEWAL_FEE.toLocaleString()}</p>\r\n                    </div>\r\n\r\n                    {/* Receiver Info */}\r\n                    <div className={`p-3 rounded-lg text-sm mb-6 ${isDark ? 'bg-slate-700 text-slate-300' : 'bg-surface-100 text-slate-700'}`}>\r\n                        <p className=\"mb-1\"><strong>ผู้รับเงิน:</strong> กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</p>\r\n                        <p><strong>หมายเลขเคส:</strong> {renewalId}</p>\r\n                    </div>\r\n\r\n                    <button onClick={onConfirm} className=\"w-full py-4 rounded-xl bg-gradient-to-br from-primary-600 to-primary-500 text-white text-base font-semibold shadow-lg shadow-primary-500/40\">ยืนยันการชำระเงิน</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\QuotationStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renewalId' is defined but never used.","line":14,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from 'react';\r\nimport { Certificate, RENEWAL_FEE } from './types';\r\n\r\ninterface QuotationStepProps {\r\n    certificate: Certificate | null;\r\n    renewalId: string | null;\r\n    isDark: boolean;\r\n    onBack: () => void;\r\n    onProceed: () => void;\r\n}\r\n\r\nexport function QuotationStep({ certificate, renewalId, isDark, onBack, onProceed }: QuotationStepProps) {\r\n    const [quoteNumber] = useState(() => `QT-${Date.now().toString(36).toUpperCase().slice(-6)}`);\r\n    const [currentDate] = useState(() => new Date());\r\n    const [validUntil] = useState(() => {\r\n        const d = new Date();\r\n        d.setDate(d.getDate() + 30);\r\n        return d;\r\n    });\r\n\r\n    return (\r\n        <div className={`min-h-screen p-6 font-sans ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n            <div className=\"max-w-3xl mx-auto\">\r\n                <button onClick={onBack} className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border mb-6 ${isDark ? 'border-slate-700 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n                <h1 className={`text-xl font-semibold mb-5 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ใบเสนอราคา / Quotation</h1>\r\n\r\n                {/* Official Document */}\r\n                <div className=\"bg-white text-slate-900 p-10 border border-surface-200 rounded shadow-lg mb-6 font-[Sarabun]\">\r\n                    {/* Header */}\r\n                    <div className=\"flex items-start gap-4 mb-6 pb-4 border-b-2 border-slate-800\">\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"text-base font-bold text-slate-800 mb-0.5\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div>\r\n                            <div className=\"text-[11px] text-slate-700 mb-0.5\">Department of Thai Traditional and Alternative Medicine</div>\r\n                            <div className=\"text-[10px] text-slate-500\">กระทรวงสาธารณสุข | Ministry of Public Health</div>\r\n                        </div>\r\n                        <div className=\"text-right min-w-[160px]\">\r\n                            <div className=\"bg-gradient-to-r from-slate-800 to-blue-600 text-white px-3.5 py-1.5 text-sm font-semibold rounded mb-2\">ใบเสนอราคา</div>\r\n                            <div className=\"text-[11px] text-slate-700\">เลขที่: <strong>{quoteNumber}</strong></div>\r\n                            <div className=\"text-[10px] text-slate-500\">วันที่: {currentDate.toLocaleDateString('th-TH')}</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Recipient */}\r\n                    <div className=\"mb-5 p-3 bg-surface-100 rounded-md border border-surface-200\">\r\n                        <div className=\"text-[11px] text-slate-500 mb-1\">เรียน / To:</div>\r\n                        <div className=\"text-sm font-semibold\">{certificate?.siteName || 'ผู้ประกอบการ'}</div>\r\n                        <div className=\"text-[11px] text-slate-500\">ใบรับรอง: {certificate?.certificateNumber || '-'}</div>\r\n                    </div>\r\n\r\n                    {/* Fee Table */}\r\n                    <table className=\"w-full text-xs mb-5 border-collapse\">\r\n                        <thead><tr className=\"bg-slate-800 text-white\"><th className=\"p-2.5 text-center border border-slate-800 w-[50px]\">ลำดับ</th><th className=\"p-2.5 text-left border border-slate-800\">รายการ</th><th className=\"p-2.5 text-right border border-slate-800 w-[100px]\">จำนวนเงิน (บาท)</th></tr></thead>\r\n                        <tbody>\r\n                            <tr><td className=\"p-3 border border-surface-200 text-center\">1</td><td className=\"p-3 border border-surface-200\">ค่าบริการต่ออายุใบรับรองมาตรฐาน GACP</td><td className=\"p-3 border border-surface-200 text-right\">{RENEWAL_FEE.toLocaleString()}</td></tr>\r\n                        </tbody>\r\n                        <tfoot>\r\n                            <tr className=\"bg-surface-100\"><td colSpan={2} className=\"p-3 border border-surface-200 text-right font-semibold\">รวมทั้งสิ้น</td><td className=\"p-3 border border-surface-200 text-right font-bold text-slate-800\">{RENEWAL_FEE.toLocaleString()}</td></tr>\r\n                            <tr><td colSpan={3} className=\"p-2 border border-surface-200 text-center italic text-[11px] text-slate-600\">(สามหมื่นบาทถ้วน)</td></tr>\r\n                        </tfoot>\r\n                    </table>\r\n\r\n                    {/* Validity */}\r\n                    <div className=\"flex gap-4 mb-6\">\r\n                        <div className=\"flex-1 p-2.5 bg-secondary-50 border border-secondary-500 rounded-md\">\r\n                            <div className=\"text-[10px] text-secondary-800 mb-0.5\">ใบเสนอราคานี้มีอายุถึง</div>\r\n                            <div className=\"text-xs font-semibold text-secondary-700\">{validUntil.toLocaleDateString('th-TH')}</div>\r\n                        </div>\r\n                        <div className=\"flex-1 p-2.5 bg-blue-50 border border-blue-500 rounded-md\">\r\n                            <div className=\"text-[10px] text-blue-800 mb-0.5\">ชำระเงินภายใน</div>\r\n                            <div className=\"text-xs font-semibold text-blue-700\">7 วัน หลังจากยืนยัน</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex gap-3\">\r\n                    <button onClick={() => window.print()} className=\"flex-1 py-3.5 rounded-xl border-2 border-primary-600 text-primary-600 text-sm font-semibold flex items-center justify-center gap-2\">\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><polyline points=\"6 9 6 2 18 2 18 9\" /><path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\" /><rect x=\"6\" y=\"14\" width=\"12\" height=\"8\" /></svg>\r\n                        พิมพ์ใบเสนอราคา\r\n                    </button>\r\n                    <button onClick={onProceed} className=\"flex-1 py-3.5 rounded-xl bg-gradient-to-br from-primary-600 to-primary-500 text-white text-sm font-semibold shadow-lg shadow-primary-500/40\">ยืนยันและออกใบวางบิล →</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\SuccessStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\UploadStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'file' is defined but never used.","line":52,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Suspense, useEffect, useState } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { apiClient as api } from '@/lib/api';\r\nimport { Certificate, RENEWAL_FEE, REQUIRED_DOCS, RenewalStep } from './types';\r\nimport { UploadStep } from './UploadStep';\r\nimport { QuotationStep } from './QuotationStep';\r\nimport { InvoiceStep } from './InvoiceStep';\r\nimport { PaymentStep } from './PaymentStep';\r\nimport { SuccessStep } from './SuccessStep';\r\n\r\nfunction RenewalLoadingFallback() {\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-surface-100 dark:bg-slate-900\">\r\n            <div className=\"w-10 h-10 border-[3px] border-surface-200 border-t-primary-600 rounded-full animate-spin\" />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction RenewalContent() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const certId = searchParams.get('certId');\r\n\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [certificate, setCertificate] = useState<Certificate | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [uploadedDocs, setUploadedDocs] = useState<Record<string, boolean>>({});\r\n    const [uploading, setUploading] = useState<string | null>(null);\r\n    const [step, setStep] = useState<RenewalStep>('upload');\r\n    const [renewalId, setRenewalId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        const userData = localStorage.getItem(\"user\");\r\n        if (!userData) { window.location.href = \"/login\"; return; }\r\n        if (certId) loadCertificate(certId);\r\n        else setLoading(false);\r\n    }, [certId]);\r\n\r\n    const loadCertificate = async (id: string) => {\r\n        setLoading(true);\r\n        try {\r\n            const result = await api.get<{ data: Certificate }>(`/api/certificates/${id}`);\r\n            if (result.success && result.data?.data) setCertificate(result.data.data);\r\n        } catch { console.error('Failed to load certificate'); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const handleUpload = async (docId: string, file: File) => {\r\n        setUploading(docId);\r\n        try { await new Promise(resolve => setTimeout(resolve, 500)); setUploadedDocs(prev => ({ ...prev, [docId]: true })); }\r\n        finally { setUploading(null); }\r\n    };\r\n\r\n    const handleSkipUpload = () => {\r\n        const allDocs: Record<string, boolean> = {};\r\n        REQUIRED_DOCS.forEach(doc => { allDocs[doc.id] = true; });\r\n        setUploadedDocs(allDocs);\r\n    };\r\n\r\n    const handleProceedToQuotation = async () => {\r\n        let newRenewalId = `RNW-${Date.now().toString(36).toUpperCase()}`;\r\n        if (certificate) {\r\n            try {\r\n                const result = await api.post<{ data: { applicationId: string } }>('/api/applications/renewal', { previousApplicationId: certificate.applicationId, certificateId: certificate._id, documentIds: Object.keys(uploadedDocs).filter(k => uploadedDocs[k]) });\r\n                if (result.success && result.data?.data?.applicationId) newRenewalId = result.data.data.applicationId;\r\n            } catch { console.warn('[Renewal] API failed, using demo ID'); }\r\n        }\r\n        setRenewalId(newRenewalId);\r\n        setStep('quotation');\r\n    };\r\n\r\n    const handlePaymentConfirm = async () => {\r\n        try { await api.post('/api/payments/confirm', { applicationId: renewalId, phase: 'renewal', amount: RENEWAL_FEE }); }\r\n        catch { console.warn('Payment confirmation failed'); }\r\n        localStorage.setItem('last_renewal_id', renewalId || '');\r\n        localStorage.setItem('last_renewal_payment', JSON.stringify({ amount: RENEWAL_FEE, certificateNumber: certificate?.certificateNumber, siteName: certificate?.siteName, paidAt: new Date().toISOString() }));\r\n        setStep('success');\r\n    };\r\n\r\n    if (loading) return <RenewalLoadingFallback />;\r\n\r\n    if (!certificate && !certId) {\r\n        return (\r\n            <div className={`min-h-screen p-8 font-sans ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n                <div className=\"max-w-xl mx-auto text-center pt-16\">\r\n                    <div className={`w-20 h-20 rounded-2xl inline-flex items-center justify-center mb-6 ${isDark ? 'bg-primary-500/15' : 'bg-primary-50'}`}>\r\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={isDark ? '#34D399' : '#16A34A'} strokeWidth=\"1.5\"><path d=\"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z\" /><polyline points=\"13 2 13 9 20 9\" /></svg>\r\n                    </div>\r\n                    <h1 className={`text-2xl font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ต่ออายุใบรับรอง GACP</h1>\r\n                    <p className={`mb-6 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>กรุณาเลือกใบรับรองที่ต้องการต่ออายุจากหน้าใบรับรอง</p>\r\n                    <Link href=\"/certificates\" className=\"inline-flex items-center gap-2 px-7 py-3.5 rounded-xl bg-gradient-to-br from-primary-600 to-primary-500 text-white font-semibold shadow-lg shadow-primary-500/40\">ไปหน้าใบรับรอง</Link>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    switch (step) {\r\n        case 'success': return <SuccessStep certificate={certificate} renewalId={renewalId} isDark={isDark} />;\r\n        case 'payment': return <PaymentStep renewalId={renewalId} isDark={isDark} onBack={() => setStep('invoice')} onConfirm={handlePaymentConfirm} />;\r\n        case 'invoice': return <InvoiceStep certificate={certificate} renewalId={renewalId} isDark={isDark} onBack={() => setStep('quotation')} onProceed={() => setStep('payment')} />;\r\n        case 'quotation': return <QuotationStep certificate={certificate} renewalId={renewalId} isDark={isDark} onBack={() => setStep('upload')} onProceed={() => setStep('invoice')} />;\r\n        default: return <UploadStep certificate={certificate} uploadedDocs={uploadedDocs} uploading={uploading} isDark={isDark} onUpload={handleUpload} onSkipUpload={handleSkipUpload} onProceed={handleProceedToQuotation} />;\r\n    }\r\n}\r\n\r\nexport default function RenewalPage() {\r\n    return <Suspense fallback={<RenewalLoadingFallback />}><RenewalContent /></Suspense>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\renewal\\types.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\applications\\replacement\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[798,801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[798,801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCertificate'. Either include it or remove the dependency array.","line":22,"column":110,"nodeType":"ArrayExpression","endLine":22,"endColumn":118,"suggestions":[{"desc":"Update the dependencies array to be: [certId, loadCertificate]","fix":{"range":[980,988],"text":"[certId, loadCertificate]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1086,1089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1086,1089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1327,1330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1327,1330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":79,"column":160,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":79,"endColumn":225}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Suspense, useEffect, useState } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ntype ReasonType = 'lost' | 'damaged' | null;\r\n\r\nfunction ReplacementContent() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const certId = searchParams.get('certId');\r\n\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [step, setStep] = useState<'reason' | 'upload' | 'confirm' | 'submitted'>('reason');\r\n    const [reason, setReason] = useState<ReasonType>(null);\r\n    const [policeReport, setPoliceReport] = useState<File | null>(null);\r\n    const [damagedCert, setDamagedCert] = useState<File | null>(null);\r\n    const [certificate, setCertificate] = useState<any>(null);\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    useEffect(() => { setIsDark(localStorage.getItem(\"theme\") === \"dark\"); if (certId) loadCertificate(); }, [certId]);\r\n\r\n    const loadCertificate = async () => { if (!certId) return; const result = await api.get<any>(`/certificates/${certId}`); if (result.success && result.data?.data) setCertificate(result.data.data); };\r\n\r\n    const handleSubmit = async () => {\r\n        setSubmitting(true);\r\n        try {\r\n            const result = await api.post<any>('/api/applications', { serviceType: 'replacement', originalCertificateId: certId, data: { replacementReason: reason, applicantInfo: certificate?.applicantInfo } });\r\n            if (result.success && result.data?.data) setStep('submitted');\r\n        } catch { } finally { setSubmitting(false); }\r\n    };\r\n\r\n    const stepLabels = ['เลือกสาเหตุ', 'แนบหลักฐาน', 'ยืนยัน', 'เสร็จสิ้น'];\r\n    const stepKeys = ['reason', 'upload', 'confirm', 'submitted'];\r\n    const stepIndex = stepKeys.indexOf(step);\r\n\r\n    return (\r\n        <div className={`min-h-screen p-6 font-sans ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}>\r\n            <div className=\"max-w-xl mx-auto\">\r\n                <button onClick={() => router.back()} className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border mb-6 ${isDark ? 'border-slate-700 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n                <h1 className={`text-2xl font-semibold mb-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ขอใบรับรองแทน</h1>\r\n                <p className={`text-sm mb-8 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>กรณีใบรับรองสูญหายหรือถูกทำลาย</p>\r\n\r\n                {/* Progress Steps */}\r\n                <div className=\"flex gap-2 mb-8\">\r\n                    {stepLabels.map((label, idx) => (\r\n                        <div key={label} className=\"flex-1 text-center\">\r\n                            <div className={`w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center text-sm font-semibold ${idx < stepIndex ? 'bg-primary-600 text-white' : idx === stepIndex ? 'bg-blue-600 text-white' : isDark ? 'bg-slate-700 text-slate-400' : 'bg-surface-200 text-slate-500'}`}>{idx + 1}</div>\r\n                            <div className={`text-xs ${idx === stepIndex ? 'text-blue-600' : isDark ? 'text-slate-500' : 'text-slate-400'}`}>{label}</div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Step: Reason */}\r\n                {step === 'reason' && (\r\n                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <h3 className={`text-base font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>สาเหตุที่ต้องขอใบรับรองแทน</h3>\r\n                        <div className=\"space-y-3 mb-6\">\r\n                            {[{ value: 'lost', label: 'ใบรับรองสูญหาย', desc: 'ต้องแนบใบแจ้งความจากสถานีตำรวจ' }, { value: 'damaged', label: 'ใบรับรองถูกทำลายหรือลบเลือน', desc: 'ต้องแนบใบรับรองที่ชำรุด' }].map(opt => (\r\n                                <label key={opt.value} className={`block p-4 rounded-xl cursor-pointer ${reason === opt.value ? 'border-2 border-blue-600 bg-blue-50' : (isDark ? 'border border-slate-600' : 'border border-surface-200')}`}>\r\n                                    <input type=\"radio\" name=\"reason\" value={opt.value} checked={reason === opt.value} onChange={() => setReason(opt.value as ReasonType)} className=\"mr-3\" />\r\n                                    <span className={`font-medium ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{opt.label}</span>\r\n                                    <p className={`text-sm mt-1 ml-7 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{opt.desc}</p>\r\n                                </label>\r\n                            ))}\r\n                        </div>\r\n                        <button onClick={() => setStep('upload')} disabled={!reason} className={`w-full py-3.5 rounded-xl text-sm font-semibold ${reason ? 'bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40' : 'bg-surface-200 text-slate-400 cursor-not-allowed'}`}>ถัดไป →</button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step: Upload */}\r\n                {step === 'upload' && (\r\n                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <h3 className={`text-base font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{reason === 'lost' ? 'แนบใบแจ้งความ' : 'แนบใบรับรองที่ชำรุด'}</h3>\r\n                        <label className={`flex flex-col items-center gap-3 p-8 rounded-xl border-2 border-dashed cursor-pointer mb-6 ${isDark ? 'border-slate-600' : 'border-surface-200'}`}>\r\n                            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" className={isDark ? 'text-slate-400' : 'text-slate-500'}><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"17 8 12 3 7 8\" /><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\" /></svg>\r\n                            <span className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{reason === 'lost' ? (policeReport ? policeReport.name : 'คลิกเพื่ออัปโหลดใบแจ้งความ') : (damagedCert ? damagedCert.name : 'คลิกเพื่ออัปโหลดใบรับรองที่ชำรุด')}</span>\r\n                            <input type=\"file\" accept=\".pdf,.jpg,.jpeg,.png\" className=\"hidden\" onChange={(e) => { const file = e.target.files?.[0]; if (file) reason === 'lost' ? setPoliceReport(file) : setDamagedCert(file); }} />\r\n                        </label>\r\n                        <div className=\"flex gap-3\">\r\n                            <button onClick={() => setStep('reason')} className={`flex-1 py-3.5 rounded-xl text-sm font-medium border ${isDark ? 'border-slate-600 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n                            <button onClick={() => setStep('confirm')} disabled={reason === 'lost' ? !policeReport : !damagedCert} className={`flex-1 py-3.5 rounded-xl text-sm font-semibold ${(reason === 'lost' ? policeReport : damagedCert) ? 'bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40' : 'bg-surface-200 text-slate-400 cursor-not-allowed'}`}>ถัดไป →</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step: Confirm */}\r\n                {step === 'confirm' && (\r\n                    <div className={`rounded-2xl p-6 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <h3 className={`text-base font-semibold mb-4 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ยืนยันข้อมูล</h3>\r\n                        <div className=\"bg-secondary-50 border border-secondary-500 rounded-xl p-4 mb-6\"><p className=\"text-sm text-secondary-800\">หลังจากส่งคำขอ ทีมงานจะประเมินและส่งใบเสนอราคาให้ท่านผ่านระบบ</p></div>\r\n                        <table className=\"w-full text-sm mb-6\">\r\n                            <tbody>\r\n                                <tr><td className={`py-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ใบรับรองเดิม:</td><td className={`py-2 font-medium ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{certificate?.certificateNumber || '-'}</td></tr>\r\n                                <tr><td className={`py-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>สาเหตุ:</td><td className={`py-2 font-medium ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{reason === 'lost' ? 'ใบรับรองสูญหาย' : 'ใบรับรองถูกทำลาย/ลบเลือน'}</td></tr>\r\n                                <tr><td className={`py-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>หลักฐาน:</td><td className={`py-2 font-medium ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>{reason === 'lost' ? policeReport?.name : damagedCert?.name}</td></tr>\r\n                            </tbody>\r\n                        </table>\r\n                        <div className=\"flex gap-3\">\r\n                            <button onClick={() => setStep('upload')} className={`flex-1 py-3.5 rounded-xl text-sm font-medium border ${isDark ? 'border-slate-600 text-slate-400' : 'border-surface-200 text-slate-600'}`}>← ย้อนกลับ</button>\r\n                            <button onClick={handleSubmit} disabled={submitting} className={`flex-1 py-3.5 rounded-xl text-sm font-semibold bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40 ${submitting ? 'opacity-70' : ''}`}>{submitting ? 'กำลังส่ง...' : 'ส่งคำขอ'}</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Step: Submitted */}\r\n                {step === 'submitted' && (\r\n                    <div className={`rounded-2xl p-8 border text-center ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <div className=\"w-16 h-16 rounded-full bg-primary-600 flex items-center justify-center mx-auto mb-4\"><svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" strokeWidth=\"3\"><polyline points=\"20 6 9 17 4 12\" /></svg></div>\r\n                        <h3 className={`text-xl font-semibold mb-2 ${isDark ? 'text-surface-100' : 'text-slate-900'}`}>ส่งคำขอเรียบร้อย</h3>\r\n                        <p className={`text-sm mb-6 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ทีมงานจะตรวจสอบและส่งใบเสนอราคาให้ท่าน<br />กรุณาตรวจสอบในหน้า &quot;การเงิน&quot; เพื่อดูสถานะ</p>\r\n                        <div className=\"flex gap-3 justify-center\">\r\n                            <button onClick={() => router.push('/farmer/applications')} className={`px-6 py-3.5 rounded-xl text-sm font-medium border ${isDark ? 'border-slate-600 text-slate-400' : 'border-surface-200 text-slate-600'}`}>กลับหน้าคำขอ</button>\r\n                            <button onClick={() => router.push('/payments')} className=\"px-6 py-3.5 rounded-xl text-sm font-semibold bg-gradient-to-br from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-500/40\">ไปหน้าการเงิน</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ReplacementLoadingFallback() {\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-surface-100\">\r\n            <div className=\"text-center\">\r\n                <div className=\"w-10 h-10 border-[3px] border-surface-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4\" />\r\n                <p className=\"text-slate-500 text-sm\">กำลังโหลด...</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default function ReplacementApplicationPage() { return <Suspense fallback={<ReplacementLoadingFallback />}><ReplacementContent /></Suspense>; }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\certificates\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":28,"column":8,"nodeType":"ArrayExpression","endLine":28,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [router]","fix":{"range":[1215,1217],"text":"[router]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":137,"column":33,"nodeType":"JSXOpeningElement","endLine":137,"endColumn":170}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ninterface Certificate {\r\n    _id: string; certificateNumber: string; applicationId: string;\r\n    siteName: string; plantType: string; issuedDate: string; expiryDate: string;\r\n    status: 'ACTIVE' | 'EXPIRED' | 'SUSPENDED'; qrCode?: string;\r\n}\r\n\r\nexport default function CertificatesPage() {\r\n    const router = useRouter();\r\n    const [certificates, setCertificates] = useState<Certificate[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [viewCert, setViewCert] = useState<Certificate | null>(null);\r\n    const [showQR, setShowQR] = useState<Certificate | null>(null);\r\n    const [filter, setFilter] = useState<'ALL' | 'ACTIVE' | 'EXPIRED'>('ALL');\r\n    // Theme state is handled by Layout, just use system/css vars or simple dark mode classes if valid\r\n    // For specific dark mode in card, rely on standard dark: attributes\r\n\r\n    useEffect(() => {\r\n        const userData = localStorage.getItem(\"user\");\r\n        if (!userData) { router.push(\"/login\"); return; }\r\n        loadCertificates();\r\n    }, []);\r\n\r\n    const loadCertificates = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const result = await api.get<{ data: Certificate[] }>(\"/api/certificates/my\");\r\n            if (result.success && result.data?.data) setCertificates(result.data.data);\r\n            else setCertificates([]);\r\n        } catch { setCertificates([]); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const formatDate = (d: string) => new Date(d).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });\r\n    const getDaysRemaining = (exp: string) => Math.ceil((new Date(exp).getTime() - Date.now()) / 86400000);\r\n\r\n    const filteredCerts = certificates.filter(c => filter === 'ALL' || c.status === filter);\r\n\r\n    return (\r\n        <div className=\"p-6 lg:p-10 pb-24 lg:pb-10 max-w-5xl mx-auto font-[Kanit] animate-fadeIn\">\r\n            <header className=\"flex justify-between items-center flex-wrap gap-4 mb-7\">\r\n                <div>\r\n                    <h1 className=\"text-2xl lg:text-3xl font-medium text-slate-900 dark:text-slate-100\">ใบรับรอง GACP</h1>\r\n                    <p className=\"text-sm text-slate-500 mt-1\">ใบรับรองมาตรฐานการปลูกและเก็บเกี่ยวพืชสมุนไพร</p>\r\n                </div>\r\n                <div className=\"flex gap-1 p-1 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700\">\r\n                    {(['ALL', 'ACTIVE', 'EXPIRED'] as const).map(f => (\r\n                        <button key={f} onClick={() => setFilter(f)} className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${filter === f ? 'bg-emerald-500 text-white' : 'text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700'}`}>\r\n                            {f === 'ALL' ? 'ทั้งหมด' : f === 'ACTIVE' ? 'ใช้งานได้' : 'หมดอายุ'}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </header>\r\n\r\n            {loading ? (\r\n                <div className=\"rounded-2xl p-16 text-center bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                    <div className=\"w-10 h-10 border-3 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto\" />\r\n                    <p className=\"mt-4 text-slate-500\">กำลังโหลดใบรับรอง...</p>\r\n                </div>\r\n            ) : filteredCerts.length > 0 ? (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                    {filteredCerts.map(cert => {\r\n                        const daysLeft = getDaysRemaining(cert.expiryDate);\r\n                        const isActive = cert.status === 'ACTIVE';\r\n                        return (\r\n                            <div key={cert._id} className=\"rounded-2xl overflow-hidden bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow\">\r\n                                <div className={`p-6 text-white relative ${isActive ? 'bg-gradient-to-br from-emerald-600 to-emerald-400' : 'bg-gradient-to-br from-slate-500 to-slate-400'}`}>\r\n                                    <span className=\"absolute top-5 right-5 text-3xl opacity-20\">\r\n                                        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><circle cx=\"12\" cy=\"8\" r=\"6\" /><path d=\"M15.477 12.89L17 22l-5-3-5 3 1.523-9.11\" /></svg>\r\n                                    </span>\r\n                                    <p className=\"text-xs opacity-80 mb-1\">เลขที่ใบรับรอง</p>\r\n                                    <h3 className=\"text-xl font-semibold\">{cert.certificateNumber}</h3>\r\n                                </div>\r\n                                <div className=\"p-5\">\r\n                                    <p className=\"text-xs text-slate-500\">สถานที่</p>\r\n                                    <p className=\"font-medium mb-4 text-slate-900 dark:text-slate-200\">{cert.siteName}</p>\r\n                                    <div className=\"grid grid-cols-2 gap-3 mb-4\">\r\n                                        <div><p className=\"text-xs text-slate-500\">ประเภทพืช</p><p className=\"text-sm font-medium text-slate-900 dark:text-slate-200\">{cert.plantType}</p></div>\r\n                                        <div>\r\n                                            <p className=\"text-xs text-slate-500\">สถานะ</p>\r\n                                            <span className={`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium ${isActive ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-400' : 'bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-400'}`}>\r\n                                                {isActive ? <><svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" className=\"inline\"><polyline points=\"20 6 9 17 4 12\" /></svg> ใช้งานได้</> : 'หมดอายุ'}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div><p className=\"text-xs text-slate-500\">วันที่ออก</p><p className=\"text-sm text-slate-700 dark:text-slate-300\">{formatDate(cert.issuedDate)}</p></div>\r\n                                        <div>\r\n                                            <p className=\"text-xs text-slate-500\">วันหมดอายุ</p>\r\n                                            <p className={`text-sm ${daysLeft < 30 ? 'text-amber-500' : 'text-slate-700 dark:text-slate-300'}`}>{formatDate(cert.expiryDate)}</p>\r\n                                            {isActive && daysLeft <= 90 && <p className=\"text-xs text-amber-500\">(เหลือ {daysLeft} วัน)</p>}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-2 pt-4 border-t border-slate-200 dark:border-slate-700\">\r\n                                        <button onClick={() => setViewCert(cert)} className=\"flex-1 py-2.5 rounded-lg text-sm flex items-center justify-center gap-1.5 bg-slate-100 text-slate-600 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600\">ดู</button>\r\n                                        <button onClick={() => setShowQR(cert)} className=\"flex-1 py-2.5 rounded-lg text-sm flex items-center justify-center gap-1.5 bg-slate-100 text-slate-600 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600\">QR</button>\r\n                                        <button className=\"px-4 py-2.5 rounded-lg bg-emerald-500 text-white text-sm hover:bg-emerald-600\">\r\n                                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"7 10 12 15 17 10\" /><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" /></svg>\r\n                                        </button>\r\n                                    </div>\r\n                                    {(daysLeft <= 90 || cert.status === 'EXPIRED') && (\r\n                                        <Link href={`/farmer/applications/renewal?certId=${cert._id}`} className={`flex items-center justify-center gap-2 mt-3 py-3 rounded-xl text-white text-sm font-semibold shadow-lg ${cert.status === 'EXPIRED' ? 'bg-gradient-to-br from-amber-500 to-amber-400 shadow-amber-500/30' : 'bg-gradient-to-br from-emerald-600 to-emerald-400 shadow-emerald-500/30'}`}>\r\n                                            {cert.status === 'EXPIRED' ? 'ต่อสัญญาเลย' : 'ต่อสัญญาก่อนหมดอายุ'}\r\n                                        </Link>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            ) : (\r\n                <div className=\"rounded-2xl p-16 text-center bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                    <div className=\"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-5 bg-emerald-50 dark:bg-emerald-500/15\">\r\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"1.5\"><circle cx=\"12\" cy=\"8\" r=\"6\" /><path d=\"M15.477 12.89L17 22l-5-3-5 3 1.523-9.11\" /></svg>\r\n                    </div>\r\n                    <h3 className=\"text-lg font-medium mb-2 text-slate-900 dark:text-white\">ยังไม่มีใบรับรอง</h3>\r\n                    <p className=\"text-sm text-slate-500 mb-5\">เมื่อคำขอได้รับการอนุมัติ ใบรับรองจะแสดงที่นี่</p>\r\n                    <Link href=\"/farmer/applications/new\" className=\"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-br from-emerald-600 to-emerald-500 text-white font-medium shadow-lg shadow-emerald-500/30 hover:shadow-emerald-500/40 transition-shadow\">ยื่นคำขอใหม่</Link>\r\n                </div>\r\n            )}\r\n\r\n            {/* View Certificate Modal */}\r\n            {viewCert && (\r\n                <div className=\"fixed inset-0 bg-black/70 z-[1000] flex items-center justify-center p-5\" onClick={() => setViewCert(null)}>\r\n                    <div className=\"w-full max-w-lg max-h-[90vh] overflow-auto bg-white rounded-2xl animate-scaleIn\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"flex justify-between items-center p-4 border-b border-slate-200\">\r\n                            <h3 className=\"text-lg font-semibold text-slate-900\">ใบรับรอง GACP</h3>\r\n                            <button onClick={() => setViewCert(null)} className=\"px-4 py-2 rounded-lg bg-red-500 text-white text-sm hover:bg-red-600\">ปิด</button>\r\n                        </div>\r\n                        <div className=\"p-6 bg-slate-100\">\r\n                            <div className=\"bg-white border-2 border-emerald-500 rounded-xl p-8 text-center relative overflow-hidden\">\r\n                                <div className=\"absolute top-0 right-0 w-24 h-24 bg-emerald-100 rounded-bl-full opacity-50\"></div>\r\n                                <img src=\"/images/dtam-logo.png\" alt=\"DTAM\" className=\"w-16 h-16 mx-auto mb-4\" onError={e => (e.currentTarget.style.display = 'none')} />\r\n                                <h2 className=\"text-2xl font-bold text-emerald-600 mb-1\">ใบรับรองมาตรฐาน GACP</h2>\r\n                                <p className=\"text-xs text-slate-500 mb-5\">Good Agricultural and Collection Practices</p>\r\n                                <div className=\"border-t border-b border-dashed border-slate-300 py-5 my-5\">\r\n                                    <p className=\"text-sm text-slate-600 mb-2\">เลขที่ใบรับรอง</p>\r\n                                    <p className=\"text-2xl font-bold text-slate-900\">{viewCert.certificateNumber}</p>\r\n                                </div>\r\n                                <p className=\"text-sm text-slate-600 mb-1\">ออกให้แก่</p>\r\n                                <p className=\"text-lg font-semibold text-slate-900 mb-4\">{viewCert.siteName}</p>\r\n                                <p className=\"text-sm text-slate-500\">ประเภทพืช: {viewCert.plantType}</p>\r\n                                <p className=\"text-sm text-slate-500 mt-2\">มีผลตั้งแต่ {formatDate(viewCert.issuedDate)} ถึง {formatDate(viewCert.expiryDate)}</p>\r\n                                <div className=\"mt-6 pt-5 border-t border-slate-200\">\r\n                                    <p className=\"text-xs text-slate-400\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</p>\r\n                                    <p className=\"text-xs text-slate-400\">กระทรวงสาธารณสุข</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-3 p-4 border-t border-slate-200\">\r\n                            <button\r\n                                onClick={() => window.open(`/api/certificates/${viewCert._id}/download`, '_blank')}\r\n                                className=\"flex-1 py-3 rounded-xl border border-emerald-500 text-emerald-500 font-medium flex items-center justify-center gap-1.5 hover:bg-emerald-50\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><polyline points=\"6 9 6 2 18 2 18 9\" /><path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\" /><rect x=\"6\" y=\"14\" width=\"12\" height=\"8\" /></svg>\r\n                                พิมพ์\r\n                            </button>\r\n                            <button\r\n                                onClick={async () => {\r\n                                    try {\r\n                                        const res = await api.getBlob(`/api/certificates/${viewCert._id}/download`);\r\n                                        if (res) {\r\n                                            const url = window.URL.createObjectURL(res);\r\n                                            const a = document.createElement('a');\r\n                                            a.href = url;\r\n                                            a.download = `GACP-${viewCert.certificateNumber}.pdf`;\r\n                                            document.body.appendChild(a);\r\n                                            a.click();\r\n                                            window.URL.revokeObjectURL(url);\r\n                                            document.body.removeChild(a);\r\n                                        }\r\n                                    } catch (e) {\r\n                                        console.error(\"Download failed\", e);\r\n                                        alert(\"ดาวน์โหลดไม่สำเร็จ\");\r\n                                    }\r\n                                }}\r\n                                className=\"flex-1 py-3 rounded-xl bg-emerald-500 text-white font-medium flex items-center justify-center gap-1.5 hover:bg-emerald-600\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"7 10 12 15 17 10\" /><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" /></svg>\r\n                                ดาวน์โหลด PDF\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* QR Modal */}\r\n            {showQR && (\r\n                <div className=\"fixed inset-0 bg-black/70 z-[1000] flex items-center justify-center p-5\" onClick={() => setShowQR(null)}>\r\n                    <div className=\"w-full max-w-sm bg-white rounded-2xl p-8 text-center animate-scaleIn\" onClick={e => e.stopPropagation()}>\r\n                        <h3 className=\"text-lg font-semibold text-slate-900 mb-5\">QR Code ตรวจสอบ</h3>\r\n                        <div className=\"w-48 h-48 mx-auto mb-5 bg-slate-100 rounded-xl flex items-center justify-center\">\r\n                            <div className=\"w-40 h-40\" style={{ background: `url('https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=https://gacp.dtam.go.th/verify/${showQR.certificateNumber}')`, backgroundSize: 'cover' }} />\r\n                        </div>\r\n                        <p className=\"text-sm text-slate-500 mb-2\">สแกนเพื่อตรวจสอบใบรับรอง</p>\r\n                        <p className=\"font-semibold text-slate-900\">{showQR.certificateNumber}</p>\r\n                        <button onClick={() => setShowQR(null)} className=\"mt-6 px-8 py-3 rounded-xl bg-emerald-500 text-white font-medium hover:bg-emerald-600\">ปิด</button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1239,1242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1239,1242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4026,4029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4026,4029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4552,4555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4552,4555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":140,"column":25,"nodeType":"JSXOpeningElement","endLine":140,"endColumn":118}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { ApplicationService, Application, Certificate } from \"@/lib/services/application-service\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { IconLeaf, IconDocument, IconCheckCircle, IconClock, IconSearch, IconWarning, IconReceipt, IconLock, Icons } from \"@/components/ui/icons\";\r\nimport { useLanguage } from \"@/lib/i18n/LanguageContext\";\r\n\r\ninterface User {\r\n    id: string;\r\n    firstName?: string;\r\n    lastName?: string;\r\n    companyName?: string;\r\n    accountType?: string;\r\n    verificationStatus?: string;\r\n}\r\n\r\nexport default function DashboardPage() {\r\n    const router = useRouter();\r\n    const { dict, language } = useLanguage();\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [applications, setApplications] = useState<Application[]>([]);\r\n    const [certificates, setCertificates] = useState<Certificate[]>([]);\r\n    const [stats, setStats] = useState({ total: 0, active: 0, certified: 0 });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    const STATUS_MAP: Record<string, { label: string; color: string; bg: string; icon: any }> = {\r\n        DRAFT: { label: dict.dashboard.status.DRAFT, color: \"text-slate-600\", bg: \"bg-slate-100\", icon: IconDocument },\r\n        SUBMITTED: { label: dict.dashboard.status.SUBMITTED, color: \"text-blue-600\", bg: \"bg-blue-50\", icon: IconClock },\r\n        PAYMENT_1_PENDING: { label: dict.dashboard.status.PAYMENT_1_PENDING, color: \"text-amber-600\", bg: \"bg-amber-50\", icon: IconReceipt },\r\n        PAID_PHASE_1: { label: dict.dashboard.status.PAID_PHASE_1, color: \"text-emerald-600\", bg: \"bg-emerald-50\", icon: IconCheckCircle },\r\n        PAYMENT_2_PENDING: { label: dict.dashboard.status.PAYMENT_2_PENDING, color: \"text-pink-600\", bg: \"bg-pink-50\", icon: IconReceipt },\r\n        PAID_PHASE_2: { label: dict.dashboard.status.PAID_PHASE_2, color: \"text-emerald-600\", bg: \"bg-emerald-50\", icon: IconCheckCircle },\r\n        REVISION_REQUIRED: { label: dict.dashboard.status.REVISION_REQUIRED, color: \"text-red-600\", bg: \"bg-red-50\", icon: IconWarning },\r\n        DOCUMENT_APPROVED: { label: dict.dashboard.status.DOCUMENT_APPROVED, color: \"text-indigo-600\", bg: \"bg-indigo-50\", icon: IconCheckCircle },\r\n        PENDING_AUDIT: { label: dict.dashboard.status.PENDING_AUDIT, color: \"text-purple-600\", bg: \"bg-purple-50\", icon: IconSearch },\r\n        APPROVED: { label: dict.dashboard.status.APPROVED, color: \"text-green-600\", bg: \"bg-green-50\", icon: IconCheckCircle },\r\n    };\r\n\r\n    useEffect(() => {\r\n        const sessionUser = AuthService.getUser();\r\n        if (!sessionUser) { router.push(\"/login\"); return; }\r\n        setUser(sessionUser);\r\n\r\n        const loadData = async () => {\r\n            try {\r\n                setIsLoading(true);\r\n                // Fetch fresh profile\r\n                try {\r\n                    const profileRes = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/auth-farmer/me`, {\r\n                        headers: { 'Authorization': `Bearer ${AuthService.getToken()}` },\r\n                        cache: 'no-store'\r\n                    });\r\n                    if (profileRes.ok) {\r\n                        const profileData = await profileRes.json();\r\n                        const freshUser = profileData.data.user || profileData.data;\r\n                        setUser(freshUser);\r\n                        AuthService.updateUser(freshUser);\r\n                    }\r\n                } catch (err) { console.warn('Profile refresh failed', err); }\r\n\r\n                const [appRes, certRes] = await Promise.all([\r\n                    ApplicationService.getMyApplications(),\r\n                    ApplicationService.getMyCertificates()\r\n                ]);\r\n\r\n                if (appRes.success && appRes.data) {\r\n                    const apps: Application[] = Array.isArray(appRes.data) ? appRes.data : (appRes.data as any).data || [];\r\n                    setApplications(apps);\r\n                    setStats({\r\n                        total: apps.length,\r\n                        active: apps.filter(a => !['APPROVED', 'REJECTED'].includes(a.status)).length,\r\n                        certified: apps.filter(a => a.status === 'APPROVED').length\r\n                    });\r\n                }\r\n\r\n                if (certRes.success && certRes.data) {\r\n                    const certs = Array.isArray(certRes.data) ? certRes.data : (certRes.data as any).data || [];\r\n                    setCertificates(certs);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Dashboard Load Error\", error);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        loadData();\r\n    }, [router]);\r\n\r\n    const getGreeting = () => {\r\n        const h = new Date().getHours();\r\n        if (h < 12) return dict.dashboard.greeting.morning;\r\n        if (h < 17) return dict.dashboard.greeting.afternoon;\r\n        return dict.dashboard.greeting.evening;\r\n    };\r\n\r\n    if (!user || isLoading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[60vh]\">\r\n                <div className=\"w-16 h-16 border-4 border-primary/20 border-t-primary rounded-full animate-spin mb-4\"></div>\r\n                <p className=\"text-slate-400 font-medium animate-pulse\">{dict.common?.loading || 'กำลังโหลด...'}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const latestApp = applications[0];\r\n\r\n    return (\r\n        <div className=\"space-y-10 animate-fade-in\">\r\n            {/* 0. Verification Banner */}\r\n            {user.verificationStatus !== 'APPROVED' && (\r\n                <div className=\"gacp-card bg-gradient-to-r from-warning-bg to-white border-warning/20 overflow-visible\">\r\n                    <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                        <div className=\"flex items-center gap-5\">\r\n                            <div className=\"w-14 h-14 rounded-2xl bg-warning-bg flex items-center justify-center shadow-inner\">\r\n                                <IconWarning className=\"w-8 h-8 text-warning\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-xl font-black text-warning-text leading-tight\">{dict.dashboard.verification.warningTitle}</h3>\r\n                                <p className=\"text-slate-600 mt-1 max-w-xl\">{dict.dashboard.verification.warningMsg}</p>\r\n                            </div>\r\n                        </div>\r\n                        <Link href=\"/verify-identity\" className=\"gacp-btn-primary bg-gradient-to-r from-warning to-orange-600 shadow-warning/20 whitespace-nowrap\">\r\n                            {dict.dashboard.verification.button}\r\n                        </Link>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* 1. Hero & Stats Section */}\r\n            <div className=\"grid lg:grid-cols-4 gap-8\">\r\n                {/* Hero Card */}\r\n                <div className=\"lg:col-span-3 gacp-card bg-[#006837] text-white border-0 shadow-xl p-0 overflow-hidden min-h-[240px] relative group\">\r\n                    {/* Official Watermark & Gradients */}\r\n                    <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-10 mix-blend-overlay\"></div>\r\n                    <div className=\"absolute top-0 right-0 w-[60%] h-full bg-gradient-to-l from-emerald-400/20 to-transparent\"></div>\r\n                    <div className=\"absolute -bottom-10 -right-10 opacity-10 transition-transform group-hover:scale-110 duration-700\">\r\n                        <img src=\"/images/dtam-logo.png\" alt=\"Watermark\" className=\"w-80 h-80 brightness-0 invert\" />\r\n                    </div>\r\n\r\n                    <div className=\"h-full p-8 flex flex-col justify-between relative z-10\">\r\n                        <div>\r\n                            <div className=\"flex items-center gap-2 mb-3\">\r\n                                <span className=\"flex h-2 w-2 relative\">\r\n                                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\r\n                                    <span className=\"relative inline-flex rounded-full h-2 w-2 bg-emerald-400\"></span>\r\n                                </span>\r\n                                <span className=\"text-emerald-100/90 text-sm font-bold tracking-widest uppercase\">{getGreeting()}</span>\r\n                            </div>\r\n                            <h1 className=\"text-4xl lg:text-5xl font-black text-white leading-tight drop-shadow-sm\">\r\n                                {user.firstName} <span className=\"text-emerald-200\">{user.lastName}</span>\r\n                            </h1>\r\n                            <div className=\"flex items-center gap-2 mt-2\">\r\n                                <div className=\"p-1 bg-white/20 rounded-lg backdrop-blur-sm\">\r\n                                    <IconLeaf className=\"w-4 h-4 text-white\" />\r\n                                </div>\r\n                                <p className=\"text-emerald-50 font-medium\">{user.companyName || 'วิสาหกิจชุมชนเกษตรกรไทย'}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-wrap items-center gap-4 mt-6\">\r\n                            {user.verificationStatus === 'APPROVED' ? (\r\n                                <Link href=\"/farmer/applications/new\" className=\"gacp-btn-primary bg-white text-primary hover:bg-emerald-50 shadow-white/10 border-0 px-8\">\r\n                                    <IconLeaf className=\"w-5 h-5\" />\r\n                                    {dict.dashboard.hero.newApp}\r\n                                </Link>\r\n                            ) : (\r\n                                <button className=\"gacp-btn-secondary bg-white/10 border-white/20 text-white cursor-not-allowed px-8\">\r\n                                    <IconLock className=\"w-5 h-5 mr-2 opacity-50\" />\r\n                                    {dict.dashboard.hero.verifyToStart}\r\n                                </button>\r\n                            )}\r\n                            <div className=\"flex -space-x-3 overflow-hidden ml-2 items-center\">\r\n                                <div className=\"inline-block h-8 w-8 rounded-full ring-2 ring-primary bg-emerald-500 overflow-hidden flex items-center justify-center text-[10px] font-bold\">DT</div>\r\n                                <div className=\"inline-block h-8 w-8 rounded-full ring-2 ring-primary bg-emerald-600 overflow-hidden flex items-center justify-center text-[10px] font-bold\">AM</div>\r\n                                <span className=\"ml-4 text-xs text-emerald-100/60 font-medium\">Verified by Department</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Vertical Stat Cards */}\r\n                <div className=\"flex flex-col gap-4\">\r\n                    <div className=\"flex-1 gacp-card p-6 flex flex-col justify-between group hover:bg-primary-50\">\r\n                        <span className=\"text-xs font-black text-slate-400 uppercase tracking-widest\">{dict.dashboard.stats.total}</span>\r\n                        <div className=\"flex items-end justify-between\">\r\n                            <span className=\"text-4xl font-black text-slate-800\">{stats.total}</span>\r\n                            <div className=\"p-2 rounded-xl bg-slate-50 text-slate-400 group-hover:bg-white group-hover:text-primary transition-colors\">\r\n                                <IconDocument className=\"w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex-1 gacp-card p-6 flex flex-col justify-between group hover:bg-emerald-50\">\r\n                        <span className=\"text-xs font-black text-slate-400 uppercase tracking-widest\">{dict.dashboard.stats.certified}</span>\r\n                        <div className=\"flex items-end justify-between\">\r\n                            <span className=\"text-4xl font-black text-primary\">{stats.certified}</span>\r\n                            <div className=\"p-2 rounded-xl bg-primary-50 text-primary transition-colors\">\r\n                                <IconCheckCircle className=\"w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 2. Main Content Grid */}\r\n            <div className=\"grid lg:grid-cols-3 gap-10\">\r\n\r\n                {/* Left Column: Recent Activity & Alerts */}\r\n                <div className=\"lg:col-span-2 space-y-8\">\r\n\r\n                    {/* Critical Alerts */}\r\n                    {(latestApp?.status === 'PAYMENT_1_PENDING' || latestApp?.status === 'PAYMENT_2_PENDING') && (\r\n                        <div className=\"gacp-card bg-gradient-to-br from-rose-600 to-pink-700 text-white border-0 shadow-premium group\">\r\n                            <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center group-hover:rotate-12 transition-transform\">\r\n                                        <IconReceipt className=\"w-8 h-8\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"text-xl font-black\">{dict.dashboard.alerts?.paymentTitle}</h3>\r\n                                        <p className=\"text-rose-100 text-sm mt-1\">{dict.dashboard.alerts?.paymentDesc}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <Link href=\"/farmer/payments\" className=\"gacp-btn-primary bg-white text-rose-600 border-0 hover:bg-rose-50 shadow-white/10 px-8\">\r\n                                    {dict.dashboard.alerts?.paymentButton}\r\n                                </Link>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Active Application Status */}\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h2 className=\"text-2xl font-black text-slate-800 flex items-center gap-3\">\r\n                                <span className=\"w-2 h-8 bg-primary rounded-full\"></span>\r\n                                {dict.dashboard.sections.recent}\r\n                            </h2>\r\n                            {latestApp && (\r\n                                <Link href=\"/farmer/applications\" className=\"text-sm font-bold text-primary hover:underline\">\r\n                                    {dict.common?.viewAll}\r\n                                </Link>\r\n                            )}\r\n                        </div>\r\n\r\n                        {latestApp ? (\r\n                            <div className=\"gacp-card p-0 group overflow-visible\">\r\n                                <div className=\"p-8 border-b border-slate-100 flex flex-wrap justify-between items-start gap-4\">\r\n                                    <div className=\"flex items-center gap-5\">\r\n                                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center shadow-inner ${STATUS_MAP[latestApp.status]?.bg}`}>\r\n                                            {(() => {\r\n                                                const StatusIcon = STATUS_MAP[latestApp.status]?.icon || IconDocument;\r\n                                                return <StatusIcon className={`w-8 h-8 ${STATUS_MAP[latestApp.status]?.color || 'text-slate-400'}`} />;\r\n                                            })()}\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"flex items-center gap-2 mb-1\">\r\n                                                <h3 className=\"text-xl font-bold text-slate-800 uppercase tracking-tight\">{dict.dashboard.appCard.title}</h3>\r\n                                                <span className=\"text-xs font-mono font-bold text-slate-400\">#{latestApp._id?.slice(-8).toUpperCase()}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <span className={`gacp-badge ${STATUS_MAP[latestApp.status]?.bg} ${STATUS_MAP[latestApp.status]?.color}`}>\r\n                                                    {STATUS_MAP[latestApp.status]?.label || latestApp.status}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex flex-col items-end\">\r\n                                        <span className=\"text-[10px] font-black uppercase text-slate-400 tracking-widest\">{dict.dashboard.appCard.lastUpdate}</span>\r\n                                        <span className=\"text-sm font-bold text-slate-700\">\r\n                                            {new Date(latestApp.updatedAt || latestApp.createdAt).toLocaleDateString(language === 'th' ? 'th-TH' : 'en-US', {\r\n                                                day: 'numeric', month: 'long', year: 'numeric'\r\n                                            })}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"p-8 bg-slate-50/50 flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                                    <div className=\"flex items-center gap-8\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] font-black uppercase text-slate-400 tracking-widest\">Type</span>\r\n                                            <span className=\"text-sm font-bold text-slate-600\">GACP Certification</span>\r\n                                        </div>\r\n                                        <div className=\"w-px h-8 bg-slate-200\"></div>\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] font-black uppercase text-slate-400 tracking-widest\">Plants</span>\r\n                                            <span className=\"text-sm font-bold text-slate-600\">{latestApp.items?.length || 0} Species</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <Link\r\n                                        href={`/farmer/applications/new/step/${latestApp.status === 'PAYMENT_1_PENDING' || latestApp.status === 'PAYMENT_2_PENDING' ? '14' : '1'}`}\r\n                                        className=\"gacp-btn-primary px-10\"\r\n                                    >\r\n                                        {dict.dashboard.appCard.continue}\r\n                                        <Icons.ArrowRight className=\"w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform\" />\r\n                                    </Link>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"gacp-card py-20 bg-white border-dashed border-2 flex flex-col items-center justify-center text-center opacity-70\">\r\n                                <div className=\"w-20 h-20 rounded-full bg-slate-50 flex items-center justify-center mb-6\">\r\n                                    <IconDocument className=\"w-10 h-10 text-slate-200\" />\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-slate-800\">{dict.dashboard.empty.title}</h3>\r\n                                <p className=\"text-slate-500 max-w-xs mx-auto mt-2\">{dict.dashboard.empty.desc}</p>\r\n                                <Link href=\"/farmer/applications/new\" className=\"gacp-btn-secondary mt-8 border-slate-200 text-slate-600\">\r\n                                    {dict.common?.startNow}\r\n                                </Link>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Widgets */}\r\n                <div className=\"space-y-8\">\r\n\r\n                    {/* Certificates Widget */}\r\n                    <div className=\"space-y-4\">\r\n                        <h2 className=\"text-2xl font-black text-slate-800 flex items-center gap-3\">\r\n                            <span className=\"w-2 h-8 bg-indigo-500 rounded-full\"></span>\r\n                            {dict.dashboard.sections.certificates}\r\n                        </h2>\r\n\r\n                        {certificates.length === 0 ? (\r\n                            <div className=\"gacp-card py-10 flex flex-col items-center justify-center text-center opacity-60\">\r\n                                <IconCheckCircle className=\"w-12 h-12 text-slate-200 mb-4\" />\r\n                                <p className=\"text-slate-400 font-bold\">{dict.dashboard.sections.noCert}</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                {certificates.map(cert => (\r\n                                    <div key={cert._id} className=\"gacp-card p-5 hover:border-indigo-100 group\">\r\n                                        <div className=\"flex justify-between items-start mb-4\">\r\n                                            <div className=\"p-2 rounded-xl bg-indigo-50 text-indigo-600\">\r\n                                                <IconDocument className=\"w-6 h-6\" />\r\n                                            </div>\r\n                                            <span className=\"text-[10px] font-black uppercase text-slate-400 group-hover:text-indigo-400 transition-colors\">#{cert.certificateNumber}</span>\r\n                                        </div>\r\n                                        <h4 className=\"text-lg font-black text-slate-800 leading-tight\">{cert.plantType || 'Herb Plant'}</h4>\r\n                                        <p className=\"text-xs text-slate-500 mt-1\">Exp: {new Date(cert.expiryDate).toLocaleDateString()}</p>\r\n                                        <button className=\"w-full mt-4 py-2 border border-slate-100 rounded-xl text-xs font-black text-indigo-600 uppercase tracking-widest hover:bg-indigo-50 hover:border-indigo-100 transition-all\">\r\n                                            {dict.dashboard.buttons.download}\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Quick Menu */}\r\n                    <div className=\"space-y-4\">\r\n                        <h2 className=\"text-2xl font-black text-slate-800 tracking-tight\">{dict.dashboard.sections.quickMenu}</h2>\r\n                        <div className=\"grid gap-4\">\r\n                            {[\r\n                                { title: dict.dashboard.menus.manual, desc: dict.dashboard.menus.manualDesc, icon: IconDocument, color: 'text-blue-600', bg: 'bg-blue-50' },\r\n                                { title: dict.dashboard.menus.report, desc: dict.dashboard.menus.reportDesc, icon: IconWarning, color: 'text-amber-600', bg: 'bg-amber-50' }\r\n                            ].map((item, idx) => (\r\n                                <button key={idx} className=\"gacp-card p-4 flex items-center gap-4 hover:bg-slate-50 text-left border-0 shadow-soft group\">\r\n                                    <div className={`w-12 h-12 rounded-2xl ${item.bg} ${item.color} flex items-center justify-center group-hover:scale-110 transition-transform`}>\r\n                                        <item.icon className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 className=\"font-black text-slate-800 text-sm whitespace-nowrap\">{item.title}</h4>\r\n                                        <p className=\"text-slate-400 text-xs mt-0.5 font-medium\">{item.desc}</p>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\documents\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadDocument' and 'router'. Either include them or remove the dependency array.","line":22,"column":210,"nodeType":"ArrayExpression","endLine":22,"endColumn":214,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadDocument, router]","fix":{"range":[1039,1043],"text":"[id, loadDocument, router]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":99,"column":33,"nodeType":"JSXOpeningElement","endLine":99,"endColumn":113}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ninterface DocumentInfo { _id: string; name: string; type: string; url: string; size: number; uploadedAt: string; applicationId: string; }\r\n\r\nexport default function DocumentViewerPage() {\r\n    const router = useRouter();\r\n    const params = useParams();\r\n    const id = params?.id as string;\r\n\r\n    const [document, setDocument] = useState<DocumentInfo | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [zoom, setZoom] = useState(100);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n\r\n    useEffect(() => { setMounted(true); setIsDark(localStorage.getItem(\"theme\") === \"dark\"); const userData = localStorage.getItem(\"user\"); if (!userData) { router.push(\"/login\"); return; } loadDocument(); }, [id]);\r\n\r\n    const loadDocument = async () => {\r\n        if (!id) return;\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const result = await api.get<{ data: DocumentInfo }>(`/documents/${id}`);\r\n            if (result.success && result.data?.data) { setDocument(result.data.data); }\r\n            else { setDocument({ _id: id, name: \"เอกสารประกอบคำขอ.pdf\", type: \"application/pdf\", url: \"/api/documents/\" + id, size: 1024 * 1024 * 2.5, uploadedAt: new Date().toISOString(), applicationId: \"app_12345\" }); }\r\n        } catch { setError(\"ไม่สามารถโหลดเอกสารได้\"); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const handleDownload = () => { if (!document) return; const link = window.document.createElement('a'); link.href = document.url; link.download = document.name; window.document.body.appendChild(link); link.click(); window.document.body.removeChild(link); };\r\n    const formatFileSize = (bytes: number) => bytes < 1024 ? bytes + \" B\" : bytes < 1024 * 1024 ? (bytes / 1024).toFixed(1) + \" KB\" : (bytes / (1024 * 1024)).toFixed(2) + \" MB\";\r\n\r\n    if (!mounted) return null;\r\n    const isPdf = document?.type === \"application/pdf\";\r\n    const isImage = document?.type?.startsWith(\"image/\");\r\n\r\n    return (\r\n        <div className={`min-h-screen font-sans ${isDark ? 'bg-slate-900 text-surface-100' : 'bg-surface-100 text-slate-900'}`}>\r\n            {/* Header */}\r\n            <header className={`sticky top-0 z-50 px-6 py-3 flex justify-between items-center border-b ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/farmer/applications\" className={`flex items-center gap-2 text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M15 18l-6-6 6-6\" /></svg> กลับ\r\n                    </Link>\r\n                    {document && (\r\n                        <div className={`pl-4 border-l ${isDark ? 'border-slate-700' : 'border-surface-200'}`}>\r\n                            <h1 className=\"text-base font-medium\">{document.name}</h1>\r\n                            <p className={`text-xs ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>{formatFileSize(document.size)} • อัปโหลดเมื่อ {new Date(document.uploadedAt).toLocaleDateString('th-TH')}</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                {document && (\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className={`flex items-center gap-1 rounded-lg p-1 border ${isDark ? 'bg-slate-700 border-slate-600' : 'bg-white border-surface-200'}`}>\r\n                            <button onClick={() => setZoom(Math.max(50, zoom - 25))} className=\"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-surface-100\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><circle cx=\"11\" cy=\"11\" r=\"8\" /><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\" /><line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" /></svg>\r\n                            </button>\r\n                            <span className={`text-xs min-w-[40px] text-center ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{zoom}%</span>\r\n                            <button onClick={() => setZoom(Math.min(200, zoom + 25))} className=\"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-surface-100\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><circle cx=\"11\" cy=\"11\" r=\"8\" /><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\" /><line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\" /><line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" /></svg>\r\n                            </button>\r\n                        </div>\r\n                        <button onClick={() => window.print()} className={`px-4 py-2 rounded-lg text-sm flex items-center gap-1.5 border ${isDark ? 'border-slate-600' : 'border-surface-200'}`}>\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><polyline points=\"6 9 6 2 18 2 18 9\" /><path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\" /><rect x=\"6\" y=\"14\" width=\"12\" height=\"8\" /></svg>\r\n                            พิมพ์\r\n                        </button>\r\n                        <button onClick={handleDownload} className=\"px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1.5 bg-primary-600 text-white\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"7 10 12 15 17 10\" /><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" /></svg>\r\n                            ดาวน์โหลด\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </header>\r\n\r\n            {/* Content */}\r\n            <main className=\"p-6 flex justify-center\">\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-[60vh]\">\r\n                        <div className={`w-10 h-10 border-[3px] rounded-full animate-spin ${isDark ? 'border-slate-700 border-t-primary-500' : 'border-surface-200 border-t-primary-600'}`} />\r\n                        <p className={`mt-4 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>กำลังโหลดเอกสาร...</p>\r\n                    </div>\r\n                ) : error ? (\r\n                    <div className={`rounded-2xl p-16 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                        <p className=\"text-red-500 font-medium\">{error}</p>\r\n                        <Link href=\"/applications\" className=\"inline-block mt-4 px-5 py-2.5 rounded-lg bg-primary-600 text-white\">กลับ</Link>\r\n                    </div>\r\n                ) : document ? (\r\n                    <div className=\"w-full max-w-[900px] transition-transform\" style={{ transform: `scale(${zoom / 100})`, transformOrigin: \"top center\" }}>\r\n                        {isPdf ? (\r\n                            <iframe src={document.url} className={`w-full h-[80vh] rounded-xl border ${isDark ? 'border-slate-700' : 'border-surface-200'}`} style={{ background: '#FFF' }} />\r\n                        ) : isImage ? (\r\n                            <div className={`rounded-xl p-4 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                <img src={document.url} alt={document.name} className=\"max-w-full rounded-lg\" />\r\n                            </div>\r\n                        ) : (\r\n                            <div className={`rounded-2xl p-16 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                                <div className={`mb-4 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                                    <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\"><path d=\"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z\" /><polyline points=\"13 2 13 9 20 9\" /></svg>\r\n                                </div>\r\n                                <h3 className=\"text-lg font-medium mb-2\">{document.name}</h3>\r\n                                <p className={`text-sm mb-5 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>ไม่สามารถแสดงตัวอย่างได้</p>\r\n                                <button onClick={handleDownload} className=\"px-6 py-3 rounded-xl bg-primary-600 text-white font-medium inline-flex items-center gap-2\">\r\n                                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><polyline points=\"7 10 12 15 17 10\" /><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" /></svg>\r\n                                    ดาวน์โหลดเพื่อดู\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : null}\r\n            </main>\r\n\r\n            <style jsx global>{`@media print { header { display: none !important; } main { padding: 0 !important; } }`}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\establishments\\new\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":8,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\establishments\\new\\page.tsx:17:9\n  15 |     useEffect(() => {\n  16 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 17 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |         setIsDark(localStorage.getItem(\"theme\") === \"dark\");\n  19 |         const userData = localStorage.getItem(\"user\");\n  20 |         if (!userData) { window.location.href = \"/login\"; }","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function NewEstablishmentPage() {\r\n    const router = useRouter();\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [name, setName] = useState(\"\");\r\n    const [address, setAddress] = useState(\"\");\r\n    const [area, setArea] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        const userData = localStorage.getItem(\"user\");\r\n        if (!userData) { window.location.href = \"/login\"; }\r\n    }, []);\r\n\r\n    const handleSubmit = (e: React.FormEvent) => { e.preventDefault(); alert(\"ฟีเจอร์นี้จะเปิดให้บริการเร็วๆ นี้\"); };\r\n\r\n    if (!mounted) return <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-slate-900' : 'bg-surface-100'}`}><div className=\"w-10 h-10 border-[3px] border-surface-200 border-t-primary-600 rounded-full animate-spin\" /></div>;\r\n\r\n    return (\r\n        <div className={`min-h-screen font-sans transition-all ${isDark ? 'bg-slate-900 text-surface-100' : 'bg-surface-100 text-slate-900'}`}>\r\n            {/* Header */}\r\n            <header className={`px-6 py-5 border-b ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <div className=\"max-w-[700px] mx-auto flex items-center gap-4\">\r\n                    <Link href=\"/establishments\" className={`flex items-center ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M15 18L9 12L15 6\" /></svg>\r\n                    </Link>\r\n                    <h1 className=\"text-xl font-medium\">เพิ่มแปลงปลูกใหม่</h1>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Form */}\r\n            <main className=\"max-w-[700px] mx-auto p-6\">\r\n                <div className={`rounded-2xl p-7 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                    <form onSubmit={handleSubmit}>\r\n                        <div className=\"mb-5\">\r\n                            <label className={`text-sm font-medium block mb-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ชื่อแปลงปลูก</label>\r\n                            <input type=\"text\" placeholder=\"แปลงสมุนไพรบ้านใหม่\" value={name} onChange={(e) => setName(e.target.value)} className={`w-full px-4 py-3.5 rounded-xl text-[15px] outline-none border ${isDark ? 'bg-slate-700 border-slate-600 text-surface-100 focus:border-primary-500' : 'bg-white border-surface-200 text-slate-900 focus:border-primary-600'}`} required />\r\n                        </div>\r\n                        <div className=\"mb-5\">\r\n                            <label className={`text-sm font-medium block mb-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>ที่อยู่</label>\r\n                            <textarea placeholder=\"123 หมู่ 4 ต.บางนา อ.เมือง จ.สมุทรปราการ\" value={address} onChange={(e) => setAddress(e.target.value)} className={`w-full px-4 py-3.5 rounded-xl text-[15px] outline-none border min-h-[100px] resize-y ${isDark ? 'bg-slate-700 border-slate-600 text-surface-100 focus:border-primary-500' : 'bg-white border-surface-200 text-slate-900 focus:border-primary-600'}`} required />\r\n                        </div>\r\n                        <div className=\"mb-7\">\r\n                            <label className={`text-sm font-medium block mb-2 ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>พื้นที่ (ไร่)</label>\r\n                            <input type=\"number\" placeholder=\"10\" value={area} onChange={(e) => setArea(e.target.value)} className={`w-full px-4 py-3.5 rounded-xl text-[15px] outline-none border ${isDark ? 'bg-slate-700 border-slate-600 text-surface-100 focus:border-primary-500' : 'bg-white border-surface-200 text-slate-900 focus:border-primary-600'}`} required />\r\n                        </div>\r\n                        <button type=\"submit\" className=\"w-full py-4 bg-gradient-to-br from-primary-700 to-primary-500 text-white text-base font-semibold rounded-xl shadow-lg shadow-primary-500/40\">บันทึกแปลงปลูก</button>\r\n                    </form>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\establishments\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\layout.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\layout.tsx:17:9\n  15 |     useEffect(() => {\n  16 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 17 |         setIsDark(localStorage.getItem(\"theme\") === \"dark\");\n     |         ^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |\n  19 |         // Listen for theme changes\n  20 |         const handleStorage = () => {","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\notifications\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":39,"column":8,"nodeType":"ArrayExpression","endLine":39,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [router]","fix":{"range":[1971,1973],"text":"[router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ninterface Notification {\r\n    id: string;\r\n    _id?: string;\r\n    title: string;\r\n    message: string;\r\n    type: 'INFO' | 'SUCCESS' | 'WARNING' | 'DANGER';\r\n    read: boolean;\r\n    createdAt: string;\r\n    actionUrl?: string;\r\n    actionLabel?: string;\r\n}\r\n\r\nconst DEMO_NOTIFICATIONS: Notification[] = [\r\n    { id: \"1\", title: \"ยินดีต้อนรับสู่ระบบ GACP\", message: \"ระบบพร้อมให้บริการแล้ว คุณสามารถเริ่มยื่นคำขอรับรองมาตรฐานได้เลย\", type: \"SUCCESS\", read: false, createdAt: new Date(Date.now() - 1000 * 60 * 30).toISOString(), actionUrl: \"/applications/new\", actionLabel: \"ยื่นคำขอใหม่\" },\r\n    { id: \"2\", title: \"เอกสารถูกตรวจสอบแล้ว\", message: \"คำขอ #APP-2024-001 ผ่านการตรวจเอกสารเบื้องต้น กรุณาชำระเงินงวดที่ 2\", type: \"INFO\", read: false, createdAt: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), actionUrl: \"/payments?app=APP-2024-001\", actionLabel: \"ชำระเงิน\" },\r\n    { id: \"3\", title: \"นัดหมายตรวจประเมินสถานที่\", message: \"เจ้าหน้าที่จะเข้าตรวจประเมินสถานที่ในวันที่ 20 ธ.ค. 2567 เวลา 10:00 น.\", type: \"WARNING\", read: true, createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(), actionUrl: \"/tracking\", actionLabel: \"ดูรายละเอียด\" },\r\n];\r\n\r\nexport default function NotificationsPage() {\r\n    const router = useRouter();\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [filter, setFilter] = useState<'ALL' | 'UNREAD'>('ALL');\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        if (!localStorage.getItem(\"user\")) { router.push(\"/login\"); return; }\r\n        loadNotifications();\r\n    }, []);\r\n\r\n    const loadNotifications = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const result = await api.get<{ data: Notification[] }>(\"/api/notifications\");\r\n            if (result.success && result.data) {\r\n                setNotifications(result.data.data || []);\r\n            } else {\r\n                setNotifications(DEMO_NOTIFICATIONS);\r\n            }\r\n        } catch {\r\n            setNotifications(DEMO_NOTIFICATIONS);\r\n        }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const markAsRead = async (id: string) => {\r\n        try { await api.post(`/api/notifications/${id}/read`, {}); } catch { }\r\n        setNotifications(prev => prev.map(n => (n.id === id || n._id === id) ? { ...n, read: true } : n));\r\n    };\r\n\r\n    const markAllAsRead = async () => {\r\n        try { await api.post(\"/api/notifications/read-all\", {}); } catch { }\r\n        setNotifications(prev => prev.map(n => ({ ...n, read: true })));\r\n    };\r\n\r\n    const toggleTheme = () => { setIsDark(!isDark); localStorage.setItem(\"theme\", !isDark ? \"dark\" : \"light\"); };\r\n    const handleLogout = () => { localStorage.removeItem(\"user\"); window.location.href = \"/api/auth/logout\"; };\r\n\r\n    const formatTime = (date: string) => {\r\n        const diff = Date.now() - new Date(date).getTime();\r\n        const mins = Math.floor(diff / 60000), hours = Math.floor(diff / 3600000), days = Math.floor(diff / 86400000);\r\n        if (mins < 60) return `${mins} นาทีที่แล้ว`;\r\n        if (hours < 24) return `${hours} ชั่วโมงที่แล้ว`;\r\n        if (days < 7) return `${days} วันที่แล้ว`;\r\n        return new Date(date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });\r\n    };\r\n\r\n    const getTypeClasses = (type: string, read: boolean) => {\r\n        const base = read ? 'bg-white border-surface-200 dark:bg-slate-800 dark:border-slate-700' : '';\r\n        switch (type) {\r\n            case 'SUCCESS': return read ? base : 'bg-primary-50 border-primary-200 dark:bg-primary-500/15 dark:border-primary-500/30';\r\n            case 'WARNING': return read ? base : 'bg-secondary-50 border-secondary-300 dark:bg-secondary-500/15 dark:border-secondary-500/30';\r\n            case 'DANGER': return read ? base : 'bg-red-50 border-red-300 dark:bg-red-500/15 dark:border-red-500/30';\r\n            default: return read ? base : 'bg-blue-50 border-blue-200 dark:bg-blue-500/15 dark:border-blue-500/30';\r\n        }\r\n    };\r\n\r\n    const getIconBg = (type: string) => {\r\n        switch (type) {\r\n            case 'SUCCESS': return 'bg-primary-100 text-primary-600 dark:bg-primary-500/20 dark:text-primary-400';\r\n            case 'WARNING': return 'bg-secondary-100 text-secondary-600 dark:bg-secondary-500/20 dark:text-secondary-400';\r\n            case 'DANGER': return 'bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-400';\r\n            default: return 'bg-blue-100 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400';\r\n        }\r\n    };\r\n\r\n    const getDotColor = (type: string) => {\r\n        switch (type) {\r\n            case 'SUCCESS': return 'bg-primary-500';\r\n            case 'WARNING': return 'bg-secondary-500';\r\n            case 'DANGER': return 'bg-red-500';\r\n            default: return 'bg-blue-500';\r\n        }\r\n    };\r\n\r\n    if (!mounted) return null;\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n    const filteredNotifications = filter === 'UNREAD' ? notifications.filter(n => !n.read) : notifications;\r\n\r\n    const navItems = [\r\n        { href: \"/farmer/dashboard\", label: \"หน้าหลัก\" },\r\n        { href: \"/farmer/applications\", label: \"คำขอ\" },\r\n        { href: \"/farmer/certificates\", label: \"ใบรับรอง\" },\r\n        { href: \"/farmer/tracking\", label: \"ติดตาม\" },\r\n        { href: \"/farmer/payments\", label: \"การเงิน\" },\r\n        { href: \"/farmer/profile\", label: \"โปรไฟล์\" },\r\n        { href: \"/payments\", label: \"การเงิน\" },\r\n        { href: \"/profile\", label: \"โปรไฟล์\" },\r\n    ];\r\n\r\n    return (\r\n        <div className={`min-h-screen font-sans transition-colors ${isDark ? 'dark bg-slate-900 text-slate-100' : 'bg-surface-50 text-slate-900'}`}>\r\n            {/* Sidebar */}\r\n            <aside className={`hidden lg:flex fixed left-0 top-0 bottom-0 w-[72px] flex-col items-center py-5 border-r z-50 ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                <div className=\"w-11 h-11 rounded-2xl bg-gradient-to-br from-primary-600 to-primary-400 flex items-center justify-center text-xl font-semibold text-white mb-8\">G</div>\r\n                <nav className=\"flex-1 flex flex-col gap-1 w-full px-2\">\r\n                    {navItems.map(item => (\r\n                        <Link key={item.href} href={item.href} className={`flex flex-col items-center gap-1 py-2.5 rounded-xl transition-all hover:bg-slate-100 dark:hover:bg-slate-700`}>\r\n                            <span className=\"text-[10px] font-medium text-slate-500\">{item.label}</span>\r\n                        </Link>\r\n                    ))}\r\n                </nav>\r\n                <div className=\"flex flex-col gap-3\">\r\n                    <button onClick={toggleTheme} className={`w-10 h-10 rounded-xl flex items-center justify-center ${isDark ? 'bg-primary-500/15' : 'bg-primary-50'}`}>\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">{isDark ? <><circle cx=\"12\" cy=\"12\" r=\"5\" /><line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\" /></> : <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\" />}</svg>\r\n                    </button>\r\n                    <button onClick={handleLogout} className=\"w-10 h-10 rounded-xl flex items-center justify-center text-slate-500\">\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\" /><polyline points=\"16 17 21 12 16 7\" /><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\" /></svg>\r\n                    </button>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Mobile Nav */}\r\n            <nav className={`lg:hidden fixed bottom-0 inset-x-0 h-[72px] flex justify-around items-center z-50 border-t ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-surface-200'}`}>\r\n                {navItems.slice(0, 5).map(item => (\r\n                    <Link key={item.href} href={item.href} className=\"flex flex-col items-center gap-1 py-2 px-3\">\r\n                        <span className=\"text-[10px] font-medium text-slate-500\">{item.label}</span>\r\n                    </Link>\r\n                ))}\r\n            </nav>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"lg:ml-[72px] p-6 lg:p-10 pb-24 lg:pb-10 max-w-3xl\">\r\n                {/* Header */}\r\n                <header className=\"flex justify-between items-start flex-wrap gap-4 mb-7\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl lg:text-3xl font-medium flex items-center gap-3\">\r\n                            การแจ้งเตือน\r\n                            {unreadCount > 0 && (\r\n                                <span className=\"px-3 py-1 rounded-full text-sm font-semibold bg-primary-500 text-white\">{unreadCount} ใหม่</span>\r\n                            )}\r\n                        </h1>\r\n                        <p className=\"text-sm text-slate-500 mt-1\">ข้อความและการอัปเดตจากระบบ</p>\r\n                    </div>\r\n                    {unreadCount > 0 && (\r\n                        <button onClick={markAllAsRead} className={`px-5 py-2.5 rounded-xl text-sm font-medium flex items-center gap-2 ${isDark ? 'bg-slate-700 text-slate-300' : 'bg-white border border-surface-200 text-slate-600'}`}>\r\n                            อ่านทั้งหมด\r\n                        </button>\r\n                    )}\r\n                </header>\r\n\r\n                {/* Filter Tabs */}\r\n                <div className=\"flex gap-2 mb-5\">\r\n                    {[{ key: 'ALL', label: 'ทั้งหมด', count: notifications.length }, { key: 'UNREAD', label: 'ยังไม่อ่าน', count: unreadCount }].map(tab => (\r\n                        <button key={tab.key} onClick={() => setFilter(tab.key as 'ALL' | 'UNREAD')} className={`px-5 py-2.5 rounded-full text-sm font-medium flex items-center gap-2 transition-colors ${filter === tab.key ? 'bg-primary-500 text-white' : `${isDark ? 'bg-slate-700 text-slate-300' : 'bg-white border border-surface-200 text-slate-600'}`}`}>\r\n                            {tab.label}\r\n                            <span className={`px-2 py-0.5 rounded-full text-xs ${filter === tab.key ? 'bg-white/20 text-white' : 'bg-primary-100 text-primary-600'}`}>{tab.count}</span>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Notifications List */}\r\n                {loading ? (\r\n                    <div className={`rounded-2xl p-16 text-center ${isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-surface-200'}`}>\r\n                        <div className=\"w-10 h-10 border-3 border-primary-500/30 border-t-primary-500 rounded-full animate-spin mx-auto\" />\r\n                        <p className=\"mt-4 text-slate-500\">กำลังโหลด...</p>\r\n                    </div>\r\n                ) : filteredNotifications.length > 0 ? (\r\n                    <div className=\"flex flex-col gap-3\">\r\n                        {filteredNotifications.map(n => (\r\n                            <div\r\n                                key={n.id || n._id}\r\n                                onClick={() => !n.read && markAsRead(n.id || n._id || '')}\r\n                                className={`rounded-2xl p-5 border transition-all relative ${n.read ? '' : 'cursor-pointer'} ${getTypeClasses(n.type, n.read)}`}\r\n                            >\r\n                                {!n.read && <div className={`absolute top-5 right-5 w-2.5 h-2.5 rounded-full ${getDotColor(n.type)}`} />}\r\n                                <div className=\"flex gap-4\">\r\n                                    <div className={`w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0 text-xl ${getIconBg(n.type)}`}>\r\n                                        {n.type === 'SUCCESS' ? <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\"><polyline points=\"20 6 9 17 4 12\" /></svg> : n.type === 'WARNING' ? '!' : n.type === 'DANGER' ? 'X' : 'i'}\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                        <div className=\"flex justify-between items-start gap-4\">\r\n                                            <h3 className=\"text-base font-medium\">{n.title}</h3>\r\n                                            <span className=\"text-xs text-slate-400 whitespace-nowrap\">{formatTime(n.createdAt)}</span>\r\n                                        </div>\r\n                                        <p className=\"text-sm text-slate-500 mt-1.5 leading-relaxed\">{n.message}</p>\r\n                                        {n.actionUrl && (\r\n                                            <Link href={n.actionUrl} onClick={e => e.stopPropagation()} className=\"inline-flex items-center gap-1.5 mt-3 px-4 py-2 rounded-lg bg-primary-500 text-white text-xs font-medium\">\r\n                                                {n.actionLabel || \"ดูรายละเอียด\"} →\r\n                                            </Link>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    <div className={`rounded-2xl p-16 text-center ${isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-surface-200'}`}>\r\n                        <div className={`w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-5 ${isDark ? 'bg-primary-500/15' : 'bg-primary-50'}`}>\r\n                            <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\"><path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\" /><path d=\"M13.73 21a2 2 0 0 1-3.46 0\" /></svg>\r\n                        </div>\r\n                        <h3 className=\"text-lg font-medium mb-2\">{filter === 'UNREAD' ? \"ไม่มีการแจ้งเตือนที่ยังไม่อ่าน\" : \"ไม่มีการแจ้งเตือน\"}</h3>\r\n                        <p className=\"text-sm text-slate-500\">เมื่อมีการแจ้งเตือนใหม่ จะแสดงที่นี่</p>\r\n                    </div>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\payments\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'payQR' is assigned a value but never used.","line":37,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setPayQR' is assigned a value but never used.","line":37,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":71,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filteredPayments' is assigned a value but never used.","line":87,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7929,7932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7929,7932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":249,"column":41,"nodeType":"JSXOpeningElement","endLine":249,"endColumn":116}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { PaymentService, PaymentRecord } from \"@/lib/services/payment-service\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\nimport { IconDocument, IconClock, IconCheckCircle, IconPayment, IconWarning } from \"@/components/ui/icons\";\r\n\r\n// ... (Imports logic)\r\n\r\n// PaymentRecord interface is now imported, remove local definition if matching or update\r\n// The imported one has serviceType.\r\n// Local one: interface PaymentRecord { ... } -> Remove\r\n\r\nconst TYPE_CONFIG = {\r\n    QUOTATION: { label: \"ใบเสนอราคา\", color: \"blue\", desc: \"เอกสารเสนอราคาค่าธรรมเนียม\" },\r\n    INVOICE: { label: \"ใบแจ้งหนี้\", color: \"amber\", desc: \"เอกสารเรียกเก็บเงิน\" },\r\n    RECEIPT: { label: \"ใบเสร็จรับเงิน\", color: \"emerald\", desc: \"หลักฐานการชำระเงิน\" }\r\n};\r\n\r\nconst STATUS_LABELS: Record<string, { label: string; color: string }> = {\r\n    PENDING_APPROVAL: { label: \"รอการตรวจสอบ\", color: \"amber\" },\r\n    APPROVED: { label: \"ชำระแล้ว\", color: \"emerald\" },\r\n    REJECTED: { label: \"ถูกปฏิเสธ\", color: \"red\" },\r\n    PENDING: { label: \"รอชำระเงิน\", color: \"amber\" },\r\n    DELIVERED: { label: \"ออกเอกสารแล้ว\", color: \"blue\" },\r\n    ISSUED: { label: \"ออกเอกสารแล้ว\", color: \"blue\" },\r\n    CANCELLED: { label: \"ยกเลิก\", color: \"red\" },\r\n};\r\n\r\nexport default function PaymentsPage() {\r\n    const router = useRouter();\r\n    const [payments, setPayments] = useState<PaymentRecord[]>([]);\r\n    const [filter, setFilter] = useState<\"ALL\" | \"PENDING\" | \"PAID\">(\"ALL\");\r\n    const [viewDoc, setViewDoc] = useState<PaymentRecord | null>(null);\r\n    const [payQR, setPayQR] = useState<PaymentRecord | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const user = AuthService.getUser();\r\n        if (!user) {\r\n            router.push(\"/login\");\r\n            return;\r\n        }\r\n        loadPayments();\r\n    }, [router]);\r\n\r\n    const loadPayments = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await PaymentService.getMyPayments();\r\n            setPayments(data);\r\n        } catch { setPayments([]); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const handleKsherPay = async (invoiceId: string) => {\r\n        if (!confirm(\"ต้องการชำระเงินผ่าน Ksher Gateway ใช่หรือไม่?\")) return;\r\n        setUploading(true); // Re-use uploading state for \"Processing\"\r\n        try {\r\n            const res = await PaymentService.payWithKsher(invoiceId);\r\n            if (res.success && res.data?.payment_url) {\r\n                // Redirect to Ksher (Mock) Payment Page\r\n                window.location.href = res.data.payment_url;\r\n            } else {\r\n                alert('ไม่สามารถเริ่มรายการชำระเงินได้' + (res.error ? ': ' + res.error : ''));\r\n                setUploading(false);\r\n            }\r\n        } catch (error) {\r\n            alert('เกิดข้อผิดพลาดในการเชื่อมต่อ');\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const formatAmount = (n: number) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(n);\r\n\r\n    // Heuristic + ServiceType\r\n    const getFeeName = (p: PaymentRecord) => {\r\n        if (p.serviceType === 'APPLICATION_FEE') return \"ค่าธรรมเนียมคำขอ (Fee 1)\";\r\n        if (p.serviceType === 'AUDIT_FEE') return \"ค่าธรรมเนียมการตรวจประเมิน (Fee 2)\";\r\n        if (p.amount <= 5000) return \"ค่าธรรมเนียมคำขอ (Fee 1)\";\r\n        return \"ค่าธรรมเนียมการตรวจประเมิน (Fee 2)\";\r\n    };\r\n\r\n    const filteredPayments = payments.filter(p => {\r\n        if (filter === \"ALL\") return true;\r\n        if (filter === \"PENDING\") return p.status === \"PENDING\";\r\n        if (filter === \"PAID\") return p.status === \"APPROVED\" || p.type === \"RECEIPT\";\r\n        return true;\r\n    });\r\n\r\n    const displayedPayments = payments.filter(p => {\r\n        if (filter === \"ALL\") return true;\r\n        if (filter === \"PENDING\") return p.status === \"PENDING\" || p.status === \"PENDING_APPROVAL\";\r\n        if (filter === \"PAID\") return p.status === \"APPROVED\" || p.type === \"RECEIPT\" || p.status === \"PAID\"; // Added PAID\r\n        return true;\r\n    });\r\n\r\n    const pendingAmount = payments.filter(p => (p.status === \"PENDING\" || p.status === \"PENDING_APPROVAL\")).reduce((sum, p) => sum + p.amount, 0);\r\n    const paidAmount = payments.filter(p => p.status === \"APPROVED\" || p.type === \"RECEIPT\" || p.status === \"PAID\").reduce((sum, p) => sum + p.amount, 0);\r\n\r\n    const stats = [\r\n        { label: \"ยอดที่ต้องชำระ (Pending)\", value: formatAmount(pendingAmount), Icon: IconClock, color: \"bg-amber-500\" },\r\n        { label: \"ชำระแล้ว (Paid)\", value: formatAmount(paidAmount), Icon: IconCheckCircle, color: \"bg-emerald-500\" },\r\n    ];\r\n\r\n    const getColorCls = (color: string, bg = false) => {\r\n        const map: Record<string, { bg: string; text: string }> = {\r\n            emerald: { bg: 'bg-emerald-100', text: 'text-emerald-600' },\r\n            amber: { bg: 'bg-amber-100', text: 'text-amber-600' },\r\n            blue: { bg: 'bg-blue-100', text: 'text-blue-600' },\r\n            red: { bg: 'bg-red-100', text: 'text-red-600' },\r\n            slate: { bg: 'bg-slate-100', text: 'text-slate-600' },\r\n        };\r\n        return bg ? map[color]?.bg || 'bg-slate-100' : map[color]?.text || 'text-slate-600';\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in pb-20\">\r\n            {/* Header */}\r\n            <div className=\"bg-gradient-to-br from-[#1e293b] to-[#0f172a] rounded-[2rem] p-8 lg:p-12 text-white relative overflow-hidden shadow-2xl\">\r\n                <div className=\"absolute inset-0 bg-[url('/images/thai-pattern-bg.png')] opacity-5 mix-blend-overlay\"></div>\r\n                <div className=\"relative z-10 flex items-center justify-between\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl lg:text-4xl font-black mb-2 tracking-tight\">Financial Center</h1>\r\n                        <p className=\"text-slate-400 font-medium\">ระบบชำระค่าธรรมเนียมและประวัติธุรกรรม</p>\r\n                    </div>\r\n                    <div className=\"w-16 h-16 bg-white/10 rounded-2xl backdrop-blur-md flex items-center justify-center border border-white/10\">\r\n                        <IconPayment size={32} className=\"text-emerald-400\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {stats.map((stat, i) => (\r\n                    <div key={i} className=\"p-8 rounded-[2rem] bg-white border border-slate-100 shadow-xl shadow-slate-200/50 flex items-center justify-between group hover:border-[#006837]/20 transition-all\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-400 font-bold uppercase tracking-widest mb-2\">{stat.label}</p>\r\n                            <p className=\"text-4xl font-black text-slate-800 group-hover:text-[#006837] transition-colors\">{stat.value}</p>\r\n                        </div>\r\n                        <div className={`w-16 h-16 rounded-2xl ${stat.color.replace('bg-', 'bg-')}/10 flex items-center justify-center text-${stat.color.replace('bg-', '')}`}>\r\n                            <stat.Icon size={32} className={stat.color.replace('bg-', 'text-')} />\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Filter Tabs */}\r\n            <div className=\"bg-slate-100 p-1.5 rounded-2xl inline-flex\">\r\n                {[\r\n                    { key: \"ALL\", label: \"รายการทั้งหมด\" },\r\n                    { key: \"PENDING\", label: \"รอชำระเงิน\" },\r\n                    { key: \"PAID\", label: \"ประวัติการชำระ\" }\r\n                ].map(tab => (\r\n                    <button key={tab.key} onClick={() => setFilter(tab.key as any)}\r\n                        className={`px-6 py-3 rounded-xl text-sm font-bold transition-all ${filter === tab.key\r\n                            ? 'bg-white text-[#006837] shadow-md'\r\n                            : 'text-slate-500 hover:text-slate-700'\r\n                            }`}>\r\n                        {tab.label}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Payment List */}\r\n            <div className=\"space-y-4\">\r\n                {loading ? (\r\n                    <div className=\"text-center py-24\">\r\n                        <div className=\"w-10 h-10 border-4 border-slate-200 border-t-slate-800 rounded-full animate-spin mx-auto mb-4\"></div>\r\n                        <p className=\"text-slate-400 font-bold\">กำลังโหลดธุรกรรม...</p>\r\n                    </div>\r\n                ) : displayedPayments.length > 0 ? (\r\n                    displayedPayments.map(p => {\r\n                        const typeCfg = TYPE_CONFIG[p.type];\r\n                        const statusCfg = STATUS_LABELS[p.status] || { label: p.status, color: 'slate' };\r\n                        const feeName = getFeeName(p);\r\n\r\n                        return (\r\n                            <div key={p.id} className=\"bg-white rounded-[1.5rem] p-6 border border-slate-100 shadow-sm hover:shadow-xl transition-all group relative overflow-hidden\">\r\n                                {p.status === 'PENDING' && <div className=\"absolute left-0 top-0 bottom-0 w-1.5 bg-amber-500\"></div>}\r\n                                {p.status === 'APPROVED' && <div className=\"absolute left-0 top-0 bottom-0 w-1.5 bg-emerald-500\"></div>}\r\n\r\n                                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10 pl-4\">\r\n                                    <div className=\"flex items-start gap-5\">\r\n                                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 ${getColorCls(typeCfg.color, true)}`}>\r\n                                            <IconDocument size={24} className={getColorCls(typeCfg.color)} />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"flex flex-wrap items-center gap-2 mb-1\">\r\n                                                <span className={`px-2.5 py-1 rounded-md text-[10px] font-black tracking-widest uppercase ${getColorCls(typeCfg.color, true)} ${getColorCls(typeCfg.color)}`}>\r\n                                                    {typeCfg.label}\r\n                                                </span>\r\n                                                <span className={`px-2.5 py-1 rounded-md text-[10px] font-black tracking-widest uppercase ${getColorCls(statusCfg.color, true)} ${getColorCls(statusCfg.color)}`}>\r\n                                                    {statusCfg.label}\r\n                                                </span>\r\n                                            </div>\r\n                                            <h3 className=\"font-black text-slate-800 text-lg group-hover:text-[#006837] transition-colors\">{feeName}</h3>\r\n                                            <p className=\"text-xs text-slate-400 font-mono mt-1\">REF: {p.documentNumber} • {new Date(p.createdAt).toLocaleDateString('th-TH')}</p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center justify-between md:justify-end gap-8 border-t md:border-t-0 pt-4 md:pt-0\">\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-0.5\">AMOUNT</p>\r\n                                            <p className=\"text-2xl font-black text-slate-800\">{formatAmount(p.amount)}</p>\r\n                                        </div>\r\n                                        <div className=\"flex gap-3\">\r\n                                            <button onClick={() => setViewDoc(p)} className=\"w-12 h-12 rounded-xl bg-slate-50 flex items-center justify-center text-slate-500 hover:bg-slate-200 hover:text-slate-800 transition-colors\">\r\n                                                <IconDocument size={20} />\r\n                                            </button>\r\n                                            {p.status === \"PENDING\" && (\r\n                                                <button onClick={() => handleKsherPay(p.id)} disabled={uploading} className=\"bg-[#006837] text-white px-6 rounded-xl font-bold shadow-lg shadow-emerald-700/20 hover:bg-[#00502b] hover:-translate-y-1 transition-all flex items-center gap-2\">\r\n                                                    {uploading ? <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" /> : 'ชำระเงิน'}\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })\r\n                ) : (\r\n                    <div className=\"text-center py-20 bg-slate-50/50 rounded-[2rem] border-2 border-dashed border-slate-200\">\r\n                        <div className=\"w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 text-slate-300 shadow-sm\">\r\n                            <IconDocument size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-black text-slate-900\">ไม่พบรายการธุรกรรม</h3>\r\n                        <p className=\"text-slate-400 text-sm font-medium\">รายการเรียกเก็บเงินและใบเสร็จของคุณจะปรากฏที่นี่</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Modal - View Document (Premium) */}\r\n            {viewDoc && (\r\n                <div className=\"fixed inset-0 bg-slate-900/90 z-[100] flex items-center justify-center p-4 backdrop-blur-md\" onClick={() => setViewDoc(null)}>\r\n                    <div className=\"bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-scaleIn\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"flex justify-between items-center p-6 border-b bg-slate-50/80 backdrop-blur-sm sticky top-0 z-10\">\r\n                            <h3 className=\"font-black text-xl text-slate-800 tracking-tight\">{TYPE_CONFIG[viewDoc.type].label}</h3>\r\n                            <button onClick={() => setViewDoc(null)} className=\"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 hover:bg-slate-300 font-bold\">✕</button>\r\n                        </div>\r\n                        <div className=\"p-8 md:p-12 bg-slate-100 max-h-[70vh] overflow-auto\">\r\n                            <div className=\"bg-white shadow-xl p-8 min-h-[600px] relative mx-auto max-w-xl animate-fade-in print:shadow-none print:p-0\">\r\n                                {/* Letterhead */}\r\n                                <div className=\"flex justify-between items-start mb-10 border-b pb-8\">\r\n                                    <div className=\"flex gap-4\">\r\n                                        <img src=\"/images/dtam-logo.png\" className=\"w-20 h-20 opacity-90\" alt=\"\" />\r\n                                        <div>\r\n                                            <h4 className=\"font-bold text-slate-800 text-lg\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</h4>\r\n                                            <p className=\"text-xs text-slate-500 max-w-[200px] leading-relaxed mt-1\">88/23 หมู่ 4 ถนนติวานนท์ ต.ตลาดขวัญ อ.เมือง จ.นนทบุรี 11000</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <div className=\"inline-block px-4 py-1.5 bg-slate-900 text-white text-xs font-black rounded mb-3 tracking-widest uppercase\">\r\n                                            {viewDoc.type}\r\n                                        </div>\r\n                                        <p className=\"font-mono text-slate-600 font-bold text-lg\">{viewDoc.documentNumber}</p>\r\n                                        <p className=\"text-xs text-slate-400 font-medium\">DATE: {new Date(viewDoc.createdAt).toLocaleDateString('th-TH')}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Bill To */}\r\n                                <div className=\"mb-12\">\r\n                                    <h5 className=\"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-2\">BILL TO</h5>\r\n                                    <div className=\"text-sm font-bold text-slate-800\">ผู้ยื่นคำขอรับรองมาตรฐาน GACP</div>\r\n                                    <div className=\"text-xs text-slate-500 mt-1\">Ref App ID: {viewDoc.applicationId}</div>\r\n                                </div>\r\n\r\n                                {/* Line Items */}\r\n                                <table className=\"w-full text-sm mb-12\">\r\n                                    <thead>\r\n                                        <tr className=\"text-slate-400 border-b-2 border-slate-100\">\r\n                                            <th className=\"py-3 text-left w-16 font-black uppercase text-[10px] tracking-widest\">No.</th>\r\n                                            <th className=\"py-3 text-left font-black uppercase text-[10px] tracking-widest\">Description</th>\r\n                                            <th className=\"py-3 text-right font-black uppercase text-[10px] tracking-widest\">Amount</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr className=\"border-b border-slate-50 group\">\r\n                                            <td className=\"py-6 text-slate-400 font-medium\">01</td>\r\n                                            <td className=\"py-6\">\r\n                                                <div className=\"font-bold text-slate-800\">{getFeeName(viewDoc)}</div>\r\n                                            </td>\r\n                                            <td className=\"py-6 text-right font-bold text-slate-800 text-lg\">{formatAmount(viewDoc.amount)}</td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n\r\n                                {/* Total */}\r\n                                <div className=\"flex justify-end mb-12\">\r\n                                    <div className=\"w-1/2\">\r\n                                        <div className=\"flex justify-between py-2 border-b border-slate-100\">\r\n                                            <span className=\"text-slate-500 font-medium\">Subtotal</span>\r\n                                            <span className=\"font-bold text-slate-800\">{formatAmount(viewDoc.amount)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between py-4\">\r\n                                            <span className=\"text-slate-900 font-black text-lg\">Total</span>\r\n                                            <span className=\"font-black text-emerald-600 text-2xl\">{formatAmount(viewDoc.amount)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Footer Note */}\r\n                                {viewDoc.type === \"INVOICE\" && (\r\n                                    <div className=\"bg-amber-50 rounded-xl p-5 border border-amber-100 text-xs text-amber-800 leading-relaxed flex gap-3\">\r\n                                        <IconWarning size={20} className=\"flex-shrink-0 text-amber-600\" />\r\n                                        <div>\r\n                                            <strong className=\"block mb-1 font-bold text-amber-900\">Payment Instruction</strong>\r\n                                            Please verify the details before proceeding with payment via Ksher Gateway.\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-6 border-t bg-white flex justify-end gap-3 z-20 relative\">\r\n                            <button className=\"px-6 py-3 rounded-xl border-2 border-slate-100 text-slate-600 font-bold hover:bg-slate-50 transition-all\" onClick={() => window.print()}>\r\n                                Print\r\n                            </button>\r\n                            <button\r\n                                onClick={() => PaymentService.downloadInvoicePdf(viewDoc.id, viewDoc.documentNumber)}\r\n                                className=\"px-6 py-3 rounded-xl bg-slate-900 text-white font-bold hover:bg-slate-800 shadow-lg shadow-slate-900/20 transition-all flex items-center gap-2\">\r\n                                <IconDocument size={18} />\r\n                                Download PDF\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\planting\\new\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[273,276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[273,276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[815,818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[815,818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1465,1468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1465,1468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2954,2957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2954,2957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { apiClient } from '@/lib/api';\r\n\r\nexport default function NewPlantingCyclePage() {\r\n    const router = useRouter();\r\n    const [farms, setFarms] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const [form, setForm] = useState({\r\n        farmId: '',\r\n        pkantSpeciesId: 'P001', // Default \r\n        batchName: '',\r\n        cycleDate: new Date().toISOString().split('T')[0],\r\n        quantity: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        // Fetch only farms relevant to user\r\n        apiClient.get('/farms').then(res => {\r\n            setFarms((res.data as any[]) || []);\r\n            setLoading(false);\r\n        }).catch(err => {\r\n            console.error(err);\r\n            setError('Failed to load farms');\r\n            setLoading(false);\r\n        });\r\n    }, []);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setSubmitting(true);\r\n        setError('');\r\n\r\n        try {\r\n            await apiClient.post('/planting-cycles', {\r\n                ...form,\r\n                plantSpeciesId: 'P001', // Hardcode for now or fetch list\r\n                startDate: form.cycleDate\r\n            });\r\n            router.push('/planting');\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            // Show the specific error from backend (check certificate)\r\n            const msg = err.response?.data?.message || err.response?.data?.error || 'Failed to create cycle';\r\n            setError(msg);\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 lg:p-10 max-w-2xl mx-auto\">\r\n            <h1 className=\"text-2xl font-medium mb-6\">เริ่มรอบการปลูกใหม่</h1>\r\n\r\n            {error && (\r\n                <div className=\"mb-6 p-4 bg-red-50 text-red-600 rounded-xl border border-red-100\">\r\n                    ⚠️ {error}\r\n                </div>\r\n            )}\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">เลือกแปลงปลูก (Certified Farm)</label>\r\n                    {loading ? <div className=\"text-sm text-slate-500\">Loading farms...</div> : (\r\n                        <select\r\n                            required\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n                            value={form.farmId}\r\n                            onChange={e => setForm({ ...form, farmId: e.target.value })}\r\n                        >\r\n                            <option value=\"\">-- เลือกฟาร์ม --</option>\r\n                            {farms.map((f: any) => (\r\n                                <option key={f.id} value={f.id}>{f.farmName} ({f.status})</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n                    <p className=\"text-xs text-slate-500 mt-2\">\r\n                        * เฉพาะฟาร์มที่ได้รับใบรับรอง (Status: VERIFIED/ACTIVE) เท่านั้นจึงจะสามารถเริ่มรอบปลูกได้\r\n                    </p>\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">ชื่อรอบปลูก / Batch Name</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        required\r\n                        placeholder=\"e.g. Cycle-2024-001\"\r\n                        className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n                        value={form.batchName}\r\n                        onChange={e => setForm({ ...form, batchName: e.target.value })}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">วันที่เริ่มปลูก</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            required\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n                            value={form.cycleDate}\r\n                            onChange={e => setForm({ ...form, cycleDate: e.target.value })}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">จำนวนต้น (โดยประมาณ)</label>\r\n                        <input\r\n                            type=\"number\"\r\n                            required\r\n                            placeholder=\"0\"\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n                            value={form.quantity}\r\n                            onChange={e => setForm({ ...form, quantity: e.target.value })}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"pt-4 flex gap-3\">\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={() => router.back()}\r\n                        className=\"flex-1 py-3 rounded-xl border border-slate-200 font-medium hover:bg-slate-50\"\r\n                    >\r\n                        ยกเลิก\r\n                    </button>\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={submitting}\r\n                        className=\"flex-1 py-3 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 disabled:opacity-50\"\r\n                    >\r\n                        {submitting ? 'กำลังบันทึก...' : 'บันทึกข้อมูล'}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\planting\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[225,228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[225,228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[777,780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[777,780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[821,824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[821,824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1327,1330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1327,1330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1339,1342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1339,1342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1377,1380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1377,1380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1385,1388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1385,1388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4143,4146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4143,4146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { apiClient } from '@/lib/api';\r\n\r\nexport default function PlantingCyclesPage() {\r\n    const [cycles, setCycles] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        fetchCycles();\r\n    }, []);\r\n\r\n    const fetchCycles = async () => {\r\n        try {\r\n            // Need to get first farm ID or fetch all cycles for user?\r\n            // The API expects `farmId`. We should probably fetch farms first or update API to allow fetching all user's cycles.\r\n            // For now, let's fetch farms to get IDs, then fetch cycles.\r\n            const farmsRes = await apiClient.get<any[]>('/farms');\r\n            const farms: any[] = farmsRes.data || [];\r\n\r\n            if (farms.length === 0) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Fetch cycles for all farms (Promise.all)\r\n            const cyclesPromises = farms.map(farm =>\r\n                apiClient.get(`/planting-cycles?farmId=${farm.id}`).then(res => res.data || []).catch(() => [])\r\n            );\r\n\r\n            const results = await Promise.all(cyclesPromises);\r\n            const allCycles = results.reduce((acc: any[], val: any) => acc.concat(val), []).sort((a: any, b: any) => new Date(b.startDate).getTime() - new Date(a.startDate).getTime());\r\n\r\n            setCycles(allCycles);\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError('Failed to load planting cycles');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 lg:p-10 pb-24 lg:pb-10 max-w-6xl mx-auto\">\r\n            <header className=\"flex justify-between items-center mb-8\">\r\n                <div>\r\n                    <h1 className=\"text-2xl lg:text-3xl font-medium text-slate-900\">รอบการปลูก</h1>\r\n                    <p className=\"text-slate-500 mt-1\">จัดการรอบการปลูกและบันทึกกิจกรรม</p>\r\n                </div>\r\n                <Link href=\"/planting/new\" className=\"flex items-center gap-2 px-6 py-3 rounded-xl bg-emerald-600 text-white font-medium shadow-lg shadow-emerald-500/30 hover:bg-emerald-700 transition-colors\">\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                        <path d=\"M12 5v14M5 12h14\" />\r\n                    </svg>\r\n                    เริ่มรอบปลูกใหม่\r\n                </Link>\r\n            </header>\r\n\r\n            {loading ? (\r\n                <div className=\"text-center py-12\">\r\n                    <div className=\"w-10 h-10 border-3 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto mb-4\" />\r\n                    <p className=\"text-slate-500\">กำลังโหลดข้อมูล...</p>\r\n                </div>\r\n            ) : error ? (\r\n                <div className=\"p-4 bg-red-50 text-red-600 rounded-xl\">{error}</div>\r\n            ) : cycles.length === 0 ? (\r\n                <div className=\"text-center py-12 bg-white rounded-3xl border border-slate-200\">\r\n                    <div className=\"w-16 h-16 bg-emerald-50 rounded-2xl flex items-center justify-center mx-auto mb-4\">\r\n                        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" className=\"text-emerald-600\">\r\n                            <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" />\r\n                        </svg>\r\n                    </div>\r\n                    <h3 className=\"text-lg font-medium text-slate-900\">ยังไม่มีรอบการปลูก</h3>\r\n                    <p className=\"text-slate-500 mt-2 mb-6\">เริ่มบันทึกรอบการปลูกแรกของคุณเพื่อติดตามผลผลิต</p>\r\n                    <Link href=\"/planting/new\" className=\"inline-flex items-center gap-2 text-emerald-600 font-medium hover:text-emerald-700\">\r\n                        เริ่มรอบปลูกใหม่ &rarr;\r\n                    </Link>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid gap-4\">\r\n                    {cycles.map((cycle: any) => (\r\n                        <div key={cycle.id} className=\"bg-white p-6 rounded-2xl border border-slate-200 hover:border-emerald-500/50 transition-colors group\">\r\n                            <div className=\"flex justify-between items-start\">\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-medium text-slate-900 group-hover:text-emerald-700 transition-colors\">\r\n                                        {cycle.cycleName}\r\n                                    </h3>\r\n                                    <div className=\"flex items-center gap-4 mt-2 text-sm text-slate-500\">\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            🌱 {cycle.plantSpecies?.nameTH || 'N/A'}\r\n                                        </span>\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            📅 เริ่ม: {new Date(cycle.startDate).toLocaleDateString('th-TH')}\r\n                                        </span>\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            📜 Cert: {cycle.certificate?.certificateNumber || 'N/A'}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${cycle.status === 'ACTIVE' ? 'bg-emerald-100 text-emerald-700' :\r\n                                    cycle.status === 'HARVESTED' ? 'bg-blue-100 text-blue-700' :\r\n                                        'bg-slate-100 text-slate-600'\r\n                                    }`}>\r\n                                    {cycle.status}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\EnhancedValidation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327,330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327,330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/EnhancedValidation.tsx\r\n\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface ValidationRule {\r\n  pattern: RegExp;\r\n  message: string;\r\n  isValid: (value: string) => boolean;\r\n}\r\n\r\ninterface EnhancedValidationProps {\r\n  onValidationComplete: (isValid: boolean, data: any) => void;\r\n}\r\n\r\nconst EnhancedValidation: React.FC<EnhancedValidationProps> = ({ onValidationComplete }) => {\r\n  const [formData, setFormData] = useState({\r\n    thaiId: '',\r\n    taxId: '',\r\n    phoneNumber: '',\r\n    email: ''\r\n  });\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [validations, setValidations] = useState<Record<string, boolean>>({});\r\n\r\n  const validationRules: Record<string, ValidationRule> = {\r\n    thaiId: {\r\n      pattern: /^\\d{13}$/,\r\n      message: 'เลขบัตรประชาชนต้องมี 13 หลัก',\r\n      isValid: (value: string) => {\r\n        if (!/^\\d{13}$/.test(value)) return false;\r\n\r\n        // Thai ID checksum validation\r\n        const digits = value.split('').map(Number);\r\n        const sum = digits.slice(0, 12).reduce((acc, digit, index) => acc + digit * (13 - index), 0);\r\n        const checksum = (11 - (sum % 11)) % 10;\r\n\r\n        return checksum === digits[12];\r\n      }\r\n    },\r\n    taxId: {\r\n      pattern: /^\\d{13}$/,\r\n      message: 'เลขทะเบียนนิติบุคคลต้องมี 13 หลัก',\r\n      isValid: (value: string) => /^\\d{13}$/.test(value)\r\n    },\r\n    phoneNumber: {\r\n      pattern: /^0[689]\\d{8}$/,\r\n      message: 'เบอร์โทรศัพท์ต้องขึ้นต้นด้วย 06, 08, หรือ 09 และมี 10 หลัก',\r\n      isValid: (value: string) => /^0[689]\\d{8}$/.test(value)\r\n    },\r\n    email: {\r\n      pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\r\n      message: 'รูปแบบอีเมลไม่ถูกต้อง',\r\n      isValid: (value: string) => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value)\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (field: string, value: string) => {\r\n    const cleanValue = value.replace(/[^0-9]/g, ''); // For numeric fields\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [field]: field === 'email' ? value : cleanValue\r\n    }));\r\n\r\n    // Real-time validation\r\n    if (value.length > 0) {\r\n      const rule = validationRules[field];\r\n      const isValid = rule.isValid(field === 'email' ? value : cleanValue);\r\n\r\n      setValidations(prev => ({\r\n        ...prev,\r\n        [field]: isValid\r\n      }));\r\n\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [field]: isValid ? '' : rule.message\r\n      }));\r\n    } else {\r\n      setValidations(prev => ({\r\n        ...prev,\r\n        [field]: false\r\n      }));\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [field]: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    const allValid = Object.keys(validations).every(key => validations[key]);\r\n    const hasData = Object.values(formData).some(value => value.length > 0);\r\n\r\n    if (hasData && allValid) {\r\n      onValidationComplete(true, formData);\r\n    } else {\r\n      onValidationComplete(false, { error: 'กรุณากรอกข้อมูลให้ถูกต้อง' });\r\n    }\r\n  };\r\n\r\n  const inputConfigs: { key: keyof typeof formData; label: string; placeholder: string; type: string; maxLength: number }[] = [\r\n    { key: 'thaiId', label: 'เลขบัตรประชาชน', placeholder: '13 หลัก', type: 'text', maxLength: 13 },\r\n    { key: 'taxId', label: 'เลขทะเบียนนิติบุคคล', placeholder: '13 หลัก', type: 'text', maxLength: 13 },\r\n    { key: 'phoneNumber', label: 'เบอร์โทรศัพท์', placeholder: '0xxxxxxxxx', type: 'tel', maxLength: 10 },\r\n    { key: 'email', label: 'อีเมล', placeholder: 'example@email.com', type: 'email', maxLength: 100 }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"gacp-card p-6 shadow-soft\">\r\n      <h3 className=\"text-xl font-black text-slate-800 mb-6 border-b border-slate-50 pb-6 flex items-center gap-3\">\r\n        <div className=\"w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center text-primary\">\r\n          ✅\r\n        </div>\r\n        การตรวจสอบข้อมูลขั้นสูง\r\n      </h3>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {inputConfigs.map(({ key, label, placeholder, type, maxLength }) => (\r\n          <div key={key}>\r\n            <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n              {label}\r\n            </label>\r\n            <div className=\"relative\">\r\n              <input\r\n                type={type}\r\n                value={formData[key]}\r\n                onChange={(e) => handleInputChange(key, e.target.value)}\r\n                maxLength={maxLength}\r\n                placeholder={placeholder}\r\n                className={`w-full p-3 border-2 rounded-lg pr-10 ${errors[key]\r\n                    ? 'border-rose-300 bg-rose-50'\r\n                    : validations[key]\r\n                      ? 'border-emerald-300 bg-emerald-50'\r\n                      : 'border-slate-200'\r\n                  }`}\r\n              />\r\n              <div className=\"absolute right-3 top-3\">\r\n                {validations[key] && (\r\n                  <span className=\"text-emerald-600\">✓</span>\r\n                )}\r\n                {errors[key] && (\r\n                  <span className=\"text-rose-600\">✗</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {errors[key] && (\r\n              <p className=\"text-sm text-rose-600 mt-1\">{errors[key]}</p>\r\n            )}\r\n            {validations[key] && (\r\n              <p className=\"text-sm text-emerald-600 mt-1\">✅ ข้อมูลถูกต้อง</p>\r\n            )}\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"pt-4\">\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full gacp-btn-primary\"\r\n          >\r\n            ตรวจสอบข้อมูลทั้งหมด\r\n          </button>\r\n        </div>\r\n      </form>\r\n\r\n      <div className=\"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n        <h4 className=\"font-semibold text-blue-800 mb-2\">🔍 คำแนะนำการตรวจสอบ</h4>\r\n        <ul className=\"text-sm text-blue-700 space-y-1\">\r\n          <li>• เลขบัตรประชาชน: ตรวจสอบ checksum และรูปแบบ</li>\r\n          <li>• เลขทะเบียนนิติบุคคล: ตรวจสอบรูปแบบ 13 หลัก</li>\r\n          <li>• เบอร์โทรศัพท์: ตรวจสอบรูปแบบมือถือไทย</li>\r\n          <li>• อีเมล: ตรวจสอบรูปแบบอีเมลมาตรฐาน</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EnhancedValidation;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\NotificationSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":41,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/NotificationSettings.tsx\r\n\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface NotificationSettings {\r\n  email: boolean;\r\n  sms: boolean;\r\n  push: boolean;\r\n  applicationStatus: boolean;\r\n  paymentReminder: boolean;\r\n  systemUpdates: boolean;\r\n  marketingEmails: boolean;\r\n}\r\n\r\ninterface NotificationSettingsProps {\r\n  settings: NotificationSettings;\r\n  onSettingsChange: (settings: NotificationSettings) => void;\r\n}\r\n\r\nconst NotificationSettings: React.FC<NotificationSettingsProps> = ({ settings, onSettingsChange }) => {\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const handleToggle = async (key: keyof NotificationSettings) => {\r\n    const newSettings = { ...settings, [key]: !settings[key] };\r\n\r\n    setSaving(true);\r\n    try {\r\n      const response = await fetch('/api/auth/notifications', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(newSettings),\r\n      });\r\n\r\n      if (response.ok) {\r\n        onSettingsChange(newSettings);\r\n      } else {\r\n        const error = await response.json();\r\n        alert('บันทึกการตั้งค่าไม่สำเร็จ: ' + (error.message || 'Unknown error'));\r\n      }\r\n    } catch (error) {\r\n      alert('บันทึกการตั้งค่าไม่สำเร็จ');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const notificationTypes: { key: keyof NotificationSettings; label: string; description: string }[] = [\r\n    { key: 'email', label: 'อีเมล', description: 'รับแจ้งเตือนเกี่ยวกับใบสนคร' },\r\n    { key: 'sms', label: 'SMS', description: 'แจ้งเตือนผ่าน SMS' },\r\n    { key: 'push', label: 'Push', description: 'แจ้งเตือนในแอปพลิเคชั่น' },\r\n    { key: 'applicationStatus', label: 'สถานะคำสมัคร', description: 'เมื่อสถานะเปลี่ยน' },\r\n    { key: 'paymentReminder', label: 'การชำระเงิน', description: 'แจ้งเตือนก่อนชำระเงิน' },\r\n    { key: 'systemUpdates', label: 'อัพเดตระบบ', description: 'การอัพเดตระบบระบบ' },\r\n    { key: 'marketingEmails', label: 'การตลาดการ', description: 'ข้อมูลสินค้าและโปรโมชั่น' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"gacp-card p-6 shadow-soft\">\r\n      <h3 className=\"text-xl font-black text-slate-800 mb-6 border-b border-slate-50 pb-6 flex items-center gap-3\">\r\n        <div className=\"w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center text-primary\">\r\n          🔔\r\n        </div>\r\n        การตั้งค่าการแจ้งเตือน\r\n      </h3>\r\n\r\n      <div className=\"space-y-4\">\r\n        {notificationTypes.map(({ key, label, description }) => (\r\n          <div key={key} className=\"flex items-center justify-between py-3 border-b border-slate-100\">\r\n            <div>\r\n              <div className=\"font-medium text-slate-700\">{label}</div>\r\n              <div className=\"text-sm text-slate-500\">{description}</div>\r\n            </div>\r\n            <button\r\n              onClick={() => handleToggle(key)}\r\n              disabled={saving}\r\n              className={`w-12 h-6 rounded-full transition-colors ${settings[key]\r\n                  ? 'bg-primary text-white'\r\n                  : 'bg-slate-200 text-slate-600 hover:bg-slate-300'\r\n                }`}\r\n            >\r\n              {settings[key] && (\r\n                <span className=\"text-white text-xs\">✓</span>\r\n              )}\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"mt-6 flex justify-end\">\r\n        <button\r\n          onClick={() => alert('การตั้งค่าถูกบันทึก')}\r\n          className=\"gacp-btn-primary\"\r\n        >\r\n          บันทึกการตั้งค่า\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationSettings;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\PasswordChange.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":75,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/PasswordChange.tsx\r\n\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface PasswordChangeProps {\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst PasswordChange: React.FC<PasswordChangeProps> = ({ onSuccess }) => {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: ''\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [errors, setErrors] = useState<string[]>([]);\r\n\r\n  const validatePassword = (password: string) => {\r\n    const minLength = password.length >= 8;\r\n    const hasUpperCase = /[A-Z]/.test(password);\r\n    const hasLowerCase = /[a-z]/.test(password);\r\n    const hasNumbers = /\\d/.test(password);\r\n    const hasSpecialChar = /[!@#$%^&*]/.test(password);\r\n    \r\n    return minLength && hasUpperCase && hasLowerCase && hasNumbers && hasSpecialChar;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setErrors([]);\r\n    \r\n    // Validation\r\n    const newErrors: string[] = [];\r\n    \r\n    if (!formData.currentPassword) {\r\n      newErrors.push('กรุณากรอกรหัสผ่านปัจจุบัน');\r\n    }\r\n    \r\n    if (!validatePassword(formData.newPassword)) {\r\n      newErrors.push('รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร ใหญ่ เล็กตัวเลข และอักขระวางพิเศษ');\r\n    }\r\n    \r\n    if (formData.newPassword !== formData.confirmPassword) {\r\n      newErrors.push('รหัสผ่านใหม่ไม่ตรงกัน');\r\n    }\r\n    \r\n    if (newErrors.length > 0) {\r\n      setErrors(newErrors);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    \r\n    try {\r\n      const response = await fetch('/api/auth/change-password', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          currentPassword: formData.currentPassword,\r\n          newPassword: formData.newPassword\r\n        }),\r\n      });\r\n      \r\n      if (response.ok) {\r\n        alert('เปลี่ยนรหัสผ่านสำเร็จ');\r\n        setShowForm(false);\r\n        setFormData({ currentPassword: '', newPassword: '', confirmPassword: '' });\r\n        onSuccess();\r\n      } else {\r\n        const error = await response.json();\r\n        setErrors([error.message || 'เปลี่ยนรหัสผ่านไม่สำเร็จ']);\r\n      }\r\n    } catch (error) {\r\n      setErrors(['เกิดข้อผิดพลาด กรุณาลองใหม่']);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"gacp-card p-6 shadow-soft\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-xl font-black text-slate-800\">จัดการรหัสผ่าน</h3>\r\n        <button\r\n          onClick={() => setShowForm(!showForm)}\r\n          className=\"gacp-btn-secondary\"\r\n        >\r\n          {showForm ? 'ยกเลิก' : 'เปลี่ยน'}\r\n        </button>\r\n      </div>\r\n\r\n      {showForm && (\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          {errors.map((error, index) => (\r\n            <div key={index} className=\"bg-rose-50 border border-rose-200 text-rose-600 p-3 rounded-lg text-sm\">\r\n              {error}\r\n            </div>\r\n          ))}\r\n          \r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n              รหัสผ่านปัจจุบัน\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              value={formData.currentPassword}\r\n              onChange={(e) => setFormData({...formData, currentPassword: e.target.value})}\r\n              className=\"w-full p-3 border-2 rounded-lg\"\r\n              placeholder=\"กรอกรหัสผ่านปัจจุบัน\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n              รหัสผ่านใหม่\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              value={formData.newPassword}\r\n              onChange={(e) => setFormData({...formData, newPassword: e.target.value})}\r\n              className=\"w-full p-3 border-2 rounded-lg\"\r\n              placeholder=\"รหัสผ่านใหม่ (อย่างน้อย 8 ตัว)\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 mb-2\">\r\n              ยืนยันรหัสผ่านใหม่\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              value={formData.confirmPassword}\r\n              onChange={(e) => setFormData({...formData, confirmPassword: e.target.value})}\r\n              className=\"w-full p-3 border-2 rounded-lg\"\r\n              placeholder=\"ยืนยันรหัสผ่านใหม่\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex gap-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowForm(false)}\r\n              className=\"flex-1 gacp-btn-secondary\"\r\n            >\r\n              ยกเลิก\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"flex-1 gacp-btn-primary disabled:opacity-50\"\r\n            >\r\n              {loading ? 'กำลังดำเนินการ...' : 'เปลี่ยนรหัสผ่าน'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PasswordChange;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\PrivacySettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[711,714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[711,714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":40,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/PrivacySettings.tsx\r\n\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface PrivacySettings {\r\n  profileVisibility: 'public' | 'private' | 'connections';\r\n  dataSharing: boolean;\r\n  marketingCommunications: boolean;\r\n  activityVisibility: boolean;\r\n  locationSharing: boolean;\r\n  analyticsTracking: boolean;\r\n}\r\n\r\ninterface PrivacySettingsProps {\r\n  settings: PrivacySettings;\r\n  onSettingsChange: (settings: PrivacySettings) => void;\r\n}\r\n\r\nconst PrivacySettings: React.FC<PrivacySettingsProps> = ({ settings, onSettingsChange }) => {\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const handleToggle = async (key: keyof PrivacySettings, value?: any) => {\r\n    const newSettings = { ...settings, [key]: value !== undefined ? value : !settings[key] };\r\n\r\n    setSaving(true);\r\n    try {\r\n      const response = await fetch('/api/auth/privacy', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(newSettings),\r\n      });\r\n\r\n      if (response.ok) {\r\n        onSettingsChange(newSettings);\r\n      } else {\r\n        const error = await response.json();\r\n        alert('บันทึกการตั้งค่าไม่สำเร็จ: ' + (error.message || 'Unknown error'));\r\n      }\r\n    } catch (error) {\r\n      alert('บันทึกการตั้งค่าไม่สำเร็จ');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const privacyOptions: { key: keyof PrivacySettings; label: string; description: string; type: 'select' | 'toggle'; options?: { value: string; label: string }[] }[] = [\r\n    {\r\n      key: 'profileVisibility',\r\n      label: 'การมองเห็นโปรไฟล์',\r\n      description: 'ควบคุมว่าใครสามารถมองเห็นโปรไฟล์ของคุณได้',\r\n      type: 'select',\r\n      options: [\r\n        { value: 'public', label: 'สาธารณะ - ทุกคนมองเห็นได้' },\r\n        { value: 'private', label: 'ส่วนตัว - เฉพาะคุณเท่านั้น' },\r\n        { value: 'connections', label: 'เฉพาะผู้ที่เชื่อมต่อ' }\r\n      ]\r\n    },\r\n    { key: 'dataSharing', label: 'การแชร์ข้อมูล', description: 'อนุญาตให้ใช้ข้อมูลสำหรับการวิเคราะห์', type: 'toggle' },\r\n    { key: 'marketingCommunications', label: 'การสื่อสารทางการตลาด', description: 'รับข้อมูลโปรโมชั่นและข่าวสาร', type: 'toggle' },\r\n    { key: 'activityVisibility', label: 'การมองเห็นกิจกรรม', description: 'แสดงกิจกรรมล่าสุดในโปรไฟล์', type: 'toggle' },\r\n    { key: 'locationSharing', label: 'การแชร์ตำแหน่ง', description: 'แชร์ตำแหน่งของฟาร์มในโปรไฟล์สาธารณะ', type: 'toggle' },\r\n    { key: 'analyticsTracking', label: 'การติดตามวิเคราะห์', description: 'ช่วยปรับปรุงประสบการณ์การใช้งาน', type: 'toggle' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"gacp-card p-6 shadow-soft\">\r\n      <h3 className=\"text-xl font-black text-slate-800 mb-6 border-b border-slate-50 pb-6 flex items-center gap-3\">\r\n        <div className=\"w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center text-primary\">\r\n          🔒\r\n        </div>\r\n        การตั้งค่าความเป็นส่วนตัว\r\n      </h3>\r\n\r\n      <div className=\"space-y-6\">\r\n        {privacyOptions.map(({ key, label, description, type, options }) => (\r\n          <div key={key} className=\"flex items-center justify-between py-4 border-b border-slate-100\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"font-medium text-slate-700\">{label}</div>\r\n              <div className=\"text-sm text-slate-500 mt-1\">{description}</div>\r\n            </div>\r\n\r\n            {type === 'toggle' ? (\r\n              <button\r\n                onClick={() => handleToggle(key)}\r\n                disabled={saving}\r\n                className={`w-12 h-6 rounded-full transition-colors ${settings[key]\r\n                  ? 'bg-primary text-white'\r\n                  : 'bg-slate-200 text-slate-600 hover:bg-slate-300'\r\n                  }`}\r\n              >\r\n                {settings[key] && (\r\n                  <span className=\"text-white text-xs\">✓</span>\r\n                )}\r\n              </button>\r\n            ) : (\r\n              <select\r\n                value={settings[key] as string}\r\n                onChange={(e) => handleToggle(key, e.target.value)}\r\n                disabled={saving}\r\n                className=\"px-3 py-2 border-2 rounded-lg bg-white text-slate-700 focus:outline-none focus:border-primary\"\r\n              >\r\n                {options?.map((option) => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"mt-6 p-4 bg-amber-50 rounded-lg border border-amber-200\">\r\n        <h4 className=\"font-semibold text-amber-800 mb-2\">📋 ข้อมูลความเป็นส่วนตัว</h4>\r\n        <ul className=\"text-sm text-amber-700 space-y-1\">\r\n          <li>• ข้อมูลส่วนตัวของคุณได้รับการคุ้มครองตามกฎหมายคุ้มครองข้อมูลส่วนบุคคล</li>\r\n          <li>• เราไม่เปิดเผยข้อมูลให้บุคคลภายนอกโดยไม่ได้รับอนุญาต</li>\r\n          <li>• คุณสามารถแก้ไขการตั้งค่าได้ตลอดเวลา</li>\r\n          <li>• ข้อมูลที่ลบไปแล้วไม่สามารถกู้คืนได้</li>\r\n        </ul>\r\n      </div>\r\n\r\n      <div className=\"mt-6 flex justify-between\">\r\n        <button\r\n          onClick={() => {\r\n            if (confirm('คุณต้องการคืนค่าการตั้งค่าเป็นค่าเริ่มต้นหรือไม่?')) {\r\n              const defaultSettings: PrivacySettings = {\r\n                profileVisibility: 'public',\r\n                dataSharing: false,\r\n                marketingCommunications: false,\r\n                activityVisibility: true,\r\n                locationSharing: false,\r\n                analyticsTracking: true,\r\n              };\r\n              handleToggle('profileVisibility', defaultSettings.profileVisibility);\r\n              // Handle other settings...\r\n            }\r\n          }}\r\n          className=\"gacp-btn-secondary\"\r\n        >\r\n          คืนค่าเริ่มต้น\r\n        </button>\r\n\r\n        <button\r\n          onClick={() => alert('การตั้งค่าถูกบันทึกแล้ว')}\r\n          className=\"gacp-btn-primary\"\r\n        >\r\n          บันทึกการตั้งค่า\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PrivacySettings;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\ProfilePicture.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleUpload' is assigned a value but never used.","line":41,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":62,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":73,"column":11,"nodeType":"JSXOpeningElement","endLine":73,"endColumn":85},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":75,"column":11,"nodeType":"JSXOpeningElement","endLine":75,"endColumn":90}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/ProfilePicture.tsx\r\n\"use client\";\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { IconUser, IconCamera } from '@/components/ui/icons';\r\n\r\ninterface ProfilePictureProps {\r\n  currentImage?: string;\r\n  onImageChange: (imageUrl: string) => void;\r\n  isEditing: boolean;\r\n}\r\n\r\nconst ProfilePicture: React.FC<ProfilePictureProps> = ({ currentImage, onImageChange, isEditing }) => {\r\n  const [uploading, setUploading] = useState(false);\r\n  const [preview, setPreview] = useState<string | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      // Validate file type and size\r\n      if (!file.type.startsWith('image/')) {\r\n        alert('กรุณาเลือกไฟล์รูปภาพเท่านั้น');\r\n        return;\r\n      }\r\n      \r\n      if (file.size > 5 * 1024 * 1024) { // 5MB limit\r\n        alert('รูปภาพต้องมีขนาดไม่เกิน 5MB');\r\n        return;\r\n      }\r\n\r\n      // Create preview\r\n      const reader = new FileReader();\r\n      reader.onloadend = (e) => {\r\n        setPreview(e.target?.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleUpload = async () => {\r\n    if (!fileInputRef.current?.files?.[0]) return;\r\n    \r\n    setUploading(true);\r\n    const formData = new FormData();\r\n    formData.append('profileImage', fileInputRef.current.files[0]);\r\n    \r\n    try {\r\n      const response = await fetch('/api/auth/profile/image', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        onImageChange(result.profileImage);\r\n        setPreview(null);\r\n        if (fileInputRef.current) {\r\n          fileInputRef.current.value = '';\r\n        }\r\n      }\r\n    } catch (error) {\r\n      alert('อัพโหลดรูปภาพไม่สำเร็จ');\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative group\">\r\n      <div className=\"w-32 h-32 bg-white rounded-full shadow-elevated mx-auto mb-6 flex items-center justify-center border-4 border-white overflow-hidden\">\r\n        {preview ? (\r\n          <img src={preview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n        ) : currentImage ? (\r\n          <img src={currentImage} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n        ) : (\r\n          <IconUser className=\"w-16 h-16 text-slate-400\" />\r\n        )}\r\n      </div>\r\n      \r\n      {isEditing && (\r\n        <>\r\n          <button \r\n            onClick={() => fileInputRef.current?.click()}\r\n            className=\"absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full shadow-lg hover:bg-primary/90 transition-all\"\r\n            disabled={uploading}\r\n          >\r\n            {uploading ? (\r\n              <div className=\"w-4 h-4 border-2 border-white border-t-transparent animate-spin\" />\r\n            ) : (\r\n              <IconCamera className=\"w-4 h-4\" />\r\n            )}\r\n          </button>\r\n          \r\n          <input\r\n            ref={fileInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            onChange={handleFileSelect}\r\n            className=\"hidden\"\r\n          />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfilePicture;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\TwoFactorAuth.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":30,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":57,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":79,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":121,"column":17,"nodeType":"JSXOpeningElement","endLine":121,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/app/farmer/profile/components/TwoFactorAuth.tsx\r\n\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\n\r\ninterface TwoFactorAuthProps {\r\n  isEnabled: boolean;\r\n  onToggle: (enabled: boolean) => void;\r\n}\r\n\r\nconst TwoFactorAuth: React.FC<TwoFactorAuthProps> = ({ isEnabled, onToggle }) => {\r\n  const [showSetup, setShowSetup] = useState(false);\r\n  const [qrCode, setQrCode] = useState('');\r\n  const [backupCodes, setBackupCodes] = useState<string[]>([]);\r\n  const [verifying, setVerifying] = useState(false);\r\n  const [verificationCode, setVerificationCode] = useState('');\r\n\r\n  const handleSetup = async () => {\r\n    try {\r\n      const response = await fetch('/api/auth/2fa/setup', {\r\n        method: 'POST',\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setQrCode(data.qrCode);\r\n        setBackupCodes(data.backupCodes);\r\n        setShowSetup(true);\r\n      }\r\n    } catch (error) {\r\n      alert('ไม่สามารถตั้งค่า 2FA');\r\n    }\r\n  };\r\n\r\n  const handleVerify = async () => {\r\n    if (verificationCode.length !== 6) {\r\n      alert('กรุณากรอกรหัสผ่าน 6 หลัก');\r\n      return;\r\n    }\r\n\r\n    setVerifying(true);\r\n    try {\r\n      const response = await fetch('/api/auth/2fa/verify', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ code: verificationCode }),\r\n      });\r\n      \r\n      if (response.ok) {\r\n        alert('2FA ถูกเปิดใช้งานสำเร็จ');\r\n        onToggle(true);\r\n        setShowSetup(false);\r\n        setVerificationCode('');\r\n      } else {\r\n        alert('รหัสผ่าน 2FA ไม่ถูกต้อง');\r\n      }\r\n    } catch (error) {\r\n      alert('การยืนยันรหัสผ่าน 2FA ล้มเหลว');\r\n    } finally {\r\n      setVerifying(false);\r\n    }\r\n  };\r\n\r\n  const handleDisable = async () => {\r\n    if (!confirm('คุณต้องการปิดการใช้งาน 2FA หรือไม่?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/api/auth/2fa/disable', {\r\n        method: 'POST',\r\n      });\r\n      \r\n      if (response.ok) {\r\n        alert('2FA ถูกปิดใช้งานสำเร็จ');\r\n        onToggle(false);\r\n        setShowSetup(false);\r\n      }\r\n    } catch (error) {\r\n      alert('ไม่สามารถปิดการใช้งาน 2FA');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"gacp-card p-6 shadow-soft\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-xl font-black text-slate-800 flex items-center gap-3\">\r\n          <div className=\"w-6 h-6 bg-primary/10 rounded-lg flex items-center justify-center text-primary\">\r\n            🔒\r\n          </div>\r\n          การตรวจสอบสอบตัว 2 ชั้น\r\n        </h3>\r\n        <button\r\n          onClick={() => isEnabled ? handleDisable() : handleSetup()}\r\n          className={`gacp-btn-${isEnabled ? 'secondary' : 'primary'}`}\r\n        >\r\n          {isEnabled ? 'ปิด' : 'เปิด'}\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"mb-4\">\r\n        <span className=\"text-sm text-slate-600\">\r\n          สถานะ 2FA: <span className={`font-semibold ${isEnabled ? 'text-emerald-600' : 'text-amber-600'}`}>\r\n            {isEnabled ? 'เปิดใช้งาน' : 'ปิดใช้งาน'}\r\n          </span>\r\n        </span>\r\n      </div>\r\n\r\n      {showSetup && !isEnabled && (\r\n        <div className=\"mt-6 p-6 bg-slate-50 rounded-2xl\">\r\n          <h4 className=\"text-lg font-semibold mb-4 text-center\">\r\n            ตั้งค่า 2FA\r\n          </h4>\r\n          \r\n          <div className=\"text-center\">\r\n            <p className=\"text-sm text-slate-600 mb-4\">\r\n              สแกน QR code ด้วยแอปพลิเคชั่น Authenticator\r\n            </p>\r\n            <div className=\"w-48 h-48 bg-white p-4 rounded-xl mx-auto mb-4 border-2 border-slate-200\">\r\n              {qrCode ? (\r\n                <img src={qrCode} alt=\"2FA QR Code\" className=\"w-full h-full\" />\r\n              ) : (\r\n                <div className=\"w-full h-full flex items-center justify-center text-slate-400\">\r\n                  กำลังโหลด...\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"space-y-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"กรอกรหัสผ่าน 6 หลัก\"\r\n                maxLength={6}\r\n                value={verificationCode}\r\n                onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, ''))}\r\n                className=\"w-full p-3 border-2 rounded-lg text-center text-2xl font-mono\"\r\n              />\r\n              <button\r\n                onClick={handleVerify}\r\n                disabled={verifying || verificationCode.length !== 6}\r\n                className=\"w-full gacp-btn-primary disabled:opacity-50\"\r\n              >\r\n                {verifying ? 'กำลังยืนยัน...' : 'ยืนยัน'}\r\n              </button>\r\n            </div>\r\n            \r\n            <div className=\"mt-4 p-4 bg-amber-50 rounded-lg\">\r\n              <h5 className=\"font-semibold text-amber-800 mb-2\">รหัสผ่านสำรอง:</h5>\r\n              <div className=\"text-sm text-amber-700 font-mono space-y-1\">\r\n                {backupCodes.map((code, index) => (\r\n                  <div key={index}>{code}</div>\r\n                ))}\r\n              </div>\r\n              <p className=\"text-xs text-amber-600 mt-2\">\r\n                จัดเก็บรหัสเหล่านี้ไว้ในที่ปลอดภัย\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showSetup && isEnabled && (\r\n        <div className=\"mt-6 p-6 bg-slate-50 rounded-2xl\">\r\n          <h4 className=\"text-lg font-semibold mb-4 text-center\">\r\n            จัดการ 2FA\r\n          </h4>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <button\r\n              onClick={() => alert('รหัสผ่านสำรองถูกส่งไปยังอีเมลของคุณ')}\r\n              className=\"w-full gacp-btn-secondary\"\r\n            >\r\n              ส่งรหัสผ่านสำรอง\r\n            </button>\r\n            <button\r\n              onClick={() => setShowSetup(false)}\r\n              className=\"w-full gacp-btn-secondary\"\r\n            >\r\n              ปิด\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TwoFactorAuth;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\profile\\page.tsx:67:9\n  65 |     useEffect(() => {\n  66 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 67 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  68 |         const fetchProfile = async () => {\n  69 |             const res = await api.get<User>('/auth/me');\n  70 |             if (res.success && res.data) {","line":67,"column":9,"nodeType":null,"endLine":67,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\tracking\\cycles\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":179,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\n\r\ninterface PlantSpecies {\r\n    id: string;\r\n    code: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n}\r\n\r\ninterface Certificate {\r\n    id: string;\r\n    certificateNumber: string;\r\n    expiryDate: string;\r\n}\r\n\r\ninterface PlantingCycle {\r\n    id: string;\r\n    cycleName: string;\r\n    cycleNumber: number;\r\n    status: string;\r\n    startDate: string;\r\n    expectedHarvestDate: string;\r\n    actualHarvestDate: string | null;\r\n    plotName: string;\r\n    plotArea: number;\r\n    estimatedYield: number;\r\n    actualYield: number | null;\r\n    plantSpecies: {\r\n        nameTH: string;\r\n        nameEN: string;\r\n    };\r\n    certificate: Certificate | null;\r\n    _count: {\r\n        batches: number;\r\n    };\r\n}\r\n\r\ninterface CreateFormData {\r\n    speciesId: string;\r\n    certificateId: string;\r\n    plotName: string;\r\n    plotArea: number;\r\n    startDate: string;\r\n    expectedHarvestDate: string;\r\n    estimatedYield: number;\r\n    notes: string;\r\n}\r\n\r\nconst statusConfig: Record<string, { label: string; color: string }> = {\r\n    PLANNING: { label: 'วางแผน', color: 'bg-gray-100 text-gray-700' },\r\n    PLANTED: { label: 'ปลูกแล้ว', color: 'bg-blue-100 text-blue-700' },\r\n    GROWING: { label: 'กำลังเติบโต', color: 'bg-green-100 text-green-700' },\r\n    READY_HARVEST: { label: 'พร้อมเก็บเกี่ยว', color: 'bg-yellow-100 text-yellow-700' },\r\n    HARVESTED: { label: 'เก็บเกี่ยวแล้ว', color: 'bg-emerald-100 text-emerald-700' },\r\n    COMPLETED: { label: 'เสร็จสิ้น', color: 'bg-purple-100 text-purple-700' },\r\n};\r\n\r\nconst defaultFormData: CreateFormData = {\r\n    speciesId: '',\r\n    certificateId: '',\r\n    plotName: '',\r\n    plotArea: 0,\r\n    startDate: new Date().toISOString().split('T')[0],\r\n    expectedHarvestDate: '',\r\n    estimatedYield: 0,\r\n    notes: ''\r\n};\r\n\r\nexport default function PlantingCyclesPage() {\r\n    const [cycles, setCycles] = useState<PlantingCycle[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [formData, setFormData] = useState<CreateFormData>(defaultFormData);\r\n    const [species, setSpecies] = useState<PlantSpecies[]>([]);\r\n    const [certificates, setCertificates] = useState<Certificate[]>([]);\r\n    const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n    // Get farmId from localStorage\r\n    const [farmId, setFarmId] = useState<string>('');\r\n\r\n    useEffect(() => {\r\n        const storedFarmId = localStorage.getItem('currentFarmId') || localStorage.getItem('farmId');\r\n        if (storedFarmId) {\r\n            setFarmId(storedFarmId);\r\n        }\r\n        fetchCycles();\r\n        fetchSpecies();\r\n        fetchCertificates();\r\n    }, []);\r\n\r\n    async function fetchCycles() {\r\n        try {\r\n            const storedFarmId = localStorage.getItem('currentFarmId') || localStorage.getItem('farmId');\r\n            if (!storedFarmId) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n            const res = await fetch(`/api/proxy/planting-cycles?farmId=${storedFarmId}`);\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setCycles(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching cycles:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function fetchSpecies() {\r\n        try {\r\n            const res = await fetch('/api/proxy/plants');\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setSpecies(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching species:', error);\r\n        }\r\n    }\r\n\r\n    async function fetchCertificates() {\r\n        try {\r\n            const res = await fetch('/api/proxy/certificates/my');\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setCertificates(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching certificates:', error);\r\n        }\r\n    }\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        if (!dateStr) return '-';\r\n        return new Date(dateStr).toLocaleDateString('th-TH', {\r\n            year: 'numeric',\r\n            month: 'short',\r\n            day: 'numeric'\r\n        });\r\n    };\r\n\r\n    async function handleCreate(e: React.FormEvent) {\r\n        e.preventDefault();\r\n        if (!farmId) {\r\n            setMessage({ type: 'error', text: 'กรุณาเลือกฟาร์มก่อน' });\r\n            return;\r\n        }\r\n\r\n        setSaving(true);\r\n        setMessage(null);\r\n\r\n        try {\r\n            const res = await fetch('/api/proxy/planting-cycles', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    farmId,\r\n                    ...formData,\r\n                    plotArea: parseFloat(formData.plotArea.toString()),\r\n                    estimatedYield: parseFloat(formData.estimatedYield.toString())\r\n                })\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (data.success) {\r\n                setMessage({ type: 'success', text: 'สร้างรอบการปลูกสำเร็จ' });\r\n                setShowCreateModal(false);\r\n                setFormData(defaultFormData);\r\n                fetchCycles();\r\n            } else {\r\n                setMessage({ type: 'error', text: data.message || 'เกิดข้อผิดพลาด' });\r\n            }\r\n        } catch (error) {\r\n            setMessage({ type: 'error', text: 'เกิดข้อผิดพลาดในการเชื่อมต่อ' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-6\">\r\n                <div className=\"animate-pulse space-y-4\">\r\n                    <div className=\"h-8 bg-gray-200 rounded w-1/4\"></div>\r\n                    <div className=\"h-32 bg-gray-200 rounded\"></div>\r\n                    <div className=\"h-32 bg-gray-200 rounded\"></div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-6\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-800\">🌱 รอบการปลูก</h1>\r\n                    <p className=\"text-gray-500\">จัดการรอบการปลูกและเก็บเกี่ยว</p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowCreateModal(true)}\r\n                    className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center\"\r\n                >\r\n                    <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                    </svg>\r\n                    สร้างรอบใหม่\r\n                </button>\r\n            </div>\r\n\r\n            {/* Message */}\r\n            {message && (\r\n                <div className={`mb-4 p-4 rounded-lg ${message.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>\r\n                    {message.text}\r\n                </div>\r\n            )}\r\n\r\n            {/* No farmId warning */}\r\n            {!farmId && (\r\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-6\">\r\n                    <div className=\"flex items-center text-yellow-700\">\r\n                        <svg className=\"w-5 h-5 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                        </svg>\r\n                        <span>กรุณาเลือกฟาร์มก่อนเริ่มใช้งาน (ไปที่หน้าฟาร์มของฉัน)</span>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm border\">\r\n                    <div className=\"text-3xl font-bold text-blue-600\">{cycles.length}</div>\r\n                    <div className=\"text-gray-500 text-sm\">รอบทั้งหมด</div>\r\n                </div>\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm border\">\r\n                    <div className=\"text-3xl font-bold text-green-600\">\r\n                        {cycles.filter(c => c.status === 'GROWING').length}\r\n                    </div>\r\n                    <div className=\"text-gray-500 text-sm\">กำลังปลูก</div>\r\n                </div>\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm border\">\r\n                    <div className=\"text-3xl font-bold text-yellow-600\">\r\n                        {cycles.filter(c => c.status === 'READY_HARVEST').length}\r\n                    </div>\r\n                    <div className=\"text-gray-500 text-sm\">พร้อมเก็บเกี่ยว</div>\r\n                </div>\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm border\">\r\n                    <div className=\"text-3xl font-bold text-emerald-600\">\r\n                        {cycles.filter(c => c.status === 'HARVESTED' || c.status === 'COMPLETED').length}\r\n                    </div>\r\n                    <div className=\"text-gray-500 text-sm\">เก็บเกี่ยวแล้ว</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Cycles List */}\r\n            {cycles.length === 0 ? (\r\n                <div className=\"bg-white rounded-xl shadow-sm border p-12 text-center\">\r\n                    <div className=\"text-6xl mb-4\">🌾</div>\r\n                    <h3 className=\"text-xl font-semibold text-gray-700 mb-2\">ยังไม่มีรอบการปลูก</h3>\r\n                    <p className=\"text-gray-500 mb-4\">เริ่มสร้างรอบการปลูกใหม่เพื่อติดตามผลผลิต</p>\r\n                    <button\r\n                        onClick={() => setShowCreateModal(true)}\r\n                        className=\"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n                    >\r\n                        สร้างรอบแรก\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    {cycles.map((cycle) => (\r\n                        <div key={cycle.id} className=\"bg-white rounded-xl shadow-sm border overflow-hidden hover:shadow-md transition-shadow\">\r\n                            <div className=\"p-6\">\r\n                                <div className=\"flex justify-between items-start\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold text-gray-800 mr-3\">\r\n                                                {cycle.cycleName}\r\n                                            </h3>\r\n                                            <span className={`px-3 py-1 rounded-full text-sm font-medium ${statusConfig[cycle.status]?.color || 'bg-gray-100'}`}>\r\n                                                {statusConfig[cycle.status]?.label || cycle.status}\r\n                                            </span>\r\n                                        </div>\r\n                                        <p className=\"text-gray-500\">\r\n                                            {cycle.plantSpecies.nameTH} • {cycle.plotName || 'ไม่ระบุแปลง'} • {cycle.plotArea || '-'} ไร่\r\n                                        </p>\r\n                                    </div>\r\n                                    <Link\r\n                                        href={`/tracking/cycles/${cycle.id}`}\r\n                                        className=\"px-4 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50\"\r\n                                    >\r\n                                        ดูรายละเอียด\r\n                                    </Link>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t\">\r\n                                    <div>\r\n                                        <div className=\"text-gray-500 text-sm\">วันปลูก</div>\r\n                                        <div className=\"font-medium\">{formatDate(cycle.startDate)}</div>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-gray-500 text-sm\">กำหนดเก็บ</div>\r\n                                        <div className=\"font-medium\">{formatDate(cycle.expectedHarvestDate)}</div>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-gray-500 text-sm\">ผลผลิตคาดการณ์</div>\r\n                                        <div className=\"font-medium\">{cycle.estimatedYield || '-'} กก.</div>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-gray-500 text-sm\">Batch</div>\r\n                                        <div className=\"font-medium\">{cycle._count?.batches || 0} รายการ</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {cycle.certificate && (\r\n                                    <div className=\"mt-4 pt-4 border-t flex items-center text-sm text-gray-500\">\r\n                                        <svg className=\"w-4 h-4 mr-2 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                                        </svg>\r\n                                        ใบรับรอง: {cycle.certificate.certificateNumber} (หมดอายุ: {formatDate(cycle.certificate.expiryDate)})\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Create Modal */}\r\n            {showCreateModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-6 border-b\">\r\n                            <h2 className=\"text-xl font-bold\">🌱 สร้างรอบการปลูกใหม่</h2>\r\n                        </div>\r\n                        <form onSubmit={handleCreate} className=\"p-6 space-y-4\">\r\n                            {/* Species */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ชนิดพืช *</label>\r\n                                <select\r\n                                    value={formData.speciesId}\r\n                                    onChange={(e) => setFormData({ ...formData, speciesId: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                    required\r\n                                >\r\n                                    <option value=\"\">-- เลือกชนิดพืช --</option>\r\n                                    {species.map(s => (\r\n                                        <option key={s.id} value={s.id}>{s.nameTH} ({s.nameEN})</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Certificate */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ใบรับรอง GACP</label>\r\n                                <select\r\n                                    value={formData.certificateId}\r\n                                    onChange={(e) => setFormData({ ...formData, certificateId: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                >\r\n                                    <option value=\"\">-- ไม่ระบุ --</option>\r\n                                    {certificates.map(c => (\r\n                                        <option key={c.id} value={c.id}>{c.certificateNumber}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Plot Name */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ชื่อแปลง *</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={formData.plotName}\r\n                                    onChange={(e) => setFormData({ ...formData, plotName: e.target.value })}\r\n                                    placeholder=\"เช่น แปลง A, แปลงริมน้ำ\"\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Plot Area */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">พื้นที่ (ไร่) *</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    step=\"0.01\"\r\n                                    value={formData.plotArea}\r\n                                    onChange={(e) => setFormData({ ...formData, plotArea: parseFloat(e.target.value) })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Start Date */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">วันที่เริ่มปลูก *</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={formData.startDate}\r\n                                    onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Expected Harvest Date */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">วันที่คาดว่าจะเก็บเกี่ยว</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={formData.expectedHarvestDate}\r\n                                    onChange={(e) => setFormData({ ...formData, expectedHarvestDate: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Estimated Yield */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ผลผลิตที่คาดการณ์ (กก.)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    step=\"0.1\"\r\n                                    value={formData.estimatedYield}\r\n                                    onChange={(e) => setFormData({ ...formData, estimatedYield: parseFloat(e.target.value) })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Notes */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">หมายเหตุ</label>\r\n                                <textarea\r\n                                    value={formData.notes}\r\n                                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                    rows={2}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex gap-3 pt-4\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setShowCreateModal(false)}\r\n                                    className=\"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50\"\r\n                                >\r\n                                    ยกเลิก\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={saving}\r\n                                    className=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50\"\r\n                                >\r\n                                    {saving ? 'กำลังบันทึก...' : 'สร้างรอบ'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\tracking\\lots\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBatches'. Either include it or remove the dependency array.","line":68,"column":8,"nodeType":"ArrayExpression","endLine":68,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBatches]","fix":{"range":[1720,1722],"text":"[fetchBatches]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":280,"column":37,"nodeType":"JSXOpeningElement","endLine":280,"endColumn":109}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useSearchParams } from 'next/navigation';\r\n\r\ninterface Lot {\r\n    id: string;\r\n    lotNumber: string;\r\n    packageType: string;\r\n    quantity: number;\r\n    unitWeight: number;\r\n    totalWeight: number;\r\n    status: string;\r\n    packagedAt: string;\r\n    expiryDate: string;\r\n    qrCode: string;\r\n    trackingUrl: string;\r\n    testStatus: string;\r\n    thcContent: number;\r\n    cbdContent: number;\r\n    batch: {\r\n        batchNumber: string;\r\n        harvestDate: string;\r\n        farm: {\r\n            farmName: string;\r\n        };\r\n        species: {\r\n            nameTH: string;\r\n        };\r\n    };\r\n}\r\n\r\ninterface HarvestBatch {\r\n    id: string;\r\n    batchNumber: string;\r\n    harvestDate: string;\r\n    status: string;\r\n    farm: {\r\n        farmName: string;\r\n    };\r\n    species: {\r\n        nameTH: string;\r\n    };\r\n}\r\n\r\nconst packageTypes: Record<string, string> = {\r\n    BAG_1KG: 'ถุง 1 กก.',\r\n    BAG_500G: 'ถุง 500 กรัม',\r\n    BOX_5KG: 'กล่อง 5 กก.',\r\n    BOTTLE_100ML: 'ขวด 100 ml',\r\n    BOTTLE_500ML: 'ขวด 500 ml',\r\n};\r\n\r\nexport default function LotsPage() {\r\n    const searchParams = useSearchParams();\r\n    const batchIdFromUrl = searchParams.get('batchId');\r\n\r\n    const [lots, setLots] = useState<Lot[]>([]);\r\n    const [batches, setBatches] = useState<HarvestBatch[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedLot, setSelectedLot] = useState<Lot | null>(null);\r\n    const [qrDataUrl, setQrDataUrl] = useState<string>('');\r\n    const [selectedBatchId, setSelectedBatchId] = useState<string>(batchIdFromUrl || '');\r\n\r\n    useEffect(() => {\r\n        fetchBatches();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (selectedBatchId) {\r\n            fetchLots(selectedBatchId);\r\n        }\r\n    }, [selectedBatchId]);\r\n\r\n    async function fetchBatches() {\r\n        try {\r\n            const farmId = localStorage.getItem('currentFarmId') || localStorage.getItem('farmId');\r\n            if (!farmId) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n            const res = await fetch(`/api/proxy/harvest-batches?farmId=${farmId}`);\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setBatches(data.data);\r\n                // Auto-select first batch if no batchId in URL\r\n                if (!batchIdFromUrl && data.data.length > 0) {\r\n                    setSelectedBatchId(data.data[0].id);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching batches:', error);\r\n        } finally {\r\n            if (!selectedBatchId) {\r\n                setLoading(false);\r\n            }\r\n        }\r\n    }\r\n\r\n    async function fetchLots(batchId: string) {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/proxy/lots/batch/${batchId}`);\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setLots(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching lots:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        if (!dateStr) return '-';\r\n        return new Date(dateStr).toLocaleDateString('th-TH', {\r\n            year: 'numeric',\r\n            month: 'short',\r\n            day: 'numeric'\r\n        });\r\n    };\r\n\r\n    async function showQRPrint(lot: Lot) {\r\n        setSelectedLot(lot);\r\n        try {\r\n            const res = await fetch(`/api/proxy/lots/${lot.id}/qr/print`);\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setQrDataUrl(data.data.label.qrCodeDataUrl);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching QR:', error);\r\n        }\r\n    }\r\n\r\n    function printQR() {\r\n        window.print();\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-6\">\r\n                <div className=\"animate-pulse space-y-4\">\r\n                    <div className=\"h-8 bg-gray-200 rounded w-1/4\"></div>\r\n                    <div className=\"h-32 bg-gray-200 rounded\"></div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-6\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-800\">📦 ล็อตบรรจุภัณฑ์</h1>\r\n                    <p className=\"text-gray-500\">จัดการล็อตและพิมพ์ QR Code</p>\r\n                </div>\r\n                <Link\r\n                    href=\"/tracking/cycles\"\r\n                    className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center\"\r\n                >\r\n                    <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                    </svg>\r\n                    สร้างล็อตใหม่\r\n                </Link>\r\n            </div>\r\n\r\n            {/* Batch Selector */}\r\n            {batches.length > 0 && (\r\n                <div className=\"bg-white rounded-xl shadow-sm border p-4 mb-6\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">เลือก Batch</label>\r\n                    <select\r\n                        value={selectedBatchId}\r\n                        onChange={(e) => setSelectedBatchId(e.target.value)}\r\n                        className=\"w-full md:w-1/2 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\r\n                    >\r\n                        <option value=\"\">-- เลือก Batch --</option>\r\n                        {batches.map(b => (\r\n                            <option key={b.id} value={b.id}>\r\n                                {b.batchNumber} • {b.species?.nameTH} • {formatDate(b.harvestDate)}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            )}\r\n\r\n            {/* Empty State */}\r\n            {lots.length === 0 && (\r\n                <div className=\"bg-white rounded-xl shadow-sm border p-12 text-center\">\r\n                    <div className=\"text-6xl mb-4\">📦</div>\r\n                    <h3 className=\"text-xl font-semibold text-gray-700 mb-2\">\r\n                        {selectedBatchId ? 'ยังไม่มีล็อตใน Batch นี้' : 'ยังไม่มีล็อตบรรจุภัณฑ์'}\r\n                    </h3>\r\n                    <p className=\"text-gray-500 mb-4\">\r\n                        {selectedBatchId\r\n                            ? 'สร้างล็อตใหม่จากหน้ารอบการปลูก'\r\n                            : 'เริ่มต้นจากการสร้างรอบการปลูกและเก็บเกี่ยวก่อน'}\r\n                    </p>\r\n                    <Link\r\n                        href=\"/tracking/cycles\"\r\n                        className=\"inline-block px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n                    >\r\n                        ไปที่รอบการปลูก\r\n                    </Link>\r\n                </div>\r\n            )}\r\n\r\n            {/* Lots Grid */}\r\n            {lots.length > 0 && (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    {lots.map((lot) => (\r\n                        <div key={lot.id} className=\"bg-white rounded-xl shadow-sm border p-6\">\r\n                            <div className=\"flex justify-between items-start mb-4\">\r\n                                <div>\r\n                                    <h3 className=\"font-mono font-semibold text-lg\">{lot.lotNumber}</h3>\r\n                                    <p className=\"text-gray-500\">{lot.batch?.species?.nameTH || '-'}</p>\r\n                                </div>\r\n                                <span className={`px-3 py-1 rounded-full text-sm ${lot.status === 'PACKAGED' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'\r\n                                    }`}>\r\n                                    {lot.status === 'PACKAGED' ? 'บรรจุแล้ว' : lot.status}\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                                <div>\r\n                                    <span className=\"text-gray-500\">บรรจุภัณฑ์</span>\r\n                                    <div className=\"font-medium\">{packageTypes[lot.packageType] || lot.packageType}</div>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"text-gray-500\">จำนวน</span>\r\n                                    <div className=\"font-medium\">{lot.quantity} ชิ้น ({lot.totalWeight} กก.)</div>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"text-gray-500\">วันบรรจุ</span>\r\n                                    <div className=\"font-medium\">{formatDate(lot.packagedAt)}</div>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"text-gray-500\">หมดอายุ</span>\r\n                                    <div className=\"font-medium text-red-600\">{formatDate(lot.expiryDate)}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-4 pt-4 border-t flex justify-between\">\r\n                                <button\r\n                                    onClick={() => showQRPrint(lot)}\r\n                                    className=\"px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 flex items-center\"\r\n                                >\r\n                                    <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\r\n                                    </svg>\r\n                                    ดู QR Code\r\n                                </button>\r\n                                <Link\r\n                                    href={`/trace/${lot.qrCode}`}\r\n                                    target=\"_blank\"\r\n                                    className=\"px-4 py-2 text-gray-600 hover:text-gray-800\"\r\n                                >\r\n                                    ดูหน้า Trace →\r\n                                </Link>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* QR Print Modal */}\r\n            {selectedLot && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:bg-white print:relative\">\r\n                    <div className=\"bg-white rounded-2xl p-8 w-full max-w-md print:shadow-none print:rounded-none\">\r\n                        <div className=\"text-center print:text-left\">\r\n                            <h2 className=\"text-xl font-bold mb-4 print:hidden\">QR Code สำหรับพิมพ์</h2>\r\n\r\n                            {/* QR Label - This will be printed */}\r\n                            <div className=\"border-2 border-dashed border-gray-300 p-4 rounded-lg print:border-solid\">\r\n                                {qrDataUrl && (\r\n                                    <img src={qrDataUrl} alt=\"QR Code\" className=\"w-32 h-32 mx-auto mb-4\" />\r\n                                )}\r\n                                <div className=\"text-left\">\r\n                                    <div className=\"font-mono font-bold text-lg\">{selectedLot.lotNumber}</div>\r\n                                    <div className=\"text-sm text-gray-600\">{selectedLot.batch?.species?.nameTH}</div>\r\n                                    <div className=\"text-sm text-gray-600\">{selectedLot.batch?.farm?.farmName}</div>\r\n                                    <div className=\"text-sm mt-2\">\r\n                                        <span className=\"text-gray-500\">เก็บเกี่ยว:</span> {formatDate(selectedLot.batch?.harvestDate)}\r\n                                    </div>\r\n                                    <div className=\"text-sm\">\r\n                                        <span className=\"text-gray-500\">หมดอายุ:</span> {formatDate(selectedLot.expiryDate)}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-gray-400 mt-2\">สแกน QR เพื่อดูข้อมูลผลิตภัณฑ์</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-6 flex gap-4 print:hidden\">\r\n                                <button\r\n                                    onClick={() => setSelectedLot(null)}\r\n                                    className=\"flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200\"\r\n                                >\r\n                                    ปิด\r\n                                </button>\r\n                                <button\r\n                                    onClick={printQR}\r\n                                    className=\"flex-1 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n                                >\r\n                                    🖨️ พิมพ์\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\tracking\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2817,2820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2817,2820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\farmer\\tracking\\page.tsx:58:9\n  56 |     useEffect(() => {\n  57 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 58 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  59 |         setIsDark(localStorage.getItem(\"theme\") === \"dark\");\n  60 |\n  61 |         const user = AuthService.getUser();","line":58,"column":9,"nodeType":null,"endLine":58,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { apiClient as api } from \"@/lib/api/api-client\";\r\nimport { AuthService } from \"@/lib/services/auth-service\";\r\nimport PlantUnitList from \"@/components/PlantUnitList\";\r\n\r\n/* Reuse generic icons or keep specific ones if needed. \r\n   For now, defining local specific ones to ensure UI consistency with previous design \r\n   without needing to check shared library for every single path.\r\n*/\r\nconst Icons = {\r\n    check: (c: string) => <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={c} strokeWidth=\"2.5\"><polyline points=\"20 6 9 17 4 12\" /></svg>,\r\n    clock: (c: string) => <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={c} strokeWidth=\"1.5\"><circle cx=\"12\" cy=\"12\" r=\"10\" /><polyline points=\"12 6 12 12 16 14\" /></svg>,\r\n    compassLarge: (c: string) => <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={c} strokeWidth=\"1.5\"><circle cx=\"12\" cy=\"12\" r=\"10\" /><polygon points=\"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76\" /></svg>,\r\n};\r\n\r\ninterface Application { _id: string; applicationNumber?: string; status: string; createdAt: string; data?: { farmId?: string }; }\r\n\r\nconst STEPS = [\r\n    { id: 1, label: \"ยื่นคำขอ\", statuses: [\"DRAFT\"] },\r\n    { id: 2, label: \"ชำระงวด 1\", statuses: [\"PAYMENT_1_PENDING\"] },\r\n    { id: 3, label: \"ตรวจเอกสาร\", statuses: [\"SUBMITTED\", \"REVISION_REQ\"] },\r\n    { id: 4, label: \"ชำระงวด 2\", statuses: [\"PAYMENT_2_PENDING\"] },\r\n    { id: 5, label: \"ตรวจสถานที่\", statuses: [\"AUDIT_PENDING\", \"AUDIT_SCHEDULED\"] },\r\n    { id: 6, label: \"รับรอง\", statuses: [\"CERTIFIED\"] },\r\n];\r\n\r\nconst STATUS_CONFIG: Record<string, { label: string; color: string }> = {\r\n    DRAFT: { label: \"ร่าง\", color: \"#6B7280\" },\r\n    PAYMENT_1_PENDING: { label: \"รอชำระเงินงวด 1\", color: \"#F59E0B\" },\r\n    SUBMITTED: { label: \"รอตรวจเอกสาร\", color: \"#3B82F6\" },\r\n    REVISION_REQ: { label: \"ต้องแก้ไข\", color: \"#EF4444\" },\r\n    PAYMENT_2_PENDING: { label: \"รอชำระเงินงวด 2\", color: \"#F59E0B\" },\r\n    AUDIT_PENDING: { label: \"รอตรวจสถานที่\", color: \"#8B5CF6\" },\r\n    AUDIT_SCHEDULED: { label: \"นัดตรวจแล้ว\", color: \"#06B6D4\" },\r\n    CERTIFIED: { label: \"ได้รับการรับรอง\", color: \"#10B981\" },\r\n};\r\n\r\nexport default function TrackingPage() {\r\n    const router = useRouter();\r\n    const [applications, setApplications] = useState<Application[]>([]);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n\r\n    const loadApplications = async () => {\r\n        const result = await api.get<Application[]>(\"/applications/my\");\r\n        if (result.success && result.data) {\r\n            const apps = Array.isArray(result.data) ? result.data : (result.data as any).data || [];\r\n            setApplications(apps);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n\r\n        const user = AuthService.getUser();\r\n        if (!user) {\r\n            router.push(\"/login\");\r\n            return;\r\n        }\r\n\r\n        loadApplications();\r\n    }, [router]);\r\n\r\n    const getStepForStatus = (status: string) => STEPS.findIndex(s => s.statuses.includes(status)) + 1;\r\n    const accentColor = isDark ? \"#10B981\" : \"#16A34A\";\r\n\r\n    if (!mounted) return <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-slate-900' : 'bg-stone-50'}`}><div className=\"w-10 h-10 border-3 border-slate-300 border-t-emerald-500 rounded-full animate-spin\" /></div>;\r\n\r\n    return (\r\n        <div className=\"p-6 lg:p-8 max-w-5xl mx-auto pb-24 lg:pb-8\">\r\n            <header className=\"mb-8\">\r\n                <h1 className=\"text-2xl lg:text-3xl font-medium\">ติดตามสถานะคำขอ</h1>\r\n                <p className={`text-sm mt-1 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>ตรวจสอบความคืบหน้าการขอใบรับรอง GACP</p>\r\n            </header>\r\n\r\n            {applications.length > 0 ? applications.map(app => {\r\n                const currentStep = getStepForStatus(app.status);\r\n                const statusInfo = STATUS_CONFIG[app.status];\r\n                return (\r\n                    <div key={app._id} className={`rounded-2xl p-7 mb-5 border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n                        <div className=\"flex flex-wrap justify-between items-center gap-4 mb-6\">\r\n                            <div>\r\n                                <p className={`text-xs mb-1 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>เลขที่คำขอ</p>\r\n                                <p className=\"text-xl font-semibold\">{app.applicationNumber || `#${app._id.slice(-6).toUpperCase()}`}</p>\r\n                            </div>\r\n                            <span className=\"px-4 py-2 rounded-full text-sm font-semibold\" style={{ backgroundColor: `${statusInfo?.color}15`, color: statusInfo?.color, border: `1px solid ${statusInfo?.color}30` }}>\r\n                                {statusInfo?.label}\r\n                            </span>\r\n                        </div>\r\n\r\n                        {/* Progress */}\r\n                        <div className=\"relative mb-6\">\r\n                            <div className={`h-1 rounded ${isDark ? 'bg-slate-700' : 'bg-slate-200'}`} />\r\n                            <div className=\"absolute top-0 left-0 h-1 rounded bg-gradient-to-r from-emerald-600 to-emerald-400 transition-all duration-500\" style={{ width: `${((currentStep - 1) / (STEPS.length - 1)) * 100}%` }} />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-3 lg:grid-cols-6 gap-3\">\r\n                            {STEPS.map(step => {\r\n                                const isDone = step.id < currentStep;\r\n                                const isCurrent = step.id === currentStep;\r\n                                return (\r\n                                    <div key={step.id} className=\"text-center\">\r\n                                        <div className={`w-12 h-12 rounded-2xl mx-auto mb-2 flex items-center justify-center transition-all ${isDone ? 'bg-emerald-500' : isCurrent ? (isDark ? 'bg-emerald-900/50 border-2 border-emerald-500' : 'bg-emerald-50 border-2 border-emerald-500') : (isDark ? 'bg-slate-700' : 'bg-slate-200')}`}>\r\n                                            {isDone ? Icons.check(\"#FFF\") : isCurrent ? Icons.clock(accentColor) : <span className={`text-sm font-medium ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>{step.id}</span>}\r\n                                        </div>\r\n                                        <span className={`text-xs ${isCurrent ? 'text-emerald-500 font-semibold' : isDark ? 'text-slate-500' : 'text-slate-400'}`}>{step.label}</span>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n\r\n\r\n\r\n                        <div className={`mt-6 p-4 rounded-xl ${isDark ? 'bg-slate-700/50' : 'bg-slate-50'}`}>\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <p className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                                    <strong>วันที่ยื่น:</strong> {new Date(app.createdAt).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Insert PlantUnitList if Certified or Approved */}\r\n                            {(app.status === 'CERTIFIED' || app.status === 'AUDIT_SCHEDULED' || app.status === 'AUDIT_PENDING' || app.status === 'SUBMITTED') && app.data?.farmId && (\r\n                                <div className=\"mt-4 pt-4 border-t border-gray-200/50\">\r\n                                    <PlantUnitList farmId={app.data.farmId} applicationId={app._id} canEdit={true} />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }) : (\r\n                <div className={`rounded-2xl p-16 text-center border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n                    <div className={`w-20 h-20 rounded-2xl mx-auto mb-5 flex items-center justify-center ${isDark ? 'bg-emerald-900/30' : 'bg-emerald-50'}`}>{Icons.compassLarge(accentColor)}</div>\r\n                    <h3 className=\"text-lg font-medium mb-2\">ยังไม่มีคำขอที่ต้องติดตาม</h3>\r\n                    <p className={`text-sm mb-5 ${isDark ? 'text-slate-500' : 'text-slate-400'}`}>ยื่นคำขอรับรองมาตรฐาน GACP เพื่อเริ่มต้น</p>\r\n                    <Link href=\"/farmer/applications/new\" className=\"inline-block px-6 py-3 rounded-xl bg-gradient-to-br from-emerald-600 to-emerald-500 text-white font-medium\">ยื่นคำขอใหม่</Link>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\robots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\accounting\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2452,2455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2452,2455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4044,4047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4044,4047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":154,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7761,7764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7761,7764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":342,"column":41,"nodeType":"JSXOpeningElement","endLine":346,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\nimport StaffLayout from \"../components/StaffLayout\";\r\nimport { IconDocument, IconCreditCard, IconCheckCircle, IconClock } from \"@/components/ui/icons\";\r\n\r\n// Additional icons\r\nconst IconDollar = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"23\" />\r\n        <path d=\"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\" />\r\n    </svg>\r\n);\r\n\r\nconst IconWarning = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\" />\r\n        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\" />\r\n        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n    </svg>\r\n);\r\n\r\nconst IconDownload = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\r\n        <polyline points=\"7 10 12 15 17 10\" />\r\n        <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" />\r\n    </svg>\r\n);\r\n\r\nconst IconEye = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" />\r\n        <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n    </svg>\r\n);\r\n\r\ninterface InvoiceItem {\r\n    _id: string;\r\n    invoiceNumber: string;\r\n    applicationNumber: string;\r\n    farmerName: string;\r\n    amount: number;\r\n    status: \"PENDING\" | \"PAID\" | \"OVERDUE\" | \"CANCELLED\" | \"payment_verification_pending\";\r\n    dueDate: string;\r\n    paidAt?: string;\r\n    createdAt: string;\r\n    notes?: string;\r\n    id: string;\r\n    items?: any;\r\n}\r\n\r\ninterface PaymentSummary {\r\n    totalRevenue: number;\r\n    pendingAmount: number;\r\n    overdueAmount: number;\r\n    monthlyRevenue: number;\r\n    invoiceCount: { total: number; pending: number; paid: number; overdue: number };\r\n}\r\n\r\nexport default function AccountingDashboard() {\r\n    const router = useRouter();\r\n    const [summary, setSummary] = useState<PaymentSummary | null>(null);\r\n    const [invoices, setInvoices] = useState<InvoiceItem[]>([]);\r\n    const [activeTab, setActiveTab] = useState<\"all\" | \"pending\" | \"paid\" | \"overdue\">(\"all\");\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isDark, setIsDark] = useState(false);\r\n\r\n    // Modal State\r\n    const [selectedInvoice, setSelectedInvoice] = useState<InvoiceItem | null>(null);\r\n    const [isVerifying, setIsVerifying] = useState(false);\r\n\r\n    const fetchData = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const [summaryRes, invoicesRes] = await Promise.all([\r\n                api.get<{ data: PaymentSummary }>('/api/invoices/summary'),\r\n                api.get<{ data: { invoices: InvoiceItem[] } }>('/api/invoices')\r\n            ]);\r\n            if (summaryRes.success && summaryRes.data?.data) setSummary(summaryRes.data.data);\r\n            else setSummary({ totalRevenue: 0, pendingAmount: 0, overdueAmount: 0, monthlyRevenue: 0, invoiceCount: { total: 0, pending: 0, paid: 0, overdue: 0 } });\r\n\r\n            if (invoicesRes.success && invoicesRes.data?.data?.invoices) {\r\n                const mappedInvoices = invoicesRes.data.data.invoices.map((inv: any) => ({\r\n                    ...inv,\r\n                    items: inv.items ? (typeof inv.items === 'string' ? JSON.parse(inv.items) : inv.items) : [],\r\n                }));\r\n                setInvoices(mappedInvoices);\r\n            }\r\n            else setInvoices([]);\r\n        } catch { setSummary(null); setInvoices([]); }\r\n        finally { setIsLoading(false); }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        const userData = localStorage.getItem(\"staff_user\");\r\n        if (!token || !userData) { router.push(\"/staff/login\"); return; }\r\n        try {\r\n            const user = JSON.parse(userData);\r\n            if (![\"ACCOUNTANT\", \"ADMIN\", \"SUPER_ADMIN\", \"accountant\", \"admin\"].includes(user.role)) {\r\n                router.push(\"/staff/dashboard\"); return;\r\n            }\r\n            fetchData();\r\n        } catch { router.push(\"/staff/login\"); }\r\n    }, [router, fetchData]);\r\n\r\n    const formatCurrency = (amt: number) => new Intl.NumberFormat(\"th-TH\", { style: \"currency\", currency: \"THB\", minimumFractionDigits: 0 }).format(amt);\r\n    const formatDate = (d: string) => new Date(d).toLocaleDateString(\"th-TH\", { year: \"numeric\", month: \"short\", day: \"numeric\" });\r\n\r\n    const getStatusBadge = (status: string) => {\r\n        const config: Record<string, { color: string; label: string }> = {\r\n            PENDING: { color: \"bg-amber-100 text-amber-700\", label: \"รอชำระ\" },\r\n            PAID: { color: \"bg-emerald-100 text-emerald-700\", label: \"ชำระแล้ว\" },\r\n            OVERDUE: { color: \"bg-red-100 text-red-700\", label: \"เกินกำหนด\" },\r\n            CANCELLED: { color: \"bg-slate-100 text-slate-700\", label: \"ยกเลิก\" },\r\n            payment_verification_pending: { color: \"bg-blue-100 text-blue-700\", label: \"รอตรวจสอบ\" }\r\n        };\r\n        const c = config[status] || { color: \"bg-gray-100\", label: status };\r\n        return <span className={`px-3 py-1 rounded-lg text-xs font-medium ${c.color}`}>{c.label}</span>;\r\n    };\r\n\r\n    // Extract slip filename from notes\r\n    const getSlipUrl = (notes?: string) => {\r\n        if (!notes) return null;\r\n        const match = notes.match(/\\[Slip Uploaded: (.*?)\\]/);\r\n        if (match && match[1]) {\r\n            // BACKEND_URL needs to be accessible. \r\n            // We can hardcode specific dev/prod logic or just use relative if proxy was set up (it isn't for /uploads).\r\n            // Using direct port 5000 for now or relying on Next.js env.\r\n            // A robust way: use the API base and strip '/api'\r\n            return `http://localhost:8000/uploads/${match[1]}`;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const handleVerifyPayment = async () => {\r\n        if (!selectedInvoice) return;\r\n        if (!confirm(\"ยืนยันการชำระเงินใช่หรือไม่?\")) return;\r\n\r\n        setIsVerifying(true);\r\n        try {\r\n            const res = await api.post(`/api/invoices/${selectedInvoice.id}/pay`, { transactionId: 'MANUAL_VERIFY' });\r\n            if (res.success) {\r\n                alert(\"บันทึกการชำระเงินเรียบร้อยแล้ว\");\r\n                setSelectedInvoice(null);\r\n                fetchData();\r\n            } else {\r\n                alert(\"เกิดข้อผิดพลาด: \" + res.error);\r\n            }\r\n        } catch (error) {\r\n            alert(\"เกิดข้อผิดพลาดในการเชื่อมต่อ\");\r\n        } finally {\r\n            setIsVerifying(false);\r\n        }\r\n    };\r\n\r\n    const filteredInvoices = invoices.filter(inv => {\r\n        if (activeTab === \"all\") return true;\r\n        if (activeTab === \"pending\") return inv.status === \"PENDING\" || inv.status === \"payment_verification_pending\";\r\n        return inv.status === (activeTab.toUpperCase() as any);\r\n    });\r\n\r\n    const stats = [\r\n        { label: \"รายได้รวม\", value: summary ? formatCurrency(summary.totalRevenue) : \"฿0\", Icon: IconDollar, bgColor: \"bg-emerald-500\", sub: `${summary?.invoiceCount.paid || 0} ใบเสร็จ` },\r\n        { label: \"รอชำระ\", value: summary ? formatCurrency(summary.pendingAmount) : \"฿0\", Icon: IconClock, bgColor: \"bg-amber-500\", sub: `${summary?.invoiceCount.pending || 0} รายการ` },\r\n        { label: \"เกินกำหนด\", value: summary ? formatCurrency(summary.overdueAmount) : \"฿0\", Icon: IconWarning, bgColor: \"bg-red-500\", sub: `${summary?.invoiceCount.overdue || 0} รายการ` },\r\n        { label: \"รายได้เดือนนี้\", value: summary ? formatCurrency(summary.monthlyRevenue) : \"฿0\", Icon: IconCreditCard, bgColor: \"bg-blue-500\", sub: \"ม.ค. 2569\" },\r\n    ];\r\n\r\n    if (isLoading && invoices.length === 0) {\r\n        return (\r\n            <StaffLayout title=\"ระบบบัญชี\" subtitle=\"กำลังโหลด...\">\r\n                <div className=\"flex justify-center py-20\">\r\n                    <div className=\"w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin\" />\r\n                </div>\r\n            </StaffLayout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <StaffLayout title=\"ระบบบัญชีและการเงิน\" subtitle=\"Accountant Dashboard\">\r\n            {/* Summary Cards */}\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                {stats.map((stat, i) => (\r\n                    <div key={i} className={`p-4 rounded-xl border transition-all hover:shadow-md ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                            <span className={`text-xs font-medium ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{stat.label}</span>\r\n                            <div className={`w-8 h-8 rounded-lg ${stat.bgColor} flex items-center justify-center`}>\r\n                                <stat.Icon size={16} className=\"text-white\" />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-xl font-semibold\">{stat.value}</p>\r\n                        <p className=\"text-xs text-slate-400 mt-1\">{stat.sub}</p>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Invoice Table */}\r\n            <div className={`rounded-xl overflow-hidden border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                <div className={`px-6 py-4 border-b flex items-center justify-between flex-wrap gap-4 ${isDark ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                    <div className=\"flex gap-2\">\r\n                        {[\r\n                            { key: \"all\", label: \"ทั้งหมด\", count: invoices.length },\r\n                            { key: \"pending\", label: \"รอชำระ\", count: invoices.filter(i => i.status === \"PENDING\" || i.status === \"payment_verification_pending\").length },\r\n                            { key: \"paid\", label: \"ชำระแล้ว\", count: invoices.filter(i => i.status === \"PAID\").length },\r\n                            { key: \"overdue\", label: \"เกินกำหนด\", count: invoices.filter(i => i.status === \"OVERDUE\").length },\r\n                        ].map(tab => (\r\n                            <button\r\n                                key={tab.key}\r\n                                onClick={() => setActiveTab(tab.key as typeof activeTab)}\r\n                                className={`px-4 py-2 rounded-xl text-sm font-medium transition-all ${activeTab === tab.key ? \"bg-emerald-600 text-white\" : `${isDark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'} hover:bg-slate-200`\r\n                                    }`}\r\n                            >\r\n                                {tab.label} ({tab.count})\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <button className=\"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-xl text-sm hover:bg-emerald-700\">\r\n                        <IconDownload size={16} /> ส่งออก Excel\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full\">\r\n                        <thead className={isDark ? 'bg-slate-700' : 'bg-slate-50'}>\r\n                            <tr>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">เลขที่ใบแจ้งหนี้</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">ผู้ประกอบการ</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">จำนวนเงิน</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">สถานะ</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">กำหนดชำระ</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase\">การดำเนินการ</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className={`divide-y ${isDark ? 'divide-slate-700' : 'divide-slate-200'}`}>\r\n                            {filteredInvoices.map(inv => (\r\n                                <tr key={inv.id} className={`${isDark ? 'hover:bg-slate-700/50' : 'hover:bg-slate-50'} transition-colors`}>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <p className=\"font-mono text-sm font-semibold\">{inv.invoiceNumber}</p>\r\n                                        <p className=\"text-xs text-slate-400\">{inv.applicationNumber}</p>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 text-sm\">{inv.farmerName}</td>\r\n                                    <td className=\"px-6 py-4 text-sm font-semibold\">{formatCurrency(inv.amount)}</td>\r\n                                    <td className=\"px-6 py-4\">{getStatusBadge(inv.status)}</td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <p className=\"text-sm\">{formatDate(inv.dueDate)}</p>\r\n                                        {inv.paidAt && <p className=\"text-xs text-emerald-600\">ชำระ: {formatDate(inv.paidAt)}</p>}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => setSelectedInvoice(inv)}\r\n                                                className={`flex items-center gap-1 px-3 py-1.5 text-xs rounded-lg ${isDark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-700'}`}>\r\n                                                <IconEye size={12} /> ดู\r\n                                            </button>\r\n                                            {inv.status === \"payment_verification_pending\" && (\r\n                                                <button\r\n                                                    onClick={() => { setSelectedInvoice(inv); }}\r\n                                                    className=\"flex items-center gap-1 px-3 py-1.5 text-xs bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200\">\r\n                                                    <IconCheckCircle size={12} /> ตรวจสอบ\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                {filteredInvoices.length === 0 && (\r\n                    <div className=\"p-12 text-center text-slate-400\">\r\n                        <IconDocument size={32} className=\"mx-auto mb-3\" />\r\n                        <p>ไม่พบรายการ</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Payment Verification Modal */}\r\n            {selectedInvoice && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n                    <div className={`max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl ${isDark ? 'bg-slate-800' : 'bg-white'}`}>\r\n                        <div className=\"p-6 border-b border-slate-200 flex justify-between items-center sticky top-0 bg-inherit z-10\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-bold\">รายละเอียดการชำระเงิน</h3>\r\n                                <p className=\"text-sm text-slate-500\">Invoice: {selectedInvoice.invoiceNumber}</p>\r\n                            </div>\r\n                            <button onClick={() => setSelectedInvoice(null)} className=\"p-2 hover:bg-slate-100 rounded-full\">\r\n                                ✕\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            {/* Invoice Info */}\r\n                            <div className=\"space-y-4\">\r\n                                <h4 className=\"font-semibold text-emerald-600 border-b pb-2\">ข้อมูลใบแจ้งหนี้</h4>\r\n                                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                                    <div className=\"text-slate-500\">จำนวนเงิน:</div>\r\n                                    <div className=\"font-bold text-lg\">{formatCurrency(selectedInvoice.amount)}</div>\r\n\r\n                                    <div className=\"text-slate-500\">วันที่ออกเอกสาร:</div>\r\n                                    <div>{formatDate(selectedInvoice.createdAt)}</div>\r\n\r\n                                    <div className=\"text-slate-500\">กำหนดชำระ:</div>\r\n                                    <div>{formatDate(selectedInvoice.dueDate)}</div>\r\n\r\n                                    <div className=\"text-slate-500\">เกษตรกร:</div>\r\n                                    <div>{selectedInvoice.farmerName}</div>\r\n\r\n                                    <div className=\"text-slate-500\">เลขที่ใบสมัคร:</div>\r\n                                    <div>{selectedInvoice.applicationNumber}</div>\r\n\r\n                                    <div className=\"text-slate-500\">สถานะปัจจุบัน:</div>\r\n                                    <div>{getStatusBadge(selectedInvoice.status)}</div>\r\n                                </div>\r\n\r\n                                {(selectedInvoice.status === \"PENDING\" || selectedInvoice.status === \"payment_verification_pending\") && (\r\n                                    <div className=\"pt-4 mt-4 border-t\">\r\n                                        <button\r\n                                            onClick={handleVerifyPayment}\r\n                                            disabled={isVerifying}\r\n                                            className=\"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-lg shadow-emerald-200 transition-all flex justify-center items-center gap-2\">\r\n                                            {isVerifying ? 'กำลังบันทึก...' :\r\n                                                <><IconCheckCircle /> ยืนยันการได้รับเงินถูกต้อง</>\r\n                                            }\r\n                                        </button>\r\n                                        <p className=\"text-xs text-center text-slate-400 mt-2\">\r\n                                            การกระทำนี้จะเปลี่ยนสถานะเป็น &quot;ชำระแล้ว&quot; และออกใบเสร็จรับเงินทันที\r\n                                        </p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Slip Image */}\r\n                            <div className=\"bg-slate-50 rounded-xl p-4 border border-slate-200 flex flex-col items-center\">\r\n                                <h4 className=\"font-semibold text-slate-700 mb-4 w-full\">หลักฐานการชำระเงิน</h4>\r\n                                {getSlipUrl(selectedInvoice.notes) ? (\r\n                                    <a href={getSlipUrl(selectedInvoice.notes)!} target=\"_blank\" rel=\"noopener noreferrer\" className=\"block w-full\">\r\n                                        <img\r\n                                            src={getSlipUrl(selectedInvoice.notes)!}\r\n                                            alt=\"Payment Slip\"\r\n                                            className=\"w-full h-auto rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-zoom-in\"\r\n                                        />\r\n                                        <p className=\"text-center text-xs text-blue-500 mt-2\">คลิกเพื่อดูรูปขยาย</p>\r\n                                    </a>\r\n                                ) : (\r\n                                    <div className=\"flex flex-col items-center justify-center h-64 text-slate-400 w-full bg-slate-100 rounded-lg border-dashed border-2 border-slate-300\">\r\n                                        <IconDocument size={48} className=\"mb-2 opacity-50\" />\r\n                                        <p>ไม่พบหลักฐานการชำระเงิน</p>\r\n                                        <p className=\"text-xs\">หรือยังไม่ได้อัปโหลด</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n        </StaffLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\analytics\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":61,"column":8,"nodeType":"ArrayExpression","endLine":61,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [router]","fix":{"range":[2952,2954],"text":"[router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport StaffLayout from \"../components/StaffLayout\";\r\nimport { IconChart, IconDocument, IconLeaf, IconCheckCircle } from \"@/components/ui/icons\";\r\n\r\n// Additional icons\r\nconst IconRefresh = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <polyline points=\"23 4 23 10 17 10\" />\r\n        <polyline points=\"1 20 1 14 7 14\" />\r\n        <path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\" />\r\n    </svg>\r\n);\r\n\r\nconst IconDownload = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\r\n        <polyline points=\"7 10 12 15 17 10\" />\r\n        <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\" />\r\n    </svg>\r\n);\r\n\r\nconst IconTrendUp = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <polyline points=\"23 6 13.5 15.5 8.5 10.5 1 18\" />\r\n        <polyline points=\"17 6 23 6 23 12\" />\r\n    </svg>\r\n);\r\n\r\nconst IconMapPin = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\" />\r\n        <circle cx=\"12\" cy=\"10\" r=\"3\" />\r\n    </svg>\r\n);\r\n\r\ninterface DashboardData {\r\n    overview: { totalApplications: number; pendingReview: number; approved: number; rejected: number; };\r\n    byStatus: Record<string, number>;\r\n    byPlantType: Record<string, number>;\r\n    byProvince: Record<string, number>;\r\n    monthlyTrend: Array<{ month: number; applications: number; approved: number }>;\r\n}\r\n\r\nexport default function AnalyticsPage() {\r\n    const router = useRouter();\r\n    const [data, setData] = useState<DashboardData | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [exporting, setExporting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        if (!token) { router.push(\"/staff/login\"); return; }\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch(\"/api/reports/dashboard\", { credentials: \"include\" });\r\n            const result = await res.json();\r\n            if (result.success) setData(result.data);\r\n            else setData({\r\n                overview: { totalApplications: 1234, pendingReview: 45, approved: 1089, rejected: 100 },\r\n                byStatus: { CERTIFIED: 1003, AUDIT_PENDING: 56, SUBMITTED: 45, PAYMENT_1_PENDING: 34, DRAFT: 23 },\r\n                byPlantType: { 'กัญชา': 450, 'กระท่อม': 320, 'ขมิ้นชัน': 180, 'ขิง': 120, 'กระชายดำ': 90 },\r\n                byProvince: { 'กรุงเทพฯ': 120, 'เชียงใหม่': 98, 'นครราชสีมา': 87, 'ขอนแก่น': 76, 'อุบลฯ': 65 },\r\n                monthlyTrend: Array.from({ length: 12 }, (_, i) => ({ month: i + 1, applications: Math.floor(Math.random() * 100) + 50, approved: Math.floor(Math.random() * 80) + 30 })),\r\n            });\r\n        } catch { setData({ overview: { totalApplications: 1234, pendingReview: 45, approved: 1089, rejected: 100 }, byStatus: { CERTIFIED: 1003 }, byPlantType: { 'กัญชา': 450 }, byProvince: { 'กรุงเทพฯ': 120 }, monthlyTrend: Array.from({ length: 12 }, (_, i) => ({ month: i + 1, applications: 70, approved: 50 })) }); }\r\n        finally { setLoading(false); }\r\n    };\r\n\r\n    const handleExport = (format: 'csv' | 'json', type: string) => {\r\n        setExporting(true);\r\n        window.open(`/api/reports/export?format=${format}&type=${type}`, '_blank');\r\n        setExporting(false);\r\n    };\r\n\r\n    if (!mounted) return null;\r\n\r\n    const getMaxValue = (obj: Record<string, number>) => Math.max(...Object.values(obj), 1);\r\n    const chartColors = ['bg-emerald-500', 'bg-blue-500', 'bg-amber-500', 'bg-red-500', 'bg-violet-500', 'bg-cyan-500'];\r\n    const months = ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'];\r\n\r\n    return (\r\n        <StaffLayout title=\"Analytics Dashboard\" subtitle=\"ภาพรวมและสถิติระบบรับรอง GACP\">\r\n            <div className=\"flex gap-3 mb-8\">\r\n                <button onClick={loadData} disabled={loading} className={`flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm ${isDark ? 'bg-slate-700 border border-slate-600 text-slate-300' : 'bg-white border border-slate-200 text-slate-600'}`}>\r\n                    <IconRefresh size={16} /> รีเฟรช\r\n                </button>\r\n                <button onClick={() => handleExport('csv', 'applications')} disabled={exporting} className=\"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-emerald-600 text-white text-sm font-medium\">\r\n                    <IconDownload size={16} /> Export CSV\r\n                </button>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"flex justify-center p-24\">\r\n                    <div className=\"w-10 h-10 border-3 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin\" />\r\n                </div>\r\n            ) : data ? (\r\n                <>\r\n                    {/* Overview Cards */}\r\n                    <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                        {[\r\n                            { label: \"คำขอทั้งหมด\", value: data.overview.totalApplications, Icon: IconDocument, bgColor: \"bg-emerald-500\", trend: \"+12%\", up: true },\r\n                            { label: \"รอตรวจสอบ\", value: data.overview.pendingReview, Icon: IconChart, bgColor: \"bg-blue-500\", trend: \"-5%\", up: false },\r\n                            { label: \"ได้รับรอง\", value: data.overview.approved, Icon: IconCheckCircle, bgColor: \"bg-emerald-500\", trend: \"+8%\", up: true },\r\n                            { label: \"ไม่ผ่าน\", value: data.overview.rejected, Icon: IconDocument, bgColor: \"bg-red-500\", trend: \"-2%\", up: false },\r\n                        ].map((card, i) => (\r\n                            <div key={i} className={`p-5 rounded-xl border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                                <div className=\"flex items-center justify-between mb-3\">\r\n                                    <span className=\"text-sm text-slate-500\">{card.label}</span>\r\n                                    <div className={`w-8 h-8 rounded-lg ${card.bgColor} flex items-center justify-center`}>\r\n                                        <card.Icon size={16} className=\"text-white\" />\r\n                                    </div>\r\n                                </div>\r\n                                <p className=\"text-2xl font-semibold\">{card.value.toLocaleString()}</p>\r\n                                <div className=\"flex items-center gap-1 mt-2\">\r\n                                    <span className={`text-xs ${card.up ? 'text-emerald-500' : 'text-red-500'}`}>{card.up ? '↑' : '↓'} {card.trend}</span>\r\n                                    <span className=\"text-xs text-slate-500\">vs เดือนก่อน</span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Charts Row */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8\">\r\n                        {/* Monthly Trend */}\r\n                        <div className={`lg:col-span-2 p-5 rounded-xl border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                            <h3 className=\"flex items-center gap-2 text-base font-semibold mb-5\"><IconTrendUp size={18} className=\"text-emerald-600\" /> แนวโน้มรายเดือน</h3>\r\n                            <div className=\"flex items-end h-48 gap-2\">\r\n                                {data.monthlyTrend.map((m, i) => (\r\n                                    <div key={i} className=\"flex-1 flex flex-col items-center gap-1\">\r\n                                        <div className=\"w-full flex gap-0.5 justify-center\">\r\n                                            <div className=\"w-[40%] bg-emerald-500/30 rounded-t\" style={{ height: `${(m.applications / 120) * 160}px` }} />\r\n                                            <div className=\"w-[40%] bg-emerald-500 rounded-t\" style={{ height: `${(m.approved / 120) * 160}px` }} />\r\n                                        </div>\r\n                                        <span className=\"text-[10px] text-slate-500\">{months[i]}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                            <div className=\"flex justify-center gap-6 mt-4\">\r\n                                <div className=\"flex items-center gap-2\"><div className=\"w-3 h-3 bg-emerald-500/30 rounded\" /><span className=\"text-xs text-slate-500\">คำขอใหม่</span></div>\r\n                                <div className=\"flex items-center gap-2\"><div className=\"w-3 h-3 bg-emerald-500 rounded\" /><span className=\"text-xs text-slate-500\">ได้รับรอง</span></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* By Plant Type */}\r\n                        <div className={`p-5 rounded-xl border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                            <h3 className=\"flex items-center gap-2 text-base font-semibold mb-5\"><IconLeaf size={18} className=\"text-emerald-600\" /> ตามประเภทพืช</h3>\r\n                            <div className=\"space-y-3\">\r\n                                {Object.entries(data.byPlantType).slice(0, 5).map(([name, count], i) => (\r\n                                    <div key={name}>\r\n                                        <div className=\"flex justify-between text-sm mb-1\"><span>{name}</span><span className=\"font-semibold\">{count}</span></div>\r\n                                        <div className={`h-2 rounded-full overflow-hidden ${isDark ? 'bg-slate-700' : 'bg-slate-200'}`}>\r\n                                            <div className={`h-full ${chartColors[i % chartColors.length]} rounded-full`} style={{ width: `${(count / getMaxValue(data.byPlantType)) * 100}%` }} />\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bottom Row */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n                        {/* By Status */}\r\n                        <div className={`p-5 rounded-xl border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                            <h3 className=\"flex items-center gap-2 text-base font-semibold mb-5\"><IconDocument size={18} className=\"text-emerald-600\" /> ตามสถานะ</h3>\r\n                            <div className=\"space-y-2.5\">\r\n                                {Object.entries(data.byStatus).map(([status, count], i) => {\r\n                                    const labels: Record<string, string> = { CERTIFIED: 'ได้รับรอง', AUDIT_PENDING: 'รอตรวจ', SUBMITTED: 'ยื่นแล้ว', PAYMENT_1_PENDING: 'รอชำระ 1', DRAFT: 'ร่าง', REVISION_REQ: 'ต้องแก้ไข' };\r\n                                    return (\r\n                                        <div key={status} className=\"flex items-center gap-3\">\r\n                                            <div className={`w-2.5 h-2.5 ${chartColors[i % chartColors.length]} rounded`} />\r\n                                            <span className=\"flex-1 text-sm text-slate-500\">{labels[status] || status}</span>\r\n                                            <span className=\"text-sm font-semibold\">{count}</span>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* By Province */}\r\n                        <div className={`p-5 rounded-xl border ${isDark ? 'bg-slate-800/50 border-slate-700/50' : 'bg-white border-slate-200'}`}>\r\n                            <h3 className=\"flex items-center gap-2 text-base font-semibold mb-5\"><IconMapPin size={18} className=\"text-emerald-600\" /> ตามจังหวัด (Top 5)</h3>\r\n                            <div className=\"space-y-3\">\r\n                                {Object.entries(data.byProvince).slice(0, 5).map(([name, count], i) => (\r\n                                    <div key={name}>\r\n                                        <div className=\"flex justify-between text-sm mb-1\"><span>{name}</span><span className=\"font-semibold\">{count}</span></div>\r\n                                        <div className={`h-2 rounded-full overflow-hidden ${isDark ? 'bg-slate-700' : 'bg-slate-200'}`}>\r\n                                            <div className={`h-full ${chartColors[(i + 2) % chartColors.length]} rounded-full`} style={{ width: `${(count / getMaxValue(data.byProvince)) * 100}%` }} />\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            ) : null}\r\n        </StaffLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\applications\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3059,3062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3059,3062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSubmitting' is assigned a value but never used.","line":93,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { IconDocument, IconCheckCircle, IconSearch } from \"@/components/ui/icons\";\r\n\r\n// Additional icons\r\nconst IconClock = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n        <polyline points=\"12 6 12 12 16 14\" />\r\n    </svg>\r\n);\r\n\r\nconst IconX = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\r\n        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\r\n    </svg>\r\n);\r\n\r\nconst IconEye = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" />\r\n        <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n    </svg>\r\n);\r\n\r\nconst IconWarning = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\" />\r\n        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\" />\r\n        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n    </svg>\r\n);\r\n\r\nconst IconReturn = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <polyline points=\"9 10 4 15 9 20\" />\r\n        <path d=\"M20 4v7a4 4 0 0 1-4 4H4\" />\r\n    </svg>\r\n);\r\n\r\nconst IconVideo = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <polygon points=\"23 7 16 12 23 17 23 7\" />\r\n        <rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\" />\r\n    </svg>\r\n);\r\n\r\ninterface Application {\r\n    id: string;\r\n    applicantName: string;\r\n    applicantType: string;\r\n    plantType: string;\r\n    areaType?: string; // [NEW]\r\n    status: string;\r\n    phase: number;\r\n    submissionCount: number;\r\n    submittedAt: string;\r\n    lastUpdatedAt: string;\r\n    slaTimer: string;\r\n    documents: { name: string; status: string; url: string; metadata?: any }[];\r\n    reviewHistory: { date: string; action: string; comment: string; by: string }[];\r\n    auditRecord?: { checklist: { item: string; passed: boolean }[]; photos: string[]; result: string };\r\n    payments: { phase: number; amount: number; paidAt: string }[];\r\n    youtubeUrl?: string; // Feature: Visual Evidence\r\n}\r\n\r\nconst STATUS_LABELS: Record<string, { label: string; color: string }> = {\r\n    SUBMITTED: { label: \"ยื่นคำขอ\", color: \"bg-slate-100 text-slate-700\" },\r\n    PAID_PHASE_1: { label: \"จ่ายงวด 1\", color: \"bg-blue-100 text-blue-700\" },\r\n    PENDING_REVIEW: { label: \"รอตรวจเอกสาร\", color: \"bg-amber-100 text-amber-700\" },\r\n    REVISION_REQUIRED: { label: \"แก้ไขเอกสาร\", color: \"bg-red-100 text-red-700\" },\r\n    DOCUMENT_APPROVED: { label: \"เอกสารผ่าน\", color: \"bg-green-100 text-green-700\" },\r\n    PAID_PHASE_2: { label: \"จ่ายงวด 2\", color: \"bg-blue-100 text-blue-700\" },\r\n    PENDING_SCHEDULE: { label: \"รอจัดคิว\", color: \"bg-purple-100 text-purple-700\" },\r\n    SCHEDULED: { label: \"นัดหมายแล้ว\", color: \"bg-purple-100 text-purple-700\" },\r\n    PENDING_AUDIT: { label: \"รอตรวจประเมิน\", color: \"bg-amber-100 text-amber-700\" },\r\n    AUDIT_PASSED: { label: \"ตรวจผ่าน\", color: \"bg-green-100 text-green-700\" },\r\n    APPROVED: { label: \"อนุมัติ\", color: \"bg-emerald-100 text-emerald-700\" },\r\n};\r\n\r\nexport default function JobSheetPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const [app, setApp] = useState<Application | null>(null);\r\n    const [activeTab, setActiveTab] = useState<\"documents\" | \"history\" | \"audit\">(\"documents\");\r\n    const [showActionModal, setShowActionModal] = useState(false);\r\n    const [actionType, setActionType] = useState<\"approve\" | \"reject\">(\"approve\");\r\n    const [comment, setComment] = useState(\"\");\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        if (!token) {\r\n            router.push(\"/staff/login\");\r\n            return;\r\n        }\r\n\r\n        // Fetch real application data\r\n        const fetchApplication = async () => {\r\n            try {\r\n                const res = await fetch(`/api/applications/${params.id}`, {\r\n                    headers: { 'Authorization': `Bearer ${token}` }\r\n                });\r\n                if (res.ok) {\r\n                    const result = await res.json();\r\n                    if (result.success && result.data) {\r\n                        const data = result.data;\r\n                        const formData = data.formData || {}; // Correctly access formData\r\n\r\n                        setApp({\r\n                            id: data._id || data.id || params.id as string,\r\n                            applicantName: formData.applicantData?.name || formData.applicantData?.firstName ? `${formData.applicantData?.firstName} ${formData.applicantData?.lastName}` : 'ไม่ระบุชื่อ',\r\n                            applicantType: formData.applicantData?.applicantType || 'บุคคลธรรมดา',\r\n                            plantType: formData.plantName || formData.plantId || 'ไม่ระบุ',\r\n                            areaType: data.areaType || formData.areaType || 'OUTDOOR', // Map areaType\r\n                            status: data.status,\r\n                            phase: data.status?.includes('AUDIT') ? 2 : 1,\r\n                            submissionCount: (data.rejectCount || 0) + 1,\r\n                            submittedAt: data.createdAt?.split('T')[0] || '-',\r\n                            lastUpdatedAt: data.updatedAt || data.createdAt || '-',\r\n                            slaTimer: getSLATimer(data.createdAt),\r\n                            documents: formData.documents || [], // Get from formData\r\n                            reviewHistory: [],\r\n                            payments: [],\r\n                            youtubeUrl: formData.youtubeUrl // Extract YouTube URL\r\n                        });\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('Error fetching application:', error);\r\n            }\r\n        };\r\n        fetchApplication();\r\n    }, [params.id, router]);\r\n\r\n    const getSLATimer = (createdAt: string): string => {\r\n        if (!createdAt) return '-';\r\n        const created = new Date(createdAt);\r\n        const now = new Date();\r\n        const diffDays = Math.floor((now.getTime() - created.getTime()) / (1000 * 60 * 60 * 24));\r\n        if (diffDays <= 3) return `${diffDays} วัน`;\r\n        if (diffDays <= 5) return `${diffDays} วัน`;\r\n        return `${diffDays} วัน - เกิน SLA`;\r\n    };\r\n\r\n    const handleAction = (type: \"approve\" | \"reject\") => {\r\n        setActionType(type);\r\n        setComment(\"\");\r\n        setShowActionModal(true);\r\n    };\r\n\r\n    const submitAction = async () => {\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        if (!token || !app) return;\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            const res = await fetch(`/api/applications/${app.id}/review`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    action: actionType === \"approve\" ? \"APPROVE\" : \"REJECT\",\r\n                    comment: comment\r\n                })\r\n            });\r\n\r\n            if (res.ok) {\r\n                alert(`${actionType === \"approve\" ? \"อนุมัติสำเร็จ\" : \"ส่งคืนแก้ไขสำเร็จ\"}`);\r\n                setShowActionModal(false);\r\n                router.push('/staff/dashboard');\r\n            } else {\r\n                const err = await res.json();\r\n                alert(`เกิดข้อผิดพลาด: ${err.error || 'ไม่ทราบสาเหตุ'}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Submit error:', error);\r\n            alert('เกิดข้อผิดพลาดในการส่งข้อมูล');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    if (!app) {\r\n        return <div className=\"min-h-screen flex items-center justify-center\"><div className=\"w-10 h-10 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin\"></div></div>;\r\n    }\r\n\r\n    const statusInfo = STATUS_LABELS[app.status] || { label: app.status, color: \"bg-slate-100\" };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50\">\r\n            {/* Header */}\r\n            <header className=\"bg-slate-800 text-white shadow-lg sticky top-0 z-10\">\r\n                <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <Link href=\"/staff/dashboard\" className=\"text-slate-400 hover:text-white\">← กลับ</Link>\r\n                            <div className=\"h-10 w-px bg-slate-600\" />\r\n                            <div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <p className=\"font-mono text-lg\">{app.id}</p>\r\n                                    <span className={`px-2 py-1 rounded-full text-xs ${statusInfo.color}`}>{statusInfo.label}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2 text-slate-400 text-sm mt-1\">\r\n                                    <span>{app.applicantName}</span>\r\n                                    <span>•</span>\r\n                                    <span>{app.plantType}</span>\r\n                                    {app.areaType && (\r\n                                        <>\r\n                                            <span>•</span>\r\n                                            <span className=\"text-emerald-400 font-medium\">\r\n                                                {app.areaType === 'GREENHOUSE' ? 'โรงเรือน (Greenhouse)' :\r\n                                                    app.areaType === 'INDOOR' ? 'ระบบปิด (Indoor)' : 'กลางแจ้ง (Outdoor)'}\r\n                                            </span>\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className={`px-3 py-1 rounded-lg ${app.slaTimer.includes(\"เลย\") ? \"bg-red-500\" : app.slaTimer.includes(\"วัน\") ? \"bg-amber-500\" : \"bg-green-500\"\r\n                                }`}>\r\n                                <p className=\"text-xs\">SLA Timer</p>\r\n                                <p className=\"font-bold\">{app.slaTimer}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Progress Bar */}\r\n                    <div className=\"mt-4 flex items-center gap-2 text-sm\">\r\n                        {[\r\n                            { label: \"ยื่นคำขอ\", done: true },\r\n                            { label: \"จ่ายงวด 1\", done: true },\r\n                            { label: \"ตรวจเอกสาร\", done: false, active: app.phase === 1 },\r\n                            { label: \"จ่ายงวด 2\", done: false },\r\n                            { label: \"ตรวจประเมิน\", done: false, active: app.phase === 2 },\r\n                            { label: \"อนุมัติ\", done: false },\r\n                        ].map((step, i) => (\r\n                            <div key={i} className=\"flex items-center gap-2\">\r\n                                <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs ${step.done ? \"bg-green-500 text-white\" :\r\n                                    step.active ? \"bg-blue-500 text-white animate-pulse\" :\r\n                                        \"bg-slate-600 text-slate-400\"\r\n                                    }`}>\r\n                                    {step.done ? \"✓\" : i + 1}\r\n                                </div>\r\n                                <span className={step.active ? \"text-white font-bold\" : \"text-slate-400\"}>{step.label}</span>\r\n                                {i < 5 && <span className=\"text-slate-600\">→</span>}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"max-w-7xl mx-auto px-6 py-8\">\r\n                {/* Tabs */}\r\n                <div className=\"flex gap-2 mb-6\">\r\n                    {[\r\n                        { id: \"documents\", label: \"เอกสาร\", count: app.documents.length, Icon: IconDocument },\r\n                        { id: \"history\", label: \"ประวัติ\", count: app.reviewHistory.length, Icon: IconDocument },\r\n                        { id: \"audit\", label: \"ผลตรวจประเมิน\", disabled: app.phase < 2, Icon: IconSearch },\r\n                    ].map((tab) => (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => !tab.disabled && setActiveTab(tab.id as typeof activeTab)}\r\n                            disabled={tab.disabled}\r\n                            className={`px-6 py-3 rounded-xl font-semibold transition-all ${activeTab === tab.id\r\n                                ? \"bg-slate-800 text-white\"\r\n                                : tab.disabled\r\n                                    ? \"bg-slate-100 text-slate-400 cursor-not-allowed\"\r\n                                    : \"bg-white text-slate-600 hover:bg-slate-50\"\r\n                                }`}\r\n                        >\r\n                            {tab.label} {tab.count !== undefined && `(${tab.count})`}\r\n                        </button>\r\n                    ))}\r\n\r\n                    {/* Submission Counter */}\r\n                    <div className={`ml-auto px-4 py-3 rounded-xl font-semibold ${app.submissionCount >= 3 ? \"bg-red-100 text-red-700\" :\r\n                        app.submissionCount === 2 ? \"bg-amber-100 text-amber-700\" :\r\n                            \"bg-green-100 text-green-700\"\r\n                        }`}>\r\n                        ส่งครั้งที่: {app.submissionCount}/3\r\n                        {app.submissionCount >= 3 && \" (ครบโควตาฟรี)\"}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Tab Content */}\r\n                {activeTab === \"documents\" && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg overflow-hidden\">\r\n                        <div className=\"px-6 py-4 border-b\">\r\n                            <h3 className=\"font-semibold\">เอกสารแนบ ({app.documents.length} รายการ)</h3>\r\n                        </div>\r\n\r\n                        {/* Visual Evidence Section */}\r\n                        {app.youtubeUrl && (\r\n                            <div className=\"p-4 bg-blue-50/50 border-b border-blue-100 flex items-start gap-4\">\r\n                                <div className=\"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600 shrink-0\">\r\n                                    <IconVideo size={20} />\r\n                                </div>\r\n                                <div className=\"flex-1\">\r\n                                    <h4 className=\"font-semibold text-blue-900 mb-1\">สื่อบันทึกภาพ/วิดีโอ (Evidence)</h4>\r\n                                    <p className=\"text-sm text-blue-700 mb-2\">เกษตรกรได้แนบลิงก์วิดีโอแนะนำฟาร์ม/แปลงปลูก</p>\r\n                                    <a\r\n                                        href={app.youtubeUrl}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline bg-white px-3 py-1.5 rounded-lg border border-blue-200 shadow-sm transition-colors\"\r\n                                    >\r\n                                        <IconVideo size={16} />\r\n                                        เปิดดูวิดีโอ (YouTube)\r\n                                    </a>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <div className=\"divide-y\">\r\n                            {app.documents.map((doc, i) => (\r\n                                <div key={i} className=\"p-4 hover:bg-slate-50 border-b last:border-b-0\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${doc.status === \"verified\" ? \"bg-green-100\" :\r\n                                            doc.status === \"issue\" ? \"bg-red-100\" :\r\n                                                \"bg-amber-100\"\r\n                                            }`}>\r\n                                            {doc.status === \"verified\" ? <IconCheckCircle size={16} className=\"text-green-600\" /> : doc.status === \"issue\" ? <IconX size={16} className=\"text-red-600\" /> : <IconClock size={16} className=\"text-amber-600\" />}\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <p className=\"font-medium\">{doc.name}</p>\r\n                                            <p className={`text-sm ${doc.status === \"verified\" ? \"text-green-600\" :\r\n                                                doc.status === \"issue\" ? \"text-red-600\" :\r\n                                                    \"text-amber-600\"\r\n                                                }`}>\r\n                                                {doc.status === \"verified\" ? \"ถูกต้อง\" : doc.status === \"issue\" ? \"ต้องแก้ไข\" : \"รอตรวจสอบ\"}\r\n                                            </p>\r\n                                        </div>\r\n                                        <button className=\"flex items-center gap-1.5 px-4 py-2 bg-slate-100 rounded-lg hover:bg-slate-200 text-sm\">\r\n                                            <IconEye size={14} /> Preview\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    {/* [NEW] Metadata Display (Land Info) */}\r\n                                    {doc.metadata?.area && (\r\n                                        <div className=\"ml-14 mt-2 bg-slate-100 rounded-lg p-3 text-xs w-fit border border-slate-200\">\r\n                                            <span className=\"font-bold text-slate-700 block mb-1\">\r\n                                                ข้อมูลที่ดิน ({doc.metadata.manualEntry ? 'Manual Edited' : 'AI Extracted'})\r\n                                            </span>\r\n                                            <div className=\"flex gap-4 text-slate-600\">\r\n                                                <span>ไร่: <b className=\"text-slate-900\">{doc.metadata.area.rai}</b></span>\r\n                                                <span>งาน: <b className=\"text-slate-900\">{doc.metadata.area.ngan}</b></span>\r\n                                                <span>ตร.ว.: <b className=\"text-slate-900\">{doc.metadata.area.sqWa}</b></span>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n\r\n                {\r\n                    activeTab === \"history\" && (\r\n                        <div className=\"bg-white rounded-2xl shadow-lg overflow-hidden\">\r\n                            <div className=\"px-6 py-4 border-b\">\r\n                                <h3 className=\"font-semibold\">ประวัติการดำเนินการ</h3>\r\n                            </div>\r\n                            <div className=\"p-6\">\r\n                                <div className=\"relative pl-8\">\r\n                                    {app.reviewHistory.map((item, i) => (\r\n                                        <div key={i} className=\"relative pb-8 last:pb-0\">\r\n                                            {i < app.reviewHistory.length - 1 && (\r\n                                                <div className=\"absolute left-[-20px] top-6 w-0.5 h-full bg-slate-200\" />\r\n                                            )}\r\n                                            <div className=\"absolute left-[-24px] w-3 h-3 rounded-full bg-emerald-500 border-2 border-white\" />\r\n                                            <div className=\"bg-slate-50 rounded-xl p-4\">\r\n                                                <div className=\"flex justify-between items-start mb-2\">\r\n                                                    <p className=\"font-semibold\">{item.action}</p>\r\n                                                    <p className=\"text-sm text-slate-500\">{item.date}</p>\r\n                                                </div>\r\n                                                <p className=\"text-slate-600\">{item.comment}</p>\r\n                                                <p className=\"text-sm text-slate-400 mt-1\">โดย: {item.by}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n                {/* Action Bar - Fixed at bottom during Phase 1 */}\r\n                {\r\n                    app.phase === 1 && (\r\n                        <div className=\"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4\">\r\n                            <div className=\"max-w-7xl mx-auto flex justify-end gap-4\">\r\n                                <button\r\n                                    onClick={() => handleAction(\"reject\")}\r\n                                    className=\"px-8 py-3 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700 flex items-center gap-2\"\r\n                                >\r\n                                    <IconReturn size={16} /> ส่งคืนแก้ไข\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleAction(\"approve\")}\r\n                                    className=\"px-8 py-3 bg-emerald-600 text-white rounded-xl font-semibold hover:bg-emerald-700 flex items-center gap-2\"\r\n                                >\r\n                                    <IconCheckCircle size={16} /> อนุมัติเอกสาร\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n            </main >\r\n\r\n            {/* Action Modal */}\r\n            {\r\n                showActionModal && (\r\n                    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\r\n                        <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md\">\r\n                            <div className=\"px-6 py-4 border-b\">\r\n                                <h3 className=\"text-lg font-semibold\">\r\n                                    {actionType === \"approve\" ? <><IconCheckCircle size={16} /> ยืนยันอนุมัติเอกสาร</> : <><IconReturn size={16} /> ส่งคืนแก้ไข</>}\r\n                                </h3>\r\n                            </div>\r\n                            <div className=\"p-6 space-y-4\">\r\n                                {actionType === \"reject\" && (\r\n                                    <div className=\"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg text-amber-700 text-sm\">\r\n                                        <IconWarning size={16} /> ผู้สมัครแก้ไขฟรี {3 - app.submissionCount} ครั้ง หลังจากนั้นต้องชำระค่าธรรมเนียมใหม่\r\n                                    </div>\r\n                                )}\r\n                                <textarea\r\n                                    value={comment}\r\n                                    onChange={(e) => setComment(e.target.value)}\r\n                                    placeholder={actionType === \"approve\" ? \"หมายเหตุ (ถ้ามี)...\" : \"ระบุจุดที่ต้องแก้ไขอย่างละเอียด...\"}\r\n                                    rows={4}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg\"\r\n                                    required={actionType === \"reject\"}\r\n                                />\r\n                                <div className=\"flex gap-3\">\r\n                                    <button onClick={() => setShowActionModal(false)} className=\"flex-1 py-3 border border-slate-300 rounded-xl\">\r\n                                        ยกเลิก\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={submitAction}\r\n                                        disabled={actionType === \"reject\" && !comment}\r\n                                        className={`flex-1 py-3 text-white rounded-xl disabled:opacity-50 ${actionType === \"approve\" ? \"bg-emerald-600 hover:bg-emerald-700\" : \"bg-red-600 hover:bg-red-700\"\r\n                                            }`}\r\n                                    >\r\n                                        ยืนยัน\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\applications\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\audits\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconWarning' is assigned a value but never used.","line":31,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSaving' is assigned a value but never used.","line":102,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\nimport { IconDocument, IconCheckCircle } from \"@/components/ui/icons\";\r\n\r\n// Additional icons for this page\r\nconst IconVideo = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <polygon points=\"23 7 16 12 23 17 23 7\" />\r\n        <rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\" />\r\n    </svg>\r\n);\r\n\r\nconst IconMapPin = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\" />\r\n        <circle cx=\"12\" cy=\"10\" r=\"3\" />\r\n    </svg>\r\n);\r\n\r\nconst IconX = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\r\n        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\r\n    </svg>\r\n);\r\n\r\nconst IconWarning = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\" />\r\n        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\" />\r\n        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n    </svg>\r\n);\r\n\r\ninterface ChecklistItem {\r\n    itemCode: string;\r\n    category: string;\r\n    title?: string;\r\n    titleTh?: string;\r\n    response: \"PASS\" | \"FAIL\" | \"NA\" | \"PENDING\";\r\n    notes?: string;\r\n    photos?: { url: string; caption?: string }[];\r\n}\r\n\r\ninterface AuditDetail {\r\n    _id: string;\r\n    auditNumber: string;\r\n    applicationNumber: string;\r\n    farmerName: string;\r\n    farmName?: string;\r\n    plantType?: string;\r\n    auditMode: \"ONLINE\" | \"ONSITE\" | \"HYBRID\";\r\n    status: string;\r\n    scheduledDate: string;\r\n    scheduledTime?: string;\r\n    onlineSession?: {\r\n        platform: string;\r\n        meetingUrl?: string;\r\n        meetingId?: string;\r\n    };\r\n    farmLocation?: {\r\n        address: string;\r\n        province: string;\r\n    };\r\n    responses: ChecklistItem[];\r\n    overallScore?: number;\r\n    result?: string;\r\n}\r\n\r\ninterface TemplateItem {\r\n    itemCode: string;\r\n    title: string;\r\n    titleTh: string;\r\n    category: string;\r\n    checkType: string;\r\n    isCritical?: boolean;\r\n}\r\n\r\ninterface AuditTemplate {\r\n    templateCode: string;\r\n    nameTh: string;\r\n    categories: {\r\n        categoryCode: string;\r\n        nameTh: string;\r\n        items: TemplateItem[];\r\n    }[];\r\n}\r\n\r\nexport default function AuditDetailPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const [audit, setAudit] = useState<AuditDetail | null>(null);\r\n    const [template, setTemplate] = useState<AuditTemplate | null>(null);\r\n    const [showResultModal, setShowResultModal] = useState(false);\r\n    const [result, setResult] = useState<\"PASS\" | \"MINOR\" | \"MAJOR\">(\"PASS\");\r\n    const [resultNote, setResultNote] = useState(\"\");\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [activeCategory, setActiveCategory] = useState<string>(\"\");\r\n\r\n    const fetchAudit = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            // Fetch audit details\r\n            const auditResult = await api.get<{ data: AuditDetail }>(`/api/audits/${params.id}`);\r\n            if (auditResult.success && auditResult.data?.data) {\r\n                setAudit(auditResult.data.data);\r\n\r\n                // Fetch template if needed\r\n                const templateCode = (auditResult.data.data as unknown as { templateCode?: string }).templateCode;\r\n                if (templateCode) {\r\n                    // Assuming template route might still be under field-audits or needs migration. \r\n                    // For now, let's keep it or if it fails, handle gracefully.\r\n                    // Or map it to a new public/master-data endpoint if available.\r\n                    // Let's assume templates are still fetched via old route or we mock them.\r\n                    // If templates endpoint is missing, this might fail.\r\n                    try {\r\n                        const templateResult = await api.get<{ data: AuditTemplate }>(`/api/field-audits/templates/${templateCode}`);\r\n                        if (templateResult.success && templateResult.data?.data) {\r\n                            setTemplate(templateResult.data.data);\r\n                            setActiveCategory(templateResult.data.data.categories[0]?.categoryCode || \"\");\r\n                        }\r\n                    } catch (e) {\r\n                        // Fallback/Silent fail for template\r\n                        console.warn(\"Template fetch failed\", e);\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching audit:\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [params.id]);\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        if (!token) {\r\n            router.push(\"/staff/login\");\r\n            return;\r\n        }\r\n        fetchAudit();\r\n    }, [router, fetchAudit]);\r\n\r\n    const updateResponse = (itemCode: string, response: \"PASS\" | \"FAIL\" | \"NA\", notes?: string) => {\r\n        if (!audit) return;\r\n        setAudit({\r\n            ...audit,\r\n            responses: audit.responses.map((r: ChecklistItem) =>\r\n                r.itemCode === itemCode ? { ...r, response, notes: notes ?? r.notes } : r\r\n            ),\r\n        });\r\n    };\r\n\r\n    const handleSubmitResult = async () => {\r\n        if (!audit) return;\r\n        setIsSaving(true);\r\n        try {\r\n            await api.post(`/api/audits/${audit._id}/result`, {\r\n                result: result, // 'PASS' | 'Incomplete/FAIL' mapped by backend? Backend expects result='PASS' or something?\r\n                // Backend logic: const newStatus = result === 'PASS' ? 'APPROVED' : 'REVISION_REQUIRED';\r\n                // Frontend 'result' state can be \"PASS\" | \"MINOR\" | \"MAJOR\".\r\n                // I need to map MINOR/MAJOR to backend expectation if needed. \r\n                // Backend expects 'PASS' or 'FAIL' ideally.\r\n                // Or I update backend to handle MINOR/MAJOR?\r\n                // The backend `submitResult` checks `if (result === 'PASS')`. \r\n                // So MINOR/MAJOR will go to REVISION_REQUIRED, which is correct (Audit Failed/Revision).\r\n                notes: resultNote,\r\n                auditMode: audit.auditMode,\r\n                checklist: audit.responses\r\n            });\r\n            router.push(\"/staff/dashboard\");\r\n        } catch (error) {\r\n            console.error(\"Error submitting result:\", error);\r\n            alert(\"เกิดข้อผิดพลาดในการบันทึกผล\");\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    if (isLoading || !audit) {\r\n        return <div className=\"min-h-screen flex items-center justify-center\"><div className=\"w-10 h-10 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin\"></div></div>;\r\n    }\r\n\r\n    const completedChecks = audit.responses.filter((r: ChecklistItem) => r.response !== \"PENDING\").length;\r\n    const passedChecks = audit.responses.filter((r: ChecklistItem) => r.response === \"PASS\").length;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50\">\r\n            {/* Header */}\r\n            <header className=\"bg-slate-800 text-white shadow-lg sticky top-0 z-10\">\r\n                <div className=\"max-w-7xl mx-auto px-6 py-4 flex justify-between items-center\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <Link href=\"/staff/dashboard\" className=\"text-slate-400 hover:text-white\">← กลับ</Link>\r\n                        <div className=\"h-6 w-px bg-slate-600\" />\r\n                        <div>\r\n                            <p className=\"font-mono text-sm text-slate-400\">{audit.auditNumber}</p>\r\n                            <h1 className=\"font-bold\">{audit.farmerName}</h1>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {audit.auditMode === \"ONLINE\" && audit.onlineSession?.meetingUrl && (\r\n                            <a\r\n                                href={audit.onlineSession.meetingUrl}\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className=\"flex items-center gap-2 px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700\"\r\n                            >\r\n                                <IconVideo size={20} />\r\n                                <span>เข้าห้อง VDO Call</span>\r\n                            </a>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"max-w-7xl mx-auto px-6 py-8\">\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                    {/* Left: Info & Documents */}\r\n                    <div className=\"lg:col-span-1 space-y-6\">\r\n                        {/* Appointment Info */}\r\n                        <div className=\"bg-white rounded-2xl shadow-lg p-6\">\r\n                            <h3 className=\"flex items-center gap-2 font-semibold mb-4\"><IconDocument size={18} className=\"text-emerald-600\" /> ข้อมูลนัดหมาย</h3>\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-slate-500\">พืช:</span>\r\n                                    <span className=\"font-medium\">{audit.plantType}</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-slate-500\">วันที่:</span>\r\n                                    <span className=\"font-medium\">{new Date(audit.scheduledDate).toLocaleDateString(\"th-TH\")}</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-slate-500\">เวลา:</span>\r\n                                    <span className=\"font-medium\">{audit.scheduledTime} น.</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-slate-500\">รูปแบบ:</span>\r\n                                    <span className={`px-2 py-1 rounded-full text-xs ${audit.auditMode === \"ONLINE\" ? \"bg-blue-100 text-blue-700\" : \"bg-purple-100 text-purple-700\"\r\n                                        }`}>\r\n                                        {audit.auditMode === \"ONLINE\" ? <><IconVideo size={12} /> VDO Call</> : <><IconMapPin size={12} /> ลงพื้นที่</>}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {audit.auditMode === \"ONLINE\" && audit.onlineSession?.meetingUrl && (\r\n                                <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\r\n                                    <p className=\"text-xs text-blue-600 mb-1\">ลิงก์ห้องประชุม:</p>\r\n                                    <a href={audit.onlineSession.meetingUrl} target=\"_blank\" className=\"text-blue-700 underline text-sm break-all\">\r\n                                        {audit.onlineSession.meetingUrl}\r\n                                    </a>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Template Info */}\r\n                        <div className=\"bg-white rounded-2xl shadow-lg p-6\">\r\n                            <h3 className=\"flex items-center gap-2 font-semibold mb-4\"><IconDocument size={18} className=\"text-emerald-600\" /> ข้อมูล Template</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {template ? (\r\n                                    <>\r\n                                        <p className=\"text-sm text-slate-600\">Template: {template.nameTh}</p>\r\n                                        <p className=\"text-xs text-slate-500\">รหัส: {template.templateCode}</p>\r\n                                        <div className=\"flex flex-wrap gap-1 mt-2\">\r\n                                            {template.categories.map((cat) => (\r\n                                                <button\r\n                                                    key={cat.categoryCode}\r\n                                                    onClick={() => setActiveCategory(cat.categoryCode)}\r\n                                                    className={`px-2 py-1 text-xs rounded ${activeCategory === cat.categoryCode\r\n                                                        ? \"bg-emerald-600 text-white\"\r\n                                                        : \"bg-slate-100 text-slate-600 hover:bg-slate-200\"\r\n                                                        }`}\r\n                                                >\r\n                                                    {cat.nameTh}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </>\r\n                                ) : (\r\n                                    <p className=\"text-sm text-slate-400\">กำลังโหลด...</p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right: Checklist */}\r\n                    <div className=\"lg:col-span-2\">\r\n                        <div className=\"bg-white rounded-2xl shadow-lg overflow-hidden\">\r\n                            <div className=\"px-6 py-4 border-b flex justify-between items-center\">\r\n                                <h3 className=\"flex items-center gap-2 font-semibold\"><IconCheckCircle size={18} className=\"text-emerald-600\" /> Checklist การตรวจประเมิน</h3>\r\n                                <span className=\"text-sm text-slate-500\">\r\n                                    {completedChecks}/{audit.responses.length} รายการ | ผ่าน {passedChecks} รายการ\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"divide-y\">\r\n                                {audit.responses.map((item: ChecklistItem, idx: number) => (\r\n                                    <div key={item.itemCode} className=\"p-4 hover:bg-slate-50\">\r\n                                        <div className=\"flex items-start gap-4\">\r\n                                            <span className=\"text-lg font-mono text-slate-400\">{idx + 1}.</span>\r\n                                            <div className=\"flex-1\">\r\n                                                <p className=\"font-medium\">{item.titleTh || item.itemCode}</p>\r\n                                                <p className=\"text-xs text-slate-400 mt-1\">{item.itemCode}</p>\r\n                                                <div className=\"flex gap-2 mt-2\">\r\n                                                    <button\r\n                                                        onClick={() => updateResponse(item.itemCode, \"PASS\")}\r\n                                                        className={`px-4 py-1 rounded-lg text-sm transition-all ${item.response === \"PASS\"\r\n                                                            ? \"bg-green-600 text-white\"\r\n                                                            : \"bg-green-100 text-green-700 hover:bg-green-200\"\r\n                                                            }`}\r\n                                                    >\r\n                                                        ผ่าน\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => updateResponse(item.itemCode, \"FAIL\")}\r\n                                                        className={`px-4 py-1 rounded-lg text-sm transition-all ${item.response === \"FAIL\"\r\n                                                            ? \"bg-red-600 text-white\"\r\n                                                            : \"bg-red-100 text-red-700 hover:bg-red-200\"\r\n                                                            }`}\r\n                                                    >\r\n                                                        ไม่ผ่าน\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => updateResponse(item.itemCode, \"NA\")}\r\n                                                        className={`px-4 py-1 rounded-lg text-sm transition-all ${item.response === \"NA\"\r\n                                                            ? \"bg-slate-600 text-white\"\r\n                                                            : \"bg-slate-100 text-slate-700 hover:bg-slate-200\"\r\n                                                            }`}\r\n                                                    >\r\n                                                        N/A\r\n                                                    </button>\r\n                                                </div>\r\n                                                {item.response === \"FAIL\" && (\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={item.notes || \"\"}\r\n                                                        onChange={(e) => updateResponse(item.itemCode, \"FAIL\", e.target.value)}\r\n                                                        placeholder=\"ระบุเหตุผล...\"\r\n                                                        className=\"mt-2 w-full px-3 py-2 border rounded-lg text-sm\"\r\n                                                    />\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"mt-6 flex gap-4\">\r\n                            <button\r\n                                onClick={() => { setResult(\"PASS\"); setShowResultModal(true); }}\r\n                                className=\"flex-1 py-4 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700\"\r\n                            >\r\n                                ผ่าน - ออกใบรับรอง\r\n                            </button>\r\n                            <button\r\n                                onClick={() => { setResult(\"MINOR\"); setShowResultModal(true); }}\r\n                                className=\"flex-1 py-4 bg-amber-500 text-white rounded-xl font-semibold hover:bg-amber-600\"\r\n                            >\r\n                                แก้ไขเล็กน้อย (Minor)\r\n                            </button>\r\n                            <button\r\n                                onClick={() => { setResult(\"MAJOR\"); setShowResultModal(true); }}\r\n                                className=\"flex-1 py-4 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700\"\r\n                            >\r\n                                ไม่ผ่าน/นัดใหม่ (Major)\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n\r\n            {/* Result Modal */}\r\n            {showResultModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\r\n                    <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md\">\r\n                        <div className=\"px-6 py-4 border-b flex justify-between items-center\">\r\n                            <h3 className=\"text-lg font-semibold\">\r\n                                {result === \"PASS\" && \"ยืนยันอนุมัติ\"}\r\n                                {result === \"MINOR\" && \"ขอข้อมูลเพิ่มเติม\"}\r\n                                {result === \"MAJOR\" && \"ไม่ผ่าน - ออก CARs\"}\r\n                            </h3>\r\n                            <button onClick={() => setShowResultModal(false)} className=\"text-slate-400 hover:text-slate-600\"><IconX size={20} /></button>\r\n                        </div>\r\n                        <div className=\"p-6 space-y-4\">\r\n                            <textarea\r\n                                value={resultNote}\r\n                                onChange={(e) => setResultNote(e.target.value)}\r\n                                placeholder={result === \"PASS\" ? \"หมายเหตุ (ถ้ามี)...\" : \"ระบุรายละเอียดที่ต้องแก้ไข...\"}\r\n                                rows={4}\r\n                                className=\"w-full px-3 py-2 border rounded-lg\"\r\n                            />\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => setShowResultModal(false)}\r\n                                    className=\"flex-1 py-3 border border-slate-300 rounded-xl\"\r\n                                >\r\n                                    ยกเลิก\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleSubmitResult}\r\n                                    className={`flex-1 py-3 text-white rounded-xl ${result === \"PASS\" ? \"bg-green-600 hover:bg-green-700\" :\r\n                                        result === \"MINOR\" ? \"bg-amber-500 hover:bg-amber-600\" :\r\n                                            \"bg-red-600 hover:bg-red-700\"\r\n                                        }`}\r\n                                >\r\n                                    ยืนยัน\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\audits\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\calendar\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\certificates\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\n\r\ninterface Certificate {\r\n    id: string; // The backend returns 'id', keeping it standard or need to check prisma response\r\n    certificateNumber: string;\r\n    siteName: string;\r\n    plantType: string;\r\n    issuedDate: string;\r\n    expiryDate: string;\r\n    status: string;\r\n}\r\n\r\nexport default function StaffCertificatesPage() {\r\n    const [certificates, setCertificates] = useState<Certificate[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        loadCertificates();\r\n    }, []);\r\n\r\n    const loadCertificates = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // The route in certificates.js for staff is GET /api/certificates\r\n            const result = await api.get<{ data: Certificate[] }>(\"/api/certificates\");\r\n            if (result.success && result.data?.data) {\r\n                setCertificates(result.data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-8\">\r\n            <h1 className=\"text-2xl font-bold mb-6 text-slate-800\">จัดการใบรับรอง (Certificates)</h1>\r\n\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                <table className=\"w-full text-left text-sm\">\r\n                    <thead className=\"bg-slate-50 border-b border-slate-200\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">เลขที่ใบรับรอง</th>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">ชื่อสถานที่</th>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">พืช</th>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">วันที่ออก</th>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">สถานะ</th>\r\n                            <th className=\"px-6 py-4 font-semibold text-slate-600\">จัดการ</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-slate-100\">\r\n                        {loading ? (\r\n                            <tr><td colSpan={6} className=\"px-6 py-8 text-center text-slate-500\">กำลังโหลด...</td></tr>\r\n                        ) : certificates.length === 0 ? (\r\n                            <tr><td colSpan={6} className=\"px-6 py-8 text-center text-slate-500\">ไม่พบใบรับรอง</td></tr>\r\n                        ) : (\r\n                            certificates.map((cert) => (\r\n                                <tr key={cert.id} className=\"hover:bg-slate-50 transition-colors\">\r\n                                    <td className=\"px-6 py-4 font-medium text-slate-900\">{cert.certificateNumber}</td>\r\n                                    <td className=\"px-6 py-4 text-slate-600\">{cert.siteName}</td>\r\n                                    <td className=\"px-6 py-4 text-slate-600\">{cert.plantType}</td>\r\n                                    <td className=\"px-6 py-4 text-slate-600\">{new Date(cert.issuedDate).toLocaleDateString(\"th-TH\")}</td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <span className={`px-2 py-1 rounded-full text-xs font-semibold ${cert.status.toUpperCase() === 'ACTIVE' ? 'bg-emerald-100 text-emerald-700' :\r\n                                                cert.status.toUpperCase() === 'EXPIRED' ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-600'\r\n                                            }`}>\r\n                                            {cert.status}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <button\r\n                                            onClick={() => window.open(`/api/certificates/${cert.id}/download`, '_blank')}\r\n                                            className=\"text-emerald-600 hover:text-emerald-700 font-medium text-xs border border-emerald-200 px-3 py-1.5 rounded-lg hover:bg-emerald-50\"\r\n                                        >\r\n                                            ดาวน์โหลด PDF\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\components\\StaffLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subtitle' is defined but never used.","line":66,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":64}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\components\\StaffLayout.tsx:75:9\n  73 |     useEffect(() => {\n  74 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 75 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  76 |         // Force slate/dark theme preference for staff if not set\n  77 |         const saved = localStorage.getItem(\"staff_theme\");\n  78 |         setIsDark(saved === \"light\" ? false : true);","line":75,"column":9,"nodeType":null,"endLine":75,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { usePathname, useRouter } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport {\r\n    IconHome, IconDocument, IconSearch, IconCalendar, IconCreditCard,\r\n    IconChart, IconUser, IconSun, IconMoon, IconLogout, IconCertificate\r\n} from \"@/components/ui/icons\";\r\n\r\ninterface StaffUser {\r\n    id: string;\r\n    firstName?: string;\r\n    lastName?: string;\r\n    email: string;\r\n    role: string;\r\n}\r\n\r\ninterface NavItem {\r\n    href: string;\r\n    Icon: React.FC<{ size?: number; className?: string }>;\r\n    label: string;\r\n    roles?: string[];\r\n}\r\n\r\nconst ROLE_LABELS: Record<string, { label: string }> = {\r\n    assessor: { label: \"ผู้ตรวจสอบ\" },\r\n    scheduler: { label: \"เจ้าหน้าที่จัดคิว\" },\r\n    accountant: { label: \"พนักงานบัญชี\" },\r\n    admin: { label: \"ผู้ดูแลระบบ\" },\r\n    REVIEWER_AUDITOR: { label: \"ผู้ตรวจสอบ\" },\r\n    SCHEDULER: { label: \"เจ้าหน้าที่จัดคิว\" },\r\n    ACCOUNTANT: { label: \"พนักงานบัญชี\" },\r\n    ADMIN: { label: \"ผู้ดูแลระบบ\" },\r\n    SUPER_ADMIN: { label: \"ผู้ดูแลสูงสุด\" },\r\n};\r\n\r\n// Users Management Icon\r\nconst IconUsers = ({ size = 24, className }: { size?: number; className?: string }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n        <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\r\n        <circle cx=\"9\" cy=\"7\" r=\"4\" />\r\n        <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\" />\r\n        <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\r\n    </svg>\r\n);\r\n\r\nconst NAV_ITEMS: NavItem[] = [\r\n    { href: \"/staff/dashboard\", Icon: IconHome, label: \"หน้าหลัก\" },\r\n    { href: \"/staff/applications\", Icon: IconDocument, label: \"คำขอ\" },\r\n    { href: \"/staff/audits\", Icon: IconSearch, label: \"ตรวจแปลง\" },\r\n    { href: \"/staff/certificates\", Icon: IconCertificate, label: \"ใบรับรอง\" },\r\n    { href: \"/staff/calendar\", Icon: IconCalendar, label: \"ปฏิทิน\" },\r\n    { href: \"/staff/accounting\", Icon: IconCreditCard, label: \"บัญชี\", roles: [\"accountant\", \"ACCOUNTANT\", \"admin\", \"ADMIN\", \"SUPER_ADMIN\"] },\r\n    { href: \"/staff/analytics\", Icon: IconChart, label: \"สถิติ\" },\r\n    { href: \"/staff/verification\", Icon: IconUsers, label: \"ตรวจสอบตัวตน\", roles: [\"admin\", \"ADMIN\", \"SUPER_ADMIN\"] },\r\n    { href: \"/staff/management\", Icon: IconUsers, label: \"จัดการ\", roles: [\"admin\", \"ADMIN\", \"SUPER_ADMIN\"] },\r\n];\r\n\r\ninterface StaffLayoutProps {\r\n    children: React.ReactNode;\r\n    title?: string;\r\n    subtitle?: string;\r\n}\r\n\r\nexport default function StaffLayout({ children, title, subtitle }: StaffLayoutProps) {\r\n    const pathname = usePathname();\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<StaffUser | null>(null);\r\n    const [isDark, setIsDark] = useState(true); // Default to Dark for Admin\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setMounted(true);\r\n        // Force slate/dark theme preference for staff if not set\r\n        const saved = localStorage.getItem(\"staff_theme\");\r\n        setIsDark(saved === \"light\" ? false : true);\r\n\r\n        const userData = localStorage.getItem(\"staff_user\");\r\n        if (!userData) { router.push(\"/staff/login\"); return; }\r\n        try { setUser(JSON.parse(userData)); } catch { router.push(\"/staff/login\"); }\r\n    }, [router]);\r\n\r\n    const toggleTheme = () => {\r\n        const next = !isDark;\r\n        setIsDark(next);\r\n        localStorage.setItem(\"staff_theme\", next ? \"dark\" : \"light\");\r\n    };\r\n\r\n    const handleLogout = () => {\r\n        localStorage.removeItem(\"staff_token\");\r\n        localStorage.removeItem(\"staff_user\");\r\n        document.cookie = \"staff_token=; path=/; max-age=0\";\r\n        router.push(\"/staff/login\");\r\n    };\r\n\r\n    const filteredNavItems = NAV_ITEMS.filter(item => {\r\n        if (!item.roles) return true;\r\n        if (!user) return false;\r\n        return item.roles.includes(user.role);\r\n    });\r\n\r\n    const roleInfo = user ? ROLE_LABELS[user.role] || { label: user.role } : { label: \"\" };\r\n\r\n    if (!mounted) return <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\"><div className=\"w-8 h-8 border-4 border-slate-600 border-t-slate-400 rounded-full animate-spin\" /></div>;\r\n\r\n    const bgClass = isDark ? \"bg-slate-900 text-slate-200\" : \"bg-slate-50 text-slate-800\";\r\n    const sidebarClass = isDark ? \"bg-slate-950 border-slate-800\" : \"bg-white border-slate-200\";\r\n\r\n    return (\r\n        <div className={`min-h-screen font-sans flex ${bgClass}`}>\r\n            {/* Sidebar - Desktop */}\r\n            <aside className={`hidden lg:flex fixed left-0 top-0 bottom-0 w-64 flex-col border-r transition-colors ${sidebarClass}`}>\r\n                <div className=\"p-6\">\r\n                    <div className=\"flex items-center gap-3 mb-8\">\r\n                        <div className=\"w-10 h-10 rounded-lg bg-indigo-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-indigo-900/50\">D</div>\r\n                        <div>\r\n                            <h1 className=\"font-bold text-lg leading-tight\">DTAM Staff</h1>\r\n                            <p className=\"text-xs text-slate-500\">Backoffice Portal</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <nav className=\"flex flex-col gap-1\">\r\n                        <p className=\"px-3 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Menu</p>\r\n                        {filteredNavItems.map(item => {\r\n                            const isActive = pathname === item.href || pathname.startsWith(item.href + \"/\");\r\n                            return (\r\n                                <Link\r\n                                    key={item.href}\r\n                                    href={item.href}\r\n                                    className={`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all ${isActive\r\n                                        ? 'bg-indigo-600/10 text-indigo-400'\r\n                                        : 'text-slate-500 hover:text-slate-300 hover:bg-slate-800/50'\r\n                                        }`}\r\n                                >\r\n                                    <item.Icon size={20} className={isActive ? \"text-indigo-500\" : \"\"} />\r\n                                    <span className={`text-sm font-medium ${isActive ? \"text-indigo-400\" : \"\"}`}>{item.label}</span>\r\n                                </Link>\r\n                            );\r\n                        })}\r\n                    </nav>\r\n                </div>\r\n\r\n                <div className=\"mt-auto p-4 border-t border-slate-800\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-9 h-9 rounded-full bg-slate-800 flex items-center justify-center text-slate-400\">\r\n                                <IconUser size={18} />\r\n                            </div>\r\n                            <div className=\"text-sm\">\r\n                                <p className=\"font-medium text-slate-300\">{user?.firstName}</p>\r\n                                <p className=\"text-xs text-slate-500\">{roleInfo.label}</p>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={handleLogout} className=\"text-slate-500 hover:text-red-400 transition-colors\"><IconLogout size={18} /></button>\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"flex-1 lg:ml-64 relative\">\r\n                {/* Topbar */}\r\n                <header className={`h-16 border-b flex items-center justify-between px-6 sticky top-0 z-20 backdrop-blur-md ${isDark ? 'bg-slate-900/80 border-slate-800' : 'bg-white/80 border-slate-200'}`}>\r\n                    <h2 className=\"font-semibold text-lg\">{title || 'Dashboard'}</h2>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <button onClick={toggleTheme} className=\"text-slate-500 hover:text-slate-300\">\r\n                            {isDark ? <IconSun size={20} /> : <IconMoon size={20} />}\r\n                        </button>\r\n                    </div>\r\n                </header>\r\n\r\n                <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n                    {children}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\criteria\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":136,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":158,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\n\r\ninterface Criterion {\r\n    id: string;\r\n    code: string;\r\n    category: string;\r\n    categoryTH: string | null;\r\n    label: string;\r\n    description: string | null;\r\n    icon: string | null;\r\n    sortOrder: number;\r\n    isRequired: boolean;\r\n    inputType: string;\r\n    isActive: boolean;\r\n    createdAt: string;\r\n}\r\n\r\ninterface CriterionForm {\r\n    code: string;\r\n    category: string;\r\n    categoryTH: string;\r\n    label: string;\r\n    description: string;\r\n    icon: string;\r\n    sortOrder: number;\r\n    isRequired: boolean;\r\n    inputType: string;\r\n    isActive: boolean;\r\n}\r\n\r\nconst defaultForm: CriterionForm = {\r\n    code: '',\r\n    category: '',\r\n    categoryTH: '',\r\n    label: '',\r\n    description: '',\r\n    icon: '📋',\r\n    sortOrder: 0,\r\n    isRequired: false,\r\n    inputType: 'checkbox',\r\n    isActive: true\r\n};\r\n\r\nconst categoryOptions = [\r\n    { value: 'TESTING', label: 'การทดสอบและตรวจสอบ', icon: '🧪' },\r\n    { value: 'PRODUCTION', label: 'ขั้นตอนการผลิต', icon: '⚙️' },\r\n    { value: 'SEED_SOURCE', label: 'แหล่งที่มาเมล็ดพันธุ์', icon: '🌱' },\r\n    { value: 'HYGIENE', label: 'สุขอนามัยและความปลอดภัย', icon: '🛡️' },\r\n    { value: 'OTHER', label: 'อื่นๆ', icon: '📋' }\r\n];\r\n\r\nconst inputTypeOptions = [\r\n    { value: 'checkbox', label: 'ติ๊กถูก (Checkbox)' },\r\n    { value: 'text', label: 'ข้อความ (Text)' },\r\n    { value: 'number', label: 'ตัวเลข (Number)' },\r\n    { value: 'file', label: 'ไฟล์แนบ (File)' }\r\n];\r\n\r\nexport default function CriteriaManagementPage() {\r\n    const [criteria, setCriteria] = useState<Criterion[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [showForm, setShowForm] = useState(false);\r\n    const [editingId, setEditingId] = useState<string | null>(null);\r\n    const [form, setForm] = useState<CriterionForm>(defaultForm);\r\n    const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n    useEffect(() => {\r\n        fetchCriteria();\r\n    }, []);\r\n\r\n    async function fetchCriteria() {\r\n        try {\r\n            const res = await fetch('/api/proxy/criteria/all');\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setCriteria(data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    function handleEdit(criterion: Criterion) {\r\n        setForm({\r\n            code: criterion.code,\r\n            category: criterion.category,\r\n            categoryTH: criterion.categoryTH || '',\r\n            label: criterion.label,\r\n            description: criterion.description || '',\r\n            icon: criterion.icon || '📋',\r\n            sortOrder: criterion.sortOrder,\r\n            isRequired: criterion.isRequired,\r\n            inputType: criterion.inputType,\r\n            isActive: criterion.isActive\r\n        });\r\n        setEditingId(criterion.id);\r\n        setShowForm(true);\r\n    }\r\n\r\n    function handleNew() {\r\n        setForm(defaultForm);\r\n        setEditingId(null);\r\n        setShowForm(true);\r\n    }\r\n\r\n    async function handleSubmit(e: React.FormEvent) {\r\n        e.preventDefault();\r\n        setSaving(true);\r\n        setMessage(null);\r\n\r\n        try {\r\n            const url = editingId\r\n                ? `/api/proxy/criteria/${editingId}`\r\n                : '/api/proxy/criteria';\r\n\r\n            const res = await fetch(url, {\r\n                method: editingId ? 'PATCH' : 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(form)\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (data.success) {\r\n                setMessage({ type: 'success', text: editingId ? 'อัปเดตเรียบร้อย' : 'สร้างเรียบร้อย' });\r\n                setShowForm(false);\r\n                fetchCriteria();\r\n            } else {\r\n                setMessage({ type: 'error', text: data.message || 'เกิดข้อผิดพลาด' });\r\n            }\r\n        } catch (error) {\r\n            setMessage({ type: 'error', text: 'เกิดข้อผิดพลาดในการเชื่อมต่อ' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    }\r\n\r\n    async function handleDelete(id: string) {\r\n        if (!confirm('ต้องการลบเกณฑ์นี้?')) return;\r\n\r\n        try {\r\n            const res = await fetch(`/api/proxy/criteria/${id}`, {\r\n                method: 'DELETE'\r\n            });\r\n            const data = await res.json();\r\n\r\n            if (data.success) {\r\n                setMessage({ type: 'success', text: 'ลบเรียบร้อย' });\r\n                fetchCriteria();\r\n            } else {\r\n                setMessage({ type: 'error', text: data.message || 'เกิดข้อผิดพลาด' });\r\n            }\r\n        } catch (error) {\r\n            setMessage({ type: 'error', text: 'เกิดข้อผิดพลาดในการเชื่อมต่อ' });\r\n        }\r\n    }\r\n\r\n    async function handleToggleActive(id: string, isActive: boolean) {\r\n        try {\r\n            const res = await fetch(`/api/proxy/criteria/${id}`, {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ isActive: !isActive })\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                fetchCriteria();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-6\">\r\n                <div className=\"animate-pulse space-y-4\">\r\n                    <div className=\"h-10 bg-gray-200 rounded w-1/3\"></div>\r\n                    <div className=\"h-64 bg-gray-200 rounded\"></div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-6 max-w-6xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-800\">จัดการเกณฑ์เสริม</h1>\r\n                    <p className=\"text-gray-500\">เพิ่ม ลบ แก้ไขเกณฑ์ที่แสดงในฟอร์มใบสมัคร</p>\r\n                </div>\r\n                <button\r\n                    onClick={handleNew}\r\n                    className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2\"\r\n                >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                    </svg>\r\n                    เพิ่มเกณฑ์ใหม่\r\n                </button>\r\n            </div>\r\n\r\n            {/* Message */}\r\n            {message && (\r\n                <div className={`mb-4 p-4 rounded-lg ${message.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>\r\n                    {message.text}\r\n                </div>\r\n            )}\r\n\r\n            {/* Form Modal */}\r\n            {showForm && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n                        <div className=\"p-6 border-b\">\r\n                            <h2 className=\"text-xl font-bold\">{editingId ? 'แก้ไขเกณฑ์' : 'เพิ่มเกณฑ์ใหม่'}</h2>\r\n                        </div>\r\n                        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n                            {/* Code */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">รหัสเกณฑ์ *</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={form.code}\r\n                                    onChange={(e) => setForm({ ...form, code: e.target.value.toUpperCase() })}\r\n                                    placeholder=\"เช่น CONTAMINANT_TEST\"\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                    required\r\n                                    disabled={!!editingId}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Category */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">หมวดหมู่ *</label>\r\n                                <select\r\n                                    value={form.category}\r\n                                    onChange={(e) => {\r\n                                        const opt = categoryOptions.find(o => o.value === e.target.value);\r\n                                        setForm({\r\n                                            ...form,\r\n                                            category: e.target.value,\r\n                                            categoryTH: opt?.label || '',\r\n                                            icon: opt?.icon || '📋'\r\n                                        });\r\n                                    }}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                    required\r\n                                >\r\n                                    <option value=\"\">-- เลือกหมวดหมู่ --</option>\r\n                                    {categoryOptions.map(opt => (\r\n                                        <option key={opt.value} value={opt.value}>{opt.icon} {opt.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Label */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ชื่อเกณฑ์ *</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={form.label}\r\n                                    onChange={(e) => setForm({ ...form, label: e.target.value })}\r\n                                    placeholder=\"เช่น ผลตรวจสารปนเปื้อน\"\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Description */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">คำอธิบาย</label>\r\n                                <textarea\r\n                                    value={form.description}\r\n                                    onChange={(e) => setForm({ ...form, description: e.target.value })}\r\n                                    placeholder=\"คำอธิบายเพิ่มเติม...\"\r\n                                    rows={2}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Input Type */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ประเภท Input</label>\r\n                                <select\r\n                                    value={form.inputType}\r\n                                    onChange={(e) => setForm({ ...form, inputType: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                >\r\n                                    {inputTypeOptions.map(opt => (\r\n                                        <option key={opt.value} value={opt.value}>{opt.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Sort Order */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">ลำดับการแสดง</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={form.sortOrder}\r\n                                    onChange={(e) => setForm({ ...form, sortOrder: parseInt(e.target.value) || 0 })}\r\n                                    className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Checkboxes */}\r\n                            <div className=\"flex gap-6\">\r\n                                <label className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={form.isRequired}\r\n                                        onChange={(e) => setForm({ ...form, isRequired: e.target.checked })}\r\n                                        className=\"w-4 h-4\"\r\n                                    />\r\n                                    <span className=\"text-sm\">บังคับกรอก</span>\r\n                                </label>\r\n                                <label className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={form.isActive}\r\n                                        onChange={(e) => setForm({ ...form, isActive: e.target.checked })}\r\n                                        className=\"w-4 h-4\"\r\n                                    />\r\n                                    <span className=\"text-sm\">เปิดใช้งาน</span>\r\n                                </label>\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex gap-3 pt-4\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setShowForm(false)}\r\n                                    className=\"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50\"\r\n                                >\r\n                                    ยกเลิก\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={saving}\r\n                                    className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\r\n                                >\r\n                                    {saving ? 'กำลังบันทึก...' : 'บันทึก'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Table */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border overflow-hidden\">\r\n                <table className=\"w-full\">\r\n                    <thead className=\"bg-gray-50 border-b\">\r\n                        <tr>\r\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-600\">เกณฑ์</th>\r\n                            <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-600\">หมวดหมู่</th>\r\n                            <th className=\"px-4 py-3 text-center text-sm font-medium text-gray-600\">ประเภท</th>\r\n                            <th className=\"px-4 py-3 text-center text-sm font-medium text-gray-600\">สถานะ</th>\r\n                            <th className=\"px-4 py-3 text-center text-sm font-medium text-gray-600\">จัดการ</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y\">\r\n                        {criteria.length === 0 ? (\r\n                            <tr>\r\n                                <td colSpan={5} className=\"px-4 py-12 text-center text-gray-500\">\r\n                                    ยังไม่มีเกณฑ์ในระบบ\r\n                                </td>\r\n                            </tr>\r\n                        ) : (\r\n                            criteria.map((item) => (\r\n                                <tr key={item.id} className={!item.isActive ? 'bg-gray-50' : ''}>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <div className=\"font-medium text-gray-800\">{item.label}</div>\r\n                                        <div className=\"text-xs text-gray-500\">{item.code}</div>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3\">\r\n                                        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-sm\">\r\n                                            {item.icon} {item.categoryTH || item.category}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-center\">\r\n                                        <span className=\"text-sm text-gray-600\">{item.inputType}</span>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-center\">\r\n                                        <button\r\n                                            onClick={() => handleToggleActive(item.id, item.isActive)}\r\n                                            className={`px-2 py-1 rounded text-xs font-medium ${item.isActive\r\n                                                ? 'bg-green-100 text-green-700'\r\n                                                : 'bg-gray-200 text-gray-600'\r\n                                                }`}\r\n                                        >\r\n                                            {item.isActive ? '✓ เปิด' : '✗ ปิด'}\r\n                                        </button>\r\n                                    </td>\r\n                                    <td className=\"px-4 py-3 text-center\">\r\n                                        <div className=\"flex justify-center gap-2\">\r\n                                            <button\r\n                                                onClick={() => handleEdit(item)}\r\n                                                className=\"p-1 text-blue-600 hover:bg-blue-50 rounded\"\r\n                                                title=\"แก้ไข\"\r\n                                            >\r\n                                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                                                </svg>\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(item.id)}\r\n                                                className=\"p-1 text-red-600 hover:bg-red-50 rounded\"\r\n                                                title=\"ลบ\"\r\n                                            >\r\n                                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                                                </svg>\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div className=\"bg-blue-50 rounded-lg p-4 text-center\">\r\n                    <div className=\"text-2xl font-bold text-blue-600\">{criteria.length}</div>\r\n                    <div className=\"text-sm text-blue-600\">เกณฑ์ทั้งหมด</div>\r\n                </div>\r\n                <div className=\"bg-green-50 rounded-lg p-4 text-center\">\r\n                    <div className=\"text-2xl font-bold text-green-600\">{criteria.filter(c => c.isActive).length}</div>\r\n                    <div className=\"text-sm text-green-600\">เปิดใช้งาน</div>\r\n                </div>\r\n                <div className=\"bg-gray-100 rounded-lg p-4 text-center\">\r\n                    <div className=\"text-2xl font-bold text-gray-600\">{criteria.filter(c => !c.isActive).length}</div>\r\n                    <div className=\"text-sm text-gray-600\">ปิดใช้งาน</div>\r\n                </div>\r\n                <div className=\"bg-purple-50 rounded-lg p-4 text-center\">\r\n                    <div className=\"text-2xl font-bold text-purple-600\">{new Set(criteria.map(c => c.category)).size}</div>\r\n                    <div className=\"text-sm text-purple-600\">หมวดหมู่</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\dashboard\\admin\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\dashboard\\admin\\page.tsx:51:9\n  49 |         }\n  50 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 51 |         setUser(JSON.parse(stored));\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  52 |     }, [router]);\n  53 |\n  54 |     const handleLogout = () => {","line":51,"column":9,"nodeType":null,"endLine":51,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconClock' is defined but never used.","line":9,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPendingData'. Either include it or remove the dependency array.","line":62,"column":8,"nodeType":"ArrayExpression","endLine":62,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPendingData, router]","fix":{"range":[2319,2327],"text":"[fetchPendingData, router]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6716,6719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6716,6719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport StaffLayout from \"../components/StaffLayout\";\r\nimport {\r\n    IconDocument, IconSearch, IconChart, IconCreditCard, IconCalendar,\r\n    IconCheckCircle, IconClock, IconUser\r\n} from \"@/components/ui/icons\";\r\nimport { ApplicationService, DashboardStats, Application } from \"@/lib/services/application-service\";\r\nimport DataTable from \"@/components/ui/DataTable\";\r\n\r\ninterface StaffUser {\r\n    id: string;\r\n    email: string;\r\n    firstName?: string;\r\n    lastName?: string;\r\n    role: string;\r\n}\r\n\r\ninterface PendingItem {\r\n    id: string;\r\n    applicantName: string;\r\n    plantType: string;\r\n    status: string;\r\n    submittedAt: string;\r\n    submissionCount?: number;\r\n    waitTime: string;\r\n}\r\n\r\nconst ROLE_LABELS: Record<string, { label: string }> = {\r\n    REVIEWER_AUDITOR: { label: \"ผู้ตรวจเอกสาร/ตรวจประเมิน\" },\r\n    SCHEDULER: { label: \"เจ้าหน้าที่จัดคิว\" },\r\n    ACCOUNTANT: { label: \"พนักงานบัญชี\" },\r\n    ADMIN: { label: \"ผู้ดูแลระบบ\" },\r\n    assessor: { label: \"ผู้ตรวจสอบ\" },\r\n    scheduler: { label: \"เจ้าหน้าที่จัดคิว\" },\r\n    accountant: { label: \"พนักงานบัญชี\" },\r\n    admin: { label: \"ผู้ดูแลระบบ\" },\r\n};\r\n\r\nexport default function StaffDashboardPage() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<StaffUser | null>(null);\r\n    const [activeTab, setActiveTab] = useState<\"documents\" | \"audits\">(\"documents\");\r\n    const [pendingDocuments, setPendingDocuments] = useState<PendingItem[]>([]);\r\n    const [pendingAudits, setPendingAudits] = useState<PendingItem[]>([]);\r\n    const [dashboardStats, setDashboardStats] = useState<DashboardStats>({ total: 0, pending: 0, approved: 0, todayChecked: 0 });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem(\"staff_token\");\r\n        const userData = localStorage.getItem(\"staff_user\");\r\n        if (!token || !userData) { router.push(\"/staff/login\"); return; }\r\n        try {\r\n            const parsed = JSON.parse(userData);\r\n            setUser(parsed);\r\n            if (parsed.role === \"SCHEDULER\") setActiveTab(\"audits\");\r\n            fetchPendingData();\r\n        } catch { router.push(\"/staff/login\"); }\r\n    }, [router]);\r\n\r\n    const fetchPendingData = async () => {\r\n        try {\r\n            const [pendingRes, auditsRes, statsRes] = await Promise.all([\r\n                ApplicationService.getPendingReviews(),\r\n                ApplicationService.getPendingAudits(),\r\n                ApplicationService.getStats()\r\n            ]);\r\n\r\n            if (pendingRes.success) {\r\n                setPendingDocuments(mapApplicationsToPendingItems(pendingRes.data as Application[]));\r\n            }\r\n            if (auditsRes.success) {\r\n                setPendingAudits(mapApplicationsToPendingItems(auditsRes.data as Application[]));\r\n            }\r\n            if (statsRes.success && statsRes.data) {\r\n                setDashboardStats(statsRes.data);\r\n            }\r\n        } catch (e) {\r\n            console.error('Error fetching dashboard data:', e);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const mapApplicationsToPendingItems = (apps: Application[] | undefined): PendingItem[] => {\r\n        if (!apps || !Array.isArray(apps)) return [];\r\n        return apps.map(app => ({\r\n            id: app._id || app.applicationNumber || 'Unknown',\r\n            applicantName: app.data?.applicantInfo?.name || 'ไม่ระบุ',\r\n            plantType: app.data?.formData?.plantId || 'ไม่ระบุ',\r\n            status: app.status,\r\n            submittedAt: app.audit?.scheduledDate || app.createdAt,\r\n            submissionCount: (app.rejectCount || 0) + 1,\r\n            waitTime: getWaitTime(app.createdAt)\r\n        }));\r\n    };\r\n\r\n    const getWaitTime = (date: string) => {\r\n        const diff = Date.now() - new Date(date).getTime();\r\n        const hours = Math.floor(diff / 3600000);\r\n        return hours < 24 ? `${hours} ชม.` : `${Math.floor(hours / 24)} วัน`;\r\n    };\r\n\r\n    if (!user || isLoading) return <div className=\"p-8 flex justify-center\"><div className=\"w-8 h-8 border-4 border-slate-300 border-t-slate-600 rounded-full animate-spin\"></div></div>;\r\n\r\n    const roleInfo = ROLE_LABELS[user.role] || { label: user.role };\r\n\r\n    return (\r\n        <StaffLayout title=\"Dashboard\" subtitle={`ภาพรวมการทำงาน (${roleInfo.label})`}>\r\n            {/* 1. Key Metrics */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                {[\r\n                    { label: \"งานทั้งหมดในระบบ\", value: dashboardStats.total, icon: IconCalendar, color: \"text-slate-400\" },\r\n                    { label: \"รอตรวจเอกสาร\", value: pendingDocuments.length, icon: IconDocument, color: \"text-amber-500\" },\r\n                    { label: \"รอเข้าตรวจแปลง\", value: pendingAudits.length, icon: IconSearch, color: \"text-purple-500\" },\r\n                    { label: \"อนุมัติวันนี้\", value: dashboardStats.todayChecked, icon: IconCheckCircle, color: \"text-emerald-500\" },\r\n                ].map((stat, i) => (\r\n                    <div key={i} className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-slate-500 dark:text-slate-400\">{stat.label}</p>\r\n                                <h3 className=\"text-3xl font-bold mt-2 text-slate-800 dark:text-slate-100\">{stat.value}</h3>\r\n                            </div>\r\n                            <stat.icon size={24} className={stat.color} />\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* 2. Work Queue (Tabs & Table) */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden mb-8\">\r\n                {/* Tabs */}\r\n                {user.role === \"REVIEWER_AUDITOR\" && (\r\n                    <div className=\"flex border-b border-slate-200 dark:border-slate-700\">\r\n                        {[\r\n                            { key: \"documents\", label: `รอตรวจเอกสาร (${pendingDocuments.length})`, icon: IconDocument },\r\n                            { key: \"audits\", label: `รอตรวจประเมิน (${pendingAudits.length})`, icon: IconSearch }\r\n                        ].map(tab => (\r\n                            <button\r\n                                key={tab.key}\r\n                                onClick={() => setActiveTab(tab.key as any)}\r\n                                className={`flex items-center gap-2 px-6 py-4 text-sm font-medium transition-colors border-b-2 -mb-px ${activeTab === tab.key\r\n                                    ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400 bg-indigo-50/50 dark:bg-indigo-950/10'\r\n                                    : 'border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50'\r\n                                    }`}\r\n                            >\r\n                                <tab.icon size={18} />\r\n                                {tab.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Table Header */}\r\n                <div className=\"px-6 py-4 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700\">\r\n                    <h3 className=\"font-semibold text-slate-700 dark:text-slate-200\">\r\n                        {activeTab === \"documents\" ? \"รายการเอกสารรอตรวจสอบ\" : \"รายการนัดหมายตรวจแปลง\"}\r\n                    </h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <span className=\"text-xs px-2 py-1 rounded bg-amber-100 text-amber-700 border border-amber-200\">Priority: สูง</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Table Body */}\r\n                <DataTable\r\n                    columns={[\r\n                        { key: 'id', label: 'JobID', render: (item: PendingItem) => <span className=\"font-mono text-slate-500\">#{item.id?.slice(-6)}</span> },\r\n                        { key: 'applicantName', label: 'ผู้ยื่นคำขอ' },\r\n                        { key: 'plantType', label: 'ชนิดพืช' },\r\n                        {\r\n                            key: 'status', label: 'สถานะ', render: (item: PendingItem) => (\r\n                                <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border ${item.submissionCount === 1\r\n                                    ? 'bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800'\r\n                                    : 'bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-300 dark:border-amber-800'\r\n                                    }`}>\r\n                                    <span className={`w-1.5 h-1.5 rounded-full ${item.submissionCount === 1 ? 'bg-blue-500' : 'bg-amber-500'}`}></span>\r\n                                    {item.submissionCount === 1 ? 'ยื่นใหม่' : `แก้ไขครั้งที่ ${(item.submissionCount || 1) - 1}`}\r\n                                </span>\r\n                            )\r\n                        },\r\n                        { key: 'waitTime', label: 'เวลารอคอย' },\r\n                        {\r\n                            key: 'actions', label: 'จัดการ', render: (item: PendingItem) => (\r\n                                <div className=\"text-right\">\r\n                                    <Link\r\n                                        href={`/staff/applications/${item.id}`}\r\n                                        className=\"inline-flex items-center px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-xs font-bold transition-colors shadow-sm\"\r\n                                    >\r\n                                        ตรวจสอบ\r\n                                    </Link>\r\n                                </div>\r\n                            )\r\n                        }\r\n                    ]}\r\n                    data={activeTab === \"documents\" ? pendingDocuments : pendingAudits}\r\n                    emptyMessage=\"ไม่มีรายการที่ต้องดำเนินการในขณะนี้\"\r\n                />\r\n            </div>\r\n\r\n            {/* 3. Quick Actions Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {/* Internal Tools */}\r\n                <div className=\"md:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                    <h3 className=\"font-semibold mb-4 text-slate-800 dark:text-slate-200\">เครื่องมือเจ้าหน้าที่</h3>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        {[\r\n                            { title: \"จัดการผู้ใช้\", icon: IconUser, href: \"/staff/management\", color: \"bg-blue-100 text-blue-600\" },\r\n                            { title: \"รายงานสถิติ\", icon: IconChart, href: \"/staff/analytics\", color: \"bg-emerald-100 text-emerald-600\" },\r\n                            { title: \"ระบบบัญชี\", icon: IconCreditCard, href: \"/staff/accounting\", color: \"bg-amber-100 text-amber-600\" },\r\n                            { title: \"ตารางงาน\", icon: IconCalendar, href: \"/staff/calendar\", color: \"bg-purple-100 text-purple-600\" },\r\n                        ].map((tool, i) => (\r\n                            <Link key={i} href={tool.href} className=\"flex flex-col items-center justify-center p-4 rounded-lg bg-slate-50 dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors border border-transparent hover:border-slate-200 dark:hover:border-slate-700 text-center gap-3\">\r\n                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${tool.color} dark:bg-opacity-20`}>\r\n                                    <tool.icon size={20} />\r\n                                </div>\r\n                                <span className=\"text-xs font-medium text-slate-700 dark:text-slate-300\">{tool.title}</span>\r\n                            </Link>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* System Status */}\r\n                <div className=\"bg-slate-900 text-white p-6 rounded-xl shadow-lg relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 bg-indigo-500 rounded-full blur-3xl opacity-20\"></div>\r\n                    <div className=\"relative z-10\">\r\n                        <h3 className=\"font-semibold mb-1\">สถานะระบบ</h3>\r\n                        <p className=\"text-xs text-slate-400 mb-4\">Version 2.0.1 (Stable)</p>\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-300\">Database</span>\r\n                                <span className=\"text-emerald-400 flex items-center gap-1\"><span className=\"w-2 h-2 rounded-full bg-emerald-400\"></span> Connected</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-300\">API Gateway</span>\r\n                                <span className=\"text-emerald-400 flex items-center gap-1\"><span className=\"w-2 h-2 rounded-full bg-emerald-400\"></span> Online</span>\r\n                            </div>\r\n                            <div className=\"mt-4 pt-4 border-t border-slate-700\">\r\n                                <p className=\"text-xs text-slate-400\">Last backup: 2 hours ago</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </StaffLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconUser' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2496,2499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2496,2499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { apiClient } from \"@/lib/api\";\r\nimport { IconUser, IconLock, EyeIcon } from \"@/components/ui/icons\";\r\n\r\n// Local Icons\r\nconst UserIcon = () => (\r\n    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" className=\"text-emerald-700\">\r\n        <circle cx=\"12\" cy=\"8\" r=\"4\" />\r\n        <path d=\"M4 20c0-4 4-7 8-7s8 3 8 7\" />\r\n    </svg>\r\n);\r\n\r\nconst ShieldIcon = () => (\r\n    <svg width=\"40\" height=\"40\" viewBox=\"0 0 48 48\" className=\"fill-emerald-700\">\r\n        <path d=\"M24 4L8 10V22C8 32.5 14.5 42 24 46C33.5 42 40 32.5 40 22V10L24 4Z\" />\r\n        <path d=\"M24 8L12 13V22C12 30 17 38 24 41C31 38 36 30 36 22V13L24 8Z\" fill=\"white\" fillOpacity=\"0.3\" />\r\n        <path d=\"M20 24L23 27L28 21\" stroke=\"white\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" fill=\"none\" />\r\n    </svg>\r\n);\r\n\r\nconst WarningIcon = () => (\r\n    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-amber-600\">\r\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\" />\r\n        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\" />\r\n        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n    </svg>\r\n);\r\n\r\nconst LockKeyIcon = () => (\r\n    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-slate-400\">\r\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\r\n        <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\r\n    </svg>\r\n);\r\n\r\nexport default function StaffLoginPage() {\r\n    const router = useRouter();\r\n    const [loginId, setLoginId] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState(\"\");\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setError(\"\");\r\n        setIsLoading(true);\r\n\r\n        if (!loginId.trim()) {\r\n            setError(\"กรุณากรอกชื่อผู้ใช้หรือรหัสพนักงาน\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await apiClient.post<{\r\n                user: any,\r\n                token: string,\r\n                tokens?: { accessToken: string }\r\n            }>('/auth-dtam/login', {\r\n                username: loginId.trim(),\r\n                password,\r\n                userType: 'DTAM_STAFF',\r\n            });\r\n\r\n            if (!response.success || !response.data) {\r\n                setError(response.error || 'เกิดข้อผิดพลาด กรุณาลองใหม่');\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            const responseData = response.data;\r\n            const user = responseData?.user;\r\n            const token = responseData?.token || responseData?.tokens?.accessToken;\r\n\r\n            if (!user || !token) {\r\n                setError(\"ไม่พบข้อมูลผู้ใช้งานหรือ Token\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Validate Role\r\n            // Allow all for now, as backend should have validated basic access\r\n\r\n            localStorage.setItem(\"staff_token\", token);\r\n            localStorage.setItem(\"staff_user\", JSON.stringify(user));\r\n\r\n            // Set cookie for middleware compatibility\r\n            document.cookie = `staff_token=${token}; path=/; max-age=${60 * 60 * 8}; SameSite=Lax`;\r\n\r\n            setIsLoading(false);\r\n            router.push(\"/staff/dashboard\");\r\n        } catch (err) {\r\n            console.error(\"Login error:\", err);\r\n            setError(\"เกิดข้อผิดพลาดในการเข้าสู่ระบบ\");\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-stone-50 flex items-center justify-center p-6\">\r\n            <div className=\"w-full max-w-md\">\r\n                {/* Logo */}\r\n                <div className=\"text-center mb-8\">\r\n                    <div className=\"w-20 h-20 mx-auto mb-5 bg-emerald-50 rounded-full flex items-center justify-center\">\r\n                        <ShieldIcon />\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-black text-emerald-700 mb-3\">\r\n                        ระบบเจ้าหน้าที่ GACP\r\n                    </h1>\r\n                    <div className=\"inline-block px-5 py-2 bg-emerald-50 rounded-full border border-emerald-200 text-sm font-semibold text-emerald-700\">\r\n                        กรมการแพทย์แผนไทยและการแพทย์ทางเลือก\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Card */}\r\n                <div className=\"bg-white rounded-2xl p-6 shadow-lg\">\r\n                    {/* Warning Badge */}\r\n                    <div className=\"flex items-center gap-2.5 p-3 bg-amber-50 rounded-xl mb-5 border border-amber-200\">\r\n                        <WarningIcon />\r\n                        <span className=\"text-sm text-amber-800 font-medium\">\r\n                            สำหรับเจ้าหน้าที่ที่ได้รับอนุญาตเท่านั้น\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Error */}\r\n                    {error && (\r\n                        <div className=\"flex items-center gap-2 p-3 bg-red-50 rounded-xl text-red-600 text-sm mb-4 border border-red-100\">\r\n                            <WarningIcon /> {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Form */}\r\n                    <form onSubmit={handleSubmit}>\r\n                        {/* Login ID */}\r\n                        <div className=\"mb-4\">\r\n                            <label className=\"text-sm font-semibold text-emerald-700 block mb-2\">\r\n                                ชื่อผู้ใช้ / รหัสพนักงาน / อีเมล\r\n                            </label>\r\n                            <div className=\"relative\">\r\n                                <div className=\"absolute left-3.5 top-1/2 -translate-y-1/2\">\r\n                                    <UserIcon />\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={loginId}\r\n                                    onChange={(e) => setLoginId(e.target.value)}\r\n                                    placeholder=\"admin / EMP001 / officer@dtam.go.th\"\r\n                                    className=\"w-full py-3.5 px-4 pl-12 border border-slate-200 rounded-xl text-base outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Password */}\r\n                        <div className=\"mb-5\">\r\n                            <label className=\"text-sm font-semibold text-emerald-700 block mb-2\">\r\n                                รหัสผ่าน\r\n                            </label>\r\n                            <div className=\"relative\">\r\n                                <div className=\"absolute left-3.5 top-1/2 -translate-y-1/2\">\r\n                                    <IconLock />\r\n                                </div>\r\n                                <input\r\n                                    type={showPassword ? \"text\" : \"password\"}\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                    placeholder=\"กรอกรหัสผ่าน\"\r\n                                    className=\"w-full py-3.5 px-12 border border-slate-200 rounded-xl text-base outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100\"\r\n                                    required\r\n                                />\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setShowPassword(!showPassword)}\r\n                                    className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1 bg-transparent border-none cursor-pointer\"\r\n                                >\r\n                                    <EyeIcon open={showPassword} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Submit */}\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={isLoading}\r\n                            className={`w-full py-4 rounded-xl text-white text-base font-bold flex items-center justify-center gap-2 transition-all ${isLoading\r\n                                ? 'bg-slate-400 cursor-not-allowed'\r\n                                : 'bg-emerald-700 hover:bg-emerald-800 shadow-lg shadow-emerald-700/30'\r\n                                }`}\r\n                        >\r\n                            {isLoading ? (\r\n                                <>\r\n                                    <span className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                    กำลังตรวจสอบ...\r\n                                </>\r\n                            ) : (\r\n                                <>เข้าสู่ระบบเจ้าหน้าที่</>\r\n                            )}\r\n                        </button>\r\n                    </form>\r\n\r\n                    <p className=\"text-center text-sm text-slate-500 mt-5\">\r\n                        หากยังไม่มีบัญชี กรุณาติดต่อผู้ดูแลระบบ\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Back Link */}\r\n                <div className=\"text-center mt-6\">\r\n                    <Link href=\"/\" className=\"text-emerald-600 text-sm font-medium hover:underline\">\r\n                        ← กลับหน้าหลัก\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"text-center mt-8\">\r\n                    <p className=\"text-xs text-slate-400\"><LockKeyIcon /> ระบบรักษาความปลอดภัยระดับสูง</p>\r\n                    <p className=\"text-[11px] text-slate-400 mt-1\">Staff Portal v2.6.0</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\management\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\verification\\[id]\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":220,"column":41,"nodeType":"JSXOpeningElement","endLine":224,"endColumn":43},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":241,"column":45,"nodeType":"JSXOpeningElement","endLine":245,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\n// import { useAuth } from '@/lib/services/auth-provider'; // Assume context exists or handled by layout\r\nimport { Icons } from '@/components/ui/icons';\r\nimport StaffLayout from '../../components/StaffLayout';\r\n\r\ninterface UserDetail {\r\n    id: string;\r\n    firstName: string;\r\n    lastName: string;\r\n    email: string;\r\n    accountType: string;\r\n    verificationSubmittedAt: string;\r\n    taxId?: string;\r\n    laserCode?: string;\r\n    companyName?: string;\r\n    verificationDocuments: {\r\n        idCard?: string;\r\n        companyCert?: string;\r\n        selfie?: string;\r\n    };\r\n}\r\n\r\nexport default function VerificationDetailPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<UserDetail | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [processing, setProcessing] = useState(false);\r\n    const [rejectReason, setRejectReason] = useState('');\r\n    const [showRejectForm, setShowRejectForm] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (params.id) fetchUser(params.id as string);\r\n    }, [params.id]);\r\n\r\n    const fetchUser = async (id: string) => {\r\n        try {\r\n            const token = localStorage.getItem('staff_token');\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/identity/user/${id}`, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setUser(data.data);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAction = async (action: 'APPROVE' | 'REJECT') => {\r\n        if (!confirm(`Are you sure you want to ${action} this user?`)) return;\r\n        setProcessing(true);\r\n\r\n        try {\r\n            const token = localStorage.getItem('staff_token');\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/identity/review/${user?.id}`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    action,\r\n                    note: action === 'REJECT' ? rejectReason : undefined\r\n                })\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                alert(`User ${action}D successfully`);\r\n                router.push('/staff/verification');\r\n            } else {\r\n                alert('Error: ' + data.error);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to process request');\r\n        } finally {\r\n            setProcessing(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <StaffLayout><div className=\"text-slate-400\">Loading...</div></StaffLayout>;\r\n    if (!user) return <StaffLayout><div className=\"text-red-400\">User not found</div></StaffLayout>;\r\n\r\n    const getImageUrl = (path?: string) => {\r\n        if (!path) return null;\r\n        return `${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000'}${path}`;\r\n    };\r\n\r\n    return (\r\n        <StaffLayout title=\"Review Identity\" subtitle={`Request from ${user.firstName} ${user.lastName}`}>\r\n            <button\r\n                onClick={() => router.back()}\r\n                className=\"flex items-center text-slate-400 hover:text-slate-200 mb-6 transition-colors\"\r\n            >\r\n                <Icons.ArrowLeft className=\"w-4 h-4 mr-2\" /> Back to list\r\n            </button>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left: User Info */}\r\n                <div className=\"lg:col-span-1 space-y-6\">\r\n                    <div className=\"bg-slate-800 rounded-xl border border-slate-700 p-6\">\r\n                        <h3 className=\"text-lg font-semibold text-slate-100 mb-4 flex items-center gap-2\">\r\n                            <Icons.User className=\"w-5 h-5 text-indigo-400\" />\r\n                            Applicant Info\r\n                        </h3>\r\n                        <div className=\"space-y-4 text-sm\">\r\n                            <div>\r\n                                <label className=\"text-slate-500 block mb-1\">Name</label>\r\n                                <p className=\"text-slate-200 font-medium\">{user.firstName} {user.lastName}</p>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-slate-500 block mb-1\">Email</label>\r\n                                <p className=\"text-slate-200 font-medium\">{user.email}</p>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-slate-500 block mb-1\">Account Type</label>\r\n                                <span className=\"inline-block px-2 py-1 rounded bg-slate-700 text-slate-300 text-xs\">\r\n                                    {user.accountType}\r\n                                </span>\r\n                            </div>\r\n                            {user.accountType !== 'INDIVIDUAL' && (\r\n                                <div>\r\n                                    <label className=\"text-slate-500 block mb-1\">Company Name</label>\r\n                                    <p className=\"text-slate-200 font-medium\">{user.companyName || '-'}</p>\r\n                                </div>\r\n                            )}\r\n                            <div>\r\n                                <label className=\"text-slate-500 block mb-1\">ID / Tax Number</label>\r\n                                <p className=\"text-slate-200 font-mono bg-slate-900 p-2 rounded border border-slate-700\">\r\n                                    {user.taxId || user.laserCode || 'N/A'}\r\n                                </p>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-slate-500 block mb-1\">Submitted At</label>\r\n                                <p className=\"text-slate-400\">\r\n                                    {new Date(user.verificationSubmittedAt).toLocaleString()}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"bg-slate-800 rounded-xl border border-slate-700 p-6\">\r\n                        <h3 className=\"text-lg font-semibold text-slate-100 mb-4\">Actions</h3>\r\n\r\n                        {!showRejectForm ? (\r\n                            <div className=\"space-y-3\">\r\n                                <button\r\n                                    onClick={() => handleAction('APPROVE')}\r\n                                    disabled={processing}\r\n                                    className=\"w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                                >\r\n                                    <Icons.CheckCircle className=\"w-5 h-5\" />\r\n                                    Approve & Activate\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowRejectForm(true)}\r\n                                    disabled={processing}\r\n                                    className=\"w-full py-3 bg-red-600/10 hover:bg-red-600/20 text-red-400 border border-red-900/50 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                                >\r\n                                    <Icons.XCircle className=\"w-5 h-5\" />\r\n                                    Reject\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-sm text-slate-400 mb-2 block\">Reason for Rejection</label>\r\n                                    <textarea\r\n                                        value={rejectReason}\r\n                                        onChange={e => setRejectReason(e.target.value)}\r\n                                        placeholder=\"e.g. ID card blurred, Name mismatch...\"\r\n                                        className=\"w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-slate-200 text-sm focus:ring-red-500 focus:border-red-500\"\r\n                                        rows={3}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        onClick={() => setShowRejectForm(false)}\r\n                                        className=\"flex-1 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleAction('REJECT')}\r\n                                        disabled={!rejectReason || processing}\r\n                                        className=\"flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                    >\r\n                                        Confirm Reject\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right: Documents */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    <div className=\"bg-slate-800 rounded-xl border border-slate-700 p-6\">\r\n                        <h3 className=\"text-lg font-semibold text-slate-100 mb-6 flex items-center gap-2\">\r\n                            <Icons.Document className=\"w-5 h-5 text-indigo-400\" />\r\n                            Submitted Evidence\r\n                        </h3>\r\n\r\n                        <div className=\"space-y-8\">\r\n                            {/* ID Card */}\r\n                            <div>\r\n                                <h4 className=\"text-sm font-medium text-slate-400 mb-3 uppercase tracking-wider\">\r\n                                    {user.accountType === 'INDIVIDUAL' ? 'ID Card Photo' : 'Director ID Card'}\r\n                                </h4>\r\n                                {user.verificationDocuments?.idCard ? (\r\n                                    <div className=\"rounded-lg overflow-hidden border border-slate-700 bg-slate-900\">\r\n                                        <img\r\n                                            src={getImageUrl(user.verificationDocuments.idCard)!}\r\n                                            alt=\"ID Card\"\r\n                                            className=\"w-full h-auto max-h-[500px] object-contain\"\r\n                                        />\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"p-8 text-center text-slate-500 bg-slate-900 rounded-lg border border-slate-700 border-dashed\">\r\n                                        No ID card image uploaded\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Company Cert */}\r\n                            {user.accountType !== 'INDIVIDUAL' && (\r\n                                <div>\r\n                                    <h4 className=\"text-sm font-medium text-slate-400 mb-3 uppercase tracking-wider\">\r\n                                        Company Affidavit\r\n                                    </h4>\r\n                                    {user.verificationDocuments?.companyCert ? (\r\n                                        <div className=\"rounded-lg overflow-hidden border border-slate-700 bg-slate-900\">\r\n                                            <img\r\n                                                src={getImageUrl(user.verificationDocuments.companyCert)!}\r\n                                                alt=\"Certificate\"\r\n                                                className=\"w-full h-auto max-h-[500px] object-contain\"\r\n                                            />\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"p-8 text-center text-slate-500 bg-slate-900 rounded-lg border border-slate-700 border-dashed\">\r\n                                            No certificate uploaded\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </StaffLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\staff\\verification\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'staffUser' is assigned a value but never used.","line":19,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/lib/services/auth-provider';\r\nimport { Icons } from '@/components/ui/icons';\r\nimport StaffLayout from '../components/StaffLayout';\r\n\r\ninterface PendingUser {\r\n    id: string;\r\n    firstName: string;\r\n    lastName: string;\r\n    email: string;\r\n    accountType: string;\r\n    verificationSubmittedAt: string;\r\n}\r\n\r\nexport default function StaffVerificationPage() {\r\n    const { user: staffUser } = useAuth(); // Actually staff user\r\n    const router = useRouter();\r\n    const [users, setUsers] = useState<PendingUser[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchPending();\r\n    }, []);\r\n\r\n    const fetchPending = async () => {\r\n        try {\r\n            const token = localStorage.getItem('staff_token');\r\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/identity/pending`, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setUsers(data.data);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <StaffLayout title=\"Identity Verification\" subtitle=\"Review pending identity documents\">\r\n            <div className=\"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-slate-700 flex justify-between items-center\">\r\n                    <h2 className=\"text-xl font-semibold text-slate-100 flex items-center gap-2\">\r\n                        <Icons.Clock className=\"w-5 h-5 text-amber-500\" />\r\n                        Pending Requests\r\n                        <span className=\"bg-amber-500/10 text-amber-500 text-xs px-2 py-1 rounded-full\">{users.length}</span>\r\n                    </h2>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center text-slate-500\">Loading...</div>\r\n                ) : users.length === 0 ? (\r\n                    <div className=\"p-12 text-center text-slate-500\">\r\n                        <Icons.CheckCircle className=\"w-12 h-12 mx-auto mb-4 text-emerald-500 opacity-50\" />\r\n                        <p>No pending verifications</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-slate-700\">\r\n                        {users.map((u) => (\r\n                            <div\r\n                                key={u.id}\r\n                                className=\"p-4 hover:bg-slate-700/50 transition-colors cursor-pointer flex items-center justify-between group\"\r\n                                onClick={() => router.push(`/staff/verification/${u.id}`)}\r\n                            >\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center text-slate-400\">\r\n                                        <Icons.User size={20} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"font-medium text-slate-200\">{u.firstName} {u.lastName}</h3>\r\n                                        <p className=\"text-sm text-slate-400\">{u.email}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-6\">\r\n                                    <div className=\"text-right\">\r\n                                        <span className={`text-xs px-2 py-1 rounded-full ${u.accountType === 'JURISTIC' ? 'bg-purple-500/10 text-purple-400' : 'bg-blue-500/10 text-blue-400'}`}>\r\n                                            {u.accountType}\r\n                                        </span>\r\n                                        <p className=\"text-xs text-slate-500 mt-1\">\r\n                                            {new Date(u.verificationSubmittedAt).toLocaleDateString()}\r\n                                        </p>\r\n                                    </div>\r\n                                    <Icons.ChevronRight className=\"w-5 h-5 text-slate-600 group-hover:text-slate-400\" />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </StaffLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\app\\trace\\[qrCode]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":140,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isHarvestBatch' is assigned a value but never used.","line":190,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\n\r\ninterface TraceData {\r\n    type: 'PLANTING_CYCLE' | 'HARVEST_BATCH' | 'LOT';\r\n    data: {\r\n        // Farm info\r\n        farm: {\r\n            name: string;\r\n            type?: string;\r\n            location: string;\r\n            address?: string;\r\n        };\r\n        // Plot info\r\n        plot?: {\r\n            name: string;\r\n            area?: number;\r\n            unit?: string;\r\n        };\r\n        // Plant info\r\n        plant: {\r\n            code?: string;\r\n            nameTH: string;\r\n            nameEN?: string;\r\n            scientificName?: string;\r\n            variety?: string;\r\n        };\r\n        // Cultivation info\r\n        cultivation?: {\r\n            method: string;\r\n            methodCode?: string;\r\n            seedSource?: string;\r\n            soilType?: string;\r\n            irrigationType?: string;\r\n            cycleName?: string;\r\n            cycleNumber?: number;\r\n        };\r\n        // Dates\r\n        dates?: {\r\n            planted?: string;\r\n            plantedTH?: string;\r\n            expectedHarvest?: string;\r\n            expectedHarvestTH?: string;\r\n            actualHarvest?: string;\r\n            actualHarvestTH?: string;\r\n        };\r\n        // Yield\r\n        yield?: {\r\n            estimated?: number;\r\n            actual?: number;\r\n            unit?: string;\r\n        };\r\n        // Status\r\n        status?: string;\r\n        // Batch info (for HARVEST_BATCH)\r\n        batch?: {\r\n            number?: string;\r\n            batchNumber?: string;\r\n            plantingDate?: string;\r\n            plantingDateTH?: string;\r\n            harvestDate?: string;\r\n            harvestDateTH?: string;\r\n            yield?: number;\r\n            yieldUnit?: string;\r\n            qualityGrade?: string;\r\n            status?: string;\r\n        };\r\n        // Harvests (for PLANTING_CYCLE)\r\n        harvests?: Array<{\r\n            batchNumber: string;\r\n            harvestDate?: string;\r\n            harvestDateTH?: string;\r\n            yield?: number;\r\n            yieldUnit?: string;\r\n            grade?: string;\r\n            status?: string;\r\n        }>;\r\n        // Lot info\r\n        lot?: {\r\n            lotNumber: string;\r\n            packageType: string;\r\n            quantity: number;\r\n            unitWeight: number;\r\n            status: string;\r\n            packagedAt: string;\r\n            expiryDate: string;\r\n            labTest?: {\r\n                status: string;\r\n                thcContent: number;\r\n                cbdContent: number;\r\n                moistureContent: number;\r\n            };\r\n        };\r\n        // Certificate\r\n        certificate?: {\r\n            number: string;\r\n            standard?: string;\r\n            issuedDate?: string;\r\n            issuedDateTH?: string;\r\n            expiryDate?: string;\r\n            expiryDateTH?: string;\r\n            status?: string;\r\n            isValid: boolean;\r\n        };\r\n        // Verification\r\n        verification: {\r\n            valid: boolean;\r\n            certified?: boolean;\r\n            scannedAt: string;\r\n            verifiedBy?: string;\r\n        };\r\n    };\r\n}\r\n\r\nexport default function TracePage() {\r\n    const params = useParams();\r\n    const qrCode = params?.qrCode as string;\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [traceData, setTraceData] = useState<TraceData | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!qrCode) return;\r\n\r\n        async function fetchTraceData() {\r\n            try {\r\n                // Direct API call (Nginx routes /api/* to backend)\r\n                const res = await fetch(`/api/trace/${qrCode}`);\r\n                const data = await res.json();\r\n\r\n                if (!data.success) {\r\n                    setError(data.message || 'ไม่พบข้อมูลผลิตภัณฑ์');\r\n                    return;\r\n                }\r\n\r\n                setTraceData(data);\r\n            } catch (err) {\r\n                setError('เกิดข้อผิดพลาดในการเชื่อมต่อ');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n\r\n        fetchTraceData();\r\n    }, [qrCode]);\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        if (!dateStr) return '-';\r\n        return new Date(dateStr).toLocaleDateString('th-TH', {\r\n            year: 'numeric',\r\n            month: 'long',\r\n            day: 'numeric'\r\n        });\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-green-500 border-t-transparent mx-auto mb-4\"></div>\r\n                    <p className=\"text-gray-600\">กำลังตรวจสอบ...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error || !traceData) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-orange-100 flex items-center justify-center p-4\">\r\n                <div className=\"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center\">\r\n                    <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                        <svg className=\"w-10 h-10 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                        </svg>\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-800 mb-2\">ไม่พบข้อมูล</h1>\r\n                    <p className=\"text-gray-600 mb-6\">{error || 'QR Code นี้ไม่ถูกต้องหรือไม่มีในระบบ'}</p>\r\n                    <p className=\"text-sm text-gray-400\">รหัส: {qrCode}</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const { data, type } = traceData;\r\n    const cert = data.certificate;\r\n    const isPlantingCycle = type === 'PLANTING_CYCLE';\r\n    const isHarvestBatch = type === 'HARVEST_BATCH';\r\n    const isLot = type === 'LOT';\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-8 px-4\">\r\n            <div className=\"max-w-lg mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"bg-white rounded-2xl shadow-xl overflow-hidden mb-6\">\r\n                    <div className=\"bg-gradient-to-r from-green-600 to-emerald-600 p-6 text-white text-center\">\r\n                        <div className=\"flex items-center justify-center mb-3\">\r\n                            <svg className=\"w-8 h-8 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                            </svg>\r\n                            <span className=\"text-lg font-semibold\">\r\n                                {cert?.isValid ? 'ผ่านการรับรอง GACP' : 'ข้อมูลการผลิต'}\r\n                            </span>\r\n                        </div>\r\n                        <h1 className=\"text-2xl font-bold\">\r\n                            🌿 GACP Traceability\r\n                        </h1>\r\n                        <p className=\"text-green-100 text-sm mt-1\">ระบบตรวจสอบย้อนกลับผลิตภัณฑ์สมุนไพร</p>\r\n                    </div>\r\n\r\n                    {/* Verification Badge */}\r\n                    <div className=\"p-4 bg-green-50 border-b flex items-center justify-center\">\r\n                        <div className=\"flex items-center space-x-2 text-green-700\">\r\n                            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                            </svg>\r\n                            <span className=\"font-medium\">ตรวจสอบเมื่อ: {formatDate(data.verification.scannedAt)}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* GACP Certificate Badge */}\r\n                {cert && (\r\n                    <div className={`rounded-2xl shadow-lg p-6 mb-6 ${cert.isValid ? 'bg-gradient-to-r from-green-500 to-emerald-500' : 'bg-gradient-to-r from-gray-500 to-gray-600'}`}>\r\n                        <div className=\"text-white text-center\">\r\n                            <div className=\"flex items-center justify-center mb-2\">\r\n                                <svg className=\"w-12 h-12\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z\" />\r\n                                </svg>\r\n                            </div>\r\n                            <div className=\"text-xl font-bold mb-1\">\r\n                                {cert.isValid ? '✓ ได้รับรอง GACP' : '✗ ใบรับรองหมดอายุ'}\r\n                            </div>\r\n                            <div className=\"text-lg font-mono bg-white/20 rounded-lg py-2 px-4 inline-block mb-2\">\r\n                                {cert.number}\r\n                            </div>\r\n                            <div className=\"text-sm opacity-90\">\r\n                                ออกเมื่อ: {cert.issuedDateTH || formatDate(cert.issuedDate || '')} • หมดอายุ: {cert.expiryDateTH || formatDate(cert.expiryDate || '')}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* No Certificate Warning */}\r\n                {!cert && (\r\n                    <div className=\"bg-yellow-50 border border-yellow-200 rounded-2xl p-4 mb-6\">\r\n                        <div className=\"flex items-center text-yellow-700\">\r\n                            <svg className=\"w-5 h-5 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                            </svg>\r\n                            <span>อยู่ระหว่างดำเนินการขอรับรอง GACP</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Farm Info */}\r\n                <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                    <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                        <span className=\"text-2xl mr-2\">🏠</span> ข้อมูลฟาร์ม\r\n                    </h2>\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-500\">ชื่อฟาร์ม</span>\r\n                            <span className=\"font-medium text-gray-800\">{data.farm.name}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-500\">ที่ตั้ง</span>\r\n                            <span className=\"font-medium text-gray-800\">{data.farm.location}</span>\r\n                        </div>\r\n                        {data.plot && (\r\n                            <>\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-gray-500\">แปลง/โรงปลูก</span>\r\n                                    <span className=\"font-medium text-gray-800\">{data.plot.name}</span>\r\n                                </div>\r\n                                {data.plot.area && (\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-500\">พื้นที่</span>\r\n                                        <span className=\"font-medium text-gray-800\">{data.plot.area} {data.plot.unit}</span>\r\n                                    </div>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Plant & Variety Info */}\r\n                <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                    <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                        <span className=\"text-2xl mr-2\">🌱</span> ข้อมูลพืช\r\n                    </h2>\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-500\">ชนิดพืช</span>\r\n                            <span className=\"font-medium text-gray-800\">{data.plant.nameTH}</span>\r\n                        </div>\r\n                        {data.plant.nameEN && (\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">ชื่อภาษาอังกฤษ</span>\r\n                                <span className=\"font-medium text-gray-800\">{data.plant.nameEN}</span>\r\n                            </div>\r\n                        )}\r\n                        {data.plant.scientificName && (\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">ชื่อวิทยาศาสตร์</span>\r\n                                <span className=\"font-medium text-gray-800 italic\">{data.plant.scientificName}</span>\r\n                            </div>\r\n                        )}\r\n                        {data.plant.variety && (\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">พันธุ์</span>\r\n                                <span className=\"font-medium text-emerald-600\">{data.plant.variety}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Cultivation Method Info */}\r\n                {data.cultivation && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">🌾</span> วิธีการปลูก\r\n                        </h2>\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">วิธีการ</span>\r\n                                <span className=\"font-medium text-gray-800\">{data.cultivation.method}</span>\r\n                            </div>\r\n                            {data.cultivation.seedSource && data.cultivation.seedSource !== 'ไม่ระบุ' && (\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-gray-500\">แหล่งเมล็ดพันธุ์</span>\r\n                                    <span className=\"font-medium text-gray-800\">{data.cultivation.seedSource}</span>\r\n                                </div>\r\n                            )}\r\n                            {data.cultivation.soilType && data.cultivation.soilType !== 'ไม่ระบุ' && (\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-gray-500\">ประเภทดิน</span>\r\n                                    <span className=\"font-medium text-gray-800\">{data.cultivation.soilType}</span>\r\n                                </div>\r\n                            )}\r\n                            {data.cultivation.irrigationType && data.cultivation.irrigationType !== 'ไม่ระบุ' && (\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-gray-500\">ระบบน้ำ</span>\r\n                                    <span className=\"font-medium text-gray-800\">{data.cultivation.irrigationType}</span>\r\n                                </div>\r\n                            )}\r\n                            {data.cultivation.cycleName && (\r\n                                <div className=\"flex justify-between\">\r\n                                    <span className=\"text-gray-500\">รอบการปลูก</span>\r\n                                    <span className=\"font-medium text-gray-800\">{data.cultivation.cycleName}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Dates Info */}\r\n                {(data.dates || data.batch) && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">📅</span> วันที่สำคัญ\r\n                        </h2>\r\n                        <div className=\"space-y-3\">\r\n                            {/* For PLANTING_CYCLE */}\r\n                            {data.dates && (\r\n                                <>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-500\">วันเพาะปลูก</span>\r\n                                        <span className=\"font-medium text-emerald-600\">\r\n                                            {data.dates.plantedTH || formatDate(data.dates.planted || '')}\r\n                                        </span>\r\n                                    </div>\r\n                                    {data.dates.expectedHarvest && (\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-gray-500\">กำหนดเก็บเกี่ยว</span>\r\n                                            <span className=\"font-medium text-gray-800\">\r\n                                                {data.dates.expectedHarvestTH || formatDate(data.dates.expectedHarvest)}\r\n                                            </span>\r\n                                        </div>\r\n                                    )}\r\n                                    {data.dates.actualHarvest && (\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-gray-500\">วันเก็บเกี่ยวจริง</span>\r\n                                            <span className=\"font-medium text-emerald-600\">\r\n                                                {data.dates.actualHarvestTH || formatDate(data.dates.actualHarvest)}\r\n                                            </span>\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n                            {/* For HARVEST_BATCH */}\r\n                            {data.batch && (\r\n                                <>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-500\">วันปลูก</span>\r\n                                        <span className=\"font-medium text-gray-800\">\r\n                                            {data.batch.plantingDateTH || formatDate(data.batch.plantingDate || '')}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-500\">วันเก็บเกี่ยว</span>\r\n                                        <span className=\"font-medium text-emerald-600\">\r\n                                            {data.batch.harvestDateTH || formatDate(data.batch.harvestDate || '')}\r\n                                        </span>\r\n                                    </div>\r\n                                    {data.batch.qualityGrade && (\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-gray-500\">เกรดคุณภาพ</span>\r\n                                            <span className=\"font-medium text-green-600\">เกรด {data.batch.qualityGrade}</span>\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Yield Info */}\r\n                {data.yield && (data.yield.estimated || data.yield.actual) && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">📊</span> ผลผลิต\r\n                        </h2>\r\n                        <div className=\"grid grid-cols-2 gap-4 text-center\">\r\n                            {data.yield.estimated && (\r\n                                <div className=\"bg-blue-50 rounded-xl p-4\">\r\n                                    <div className=\"text-2xl font-bold text-blue-600\">{data.yield.estimated}</div>\r\n                                    <div className=\"text-xs text-gray-500\">{data.yield.unit || 'กก.'} (คาดการณ์)</div>\r\n                                </div>\r\n                            )}\r\n                            {data.yield.actual && (\r\n                                <div className=\"bg-green-50 rounded-xl p-4\">\r\n                                    <div className=\"text-2xl font-bold text-green-600\">{data.yield.actual}</div>\r\n                                    <div className=\"text-xs text-gray-500\">{data.yield.unit || 'กก.'} (จริง)</div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Harvest History (for PLANTING_CYCLE) */}\r\n                {isPlantingCycle && data.harvests && data.harvests.length > 0 && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">🧺</span> ประวัติการเก็บเกี่ยว\r\n                        </h2>\r\n                        <div className=\"space-y-3\">\r\n                            {data.harvests.map((h, i) => (\r\n                                <div key={i} className=\"bg-gray-50 rounded-xl p-4\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"font-mono text-sm\">{h.batchNumber}</span>\r\n                                        {h.grade && <span className=\"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full\">เกรด {h.grade}</span>}\r\n                                    </div>\r\n                                    <div className=\"text-sm text-gray-500 mt-1\">\r\n                                        {h.harvestDateTH || formatDate(h.harvestDate || '')} • {h.yield} {h.yieldUnit}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Lot Info (for LOT type) */}\r\n                {isLot && data.lot && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">📦</span> ข้อมูลล็อต\r\n                        </h2>\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">รหัสล็อต</span>\r\n                                <span className=\"font-mono font-medium text-gray-800\">{data.lot.lotNumber}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">บรรจุภัณฑ์</span>\r\n                                <span className=\"font-medium text-gray-800\">{data.lot.packageType}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">น้ำหนักต่อหน่วย</span>\r\n                                <span className=\"font-medium text-gray-800\">{data.lot.unitWeight} กก.</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">วันบรรจุ</span>\r\n                                <span className=\"font-medium text-gray-800\">{formatDate(data.lot.packagedAt)}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">วันหมดอายุ</span>\r\n                                <span className=\"font-medium text-red-600\">{formatDate(data.lot.expiryDate)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Lab Test Results (for LOT) */}\r\n                {isLot && data.lot?.labTest && (\r\n                    <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\r\n                            <span className=\"text-2xl mr-2\">🧪</span> ผลการตรวจ Lab\r\n                        </h2>\r\n                        <div className=\"grid grid-cols-3 gap-4 text-center\">\r\n                            <div className=\"bg-blue-50 rounded-xl p-3\">\r\n                                <div className=\"text-2xl font-bold text-blue-600\">{data.lot.labTest.thcContent || 0}%</div>\r\n                                <div className=\"text-xs text-gray-500\">THC</div>\r\n                            </div>\r\n                            <div className=\"bg-green-50 rounded-xl p-3\">\r\n                                <div className=\"text-2xl font-bold text-green-600\">{data.lot.labTest.cbdContent || 0}%</div>\r\n                                <div className=\"text-xs text-gray-500\">CBD</div>\r\n                            </div>\r\n                            <div className=\"bg-amber-50 rounded-xl p-3\">\r\n                                <div className=\"text-2xl font-bold text-amber-600\">{data.lot.labTest.moistureContent || 0}%</div>\r\n                                <div className=\"text-xs text-gray-500\">ความชื้น</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 flex items-center justify-center\">\r\n                            <span className={`px-4 py-2 rounded-full text-sm font-medium ${data.lot.labTest.status === 'PASSED'\r\n                                ? 'bg-green-100 text-green-700'\r\n                                : 'bg-yellow-100 text-yellow-700'\r\n                                }`}>\r\n                                {data.lot.labTest.status === 'PASSED' ? '✅ ผ่านการตรวจสอบ' : '⏳ รอผลตรวจ'}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Footer */}\r\n                <div className=\"text-center text-gray-500 text-sm mt-8\">\r\n                    <p>ระบบตรวจสอบย้อนกลับผลิตภัณฑ์สมุนไพร</p>\r\n                    <p className=\"mt-1\">กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</p>\r\n                    <p className=\"mt-2 font-mono text-xs text-gray-400\">ID: {qrCode}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\AuthHealthIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'health' is assigned a value but never used.","line":7,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File: src/components/AuthHealthIndicator.tsx\r\n\"use client\";\r\n\r\nimport { useAuthHealth } from '@/hooks/useAuthHealth';\r\n\r\nexport function AuthHealthIndicator() {\r\n  const { health, loading, error, isHealthy } = useAuthHealth();\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n        <div className=\"w-2 h-2 bg-yellow-500 rounded-full animate-pulse\" />\r\n        <span>กำลังตรวจสอบระบบ...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !isHealthy) {\r\n    return (\r\n      <div className=\"flex items-center gap-2 text-sm text-red-600\">\r\n        <div className=\"w-2 h-2 bg-red-500 rounded-full\" />\r\n        <span>ระบบ Authentication มีปัญหา</span>\r\n        <button\r\n          onClick={() => window.location.reload()}\r\n          className=\"text-xs bg-red-100 text-red-700 px-2 py-1 rounded\"\r\n        >\r\n          รีเฟรช\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 text-sm text-green-600\">\r\n      <div className=\"w-2 h-2 bg-green-500 rounded-full\" />\r\n      <span>ระบบ Authentication ปกติ</span>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\CultivationMethodSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subType' is assigned a value but never used.","line":96,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'multiSelect' is assigned a value but never used.","line":101,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":16}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\CultivationMethodSelector.tsx:113:13\n  111 |         if (selectedTypes.length > 0) {\n  112 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 113 |             setLocalSelectedTypes(selectedTypes);\n      |             ^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  114 |         }\n  115 |     }, [selectedTypes]);\n  116 |","line":113,"column":13,"nodeType":null,"endLine":113,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useMasterData, type GACPFees } from '@/hooks/useMasterData';\r\nimport { getCultivationIcon, CheckIcon } from './icons/PlantIcons';\r\n\r\n// Main cultivation types (3 types that affect fees)\r\nexport type MainCultivationType = 'outdoor' | 'greenhouse' | 'indoor';\r\nexport type SubCultivationType = 'vertical' | 'hydroponic' | 'none';\r\nexport type CultivationType = MainCultivationType | 'vertical' | 'hydroponic';\r\nexport type CultivationMethod = CultivationType;\r\n\r\n// Fee constants (FALLBACK - actual data comes from API)\r\nexport const GACP_FEES: GACPFees = {\r\n    documentReview: 5000,\r\n    siteInspection: 25000,\r\n    perTypeTotal: 30000,\r\n    platformFeePercent: 10,\r\n};\r\n\r\ninterface MainMethodOption {\r\n    id: MainCultivationType;\r\n    name: string;\r\n    nameEn: string;\r\n    description: string;\r\n    pros: string[];\r\n    cons: string[];\r\n}\r\n\r\n// Only 3 main cultivation types\r\nconst MAIN_CULTIVATION_METHODS: MainMethodOption[] = [\r\n    {\r\n        id: 'outdoor',\r\n        name: 'กลางแจ้ง',\r\n        nameEn: 'Outdoor',\r\n        description: 'ปลูกในแปลงกลางแจ้ง อาศัยแสงแดดธรรมชาติ',\r\n        pros: ['ต้นทุนต่ำ', 'เหมาะกับพื้นที่กว้าง'],\r\n        cons: ['ควบคุมสภาพแวดล้อมยาก'],\r\n    },\r\n    {\r\n        id: 'greenhouse',\r\n        name: 'โรงเรือน',\r\n        nameEn: 'Greenhouse',\r\n        description: 'ปลูกในโรงเรือนที่มีหลังคาโปร่งแสง',\r\n        pros: ['ควบคุมสภาพแวดล้อมได้บางส่วน', 'ปลูกได้ตลอดปี'],\r\n        cons: ['ต้นทุนสูงกว่ากลางแจ้ง'],\r\n    },\r\n    {\r\n        id: 'indoor',\r\n        name: 'อาคารควบคุม',\r\n        nameEn: 'Indoor Controlled',\r\n        description: 'ปลูกในอาคารปิดที่ควบคุมสภาพแวดล้อมทั้งหมด',\r\n        pros: ['ควบคุมทุกปัจจัยได้', 'คุณภาพสม่ำเสมอ'],\r\n        cons: ['ต้นทุนสูง', 'ค่าไฟฟ้าสูง'],\r\n    },\r\n];\r\n\r\nexport interface CultivationConfig {\r\n    mainTypes: MainCultivationType[];\r\n    subType?: SubCultivationType;\r\n}\r\n\r\ninterface CultivationMethodSelectorProps {\r\n    value?: CultivationMethod;\r\n    selectedTypes?: MainCultivationType[];\r\n    subType?: SubCultivationType;\r\n    onChange?: (method: CultivationMethod, option?: MainMethodOption) => void;\r\n    onConfigChange?: (config: CultivationConfig) => void;\r\n    error?: string;\r\n    disabled?: boolean;\r\n    multiSelect?: boolean;\r\n}\r\n\r\n// Calculate total fee based on selected cultivation types\r\nexport function calculateGACPFee(selectedTypes: MainCultivationType[]): {\r\n    documentReview: number;\r\n    siteInspection: number;\r\n    total: number;\r\n    typeCount: number;\r\n    breakdown: Array<{ type: string; fee: number }>;\r\n} {\r\n    const typeCount = selectedTypes.length;\r\n    const documentReview = GACP_FEES.documentReview * typeCount;\r\n    const siteInspection = GACP_FEES.siteInspection * typeCount;\r\n    const total = documentReview + siteInspection;\r\n    const breakdown = selectedTypes.map(type => {\r\n        const method = MAIN_CULTIVATION_METHODS.find(m => m.id === type);\r\n        return { type: method?.name || type, fee: GACP_FEES.perTypeTotal };\r\n    });\r\n    return { documentReview, siteInspection, total, typeCount, breakdown };\r\n}\r\n\r\nexport function CultivationMethodSelector({\r\n    value,\r\n    selectedTypes = [],\r\n    subType = 'none',\r\n    onChange,\r\n    onConfigChange,\r\n    error,\r\n    disabled = false,\r\n    multiSelect = false,\r\n}: CultivationMethodSelectorProps) {\r\n    const { fees } = useMasterData();\r\n    const activeFees = fees || GACP_FEES;\r\n\r\n    const [localSelectedTypes, setLocalSelectedTypes] = useState<MainCultivationType[]>(\r\n        selectedTypes.length > 0 ? selectedTypes : (value ? [value as MainCultivationType] : [])\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (selectedTypes.length > 0) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setLocalSelectedTypes(selectedTypes);\r\n        }\r\n    }, [selectedTypes]);\r\n\r\n    const handleMainTypeSelect = (typeId: MainCultivationType) => {\r\n        if (disabled) return;\r\n\r\n        // Single select mode only now\r\n        setLocalSelectedTypes([typeId]);\r\n        const method = MAIN_CULTIVATION_METHODS.find(m => m.id === typeId);\r\n        onChange?.(typeId, method);\r\n        onConfigChange?.({ mainTypes: [typeId], subType: 'none' });\r\n    };\r\n\r\n    const feeInfo = calculateGACPFee(localSelectedTypes);\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Main cultivation types (3 options) */}\r\n            <div className=\"grid grid-cols-1 desktop:grid-cols-3 gap-5\">\r\n                {MAIN_CULTIVATION_METHODS.map((method) => {\r\n                    const isSelected = localSelectedTypes.includes(method.id);\r\n                    return (\r\n                        <button\r\n                            key={method.id}\r\n                            type=\"button\"\r\n                            onClick={() => handleMainTypeSelect(method.id)}\r\n                            disabled={disabled}\r\n                            className={`\r\n                                group relative p-5 rounded-xl text-left transition-all duration-300 transform\r\n                                ${isSelected\r\n                                    ? 'bg-gradient-to-br from-dtam-100 via-dtam-200 to-dtam-300 shadow-3d-hover scale-[1.02] border-2 border-dtam'\r\n                                    : 'bg-white shadow-3d hover:shadow-3d-hover hover:scale-[1.02] hover:-translate-y-1 border border-surface-200'\r\n                                }\r\n                                ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n                            `}\r\n                        >\r\n                            {/* Selection indicator */}\r\n                            {isSelected && (\r\n                                <span className=\"absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-br from-dtam-light to-dtam rounded-full flex items-center justify-center shadow-green-glow\">\r\n                                    <CheckIcon className=\"text-white\" size={14} />\r\n                                </span>\r\n                            )}\r\n\r\n                            {/* Icon & Name */}\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                <div className={`\r\n                                    w-11 h-11 rounded-xl flex items-center justify-center transition-all duration-300\r\n                                    ${isSelected\r\n                                        ? 'bg-gradient-to-br from-dtam-light to-dtam text-white shadow-lg'\r\n                                        : 'bg-gradient-to-br from-surface-100 to-surface-200 text-dtam group-hover:from-dtam-100 group-hover:to-dtam-200 group-hover:text-dtam-dark'\r\n                                    }\r\n                                `}>\r\n                                    {getCultivationIcon(method.id, { size: 24 })}\r\n                                </div>\r\n                                <div>\r\n                                    <div className={`font-bold ${isSelected ? 'text-dtam-dark' : 'text-content-primary group-hover:text-dtam-dark'}`}>\r\n                                        {method.name}\r\n                                    </div>\r\n                                    <div className={`text-[10px] ${isSelected ? 'text-dtam' : 'text-content-muted'}`}>{method.nameEn}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Description */}\r\n                            <p className={`text-xs leading-relaxed mb-3 ${isSelected ? 'text-dtam-dark' : 'text-content-secondary group-hover:text-content-primary'}`}>\r\n                                {method.description}\r\n                            </p>\r\n\r\n                            {/* Pros/Cons (shown when selected) */}\r\n                            {isSelected && (\r\n                                <div className=\"pt-3 border-t border-dtam-300 space-y-2 text-xs\">\r\n                                    <div className=\"flex items-start gap-2\">\r\n                                        <span className=\"font-bold text-dtam-light\">ข้อดี:</span>\r\n                                        <span className=\"text-dtam-dark\"> {method.pros.join(', ')}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-start gap-2\">\r\n                                        <span className=\"font-bold text-amber-500\">ข้อจำกัด:</span>\r\n                                        <span className=\"text-dtam-dark\"> {method.cons.join(', ')}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Fee calculation preview */}\r\n            {localSelectedTypes.length > 0 && (\r\n                <div className=\"bg-gradient-to-r from-dtam-50 via-surface-50 to-dtam-100 border-2 border-dtam-200 rounded-xl p-5 shadow-card\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-base font-bold text-dtam-dark\">ค่าธรรมเนียม GACP (ประมาณการ)</p>\r\n                            <p className=\"text-sm text-content-secondary mt-1\">\r\n                                ค่าตรวจเอกสาร ฿{activeFees.documentReview.toLocaleString()} + ค่าตรวจพื้นที่ ฿{activeFees.siteInspection.toLocaleString()}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <p className=\"text-3xl font-bold bg-gradient-to-r from-dtam-light to-dtam bg-clip-text text-transparent\">฿{feeInfo.total.toLocaleString()}</p>\r\n                            <p className=\"text-xs text-dtam\">ต่อใบคำขอ</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {error && (\r\n                <p className=\"text-xs text-red-600\">{error}</p>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport { MAIN_CULTIVATION_METHODS };\r\nexport type { MainMethodOption };\r\nexport default CultivationMethodSelector;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\FarmLayoutSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FarmLayout' is defined but never used.","line":4,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GrowingStyle' is defined but never used.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useMemo } from 'react';\r\nimport { useCultivationConfig, type FarmLayout, type GrowingStyle } from '@/hooks/useCultivationConfig';\r\n\r\n/**\r\n * FarmLayoutSelector Component\r\n * \r\n * Select farm layout based on cultivation method\r\n * - Outdoor: แปลงยาว, แปลงยกร่อง, แปลงบล็อก, กระถาง\r\n * - Greenhouse: แปลงพื้น, โต๊ะยกสูง, ไฮโดรโปนิกส์\r\n * - Indoor: ไฮโดรโปนิกส์ + Growing styles (SOG/ScrOG/Vertical)\r\n * \r\n * @author กรมการแพทย์แผนไทยและการแพทย์ทางเลือก (DTAM)\r\n */\r\n\r\n// Icon components\r\nconst LayoutIcon = ({ type, size = 20 }: { type: string; size?: number }) => {\r\n    const iconMap: Record<string, React.ReactNode> = {\r\n        rows: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\" />\r\n                <line x1=\"3\" y1=\"12\" x2=\"21\" y2=\"12\" />\r\n                <line x1=\"3\" y1=\"18\" x2=\"21\" y2=\"18\" />\r\n            </svg>\r\n        ),\r\n        layer: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <polygon points=\"12,2 22,8.5 12,15 2,8.5\" />\r\n                <polyline points=\"2,15.5 12,22 22,15.5\" />\r\n            </svg>\r\n        ),\r\n        grid: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" />\r\n                <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" />\r\n                <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" />\r\n                <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" />\r\n            </svg>\r\n        ),\r\n        pot: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <path d=\"M3 9h18l-2 12H5L3 9z\" />\r\n                <path d=\"M7 9V7a5 5 0 0 1 10 0v2\" />\r\n            </svg>\r\n        ),\r\n        table: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <rect x=\"3\" y=\"4\" width=\"18\" height=\"8\" />\r\n                <line x1=\"6\" y1=\"12\" x2=\"6\" y2=\"20\" />\r\n                <line x1=\"18\" y1=\"12\" x2=\"18\" y2=\"20\" />\r\n            </svg>\r\n        ),\r\n        drop: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <path d=\"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z\" />\r\n            </svg>\r\n        ),\r\n        plant: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <path d=\"M12 22V8\" />\r\n                <path d=\"M12 8c-3 0-5.5-2.5-5.5-5.5\" />\r\n                <path d=\"M12 8c3 0 5.5-2.5 5.5-5.5\" />\r\n            </svg>\r\n        ),\r\n        'grid-3x3': (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"5\" height=\"5\" />\r\n                <rect x=\"9.5\" y=\"3\" width=\"5\" height=\"5\" />\r\n                <rect x=\"16\" y=\"3\" width=\"5\" height=\"5\" />\r\n                <rect x=\"3\" y=\"9.5\" width=\"5\" height=\"5\" />\r\n                <rect x=\"9.5\" y=\"9.5\" width=\"5\" height=\"5\" />\r\n                <rect x=\"16\" y=\"9.5\" width=\"5\" height=\"5\" />\r\n                <rect x=\"3\" y=\"16\" width=\"5\" height=\"5\" />\r\n                <rect x=\"9.5\" y=\"16\" width=\"5\" height=\"5\" />\r\n                <rect x=\"16\" y=\"16\" width=\"5\" height=\"5\" />\r\n            </svg>\r\n        ),\r\n        net: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\r\n                <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\" />\r\n                <line x1=\"3\" y1=\"15\" x2=\"21\" y2=\"15\" />\r\n                <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\" />\r\n                <line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"21\" />\r\n            </svg>\r\n        ),\r\n        layers: (\r\n            <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <polygon points=\"12,2 22,8.5 12,15 2,8.5\" />\r\n                <polyline points=\"2,12 12,18.5 22,12\" />\r\n                <polyline points=\"2,15.5 12,22 22,15.5\" />\r\n            </svg>\r\n        ),\r\n    };\r\n    return iconMap[type] || iconMap.rows;\r\n};\r\n\r\ninterface FarmLayoutSelectorProps {\r\n    cultivationMethod: 'outdoor' | 'greenhouse' | 'indoor';\r\n    selectedLayoutId?: string;\r\n    selectedStyleId?: string;\r\n    tiers?: number;\r\n    onLayoutChange: (layoutId: string) => void;\r\n    onStyleChange?: (styleId: string) => void;\r\n    onTiersChange?: (tiers: number) => void;\r\n    disabled?: boolean;\r\n    showPlantEstimate?: boolean;\r\n    areaSqm?: number;\r\n}\r\n\r\nexport function FarmLayoutSelector({\r\n    cultivationMethod,\r\n    selectedLayoutId,\r\n    selectedStyleId,\r\n    tiers = 1,\r\n    onLayoutChange,\r\n    onStyleChange,\r\n    onTiersChange,\r\n    disabled = false,\r\n    showPlantEstimate = true,\r\n    areaSqm = 0,\r\n}: FarmLayoutSelectorProps) {\r\n    const { getLayoutsForMethod, growingStyles, estimatePlantCount, isIndoorMethod, loading } = useCultivationConfig();\r\n\r\n    // Get layouts for current method\r\n    const layouts = useMemo(() => getLayoutsForMethod(cultivationMethod), [cultivationMethod, getLayoutsForMethod]);\r\n\r\n    // Show growing styles only for indoor\r\n    const showGrowingStyles = isIndoorMethod(cultivationMethod);\r\n\r\n    // Calculate estimated plant count\r\n    const plantEstimate = useMemo(() => {\r\n        if (!selectedLayoutId || areaSqm <= 0) return null;\r\n        return estimatePlantCount(areaSqm, selectedLayoutId, selectedStyleId, tiers);\r\n    }, [selectedLayoutId, selectedStyleId, tiers, areaSqm, estimatePlantCount]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-4 text-center text-[#78909C]\">\r\n                <div className=\"animate-spin inline-block w-6 h-6 border-2 border-[#00695C] border-t-transparent rounded-full\" />\r\n                <p className=\"mt-2 text-sm\">กำลังโหลดข้อมูล...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Farm Layout Selection */}\r\n            <div>\r\n                <label className=\"block text-sm font-semibold text-[#263238] mb-3\">\r\n                    รูปแบบแปลงปลูก <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                    {layouts.map((layout) => {\r\n                        const isSelected = selectedLayoutId === layout.id;\r\n                        return (\r\n                            <button\r\n                                key={layout.id}\r\n                                type=\"button\"\r\n                                onClick={() => onLayoutChange(layout.id)}\r\n                                disabled={disabled}\r\n                                className={`\r\n                                    p-4 rounded-lg border-2 text-left transition-all\r\n                                    ${isSelected\r\n                                        ? 'border-[#00695C] bg-[#E0F2F1]'\r\n                                        : 'border-[#E0E0E0] bg-white hover:border-[#80CBC4]'\r\n                                    }\r\n                                    ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n                                `}\r\n                            >\r\n                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center mb-2 ${isSelected ? 'bg-[#00695C] text-white' : 'bg-[#ECEFF1] text-[#546E7A]'\r\n                                    }`}>\r\n                                    <LayoutIcon type={layout.icon} size={20} />\r\n                                </div>\r\n                                <div className={`font-medium text-sm ${isSelected ? 'text-[#00695C]' : 'text-[#263238]'}`}>\r\n                                    {layout.nameTH}\r\n                                </div>\r\n                                <div className=\"text-xs text-[#90A4AE] mt-1\">\r\n                                    {layout.nameEN}\r\n                                </div>\r\n                                {layout.plantsPerSqm > 0 && (\r\n                                    <div className=\"text-xs text-[#78909C] mt-2 flex items-center gap-1\">\r\n                                        <span className=\"inline-block w-2 h-2 bg-[#4CAF50] rounded-full\" />\r\n                                        {layout.plantsPerSqm} ต้น/㎡\r\n                                    </div>\r\n                                )}\r\n                                {layout.manualPlantCount && (\r\n                                    <div className=\"text-xs text-[#FF9800] mt-2\">\r\n                                        กรอกจำนวนเอง\r\n                                    </div>\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Growing Styles (Indoor Only) */}\r\n            {showGrowingStyles && (\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-[#263238] mb-3\">\r\n                        รูปแบบการปลูก (Indoor) <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                        {growingStyles.map((style) => {\r\n                            const isSelected = selectedStyleId === style.id;\r\n                            return (\r\n                                <button\r\n                                    key={style.id}\r\n                                    type=\"button\"\r\n                                    onClick={() => onStyleChange?.(style.id)}\r\n                                    disabled={disabled}\r\n                                    className={`\r\n                                        p-4 rounded-lg border-2 text-left transition-all\r\n                                        ${isSelected\r\n                                            ? 'border-[#00695C] bg-[#E0F2F1]'\r\n                                            : 'border-[#E0E0E0] bg-white hover:border-[#80CBC4]'\r\n                                        }\r\n                                        ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n                                    `}\r\n                                >\r\n                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center mb-2 ${isSelected ? 'bg-[#00695C] text-white' : 'bg-[#ECEFF1] text-[#546E7A]'\r\n                                        }`}>\r\n                                        <LayoutIcon type={style.icon} size={20} />\r\n                                    </div>\r\n                                    <div className={`font-medium text-sm ${isSelected ? 'text-[#00695C]' : 'text-[#263238]'}`}>\r\n                                        {style.nameTH}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-[#90A4AE] mt-1\">\r\n                                        {style.nameEN}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-[#78909C] mt-2 flex items-center gap-1\">\r\n                                        <span className=\"inline-block w-2 h-2 bg-[#4CAF50] rounded-full\" />\r\n                                        {style.plantsPerSqm} ต้น/㎡\r\n                                    </div>\r\n                                    {style.supportsMultipleTiers && (\r\n                                        <div className=\"text-xs text-[#2196F3] mt-1\">\r\n                                            รองรับหลายชั้น (สูงสุด {style.maxTiers} ชั้น)\r\n                                        </div>\r\n                                    )}\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Tier Selector (for Vertical style) */}\r\n            {selectedStyleId === 'vertical' && onTiersChange && (\r\n                <div>\r\n                    <label className=\"block text-sm font-semibold text-[#263238] mb-3\">\r\n                        จำนวนชั้น (Tiers)\r\n                    </label>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <input\r\n                            type=\"range\"\r\n                            min={1}\r\n                            max={5}\r\n                            value={tiers}\r\n                            onChange={(e) => onTiersChange(parseInt(e.target.value))}\r\n                            disabled={disabled}\r\n                            className=\"flex-1 h-2 bg-[#E0E0E0] rounded-lg appearance-none cursor-pointer accent-[#00695C]\"\r\n                        />\r\n                        <div className=\"w-16 text-center\">\r\n                            <span className=\"text-2xl font-bold text-[#00695C]\">{tiers}</span>\r\n                            <span className=\"text-sm text-[#78909C] ml-1\">ชั้น</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Plant Estimate Display */}\r\n            {showPlantEstimate && plantEstimate && plantEstimate.count > 0 && (\r\n                <div className=\"bg-[#E8F5E9] border border-[#A5D6A7] rounded-lg p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <div className=\"text-sm font-medium text-[#2E7D32]\">\r\n                                จำนวนต้นโดยประมาณ\r\n                            </div>\r\n                            <div className=\"text-xs text-[#66BB6A] mt-1\">\r\n                                {plantEstimate.formula}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"text-3xl font-bold text-[#2E7D32]\">\r\n                                {plantEstimate.count.toLocaleString()}\r\n                            </div>\r\n                            <div className=\"text-sm text-[#66BB6A]\">ต้น</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FarmLayoutSelector;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\FormHint.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\InlineDocumentUpload.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":31,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":7},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":180,"column":29,"nodeType":"JSXOpeningElement","endLine":184,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useRef } from 'react';\r\n\r\ninterface InlineDocumentUploadProps {\r\n    /** Unique ID for the document */\r\n    id: string;\r\n    /** Document type label (Thai) */\r\n    label: string;\r\n    /** English label */\r\n    labelEn?: string;\r\n    /** Whether the document is required */\r\n    required?: boolean;\r\n    /** Accepted file types */\r\n    accept?: string;\r\n    /** Maximum file size in MB */\r\n    maxSizeMB?: number;\r\n    /** Hint text for the document */\r\n    hint?: string;\r\n    /** Current uploaded file URL */\r\n    value?: string;\r\n    /** Callback when file is uploaded */\r\n    onChange?: (file: File | null, url: string | null) => void;\r\n    /** Error message */\r\n    error?: string;\r\n    /** Disabled state */\r\n    disabled?: boolean;\r\n}\r\n\r\nexport function InlineDocumentUpload({\r\n    id,\r\n    label,\r\n    labelEn,\r\n    required = false,\r\n    accept = '.pdf,.jpg,.jpeg,.png',\r\n    maxSizeMB = 10,\r\n    hint,\r\n    value,\r\n    onChange,\r\n    error,\r\n    disabled = false,\r\n}: InlineDocumentUploadProps) {\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [preview, setPreview] = useState<string | null>(value || null);\r\n    const [fileName, setFileName] = useState<string | null>(null);\r\n    const [uploadError, setUploadError] = useState<string | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleFileSelect = (file: File | null) => {\r\n        setUploadError(null);\r\n\r\n        if (!file) {\r\n            setPreview(null);\r\n            setFileName(null);\r\n            onChange?.(null, null);\r\n            return;\r\n        }\r\n\r\n        // Validate file size\r\n        if (file.size > maxSizeMB * 1024 * 1024) {\r\n            setUploadError(`ไฟล์ต้องมีขนาดไม่เกิน ${maxSizeMB} MB`);\r\n            return;\r\n        }\r\n\r\n        // Validate file type\r\n        const validTypes = accept.split(',').map(t => t.trim());\r\n        const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();\r\n        if (!validTypes.includes(fileExt)) {\r\n            setUploadError(`รองรับเฉพาะไฟล์ ${accept}`);\r\n            return;\r\n        }\r\n\r\n        setFileName(file.name);\r\n\r\n        // Create preview for images\r\n        if (file.type.startsWith('image/')) {\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                const url = e.target?.result as string;\r\n                setPreview(url);\r\n                onChange?.(file, url);\r\n            };\r\n            reader.readAsDataURL(file);\r\n        } else {\r\n            // For PDFs, just show the file name\r\n            setPreview(null);\r\n            onChange?.(file, file.name);\r\n        }\r\n    };\r\n\r\n    const handleDrop = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        setIsDragging(false);\r\n        if (disabled) return;\r\n\r\n        const file = e.dataTransfer.files[0];\r\n        handleFileSelect(file);\r\n    };\r\n\r\n    const handleDragOver = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        if (!disabled) setIsDragging(true);\r\n    };\r\n\r\n    const handleDragLeave = () => {\r\n        setIsDragging(false);\r\n    };\r\n\r\n    const handleClick = () => {\r\n        if (!disabled) fileInputRef.current?.click();\r\n    };\r\n\r\n    const handleRemove = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        setPreview(null);\r\n        setFileName(null);\r\n        onChange?.(null, null);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n        }\r\n    };\r\n\r\n    const displayError = uploadError || error;\r\n    const hasFile = !!preview || !!fileName;\r\n\r\n    return (\r\n        <div className=\"space-y-2\">\r\n            {/* Label */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-1.5\">\r\n                    <span className=\"text-sm font-bold text-dtam-dark\">\r\n                        {label}\r\n                        {labelEn && <span className=\"text-content-tertiary font-normal ml-1\">({labelEn})</span>}\r\n                        {required && <span className=\"text-red-500 ml-0.5\">*</span>}\r\n                    </span>\r\n                </div>\r\n                {hasFile && (\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={handleRemove}\r\n                        className=\"text-xs font-medium text-red-500 hover:text-red-600 transition-colors\"\r\n                    >\r\n                        ลบไฟล์\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Hint */}\r\n            {hint && (\r\n                <p className=\"text-xs text-content-secondary\">{hint}</p>\r\n            )}\r\n\r\n            {/* Upload Area */}\r\n            <div\r\n                onClick={handleClick}\r\n                onDrop={handleDrop}\r\n                onDragOver={handleDragOver}\r\n                onDragLeave={handleDragLeave}\r\n                className={`\r\n                    group relative border-2 border-dashed rounded-xl p-5 transition-all cursor-pointer overflow-hidden\r\n                    ${isDragging ? 'border-dtam bg-dtam-50' : 'border-surface-300 hover:border-dtam hover:bg-surface-50'}\r\n                    ${hasFile ? 'bg-surface-50 border-dtam' : 'bg-white'}\r\n                    ${disabled ? 'opacity-50 cursor-not-allowed' : ''}\r\n                    ${displayError ? 'border-red-300 bg-red-50' : ''}\r\n                `}\r\n            >\r\n                <input\r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept={accept}\r\n                    onChange={(e) => handleFileSelect(e.target.files?.[0] || null)}\r\n                    className=\"hidden\"\r\n                    disabled={disabled}\r\n                />\r\n\r\n                {hasFile ? (\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {/* Preview or Icon */}\r\n                        {preview && preview.startsWith('data:image') ? (\r\n                            <img\r\n                                src={preview}\r\n                                alt=\"Preview\"\r\n                                className=\"w-14 h-14 object-cover rounded-lg border border-surface-200 shadow-sm\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"w-14 h-14 bg-dtam-50 text-dtam rounded-lg flex items-center justify-center border border-dtam-100 shadow-sm\">\r\n                                <svg className=\"w-7 h-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                                </svg>\r\n                            </div>\r\n                        )}\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-sm font-bold text-dtam-dark truncate\">\r\n                                {fileName}\r\n                            </p>\r\n                            <p className=\"text-xs text-dtam flex items-center gap-1 font-medium mt-0.5\">\r\n                                <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                    <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n                                </svg>\r\n                                อัปโหลดสำเร็จ\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"text-center py-2\">\r\n                        <div className=\"w-12 h-12 bg-surface-100 text-content-tertiary rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 group-hover:bg-dtam-50 group-hover:text-dtam transition-all duration-300\">\r\n                            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                            </svg>\r\n                        </div>\r\n                        <p className=\"text-sm font-medium text-content-primary group-hover:text-dtam-dark transition-colors\">\r\n                            คลิกหรือลากไฟล์มาวาง\r\n                        </p>\r\n                        <p className=\"text-xs text-content-tertiary mt-1\">\r\n                            {accept.replace(/\\./g, '').toUpperCase()} (สูงสุด {maxSizeMB} MB)\r\n                        </p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Error */}\r\n            {displayError && (\r\n                <p className=\"text-xs text-red-500 flex items-center gap-1 font-medium animate-shake\">\r\n                    <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                    {displayError}\r\n                </p>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default InlineDocumentUpload;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\InteractiveMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[272,275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[272,275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport L from 'leaflet';\r\n\r\n// Fix Leaflet Default Icon\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\r\n    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\r\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\r\n});\r\n\r\nfunction LocationMarker({ position, onLocationSelect }: { position: [number, number] | null, onLocationSelect: (lat: number, lng: number) => void }) {\r\n    const map = useMapEvents({\r\n        click(e) {\r\n            onLocationSelect(e.latlng.lat, e.latlng.lng);\r\n            map.flyTo(e.latlng, map.getZoom());\r\n        },\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (position) {\r\n            map.flyTo(position, map.getZoom());\r\n        }\r\n    }, [position, map]);\r\n\r\n    return position === null ? null : (\r\n        <Marker position={position}></Marker>\r\n    );\r\n}\r\n\r\ninterface InteractiveMapProps {\r\n    initialLat?: number;\r\n    initialLng?: number;\r\n    onLocationSelect: (lat: number, lng: number) => void;\r\n}\r\n\r\nexport default function InteractiveMap({ initialLat, initialLng, onLocationSelect }: InteractiveMapProps) {\r\n    const defaultPosition: [number, number] = [13.7563, 100.5018]; // Bangkok\r\n    const position: [number, number] | null = initialLat && initialLng ? [initialLat, initialLng] : null;\r\n\r\n    return (\r\n        <MapContainer center={position || defaultPosition} zoom={13} scrollWheelZoom={true} style={{ height: '100%', width: '100%' }}>\r\n            <TileLayer\r\n                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n            />\r\n            <LocationMarker position={position} onLocationSelect={onLocationSelect} />\r\n        </MapContainer>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\PlantQRCalculator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\PlantUnitList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'applicationId' is defined but never used.","line":27,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":62},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCycle'. Either include it or remove the dependency array.","line":34,"column":8,"nodeType":"ArrayExpression","endLine":34,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [farmId, loadCycle]","fix":{"range":[862,870],"text":"[farmId, loadCycle]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2469,2472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2469,2472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":72,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { apiClient as api } from \"@/lib/api/api-client\";\r\nimport { Icons } from \"@/components/ui/icons\";\r\n\r\ninterface PlantUnit {\r\n    id: string;\r\n    code: string;\r\n    status: string;\r\n}\r\n\r\ninterface PlantingCycle {\r\n    id: string;\r\n    cycleName: string;\r\n    status: string;\r\n    plantUnits: PlantUnit[];\r\n    estimatedPlantCount: number;\r\n}\r\n\r\ninterface PlantUnitListProps {\r\n    farmId: string;\r\n    applicationId?: string;\r\n    canEdit?: boolean;\r\n}\r\n\r\nexport default function PlantUnitList({ farmId, applicationId, canEdit = false }: PlantUnitListProps) {\r\n    const [cycle, setCycle] = useState<PlantingCycle | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [generating, setGenerating] = useState(false);\r\n\r\n    useEffect(() => {\r\n        loadCycle();\r\n    }, [farmId]);\r\n\r\n    const loadCycle = async () => {\r\n        try {\r\n            setLoading(true);\r\n            // Fetch cycles for this farm\r\n            const result = await api.get<PlantingCycle[]>(`/planting-cycles?farmId=${farmId}`);\r\n            if (result.success && result.data && result.data.length > 0) {\r\n                // Determine relevant cycle. For now, take the latest one.\r\n                // In future, we might match by ID if linked.\r\n                const latest = result.data[0];\r\n\r\n                // Fetch full details including units (the list endpoint might not return relations)\r\n                const detailResult = await api.get<{ data: PlantingCycle }>(`/planting-cycles/${latest.id}`);\r\n                if (detailResult.success && detailResult.data?.data) {\r\n                    setCycle(detailResult.data.data);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to load planting cycle:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleGenerate = async () => {\r\n        if (!cycle) return;\r\n        if (!confirm(`ยืนยันการสร้างรหัสติดตามจำนวน ${cycle.estimatedPlantCount} ต้น?\\nการกระทำนี้ไม่สามารถยกเลิกได้`)) return;\r\n\r\n        try {\r\n            setGenerating(true);\r\n            const result = await api.post(`/planting-cycles/${cycle.id}/generate-units`, {});\r\n            if (result.success) {\r\n                alert(\"สร้างรหัสติดตามสำเร็จ\");\r\n                loadCycle(); // Reload to show units\r\n            } else {\r\n                alert(\"เกิดข้อผิดพลาด: \" + ((result as any).message || \"Unknown error\"));\r\n            }\r\n        } catch (error) {\r\n            alert(\"Connection error\");\r\n        } finally {\r\n            setGenerating(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"text-center p-5 text-gray-500 text-sm\">Loading tracking data...</div>;\r\n\r\n    if (!cycle) return null; // No active cycle found\r\n\r\n    const units = cycle.plantUnits || [];\r\n    const hasUnits = units.length > 0;\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden\">\r\n            <div className=\"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-8 h-8 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center\">\r\n                        <Icons.Tree className=\"w-4 h-4\" />\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"font-semibold text-gray-800 text-sm\">การติดตามรายต้น (Tree-by-Tree)</h3>\r\n                        <p className=\"text-xs text-gray-500\">รอบปลูก: {cycle.cycleName}</p>\r\n                    </div>\r\n                </div>\r\n                {hasUnits && (\r\n                    <span className=\"text-xs font-medium px-2.5 py-1 bg-emerald-100 text-emerald-700 rounded-md\">\r\n                        {units.length} ต้น\r\n                    </span>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n                {!hasUnits ? (\r\n                    <div className=\"text-center py-6\">\r\n                        <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3 text-gray-400\">\r\n                            <Icons.QrCode className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <p className=\"text-gray-500 text-sm mb-4\">ยังไม่ได้สร้างรหัสติดตามสำหรับรอบปลูกนี้</p>\r\n                        {canEdit && (\r\n                            <button\r\n                                onClick={handleGenerate}\r\n                                disabled={generating}\r\n                                className=\"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2 mx-auto\"\r\n                            >\r\n                                {generating ? <Icons.Loader className=\"w-4 h-4 animate-spin\" /> : <Icons.Plus className=\"w-4 h-4\" />}\r\n                                สร้างรหัสติดตาม ({cycle.estimatedPlantCount} ต้น)\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-60 overflow-y-auto pr-1\">\r\n                        {units.map((unit) => (\r\n                            <div key={unit.id} className=\"p-2 border border-gray-200 rounded-lg flex items-center justify-between hover:border-emerald-400 transition-colors group bg-white\">\r\n                                <div className=\"min-w-0\">\r\n                                    <div className=\"text-xs font-bold text-gray-700 truncate\" title={unit.code}>\r\n                                        {unit.code}\r\n                                    </div>\r\n                                    <div className=\"text-[10px] text-gray-500\">สถานะ: {unit.status}</div>\r\n                                </div>\r\n                                <button className=\"text-gray-400 hover:text-emerald-600 p-1\" title=\"ดู QR Code\">\r\n                                    <Icons.QrCode className=\"w-4 h-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {hasUnits && (\r\n                <div className=\"p-3 bg-gray-50 border-t border-gray-100 text-center\">\r\n                    <button className=\"text-xs font-semibold text-emerald-600 hover:text-emerald-700 flex items-center justify-center gap-1 w-full\">\r\n                        <Icons.Printer className=\"w-3.5 h-3.5\" />\r\n                        พิมพ์ QR Code ทั้งหมด\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\PurposeSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\StrainSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\icons\\PlantIcons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\icons\\WizardIcons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\system-guard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'failedChecks' is assigned a value but never used.","line":23,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":24}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\system-guard.tsx:47:9\n  45 |         // Initial check\n  46 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 47 |         checkServer();\n     |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  48 |\n  49 |         // Periodic health check every 30 seconds\n  50 |         const interval = setInterval(checkServer, 30000);","line":47,"column":9,"nodeType":null,"endLine":47,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, ReactNode, useCallback } from \"react\";\r\nimport { apiClient as api } from \"@/lib/api\";\r\nimport { colors } from \"@/lib/design-tokens\";\r\n\r\ninterface SystemGuardProps {\r\n    children: ReactNode;\r\n}\r\n\r\n\r\n/**\r\n * SystemGuard Component\r\n * Wraps the entire application and monitors backend connectivity\r\n * Shows a friendly \"Server Down\" screen when backend is unavailable\r\n */\r\nexport default function SystemGuard({ children }: SystemGuardProps) {\r\n    // Start assuming online so pages load immediately (better UX)\r\n    // Only block if confirmed offline after multiple failed checks\r\n    const [isChecking, setIsChecking] = useState(false); // Don't show checking state initially\r\n    const [isOnline, setIsOnline] = useState(true); // Assume online initially\r\n    const [retryCount, setRetryCount] = useState(0);\r\n    const [failedChecks, setFailedChecks] = useState(0); // Track consecutive failures\r\n\r\n    const checkServer = useCallback(async () => {\r\n        setIsChecking(true);\r\n        const online = await api.health();\r\n        setIsOnline(online);\r\n        setIsChecking(false);\r\n\r\n        if (online) {\r\n            setRetryCount(0);\r\n            setFailedChecks(0);\r\n        } else {\r\n            // Only mark as offline after 2+ consecutive failures\r\n            setFailedChecks(prev => {\r\n                const newCount = prev + 1;\r\n                if (newCount >= 2) setIsOnline(false);\r\n                return newCount;\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Initial check\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        checkServer();\r\n\r\n        // Periodic health check every 30 seconds\r\n        const interval = setInterval(checkServer, 30000);\r\n\r\n        return () => {\r\n            clearInterval(interval);\r\n        };\r\n    }, [checkServer]);\r\n\r\n    const handleRetry = async () => {\r\n        setRetryCount(prev => prev + 1);\r\n        await checkServer();\r\n    };\r\n\r\n    // CHANGED: Never block page rendering - always show content\r\n    // Health check only for background monitoring, not blocking\r\n    // This allows login/register pages to always be visible\r\n    if (false && !isOnline && !isChecking) {  // Disabled blocking - always show children\r\n        return (\r\n            <div style={{\r\n                minHeight: \"100vh\",\r\n                backgroundColor: colors.background,\r\n                display: \"flex\",\r\n                alignItems: \"center\",\r\n                justifyContent: \"center\",\r\n                padding: \"24px\",\r\n                fontFamily: \"'Sarabun', sans-serif\",\r\n            }}>\r\n                <div style={{\r\n                    backgroundColor: colors.card,\r\n                    borderRadius: \"24px\",\r\n                    padding: \"48px\",\r\n                    maxWidth: \"480px\",\r\n                    width: \"100%\",\r\n                    textAlign: \"center\",\r\n                    boxShadow: \"0 4px 24px rgba(0,0,0,0.08)\",\r\n                }}>\r\n                    {/* Error Icon */}\r\n                    <div style={{\r\n                        width: \"80px\",\r\n                        height: \"80px\",\r\n                        margin: \"0 auto 24px\",\r\n                        backgroundColor: \"#FEE2E2\",\r\n                        borderRadius: \"50%\",\r\n                        display: \"flex\",\r\n                        alignItems: \"center\",\r\n                        justifyContent: \"center\",\r\n                    }}>\r\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={colors.danger} strokeWidth=\"2\">\r\n                            <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n                            <path d=\"M12 8V12M12 16H12.01\" strokeLinecap=\"round\" />\r\n                        </svg>\r\n                    </div>\r\n\r\n                    {/* Title */}\r\n                    <h1 style={{\r\n                        fontSize: \"24px\",\r\n                        fontWeight: 700,\r\n                        color: colors.textDark,\r\n                        marginBottom: \"16px\",\r\n                    }}>\r\n                        เซิร์ฟเวอร์ไม่พร้อมให้บริการ\r\n                    </h1>\r\n\r\n                    {/* Description */}\r\n                    <p style={{\r\n                        fontSize: \"16px\",\r\n                        color: colors.textGray,\r\n                        marginBottom: \"32px\",\r\n                        lineHeight: 1.6,\r\n                    }}>\r\n                        ระบบกำลังปรับปรุงหรือเกิดปัญหาชั่วคราว\r\n                        <br />\r\n                        กรุณาลองใหม่อีกครั้งในอีกสักครู่\r\n                    </p>\r\n\r\n                    {/* Retry Button */}\r\n                    <button\r\n                        onClick={handleRetry}\r\n                        disabled={isChecking}\r\n                        style={{\r\n                            width: \"100%\",\r\n                            padding: \"16px 24px\",\r\n                            backgroundColor: isChecking ? colors.textGray : colors.primary,\r\n                            color: \"#FFFFFF\",\r\n                            border: \"none\",\r\n                            borderRadius: \"12px\",\r\n                            fontSize: \"16px\",\r\n                            fontWeight: 600,\r\n                            cursor: isChecking ? \"not-allowed\" : \"pointer\",\r\n                            display: \"flex\",\r\n                            alignItems: \"center\",\r\n                            justifyContent: \"center\",\r\n                            gap: \"8px\",\r\n                            transition: \"all 0.2s\",\r\n                        }}\r\n                    >\r\n                        {isChecking ? (\r\n                            <>\r\n                                <span className=\"spinner\" />\r\n                                กำลังตรวจสอบ...\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                    <path d=\"M1 4V10H7M23 20V14H17\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                                    <path d=\"M20.49 9A9 9 0 0 0 5.64 5.64L1 10M23 14L18.36 18.36A9 9 0 0 1 3.51 15\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                                </svg>\r\n                                ลองเชื่อมต่อใหม่\r\n                            </>\r\n                        )}\r\n                    </button>\r\n\r\n                    {/* Retry Count */}\r\n                    {retryCount > 0 && (\r\n                        <p style={{\r\n                            marginTop: \"16px\",\r\n                            fontSize: \"14px\",\r\n                            color: colors.textGray,\r\n                        }}>\r\n                            พยายามเชื่อมต่อแล้ว {retryCount} ครั้ง\r\n                        </p>\r\n                    )}\r\n\r\n                    {/* Support Info */}\r\n                    <div style={{\r\n                        marginTop: \"32px\",\r\n                        paddingTop: \"24px\",\r\n                        borderTop: `1px solid ${colors.textGray}33`,\r\n                    }}>\r\n                        <p style={{\r\n                            fontSize: \"14px\",\r\n                            color: colors.textGray,\r\n                        }}>\r\n                            หากปัญหายังไม่หาย กรุณาติดต่อ\r\n                            <br />\r\n                            <strong>02-123-4567</strong> หรือ <strong>support@gacp.go.th</strong>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <style jsx global>{`\r\n                    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap');\r\n                    .spinner {\r\n                        width: 20px;\r\n                        height: 20px;\r\n                        border: 2px solid rgba(255,255,255,0.3);\r\n                        border-top-color: #fff;\r\n                        border-radius: 50%;\r\n                        animation: spin 0.8s linear infinite;\r\n                    }\r\n                    @keyframes spin {\r\n                        to { transform: rotate(360deg); }\r\n                    }\r\n                `}</style>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Server is online - render children\r\n    return <>{children}</>;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\BackButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\DataTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\DocumentUploadCard.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":206,"column":33,"nodeType":"JSXOpeningElement","endLine":210,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useCallback } from 'react';\r\n\r\ninterface DocumentUploadCardProps {\r\n    id: string;\r\n    label: string;\r\n    hint?: string;\r\n    required?: boolean;\r\n    accept?: string;\r\n    maxSize?: number; // MB\r\n    value?: {\r\n        file?: File;\r\n        url?: string;\r\n        name?: string;\r\n        type?: string;\r\n    };\r\n    onChange: (value: { file?: File; url?: string; name?: string; type?: string } | null) => void;\r\n    onPreview?: (file: File) => void;\r\n}\r\n\r\nexport function DocumentUploadCard({\r\n    id,\r\n    label,\r\n    hint,\r\n    required = false,\r\n    accept = '.pdf,.jpg,.jpeg,.png',\r\n    maxSize = 5,\r\n    value,\r\n    onChange,\r\n    onPreview,\r\n}: DocumentUploadCardProps) {\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [previewUrl, setPreviewUrl] = useState<string | null>(null);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const validateFile = useCallback((file: File): string | null => {\r\n        const maxBytes = maxSize * 1024 * 1024;\r\n        if (file.size > maxBytes) {\r\n            return `ไฟล์มีขนาดเกิน ${maxSize} MB`;\r\n        }\r\n\r\n        const acceptedTypes = accept.split(',').map(t => t.trim().toLowerCase());\r\n        const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();\r\n        const isAccepted = acceptedTypes.some(at => fileExt === at || file.type.includes(at.replace('.', '')));\r\n\r\n        if (!isAccepted) {\r\n            return `รองรับเฉพาะไฟล์ ${accept}`;\r\n        }\r\n\r\n        return null;\r\n    }, [accept, maxSize]);\r\n\r\n    const handleFile = useCallback((file: File) => {\r\n        setError(null);\r\n\r\n        const validationError = validateFile(file);\r\n        if (validationError) {\r\n            setError(validationError);\r\n            return;\r\n        }\r\n\r\n        // Create preview URL for images\r\n        if (file.type.startsWith('image/')) {\r\n            const url = URL.createObjectURL(file);\r\n            setPreviewUrl(url);\r\n        } else if (file.type === 'application/pdf') {\r\n            setPreviewUrl('pdf');\r\n        } else {\r\n            setPreviewUrl(null);\r\n        }\r\n\r\n        onChange({\r\n            file,\r\n            name: file.name,\r\n            type: file.type,\r\n        });\r\n\r\n        if (onPreview) {\r\n            onPreview(file);\r\n        }\r\n    }, [validateFile, onChange, onPreview]);\r\n\r\n    const handleDrop = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        setIsDragging(false);\r\n        const file = e.dataTransfer.files[0];\r\n        if (file) handleFile(file);\r\n    }, [handleFile]);\r\n\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) handleFile(file);\r\n        if (inputRef.current) inputRef.current.value = '';\r\n    };\r\n\r\n    const handleRemove = () => {\r\n        if (previewUrl && previewUrl !== 'pdf') {\r\n            URL.revokeObjectURL(previewUrl);\r\n        }\r\n        setPreviewUrl(null);\r\n        setError(null);\r\n        onChange(null);\r\n    };\r\n\r\n    const formatFileSize = (bytes: number): string => {\r\n        if (bytes < 1024) return bytes + ' B';\r\n        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';\r\n    };\r\n\r\n    const hasFile = value?.file || value?.url;\r\n\r\n    return (\r\n        <div className=\"mb-4\">\r\n            {/* Label */}\r\n            <label className=\"block text-sm font-semibold text-gray-800 mb-2\">\r\n                {label}\r\n                {required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </label>\r\n\r\n            {/* Hint */}\r\n            {hint && (\r\n                <p className=\"text-xs text-gray-500 mb-2\">{hint}</p>\r\n            )}\r\n\r\n            {/* Upload Zone */}\r\n            {!hasFile ? (\r\n                <div\r\n                    onClick={() => inputRef.current?.click()}\r\n                    onDragEnter={(e) => { e.preventDefault(); setIsDragging(true); }}\r\n                    onDragLeave={(e) => { e.preventDefault(); setIsDragging(false); }}\r\n                    onDragOver={(e) => e.preventDefault()}\r\n                    onDrop={handleDrop}\r\n                    className={`\r\n                        relative border-2 border-dashed rounded-xl p-6 text-center cursor-pointer\r\n                        transition-all duration-200\r\n                        ${isDragging\r\n                            ? 'border-emerald-500 bg-emerald-50'\r\n                            : 'border-gray-300 bg-gray-50 hover:border-emerald-400 hover:bg-emerald-50/50'\r\n                        }\r\n                        ${error ? 'border-red-400 bg-red-50' : ''}\r\n                    `}\r\n                >\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"file\"\r\n                        accept={accept}\r\n                        onChange={handleInputChange}\r\n                        className=\"hidden\"\r\n                        id={id}\r\n                    />\r\n\r\n                    {/* Upload Icon */}\r\n                    <div className={`mx-auto mb-3 ${isDragging ? 'text-emerald-500' : 'text-gray-400'}`}>\r\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\r\n                            <polyline points=\"17 8 12 3 7 8\" />\r\n                            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\" />\r\n                        </svg>\r\n                    </div>\r\n\r\n                    <p className=\"text-sm font-medium text-gray-700 mb-1\">\r\n                        {isDragging ? 'วางไฟล์ที่นี่' : 'ลากไฟล์มาวาง หรือคลิกเพื่อเลือก'}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        {accept.split(',').map(a => a.replace('.', '').toUpperCase()).join(', ')} • สูงสุด {maxSize} MB\r\n                    </p>\r\n                </div>\r\n            ) : (\r\n                /* Preview Zone */\r\n                <div className=\"border-2 border-emerald-500 rounded-xl overflow-hidden bg-emerald-50\">\r\n                    {/* Preview Header */}\r\n                    <div className=\"flex items-center justify-between px-4 py-3 bg-emerald-100/50 border-b border-emerald-200\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-8 h-8 rounded-lg bg-emerald-500 flex items-center justify-center\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" strokeWidth=\"2\">\r\n                                    <polyline points=\"20 6 9 17 4 12\" />\r\n                                </svg>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-gray-800 truncate max-w-48\">\r\n                                    {value?.name || 'ไฟล์ที่อัปโหลด'}\r\n                                </p>\r\n                                {value?.file && (\r\n                                    <p className=\"text-xs text-gray-500\">\r\n                                        {formatFileSize(value.file.size)}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleRemove}\r\n                            className=\"px-3 py-1.5 rounded-lg bg-red-100 text-red-600 text-xs font-medium hover:bg-red-200 transition-colors\"\r\n                        >\r\n                            ลบ\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Preview Content */}\r\n                    <div className=\"p-4\">\r\n                        {previewUrl && previewUrl !== 'pdf' ? (\r\n                            /* Image Preview */\r\n                            <div className=\"relative rounded-lg overflow-hidden bg-white border border-gray-200\">\r\n                                <img\r\n                                    src={previewUrl}\r\n                                    alt=\"Preview\"\r\n                                    className=\"w-full h-48 object-contain\"\r\n                                />\r\n                                {/* AI Ready Badge */}\r\n                                <div className=\"absolute bottom-2 right-2 px-2 py-1 bg-black/70 rounded-md\">\r\n                                    <p className=\"text-xs text-white flex items-center gap-1\">\r\n                                        <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                            <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n                                            <path d=\"M12 16v-4\" />\r\n                                            <path d=\"M12 8h.01\" />\r\n                                        </svg>\r\n                                        พร้อมให้ AI ตรวจสอบ\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        ) : previewUrl === 'pdf' ? (\r\n                            /* PDF Preview */\r\n                            <div className=\"flex items-center justify-center h-32 rounded-lg bg-white border border-gray-200\">\r\n                                <div className=\"text-center\">\r\n                                    <svg className=\"mx-auto text-red-500 mb-2\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                                        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\r\n                                        <polyline points=\"14 2 14 8 20 8\" />\r\n                                        <path d=\"M10 12h4\" />\r\n                                        <path d=\"M10 16h4\" />\r\n                                    </svg>\r\n                                    <p className=\"text-sm font-medium text-gray-700\">PDF Document</p>\r\n                                    <p className=\"text-xs text-gray-500 mt-1\">พร้อมให้ AI ตรวจสอบ</p>\r\n                                </div>\r\n                            </div>\r\n                        ) : value?.url ? (\r\n                            /* URL Preview */\r\n                            <div className=\"flex items-center justify-center h-32 rounded-lg bg-white border border-gray-200\">\r\n                                <div className=\"text-center\">\r\n                                    <svg className=\"mx-auto text-emerald-500 mb-2\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                                        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\r\n                                        <polyline points=\"14 2 14 8 20 8\" />\r\n                                        <polyline points=\"16 13 12 17 8 13\" />\r\n                                    </svg>\r\n                                    <p className=\"text-sm font-medium text-gray-700\">อัปโหลดสำเร็จ</p>\r\n                                </div>\r\n                            </div>\r\n                        ) : null}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n                <p className=\"mt-2 text-sm text-red-600 flex items-center gap-1\">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                        <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n                        <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\" />\r\n                        <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\" />\r\n                    </svg>\r\n                    {error}\r\n                </p>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\StatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\WizardUI.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\bottom-nav.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\bottom-nav.tsx:69:9\n  67 |         const currentUser = AuthService.getUser();\n  68 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 69 |         setUser(currentUser);\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  70 |\n  71 |         // Listen for updates (login/profile update)\n  72 |         const unsubscribe = AuthService.onAuthChange((event, data) => {","line":69,"column":9,"nodeType":null,"endLine":69,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\error-boundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\file-upload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\form-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\gacp-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\gacp-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\gacp-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\icons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\loading-spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\modern-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\modern-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\modern-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\page-components.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":21,"column":9,"severity":1,"nodeType":null,"fix":{"range":[625,680],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client';\r\n\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { Icons } from \"./icons\";\r\nimport { AuthService, AuthUser } from \"@/lib/services/auth-service\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useLanguage } from \"@/lib/i18n/LanguageContext\";\r\n\r\ninterface SidebarProps {\r\n    isDark: boolean;\r\n    toggleTheme: () => void;\r\n}\r\n\r\nexport function Sidebar({ isDark, toggleTheme }: SidebarProps) {\r\n    const pathname = usePathname();\r\n    const [user, setUser] = useState<AuthUser | null>(null);\r\n    const { dict } = useLanguage();\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        const currentUser = AuthService.getUser();\r\n        setUser(currentUser);\r\n\r\n        const unsubscribe = AuthService.onAuthChange((event, data) => {\r\n            if (event === 'login' && data && typeof data === 'object' && 'user' in data) {\r\n                setUser((data as { user: AuthUser }).user);\r\n            } else {\r\n                setUser(AuthService.getUser());\r\n            }\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    const isVerified = user?.verificationStatus === 'APPROVED';\r\n\r\n    const navItems = [\r\n        { href: \"/farmer/dashboard\", icon: Icons.Home, label: dict.sidebar.dashboard, requiredVerify: false },\r\n        { href: \"/farmer/applications\", icon: Icons.Document, label: dict.sidebar.applications, requiredVerify: true },\r\n        { href: \"/farmer/establishments\", icon: Icons.Leaf, label: dict.sidebar.establishments, requiredVerify: true },\r\n        { href: \"/farmer/planting\", icon: Icons.Calendar, label: dict.sidebar.planting, requiredVerify: true },\r\n        { href: \"/farmer/certificates\", icon: Icons.Certificate, label: dict.sidebar.certificates, requiredVerify: true },\r\n        { href: \"/farmer/tracking\", icon: Icons.Compass, label: dict.sidebar.tracking, requiredVerify: true },\r\n        { href: \"/farmer/payments\", icon: Icons.CreditCard, label: dict.sidebar.payments, requiredVerify: true },\r\n        { href: \"/farmer/profile\", icon: Icons.User, label: dict.sidebar.profile, requiredVerify: false },\r\n        { href: \"/farmer/settings\", icon: Icons.Settings, label: dict.sidebar.settings, requiredVerify: false },\r\n    ];\r\n\r\n    const handleLogout = () => {\r\n        AuthService.logout();\r\n        window.location.href = \"/login\";\r\n    };\r\n\r\n    return (\r\n        <aside className={`\r\n            fixed left-4 top-4 bottom-4 w-20 rounded-[2.5rem] flex flex-col items-center py-8 transition-all duration-500 z-50\r\n            hidden lg:flex \r\n            ${isDark\r\n                ? 'bg-slate-900/90 border border-slate-700/50 backdrop-blur-xl shadow-2xl'\r\n                : 'bg-white/80 border border-white/40 backdrop-blur-xl shadow-soft'\r\n            }\r\n        `}>\r\n            {/* Logo Section */}\r\n            <div className=\"mb-10 relative group\">\r\n                <div className=\"absolute inset-0 bg-primary/20 rounded-2xl blur-xl group-hover:bg-primary/40 transition-all duration-700 scale-110\"></div>\r\n                <div className=\"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary to-primary-800 flex items-center justify-center text-white font-black text-xl shadow-lg relative z-10 transform group-hover:rotate-12 transition-transform\">\r\n                    G\r\n                </div>\r\n            </div>\r\n\r\n            {/* Navigation */}\r\n            <nav className=\"flex-1 flex flex-col gap-2 w-full px-2 overflow-y-auto no-scrollbar\">\r\n                {navItems.map(item => {\r\n                    if (item.requiredVerify && !isVerified) return null;\r\n\r\n                    const isActive = pathname === item.href || (item.href !== \"/farmer/dashboard\" && pathname.startsWith(item.href));\r\n\r\n                    return (\r\n                        <div key={item.href} className=\"group relative\">\r\n                            <Link\r\n                                href={item.href}\r\n                                className={`\r\n                                    flex flex-col items-center justify-center gap-1.5 py-3.5 rounded-2xl transition-all duration-300 relative\r\n                                    ${isActive\r\n                                        ? 'bg-primary text-white shadow-lg shadow-primary/20 scale-100'\r\n                                        : isDark\r\n                                            ? 'text-slate-500 hover:text-white hover:bg-white/5'\r\n                                            : 'text-gray-400 hover:text-primary hover:bg-primary-50'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <item.icon className={`w-6 h-6 transition-transform duration-300 ${isActive ? 'scale-110' : 'group-hover:scale-110'}`} />\r\n                                <span className={`text-[9px] font-black uppercase tracking-widest text-center px-1 leading-tight ${isActive ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'} transition-opacity`}>\r\n                                    {item.label}\r\n                                </span>\r\n                            </Link>\r\n\r\n                            {/* Floating Tooltip/Indicator */}\r\n                            {!isActive && (\r\n                                <div className=\"absolute left-[84px] top-1/2 -translate-y-1/2 bg-gray-900 text-white text-[10px] font-bold px-3 py-1.5 rounded-xl opacity-0 scale-95 pointer-events-none group-hover:opacity-100 group-hover:scale-100 transition-all z-[60] whitespace-nowrap shadow-xl\">\r\n                                    <div className=\"absolute left-[-4px] top-1/2 -translate-y-1/2 w-2 h-2 bg-gray-900 rotate-45\"></div>\r\n                                    {item.label}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })}\r\n            </nav>\r\n\r\n            {/* Bottom Actions */}\r\n            <div className=\"mt-auto flex flex-col items-center gap-4 w-full px-3\">\r\n                <button\r\n                    onClick={toggleTheme}\r\n                    className={`\r\n                        w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-300\r\n                        ${isDark\r\n                            ? 'bg-slate-800 text-amber-400 hover:bg-slate-700 shadow-inner'\r\n                            : 'bg-gray-50 text-slate-500 hover:bg-white hover:shadow-soft border border-gray-100'\r\n                        }\r\n                    `}\r\n                >\r\n                    {isDark ? <Icons.Sun className=\"w-5 h-5\" /> : <Icons.Moon className=\"w-5 h-5\" />}\r\n                </button>\r\n\r\n                <button\r\n                    onClick={handleLogout}\r\n                    className={`\r\n                        w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-300 mb-2\r\n                        ${isDark\r\n                            ? 'text-slate-500 hover:text-red-400 hover:bg-red-400/10'\r\n                            : 'text-gray-400 hover:text-red-500 hover:bg-red-50'\r\n                        }\r\n                    `}\r\n                >\r\n                    <Icons.Logout className=\"w-5 h-5\" />\r\n                </button>\r\n            </div>\r\n        </aside>\r\n    );\r\n}\r\n\r\nexport default Sidebar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\ui\\theme-toggle.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":15,"column":9,"severity":1,"nodeType":null,"fix":{"range":[374,429],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\r\n\r\nimport React, { useEffect, useState } from 'react';\r\n\r\ninterface ThemeToggleProps {\r\n    className?: string;\r\n    size?: 'sm' | 'md';\r\n}\r\n\r\nexport function ThemeToggle({ className = '', size = 'md' }: ThemeToggleProps) {\r\n    const [isDark, setIsDark] = useState(false);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        setMounted(true);\r\n        setIsDark(localStorage.getItem(\"theme\") === \"dark\");\r\n    }, []);\r\n\r\n    const toggleTheme = () => {\r\n        const newTheme = !isDark;\r\n        setIsDark(newTheme);\r\n        localStorage.setItem(\"theme\", newTheme ? \"dark\" : \"light\");\r\n\r\n        // Trigger storage event for other components\r\n        window.dispatchEvent(new Event('storage'));\r\n\r\n        // Also update document for immediate feedback\r\n        document.documentElement.classList.toggle('dark', newTheme);\r\n    };\r\n\r\n    if (!mounted) {\r\n        return null; // Avoid hydration mismatch\r\n    }\r\n\r\n    const buttonSize = size === 'sm' ? '36px' : '44px';\r\n    const iconSize = size === 'sm' ? '16px' : '20px';\r\n\r\n    return (\r\n        <button\r\n            onClick={toggleTheme}\r\n            className={className}\r\n            style={{\r\n                width: buttonSize,\r\n                height: buttonSize,\r\n                borderRadius: '12px',\r\n                backgroundColor: isDark ? 'rgba(16, 185, 129, 0.15)' : '#ECFDF5',\r\n                border: `1px solid ${isDark ? 'rgba(16, 185, 129, 0.3)' : '#10B981'}`,\r\n                cursor: 'pointer',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n            }}\r\n            title={isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'}\r\n        >\r\n            {isDark ? (\r\n                // Sun icon\r\n                <svg width={iconSize} height={iconSize} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#FBBF24\" strokeWidth=\"2\" strokeLinecap=\"round\">\r\n                    <circle cx=\"12\" cy=\"12\" r=\"5\" />\r\n                    <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\" />\r\n                    <line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\" />\r\n                    <line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\" />\r\n                    <line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\" />\r\n                    <line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\" />\r\n                    <line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\" />\r\n                    <line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\" />\r\n                    <line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\" />\r\n                </svg>\r\n            ) : (\r\n                // Moon icon\r\n                <svg width={iconSize} height={iconSize} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"2\" strokeLinecap=\"round\">\r\n                    <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\" />\r\n                </svg>\r\n            )}\r\n        </button>\r\n    );\r\n}\r\n\r\nexport default ThemeToggle;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\wizard\\WizardNavigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\components\\wizard\\WizardStepWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\config\\api.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\features\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\features\\permit-form\\components\\application-selector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setServiceType' is assigned a value but never used.","line":72,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculating' is assigned a value but never used.","line":76,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'calculateFee' and 'onSelectionChange'. Either include them or remove the dependency array. If 'onSelectionChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":89,"column":8,"nodeType":"ArrayExpression","endLine":89,"endColumn":50,"suggestions":[{"desc":"Update the dependencies array to be: [plant, objective, areaTypes, serviceType, onSelectionChange, calculateFee]","fix":{"range":[2890,2932],"text":"[plant, objective, areaTypes, serviceType, onSelectionChange, calculateFee]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3032,3035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3032,3035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":97,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3467,3470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3467,3470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":117,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { apiClient as api } from '@/lib/api';\r\n\r\ninterface PricingConfig {\r\n    config: {\r\n        docReviewFee: number;\r\n        baseInspectionFee: number;\r\n        areaSurcharge: number;\r\n    };\r\n    areaTypes: { id: string; label: string; labelEn: string }[];\r\n    objectives: { id: string; label: string; labelEn: string }[];\r\n    serviceTypes: { id: string; label: string }[];\r\n}\r\n\r\ninterface FeeBreakdown {\r\n    items: { description: string; quantity: number; unitPrice: number; total: number }[];\r\n    subtotal: number;\r\n    total: number;\r\n    totalText: string;\r\n    requiresTeamReview: boolean;\r\n    message?: string;\r\n}\r\n\r\n// Theme support\r\nconst getTheme = (isDark: boolean) => isDark ? {\r\n    bg: \"rgba(15, 23, 42, 0.6)\", border: \"rgba(255, 255, 255, 0.08)\",\r\n    text: \"#F8FAFC\", textSecondary: \"#94A3B8\", textMuted: \"#64748B\",\r\n    accent: \"#3B82F6\", accentLight: \"#60A5FA\", success: \"#10B981\"\r\n} : {\r\n    bg: \"#FFFFFF\", border: \"rgba(0, 0, 0, 0.08)\",\r\n    text: \"#1A1A1A\", textSecondary: \"#5A5A5A\", textMuted: \"#8A8A8A\",\r\n    accent: \"#2563EB\", accentLight: \"#3B82F6\", success: \"#16A34A\"\r\n};\r\n\r\n// Plant options (6 สมุนไพร)\r\nconst PLANTS = [\r\n    { id: 'cannabis', label: 'กัญชา', emoji: '' },\r\n    { id: 'kratom', label: 'กระท่อม', emoji: '' },\r\n    { id: 'turmeric', label: 'ขมิ้นชัน', emoji: '' },\r\n    { id: 'ginger', label: 'ขิง', emoji: '' },\r\n    { id: 'black_galingale', label: 'กระชายดำ', emoji: '' },\r\n    { id: 'plai', label: 'ไพล', emoji: '' }\r\n];\r\n\r\ninterface ApplicationSelectorProps {\r\n    isDark?: boolean;\r\n    onSelectionChange?: (selection: {\r\n        plant: string;\r\n        objective: string;\r\n        areaTypes: string[];\r\n        serviceType: string;\r\n    }) => void;\r\n    onFeeCalculated?: (fee: FeeBreakdown | null) => void;\r\n}\r\n\r\nexport default function ApplicationSelector({\r\n    isDark = false,\r\n    onSelectionChange,\r\n    onFeeCalculated\r\n}: ApplicationSelectorProps) {\r\n    const t = getTheme(isDark);\r\n\r\n    const [config, setConfig] = useState<PricingConfig | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Selections\r\n    const [plant, setPlant] = useState<string>('');\r\n    const [objective, setObjective] = useState<string>('');\r\n    const [areaTypes, setAreaTypes] = useState<string[]>([]);\r\n    const [serviceType, setServiceType] = useState<string>('new_application');\r\n\r\n    // Calculated fee\r\n    const [fee, setFee] = useState<FeeBreakdown | null>(null);\r\n    const [calculating, setCalculating] = useState(false);\r\n\r\n    // Load config\r\n    useEffect(() => {\r\n        loadConfig();\r\n    }, []);\r\n\r\n    // Calculate fee when selections change\r\n    useEffect(() => {\r\n        if (serviceType && areaTypes.length > 0) {\r\n            calculateFee();\r\n        }\r\n        onSelectionChange?.({ plant, objective, areaTypes, serviceType });\r\n    }, [plant, objective, areaTypes, serviceType]);\r\n\r\n    const loadConfig = async () => {\r\n        try {\r\n            const result = await api.get<any>('/api/pricing/fees');\r\n            if (result.success && result.data?.data) {\r\n                setConfig(result.data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load pricing config');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const calculateFee = async () => {\r\n        setCalculating(true);\r\n        try {\r\n            const result = await api.post<any>('/api/pricing/calculate', {\r\n                serviceType,\r\n                areaTypes,\r\n                plantType: plant,\r\n                objective\r\n            });\r\n            if (result.success && result.data?.data) {\r\n                setFee(result.data.data);\r\n                onFeeCalculated?.(result.data.data);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to calculate fee');\r\n        } finally {\r\n            setCalculating(false);\r\n        }\r\n    };\r\n\r\n    const toggleArea = (areaId: string) => {\r\n        setAreaTypes(prev =>\r\n            prev.includes(areaId)\r\n                ? prev.filter(a => a !== areaId)\r\n                : [...prev, areaId]\r\n        );\r\n    };\r\n\r\n    if (loading) {\r\n        return <div style={{ padding: '20px', textAlign: 'center', color: t.textMuted }}>กำลังโหลด...</div>;\r\n    }\r\n\r\n    return (\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\r\n            {/* Plant Selection */}\r\n            <div>\r\n                <label style={{ display: 'block', fontSize: '14px', fontWeight: 600, color: t.text, marginBottom: '12px' }}>\r\n                    1. เลือกประเภทสมุนไพร <span style={{ color: '#EF4444' }}>*</span>\r\n                </label>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px' }}>\r\n                    {PLANTS.map(p => (\r\n                        <button\r\n                            key={p.id}\r\n                            onClick={() => setPlant(p.id)}\r\n                            style={{\r\n                                padding: '12px', borderRadius: '10px', cursor: 'pointer',\r\n                                border: plant === p.id ? `2px solid ${t.accent}` : `1px solid ${t.border}`,\r\n                                background: plant === p.id ? `${t.accent}15` : 'transparent',\r\n                                color: t.text, fontSize: '13px', textAlign: 'center'\r\n                            }}\r\n                        >\r\n                            <span style={{ fontSize: '20px', display: 'block', marginBottom: '4px' }}>{p.emoji}</span>\r\n                            {p.label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Objective Selection */}\r\n            <div>\r\n                <label style={{ display: 'block', fontSize: '14px', fontWeight: 600, color: t.text, marginBottom: '12px' }}>\r\n                    2. วัตถุประสงค์การผลิต <span style={{ color: '#EF4444' }}>*</span>\r\n                </label>\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\r\n                    {config?.objectives.map(obj => (\r\n                        <label\r\n                            key={obj.id}\r\n                            style={{\r\n                                display: 'flex', alignItems: 'center', gap: '12px',\r\n                                padding: '12px 16px', borderRadius: '10px', cursor: 'pointer',\r\n                                border: objective === obj.id ? `2px solid ${t.accent}` : `1px solid ${t.border}`,\r\n                                background: objective === obj.id ? `${t.accent}15` : 'transparent'\r\n                            }}\r\n                        >\r\n                            <input\r\n                                type=\"radio\"\r\n                                name=\"objective\"\r\n                                value={obj.id}\r\n                                checked={objective === obj.id}\r\n                                onChange={() => setObjective(obj.id)}\r\n                                style={{ accentColor: t.accent }}\r\n                            />\r\n                            <span style={{ color: t.text, fontSize: '14px' }}>{obj.label}</span>\r\n                            <span style={{ color: t.textMuted, fontSize: '12px' }}>({obj.labelEn})</span>\r\n                        </label>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Area Type Selection (Multi-select) */}\r\n            <div>\r\n                <label style={{ display: 'block', fontSize: '14px', fontWeight: 600, color: t.text, marginBottom: '8px' }}>\r\n                    3. ลักษณะพื้นที่ <span style={{ color: '#EF4444' }}>*</span>\r\n                    <span style={{ fontWeight: 400, fontSize: '12px', color: t.textMuted, marginLeft: '8px' }}>\r\n                        (เลือกได้หลายรายการ, คิด 5,000 บาท/ประเภท)\r\n                    </span>\r\n                </label>\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\r\n                    {config?.areaTypes.map(area => (\r\n                        <label\r\n                            key={area.id}\r\n                            style={{\r\n                                display: 'flex', alignItems: 'center', gap: '12px',\r\n                                padding: '12px 16px', borderRadius: '10px', cursor: 'pointer',\r\n                                border: areaTypes.includes(area.id) ? `2px solid ${t.success}` : `1px solid ${t.border}`,\r\n                                background: areaTypes.includes(area.id) ? `${t.success}15` : 'transparent'\r\n                            }}\r\n                        >\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                checked={areaTypes.includes(area.id)}\r\n                                onChange={() => toggleArea(area.id)}\r\n                                style={{ accentColor: t.success, width: '18px', height: '18px' }}\r\n                            />\r\n                            <span style={{ color: t.text, fontSize: '14px' }}>{area.label}</span>\r\n                            <span style={{ color: t.textMuted, fontSize: '12px' }}>({area.labelEn})</span>\r\n                            {areaTypes.includes(area.id) && (\r\n                                <span style={{ marginLeft: 'auto', fontSize: '12px', color: t.success, fontWeight: 600 }}>\r\n                                    +5,000 ฿\r\n                                </span>\r\n                            )}\r\n                        </label>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Fee Preview */}\r\n            {fee && !fee.requiresTeamReview && (\r\n                <div style={{\r\n                    padding: '16px', borderRadius: '12px',\r\n                    background: `linear-gradient(135deg, ${t.accent}10, ${t.accentLight}10)`,\r\n                    border: `1px solid ${t.accent}30`\r\n                }}>\r\n                    <div style={{ fontSize: '14px', fontWeight: 600, color: t.text, marginBottom: '12px' }}>\r\n                        สรุปค่าธรรมเนียม\r\n                    </div>\r\n\r\n                    {fee.items.map((item, idx) => (\r\n                        <div key={idx} style={{\r\n                            display: 'flex', justifyContent: 'space-between',\r\n                            fontSize: '13px', color: t.textSecondary, marginBottom: '8px'\r\n                        }}>\r\n                            <span>{item.description}</span>\r\n                            <span>{item.total.toLocaleString()} ฿</span>\r\n                        </div>\r\n                    ))}\r\n\r\n                    <div style={{\r\n                        borderTop: `1px solid ${t.border}`, paddingTop: '12px', marginTop: '8px',\r\n                        display: 'flex', justifyContent: 'space-between'\r\n                    }}>\r\n                        <span style={{ fontSize: '16px', fontWeight: 700, color: t.text }}>รวมทั้งสิ้น</span>\r\n                        <span style={{ fontSize: '20px', fontWeight: 700, color: t.accent }}>\r\n                            {fee.total.toLocaleString()} ฿\r\n                        </span>\r\n                    </div>\r\n                    <div style={{ fontSize: '12px', color: t.textMuted, textAlign: 'right', marginTop: '4px' }}>\r\n                        ({fee.totalText})\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {fee?.requiresTeamReview && (\r\n                <div style={{\r\n                    padding: '16px', borderRadius: '12px',\r\n                    background: '#FEF3C7', border: '1px solid #F59E0B'\r\n                }}>\r\n                    <div style={{ fontSize: '14px', color: '#92400E' }}>\r\n                        {fee.message || 'ทีมงานจะประเมินและส่งใบเสนอราคาให้ภายหลัง'}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\features\\permit-form\\components\\documents\\invoice-document.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'invoicePhase' is defined but never used.","line":45,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useRef } from \"react\";\r\nimport { useInvoice, DEFAULT_FEES } from \"@/hooks/use-pricing\";\r\n\r\ninterface InvoiceDocumentProps {\r\n    invoiceNumber: string;\r\n    invoiceDate: string;\r\n    quotationReference: string;\r\n    applicantName: string;\r\n    applicantCompany?: string;\r\n    applicantTaxId?: string;\r\n    applicantAddress: string;\r\n    applicantPhone?: string;\r\n    invoicePhase: 1 | 2;  // งวด 1 = 5,000 บาท, งวด 2 = 25,000 บาท\r\n    items: Array<{\r\n        description: string;\r\n        quantity: number;\r\n        unitPrice: number;\r\n    }>;\r\n    totalAmount: number;\r\n    totalAmountText: string;\r\n    officerName?: string;\r\n    officerPosition?: string;\r\n}\r\n\r\n// DTAM Official Colors\r\nconst colors = {\r\n    headerBg: \"#4472C4\",\r\n    headerText: \"#FFFFFF\",\r\n    tableBorder: \"#000000\",\r\n    tableHeaderBg: \"#808080\",\r\n    text: \"#000000\",\r\n};\r\n\r\nexport default function InvoiceDocument({\r\n    invoiceNumber,\r\n    invoiceDate,\r\n    quotationReference,\r\n    applicantName,\r\n    applicantCompany,\r\n    applicantTaxId,\r\n    applicantAddress,\r\n    applicantPhone,\r\n    invoicePhase,\r\n    items,\r\n    totalAmount,\r\n    totalAmountText,\r\n    officerName = \"นายรชต โมฆพันธุ์\",\r\n    officerPosition = \"นักวิชาการสาธารณสุข\",\r\n}: InvoiceDocumentProps) {\r\n    const documentRef = useRef<HTMLDivElement>(null);\r\n\r\n    const formatAmount = (amount: number) => {\r\n        return new Intl.NumberFormat('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);\r\n    };\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    return (\r\n        <div style={{ backgroundColor: \"#F5F5F5\", padding: \"24px\", minHeight: \"100vh\" }}>\r\n            {/* Print Button */}\r\n            <div style={{ maxWidth: \"210mm\", margin: \"0 auto 16px\", display: \"flex\", justifyContent: \"flex-end\", gap: \"12px\" }}>\r\n                <button\r\n                    onClick={handlePrint}\r\n                    style={{\r\n                        padding: \"12px 24px\", backgroundColor: \"#34C759\", color: \"#FFF\",\r\n                        border: \"none\", borderRadius: \"8px\", fontSize: \"14px\", fontWeight: 600, cursor: \"pointer\"\r\n                    }}\r\n                >\r\n                    พิมพ์เอกสาร / ดาวน์โหลด PDF\r\n                </button>\r\n            </div>\r\n\r\n            {/* Document */}\r\n            <div\r\n                ref={documentRef}\r\n                id=\"invoice-document\"\r\n                style={{\r\n                    width: \"210mm\",\r\n                    minHeight: \"297mm\",\r\n                    margin: \"0 auto\",\r\n                    backgroundColor: \"#FFFFFF\",\r\n                    padding: \"20mm\",\r\n                    boxShadow: \"0 4px 20px rgba(0,0,0,0.1)\",\r\n                    fontFamily: \"'Sarabun', 'TH Sarabun New', sans-serif\",\r\n                    fontSize: \"14pt\",\r\n                    lineHeight: 1.4,\r\n                    color: colors.text,\r\n                }}\r\n            >\r\n                {/* Header */}\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"flex-start\", marginBottom: \"16px\" }}>\r\n                    {/* Left: Logo + Department Info */}\r\n                    <div style={{ display: \"flex\", gap: \"12px\" }}>\r\n                        <div style={{ width: \"60px\", height: \"60px\", borderRadius: \"50%\", border: \"2px solid #000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", fontSize: \"10px\", textAlign: \"center\" }}>\r\n                            กรมการ<br />แพทย์<br />แผนไทยฯ\r\n                        </div>\r\n                        <div style={{ fontSize: \"12pt\" }}>\r\n                            <div style={{ fontWeight: 700, fontSize: \"14pt\" }}>กองกัญชาทางการแพทย์</div>\r\n                            <div>กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div>\r\n                            <div style={{ fontSize: \"11pt\" }}>88/23 หมู่ 4 ถนนติวานนท์ ต.ตลาดขวัญ อ.เมือง จ.นนทบุรี 11000</div>\r\n                            <div style={{ fontSize: \"11pt\" }}>โทรศัพท์ (02) 5647889 หรือ 061-4219701 อีเมล tdc.cannabis.gacp@gmail.com</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right: Document Type Badge */}\r\n                    <div style={{ backgroundColor: colors.headerBg, color: colors.headerText, padding: \"8px 20px\", fontWeight: 700, fontSize: \"16pt\" }}>\r\n                        ใบวางบิล/ใบแจ้งหนี้\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Document Info */}\r\n                <div style={{ display: \"flex\", justifyContent: \"flex-end\", marginBottom: \"16px\" }}>\r\n                    <div style={{ textAlign: \"right\", fontSize: \"12pt\" }}>\r\n                        <div>ที่ว. 18 ธันวาคม 2568</div>\r\n                        <div>เลขที่เอกสาร: <strong>{invoiceNumber}</strong></div>\r\n                        <div>วันที่: <strong>{invoiceDate}</strong></div>\r\n                        <div>เลขเสนอราคาเลขที่: <strong>{quotationReference}</strong></div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Applicant Info */}\r\n                <div style={{ marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <div><strong>เรียน</strong> {applicantName}</div>\r\n                    {applicantCompany && <div><strong>หน่วยงาน/ผู้รับบริการ:</strong> {applicantCompany}</div>}\r\n                    {applicantTaxId && <div><strong>เลขประจำตัวผู้เสียภาษี:</strong> {applicantTaxId}</div>}\r\n                    <div><strong>ที่อยู่:</strong> {applicantAddress}</div>\r\n                    {applicantPhone && <div><strong>ผู้ประสานงาน:</strong> {applicantPhone}</div>}\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div style={{ marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <p>\r\n                        กองกัญชาทางการแพทย์ขอส่งใบวางบิล/ใบแจ้งหนี้ ดังรายการต่อไปนี้\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Items Table */}\r\n                <table style={{ width: \"100%\", borderCollapse: \"collapse\", marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <thead>\r\n                        <tr style={{ backgroundColor: colors.tableHeaderBg, color: \"#FFF\" }}>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"8%\", textAlign: \"center\" }}>ลำดับที่</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>รายการ</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"12%\", textAlign: \"center\" }}>จำนวน</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"12%\", textAlign: \"center\" }}>หน่วย</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"15%\", textAlign: \"center\" }}>ราคา/<br />หน่วย</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"15%\", textAlign: \"center\" }}>จำนวนเงิน<br />(บาท)</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {items.map((item, index) => (\r\n                            <tr key={index}>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>{index + 1}.</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\" }}>{item.description}</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>{item.quantity}</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>ต่อคำขอ</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\" }}>{formatAmount(item.unitPrice)}</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\" }}>{formatAmount(item.quantity * item.unitPrice)}</td>\r\n                            </tr>\r\n                        ))}\r\n                        <tr>\r\n                            <td colSpan={4} style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>\r\n                                ({totalAmountText})\r\n                            </td>\r\n                            <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\", fontWeight: 700 }}>จำนวนเงินทั้งสิ้น</td>\r\n                            <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\", fontWeight: 700 }}>{formatAmount(totalAmount)}</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n\r\n                {/* Payment Instructions */}\r\n                <div style={{ marginBottom: \"24px\", fontSize: \"11pt\", backgroundColor: \"#F9F9F9\", padding: \"16px\", borderRadius: \"4px\" }}>\r\n                    <div style={{ fontWeight: 700, marginBottom: \"8px\" }}>หมายเหตุ:</div>\r\n                    <div>1. การชำระเงิน : ภายใน 3 วัน หลังได้รับใบวางบิล/ใบแจ้งหนี้</div>\r\n                    <div style={{ marginTop: \"8px\", marginLeft: \"16px\" }}>\r\n                        <strong>โอนเงินเข้าบัญชี</strong><br />\r\n                        ชื่อบัญชี: <strong>เงินบำรุงศูนย์พัฒนายาไทยและสมุนไพร</strong><br />\r\n                        บัญชีธนาคารกรุงไทย เลขที่ <strong>4750134376</strong> สาขามหาวิทยาลัยธรรมศาสตร์ รังสิต<br />\r\n                        เลขประจำตัวผู้เสียภาษี <strong>0994000036540</strong>\r\n                    </div>\r\n                    <div style={{ marginTop: \"12px\", color: \"#D32F2F\" }}>\r\n                        <strong>กรณีทำเช็คสั่งจ่ายในนาม:</strong> เงินบำรุงศูนย์พัฒนายาไทยและสมุนไพร\r\n                    </div>\r\n                    <div style={{ marginTop: \"8px\" }}>\r\n                        2. ชื่อ-ที่อยู่ในการออกใบเสร็จรับเงิน และการส่งหลักฐานชำระเงิน :<br />\r\n                        เมื่อชำระเงินแล้วกรุณาส่ง ชื่อ-ที่อยู่ในการออกใบเสร็จ พร้อมแนบเอกสารหลักฐานชำระเงิน<br />\r\n                        มายัง กองพัฒนายาแผนไทยและสมุนไพร ทาง Google Form\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Signatures */}\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", marginTop: \"40px\", fontSize: \"12pt\" }}>\r\n                    {/* Left: Receiver Signature */}\r\n                    <div style={{ width: \"30%\", textAlign: \"center\" }}>\r\n                        <div style={{ fontWeight: 700, marginBottom: \"8px\" }}>ผู้รับบริการ</div>\r\n                        <div style={{ marginTop: \"40px\" }}>\r\n                            <div>.............................................</div>\r\n                            <div>(............................................)</div>\r\n                            <div>ตำแหน่ง............................</div>\r\n                            <div>วันที่........../............./.............</div>\r\n                            <div>{applicantCompany}</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Center: DTAM Officer Signature */}\r\n                    <div style={{ width: \"30%\", textAlign: \"center\" }}>\r\n                        <div style={{ fontWeight: 700, marginBottom: \"8px\" }}>ผู้ให้บริการ</div>\r\n                        <div style={{ marginTop: \"40px\" }}>\r\n                            <div>.............................................</div>\r\n                            <div>( {officerName} )</div>\r\n                            <div>ตำแหน่ง {officerPosition}</div>\r\n                            <div>วันที่........../............./.............</div>\r\n                            <div>กองกัญชาทางการแพทย์</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right: Director Signature */}\r\n                    <div style={{ width: \"30%\", textAlign: \"center\" }}>\r\n                        <div style={{ fontWeight: 700, marginBottom: \"8px\" }}>ผู้มีอำนาจลงนาม</div>\r\n                        <div style={{ marginTop: \"40px\" }}>\r\n                            <div>.............................................</div>\r\n                            <div>( นายปรีชา หนูทิม )</div>\r\n                            <div>ตำแหน่ง ผู้อำนวยการกองกัญชาทางการแพทย์</div>\r\n                            <div>ปฏิบัติราชการแทน อธิบดีกรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div>\r\n                            <div>วันที่........../............./.............</div>\r\n                            <div>กองกัญชาทางการแพทย์</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* QR Code placeholder */}\r\n                <div style={{ marginTop: \"24px\", display: \"flex\", justifyContent: \"flex-end\", alignItems: \"center\", gap: \"12px\" }}>\r\n                    <div style={{ width: \"80px\", height: \"80px\", border: \"2px solid #000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", fontSize: \"10px\", textAlign: \"center\" }}>\r\n                        [QR Code<br />PromptPay]\r\n                    </div>\r\n                    <div style={{ fontSize: \"11pt\" }}>กรุณาสแกนคิวอาร์โค้ด</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Print Styles */}\r\n            <style jsx global>{`\r\n                @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');\r\n                @media print {\r\n                    body * { visibility: hidden; }\r\n                    #invoice-document, #invoice-document * { visibility: visible; }\r\n                    #invoice-document { position: absolute; left: 0; top: 0; width: 210mm; }\r\n                    button { display: none !important; }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Demo with Phase 1 invoice - fetches price from API (One Brain, Many Faces)\r\nexport function InvoiceDocumentDemoPhase1() {\r\n    const { invoice, loading, error } = useInvoice('phase1');\r\n\r\n    // Use API data or fallback\r\n    const amount = invoice?.amount ?? DEFAULT_FEES.applicationFee;\r\n    const description = invoice?.description ?? 'ค่าตรวจสอบและประเมินคำขอการรับรองมาตรฐานเบื้องต้น';\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ padding: \"40px\", textAlign: \"center\" }}>\r\n                <div>กำลังโหลดข้อมูลใบแจ้งหนี้...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        console.warn('Using fallback prices for Phase 1:', error);\r\n    }\r\n\r\n    return (\r\n        <InvoiceDocument\r\n            invoiceNumber=\"GI-021268017\"\r\n            invoiceDate=\"2 ธันวาคม 2568\"\r\n            quotationReference=\"G-011268017\"\r\n            applicantName=\"ประธานกรรมการ บริษัท สมุก ครูว จำกัด\"\r\n            applicantCompany=\"บริษัท สมุก ครูว จำกัด\"\r\n            applicantTaxId=\"0835566002415\"\r\n            applicantAddress=\"เลขที่ 209/44 หมู่ 5 ต.เกาะแก้ว ชะอำ อ.อกอลาง จ.หมู่กลูเกลต 83110\"\r\n            applicantPhone=\"คุณบุญจวบริทนร์ ปวงรี โทรศัพท์ 0851914649\"\r\n            invoicePhase={1}\r\n            items={[\r\n                { description, quantity: 1, unitPrice: amount },\r\n            ]}\r\n            totalAmount={amount}\r\n            totalAmountText=\"ห้าพันบาทถ้วน\"\r\n        />\r\n    );\r\n}\r\n\r\n// Demo with Phase 2 invoice - fetches price from API (One Brain, Many Faces)\r\nexport function InvoiceDocumentDemoPhase2() {\r\n    const { invoice, loading, error } = useInvoice('phase2');\r\n\r\n    // Use API data or fallback\r\n    const amount = invoice?.amount ?? DEFAULT_FEES.inspectionFee;\r\n    const description = invoice?.description ?? 'ค่ารับรองผลการประเมินและจัดทำหนังสือรับรองมาตรฐาน';\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ padding: \"40px\", textAlign: \"center\" }}>\r\n                <div>กำลังโหลดข้อมูลใบแจ้งหนี้...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        console.warn('Using fallback prices for Phase 2:', error);\r\n    }\r\n\r\n    return (\r\n        <InvoiceDocument\r\n            invoiceNumber=\"GI-021268018\"\r\n            invoiceDate=\"15 ธันวาคม 2568\"\r\n            quotationReference=\"G-011268017\"\r\n            applicantName=\"ประธานกรรมการ บริษัท สมุก ครูว จำกัด\"\r\n            applicantCompany=\"บริษัท สมุก ครูว จำกัด\"\r\n            applicantTaxId=\"0835566002415\"\r\n            applicantAddress=\"เลขที่ 209/44 หมู่ 5 ต.เกาะแก้ว ชะอำ อ.อกอลาง จ.หมู่กลูเกลต 83110\"\r\n            applicantPhone=\"คุณบุญจวบริทนร์ ปวงรี โทรศัพท์ 0851914649\"\r\n            invoicePhase={2}\r\n            items={[\r\n                { description, quantity: 1, unitPrice: amount },\r\n            ]}\r\n            totalAmount={amount}\r\n            totalAmountText=\"สองหมื่นห้าพันบาทถ้วน\"\r\n        />\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\features\\permit-form\\components\\documents\\quotation-document.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_FEES' is defined but never used.","line":4,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useRef } from \"react\";\r\nimport { usePricing, generateQuotationItems, DEFAULT_FEES } from \"@/hooks/use-pricing\";\r\n\r\ninterface QuotationDocumentProps {\r\n    quotationNumber: string;\r\n    quotationDate: string;\r\n    applicantName: string;\r\n    applicantCompany?: string;\r\n    applicantTaxId?: string;\r\n    applicantAddress: string;\r\n    applicantPhone?: string;\r\n    items: Array<{\r\n        description: string;\r\n        quantity: number;\r\n        unitPrice: number;\r\n    }>;\r\n    totalAmount: number;\r\n    totalAmountText: string;\r\n    officerName?: string;\r\n    officerPosition?: string;\r\n}\r\n\r\n// DTAM Official Colors\r\nconst colors = {\r\n    headerBg: \"#4472C4\",\r\n    headerText: \"#FFFFFF\",\r\n    tableBorder: \"#000000\",\r\n    tableHeaderBg: \"#808080\",\r\n    text: \"#000000\",\r\n};\r\n\r\nexport default function QuotationDocument({\r\n    quotationNumber,\r\n    quotationDate,\r\n    applicantName,\r\n    applicantCompany,\r\n    applicantTaxId,\r\n    applicantAddress,\r\n    applicantPhone,\r\n    items,\r\n    totalAmount,\r\n    totalAmountText,\r\n    officerName = \"นายปรีชา หนูทิม\",\r\n    officerPosition = \"ผู้อำนวยการกองกัญชาทางการแพทย์\",\r\n}: QuotationDocumentProps) {\r\n    const documentRef = useRef<HTMLDivElement>(null);\r\n\r\n    const formatAmount = (amount: number) => {\r\n        return new Intl.NumberFormat('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);\r\n    };\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    return (\r\n        <div style={{ backgroundColor: \"#F5F5F5\", padding: \"24px\", minHeight: \"100vh\" }}>\r\n            {/* Print Button */}\r\n            <div style={{ maxWidth: \"210mm\", margin: \"0 auto 16px\", display: \"flex\", justifyContent: \"flex-end\", gap: \"12px\" }}>\r\n                <button\r\n                    onClick={handlePrint}\r\n                    style={{\r\n                        padding: \"12px 24px\", backgroundColor: \"#34C759\", color: \"#FFF\",\r\n                        border: \"none\", borderRadius: \"8px\", fontSize: \"14px\", fontWeight: 600, cursor: \"pointer\"\r\n                    }}\r\n                >\r\n                    พิมพ์เอกสาร / ดาวน์โหลด PDF\r\n                </button>\r\n            </div>\r\n\r\n            {/* Document */}\r\n            <div\r\n                ref={documentRef}\r\n                style={{\r\n                    width: \"210mm\",\r\n                    minHeight: \"297mm\",\r\n                    margin: \"0 auto\",\r\n                    backgroundColor: \"#FFFFFF\",\r\n                    padding: \"20mm\",\r\n                    boxShadow: \"0 4px 20px rgba(0,0,0,0.1)\",\r\n                    fontFamily: \"'Sarabun', 'TH Sarabun New', sans-serif\",\r\n                    fontSize: \"14pt\",\r\n                    lineHeight: 1.4,\r\n                    color: colors.text,\r\n                }}\r\n            >\r\n                {/* Header */}\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"flex-start\", marginBottom: \"16px\" }}>\r\n                    {/* Left: Logo + Department Info */}\r\n                    <div style={{ display: \"flex\", gap: \"12px\" }}>\r\n                        {/* DTAM Logo placeholder */}\r\n                        <div style={{ width: \"60px\", height: \"60px\", borderRadius: \"50%\", border: \"2px solid #000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", fontSize: \"10px\", textAlign: \"center\" }}>\r\n                            กรมการ<br />แพทย์<br />แผนไทยฯ\r\n                        </div>\r\n                        <div style={{ fontSize: \"12pt\" }}>\r\n                            <div style={{ fontWeight: 700, fontSize: \"14pt\" }}>กองกัญชาทางการแพทย์</div>\r\n                            <div>กรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div>\r\n                            <div style={{ fontSize: \"11pt\" }}>88/23 หมู่ 4 ถนนติวานนท์ ต.ตลาดขวัญ อ.เมือง จ.นนทบุรี 11000</div>\r\n                            <div style={{ fontSize: \"11pt\" }}>โทรศัพท์ (02) 5647889 หรือ 061-4219701 อีเมล tdc.cannabis.gacp@gmail.com</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right: Document Type Badge */}\r\n                    <div style={{ backgroundColor: colors.headerBg, color: colors.headerText, padding: \"8px 20px\", fontWeight: 700, fontSize: \"16pt\" }}>\r\n                        ใบเสนอราคา\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Document Info */}\r\n                <div style={{ display: \"flex\", justifyContent: \"flex-end\", marginBottom: \"16px\" }}>\r\n                    <div style={{ textAlign: \"right\", fontSize: \"12pt\" }}>\r\n                        <div>ที่ว. 16 ธันวาคม 2568</div>\r\n                        <div>เลขที่เอกสาร: <strong>{quotationNumber}</strong></div>\r\n                        <div>วันที่เอกสาร: <strong>{quotationDate}</strong></div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Applicant Info */}\r\n                <div style={{ marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <div><strong>เรียน</strong> {applicantName}</div>\r\n                    {applicantCompany && <div><strong>หน่วยงาน/ผู้รับบริการ:</strong> {applicantCompany}</div>}\r\n                    {applicantTaxId && <div><strong>เลขประจำตัวผู้เสียภาษี:</strong> {applicantTaxId}</div>}\r\n                    <div><strong>ที่อยู่:</strong> {applicantAddress}</div>\r\n                    {applicantPhone && <div><strong>ผู้ประสานงาน:</strong> {applicantPhone}</div>}\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div style={{ marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <p>\r\n                        กรมการแพทย์แผนไทยและการแพทย์ทางเลือก โดยกองกัญชาทางการแพทย์\r\n                        มีความยินดีที่จะเสนอราคาค่าบริการตรวจประเมินและรับรองมาตรฐานการเพาะปลูกและเก็บเกี่ยว\r\n                        ที่ดีของพืชกัญชา (Good Agricultural and Collection Practices) ดังรายการต่อไปนี้\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Items Table */}\r\n                <table style={{ width: \"100%\", borderCollapse: \"collapse\", marginBottom: \"16px\", fontSize: \"12pt\" }}>\r\n                    <thead>\r\n                        <tr style={{ backgroundColor: colors.tableHeaderBg, color: \"#FFF\" }}>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"8%\", textAlign: \"center\" }}>ลำดับที่</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>รายการ</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"12%\", textAlign: \"center\" }}>จำนวน</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"12%\", textAlign: \"center\" }}>หน่วย</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"15%\", textAlign: \"center\" }}>ราคา/<br />หน่วย</th>\r\n                            <th style={{ border: \"1px solid #000\", padding: \"8px\", width: \"15%\", textAlign: \"center\" }}>จำนวนเงิน<br />(บาท)</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {items.map((item, index) => (\r\n                            <tr key={index}>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>{index + 1}.</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\" }}>{item.description}</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>{item.quantity}</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>ต่อคำขอ</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\" }}>{formatAmount(item.unitPrice)},-</td>\r\n                                <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\" }}>{formatAmount(item.quantity * item.unitPrice)}</td>\r\n                            </tr>\r\n                        ))}\r\n                        <tr>\r\n                            <td colSpan={4} style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\" }}>\r\n                                ({totalAmountText})\r\n                            </td>\r\n                            <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"center\", fontWeight: 700 }}>จำนวนเงินทั้งสิ้น</td>\r\n                            <td style={{ border: \"1px solid #000\", padding: \"8px\", textAlign: \"right\", fontWeight: 700 }}>{formatAmount(totalAmount)},-</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n\r\n                {/* Verification Note */}\r\n                <div style={{ marginBottom: \"24px\", fontSize: \"11pt\" }}>\r\n                    <p>ทั้งนี้ท่านได้ตรวจสอบรายการจำนวนและราคาข้างต้นเรียบร้อยแล้ว</p>\r\n                </div>\r\n\r\n                {/* Signatures */}\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", marginTop: \"40px\", fontSize: \"12pt\" }}>\r\n                    {/* Left: Applicant Signature */}\r\n                    <div style={{ width: \"45%\", textAlign: \"center\" }}>\r\n                        <div style={{ borderTop: \"1px solid #000\", marginBottom: \"8px\", paddingTop: \"8px\" }}>\r\n                            ยืนยันคำขอรับการตรวจสอบและประเมิน\r\n                        </div>\r\n                        <div style={{ marginTop: \"40px\" }}>\r\n                            <div>.............................................</div>\r\n                            <div>(...............................................)</div>\r\n                            <div>ตำแหน่ง..............................................</div>\r\n                            <div>วันที่........../............./.............</div>\r\n                            <div style={{ fontWeight: 700, marginTop: \"8px\" }}>ผู้อนุมัติคำขอ</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right: DTAM Officer Signature */}\r\n                    <div style={{ width: \"45%\", textAlign: \"center\" }}>\r\n                        <div style={{ borderTop: \"1px solid #000\", marginBottom: \"8px\", paddingTop: \"8px\" }}>\r\n                            ในนาม กองกัญชาทางการแพทย์\r\n                        </div>\r\n                        <div style={{ marginTop: \"40px\" }}>\r\n                            <div>.............................................</div>\r\n                            <div>( {officerName} )</div>\r\n                            <div>ตำแหน่ง {officerPosition}</div>\r\n                            <div>ปฏิบัติราชการแทน อธิบดีกรมการแพทย์แผนไทยและการแพทย์ทางเลือก</div>\r\n                            <div>วันที่........../............./.............</div>\r\n                            <div style={{ fontWeight: 700, marginTop: \"8px\" }}>(ผู้เสนอราคา)</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer Notes */}\r\n                <div style={{ marginTop: \"32px\", fontSize: \"10pt\", borderTop: \"1px solid #ccc\", paddingTop: \"16px\" }}>\r\n                    <div><strong>หมายเหตุ:</strong> เนื่องจาก บริจิตอัล สมุก ว่ากิจ ยืนยอกสารเมื่อวันที่ 6 สิงหาคม 2568 จึงสมควรได้รับการอนุมัติตราสารงบประมาณเบิก กองพัฒนายาและสมุนไพร</div>\r\n                    <div>ณ วันที่ 26 มิถุนายน 2568</div>\r\n                    <div style={{ marginTop: \"8px\" }}><strong>เงื่อนไขการชำระเงิน:</strong> กรุณาชำระเงินภายใน 3 วัน</div>\r\n                    <div>ส่งเอกสารชุดคำขอผ่าน 2 ช่องทาง ทางไปรษณีย์หรืออีเมที่ระบุตามด้วยทางเอง</div>\r\n                    <div><strong>ชื่อบัญชี:</strong> เงินบำรุงศูนย์พัฒนายาไทยและสมุนไพร</div>\r\n                    <div><strong>บัญชีธนาคารกรุงไทย</strong> เลขที่ 4750134376 สาขามหาวิทยาลัยธรรมศาสตร์ รังสิต</div>\r\n                    <div><strong>เลขประจำตัวผู้เสียภาษี:</strong> 0994000036540</div>\r\n                </div>\r\n\r\n                {/* QR Code placeholder */}\r\n                <div style={{ marginTop: \"24px\", display: \"flex\", justifyContent: \"flex-end\", alignItems: \"center\", gap: \"12px\" }}>\r\n                    <div style={{ width: \"80px\", height: \"80px\", border: \"2px solid #000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", fontSize: \"10px\", textAlign: \"center\" }}>\r\n                        [QR Code]\r\n                    </div>\r\n                    <div style={{ fontSize: \"11pt\" }}>กรุณาสแกนคิวอาร์โค้ด</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Print Styles */}\r\n            <style jsx global>{`\r\n                @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');\r\n                @media print {\r\n                    body * { visibility: hidden; }\r\n                    #quotation-document, #quotation-document * { visibility: visible; }\r\n                    #quotation-document { position: absolute; left: 0; top: 0; width: 210mm; }\r\n                    button { display: none !important; }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Demo component that fetches prices from API (One Brain, Many Faces)\r\nexport function QuotationDocumentDemo() {\r\n    const { fees, loading, error } = usePricing();\r\n\r\n    // Use API fees or fallback to defaults\r\n    const items = generateQuotationItems(fees, true); // true = include inspection fee\r\n    const totalAmount = items.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ padding: \"40px\", textAlign: \"center\" }}>\r\n                <div>กำลังโหลดข้อมูลราคา...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        console.warn('Using fallback prices:', error);\r\n    }\r\n\r\n    return (\r\n        <QuotationDocument\r\n            quotationNumber=\"G-011268017\"\r\n            quotationDate=\"1 ธันวาคม 2568\"\r\n            applicantName=\"ประธานกรรมการ บริษัท สมุก ครูว จำกัด\"\r\n            applicantCompany=\"บริษัท สมุก ครูว จำกัด\"\r\n            applicantTaxId=\"0835566002415\"\r\n            applicantAddress=\"เลขที่ 209/44 หมู่ 5 ต.เกาะแก้ว ชะอำ อ.อกอลาง จ.หมู่กลูเกลต 83110\"\r\n            applicantPhone=\"คุณบุญจวบริทนร์ ปวงรี โทรศัพท์ 0851914649\"\r\n            items={items}\r\n            totalAmount={totalAmount}\r\n            totalAmountText=\"สามหมื่นบาทถ้วน\"\r\n        />\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\features\\permit-form\\components\\documents\\receipt-document.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\use-access.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\use-pricing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useAuthHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useCultivationConfig.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { api } from '@/lib/api/api-client';\r\n\r\n/**\r\n * useCultivationConfig Hook\r\n * \r\n * Fetches cultivation configuration from backend API including:\r\n * - Certification purposes (วัตถุประสงค์)\r\n * - Cultivation methods (ระบบปลูก)\r\n * - Farm layouts (รูปแบบแปลง)\r\n * - Growing styles (รูปแบบปลูก - Indoor)\r\n * - Plant count calculations\r\n * \r\n * @author กรมการแพทย์แผนไทยและการแพทย์ทางเลือก (DTAM)\r\n */\r\n\r\n// =====================\r\n// TYPE DEFINITIONS\r\n// =====================\r\n\r\nexport interface CertificationPurpose {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    description: string;\r\n    requirements: string[];\r\n    sortOrder: number;\r\n}\r\n\r\nexport interface CultivationMethod {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    description: string;\r\n    icon: string;\r\n    pros: string[];\r\n    cons: string[];\r\n    feeMultiplier: number;\r\n    sortOrder: number;\r\n}\r\n\r\nexport interface FarmLayout {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    description: string;\r\n    applicableTo: string[];\r\n    plantsPerSqm: number;\r\n    spacingRowCm?: number;\r\n    spacingPlantCm?: number;\r\n    manualPlantCount?: boolean;\r\n    icon: string;\r\n    subTypes?: string[];\r\n}\r\n\r\nexport interface GrowingStyle {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    description: string;\r\n    applicableTo: string[];\r\n    plantsPerSqm: number;\r\n    supportsMultipleTiers?: boolean;\r\n    maxTiers?: number;\r\n    icon: string;\r\n}\r\n\r\nexport interface JourneyConfig {\r\n    id: string;\r\n    purpose: string;\r\n    method: string;\r\n    level: string;\r\n    requiredFields: string[];\r\n    documents: DocumentRequirement[];\r\n    security: SecurityRequirement[];\r\n    layouts: FarmLayout[];\r\n    styles?: GrowingStyle[];\r\n}\r\n\r\nexport interface DocumentRequirement {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    category: string;\r\n    required: boolean;\r\n}\r\n\r\nexport interface SecurityRequirement {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    category: string;\r\n}\r\n\r\nexport interface PlantCalculation {\r\n    input: {\r\n        area: number;\r\n        unit: string;\r\n        layoutId: string;\r\n        styleId?: string;\r\n        tiers?: number;\r\n    };\r\n    areaSqm: number;\r\n    count: number;\r\n    formula: string;\r\n    density: number;\r\n    tiers?: number;\r\n    densitySource?: string;\r\n    manualInput?: boolean;\r\n}\r\n\r\n// =====================\r\n// FALLBACK DATA\r\n// =====================\r\n\r\nconst FALLBACK_PURPOSES: CertificationPurpose[] = [\r\n    { id: 'domestic', nameTH: 'จำหน่ายในประเทศ', nameEN: 'Domestic Sales (B2B)', description: 'จำหน่ายให้กับผู้ประกอบการในประเทศ', requirements: ['GACP'], sortOrder: 1 },\r\n    { id: 'export', nameTH: 'ส่งออก', nameEN: 'Export (International)', description: 'ส่งออกไปต่างประเทศ', requirements: ['GACP_ADVANCED'], sortOrder: 2 },\r\n    { id: 'research', nameTH: 'วิจัย', nameEN: 'Research', description: 'การวิจัยและพัฒนา', requirements: ['GACP', 'RESEARCH_PROTOCOL'], sortOrder: 3 },\r\n];\r\n\r\nconst FALLBACK_METHODS: CultivationMethod[] = [\r\n    { id: 'outdoor', nameTH: 'กลางแจ้ง', nameEN: 'Outdoor', description: 'ปลูกในแปลงกลางแจ้ง', icon: 'sun', pros: ['ต้นทุนต่ำ'], cons: ['ควบคุมยาก'], feeMultiplier: 1.0, sortOrder: 1 },\r\n    { id: 'greenhouse', nameTH: 'โรงเรือน', nameEN: 'Greenhouse', description: 'ปลูกในโรงเรือน', icon: 'home', pros: ['ควบคุมได้บางส่วน'], cons: ['ต้นทุนสูงกว่า'], feeMultiplier: 1.0, sortOrder: 2 },\r\n    { id: 'indoor', nameTH: 'ระบบปิด', nameEN: 'Indoor', description: 'ปลูกในอาคารปิด', icon: 'building', pros: ['ควบคุมทุกปัจจัย'], cons: ['ต้นทุนสูง'], feeMultiplier: 1.0, sortOrder: 3 },\r\n];\r\n\r\n// =====================\r\n// MAIN HOOK\r\n// =====================\r\n\r\nexport function useCultivationConfig() {\r\n    const [purposes, setPurposes] = useState<CertificationPurpose[]>([]);\r\n    const [methods, setMethods] = useState<CultivationMethod[]>([]);\r\n    const [allLayouts, setAllLayouts] = useState<FarmLayout[]>([]);\r\n    const [growingStyles, setGrowingStyles] = useState<GrowingStyle[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Fetch all master data on mount\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                setLoading(true);\r\n                setError(null);\r\n\r\n                // Fetch all endpoints in parallel\r\n                const [purposesRes, methodsRes, layoutsRes, stylesRes] = await Promise.all([\r\n                    api.get<{ data: CertificationPurpose[] }>('/master-data/certification-purposes'),\r\n                    api.get<{ data: CultivationMethod[] }>('/master-data/cultivation-methods'),\r\n                    api.get<{ data: FarmLayout[] }>('/master-data/farm-layouts'),\r\n                    api.get<{ data: GrowingStyle[] }>('/master-data/growing-styles'),\r\n                ]);\r\n\r\n                if (purposesRes.success && purposesRes.data) {\r\n                    setPurposes(purposesRes.data.data || FALLBACK_PURPOSES);\r\n                }\r\n                if (methodsRes.success && methodsRes.data) {\r\n                    setMethods(methodsRes.data.data || FALLBACK_METHODS);\r\n                }\r\n                if (layoutsRes.success && layoutsRes.data) {\r\n                    setAllLayouts(layoutsRes.data.data || []);\r\n                }\r\n                if (stylesRes.success && stylesRes.data) {\r\n                    setGrowingStyles(stylesRes.data.data || []);\r\n                }\r\n            } catch (err) {\r\n                console.error('[useCultivationConfig] Error fetching data:', err);\r\n                setError('ไม่สามารถโหลดข้อมูลการปลูกได้');\r\n                // Use fallback data\r\n                setPurposes(FALLBACK_PURPOSES);\r\n                setMethods(FALLBACK_METHODS);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, []);\r\n\r\n    // Get layouts filtered by cultivation method\r\n    const getLayoutsForMethod = useCallback((methodId: string): FarmLayout[] => {\r\n        return allLayouts.filter(l => l.applicableTo.includes(methodId));\r\n    }, [allLayouts]);\r\n\r\n    // Get growing styles (for indoor only)\r\n    const getGrowingStyles = useCallback((): GrowingStyle[] => {\r\n        return growingStyles;\r\n    }, [growingStyles]);\r\n\r\n    // Fetch journey config for specific purpose and method\r\n    const getJourneyConfig = useCallback(async (purpose: string, method: string): Promise<JourneyConfig | null> => {\r\n        try {\r\n            const response = await api.get<{ data: JourneyConfig }>(`/applications/config/${purpose}/${method}`);\r\n            if (response.success && response.data) {\r\n                return response.data.data;\r\n            }\r\n            return null;\r\n        } catch (err) {\r\n            console.error('[useCultivationConfig] Error fetching journey config:', err);\r\n            return null;\r\n        }\r\n    }, []);\r\n\r\n    // Calculate plant count using API\r\n    const calculatePlantCount = useCallback(async (\r\n        area: number,\r\n        unit: 'Rai' | 'Ngan' | 'Sqm',\r\n        layoutId: string,\r\n        styleId?: string,\r\n        tiers?: number\r\n    ): Promise<PlantCalculation | null> => {\r\n        try {\r\n            const response = await api.post<{ data: PlantCalculation }>('/calculations/plant-count', {\r\n                area,\r\n                unit,\r\n                layoutId,\r\n                styleId,\r\n                tiers,\r\n            });\r\n            if (response.success && response.data) {\r\n                return response.data.data;\r\n            }\r\n            return null;\r\n        } catch (err) {\r\n            console.error('[useCultivationConfig] Error calculating plants:', err);\r\n            return null;\r\n        }\r\n    }, []);\r\n\r\n    // Quick local calculation (fallback)\r\n    const estimatePlantCount = useCallback((\r\n        areaSqm: number,\r\n        layoutId: string,\r\n        styleId?: string,\r\n        tiers: number = 1\r\n    ): { count: number; formula: string } => {\r\n        const layout = allLayouts.find(l => l.id === layoutId);\r\n        if (!layout) {\r\n            return { count: 0, formula: 'ไม่พบข้อมูล layout' };\r\n        }\r\n\r\n        if (layout.manualPlantCount) {\r\n            return { count: 0, formula: 'กรุณากรอกจำนวนต้นด้วยตนเอง' };\r\n        }\r\n\r\n        let density = layout.plantsPerSqm;\r\n\r\n        // If style provided, use style's density\r\n        if (styleId) {\r\n            const style = growingStyles.find(s => s.id === styleId);\r\n            if (style) {\r\n                density = style.plantsPerSqm;\r\n                if (style.supportsMultipleTiers && tiers > 1) {\r\n                    tiers = Math.min(tiers, style.maxTiers || 5);\r\n                }\r\n            }\r\n        }\r\n\r\n        const count = Math.floor(areaSqm * density * tiers);\r\n        const formula = tiers > 1\r\n            ? `${areaSqm} ㎡ × ${density} ต้น/㎡ × ${tiers} ชั้น = ${count} ต้น`\r\n            : `${areaSqm} ㎡ × ${density} ต้น/㎡ = ${count} ต้น`;\r\n\r\n        return { count, formula };\r\n    }, [allLayouts, growingStyles]);\r\n\r\n    // Convert area units to sqm\r\n    const convertToSqm = useCallback((value: number, unit: 'Rai' | 'Ngan' | 'Sqm'): number => {\r\n        switch (unit) {\r\n            case 'Rai': return value * 1600;\r\n            case 'Ngan': return value * 400;\r\n            default: return value;\r\n        }\r\n    }, []);\r\n\r\n    return {\r\n        // State\r\n        loading,\r\n        error,\r\n\r\n        // Master data\r\n        purposes,\r\n        methods,\r\n        allLayouts,\r\n        growingStyles,\r\n\r\n        // Methods\r\n        getLayoutsForMethod,\r\n        getGrowingStyles,\r\n        getJourneyConfig,\r\n        calculatePlantCount,\r\n        estimatePlantCount,\r\n        convertToSqm,\r\n\r\n        // Check if method is indoor (for showing growing styles)\r\n        isIndoorMethod: (methodId: string) => methodId === 'indoor',\r\n    };\r\n}\r\n\r\nexport default useCultivationConfig;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useGACPData.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":199,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":199,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { api } from '@/lib/api/api-client';\r\n\r\n/**\r\n * GACP Data Types from API\r\n */\r\nexport interface GACPCategory {\r\n    id: number;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    steps: number[];\r\n}\r\n\r\nexport interface EnvironmentCheck {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    required: boolean;\r\n    gacpCategory: number;\r\n}\r\n\r\nexport interface WaterSource {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n}\r\n\r\nexport interface SecurityRequirement {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    category: string;\r\n}\r\n\r\nexport interface DocumentDef {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    category: string;\r\n    required: boolean;\r\n}\r\n\r\nexport interface StepRequirements {\r\n    step: number;\r\n    gacpCategories: GACPCategory[];\r\n    fields: string[];\r\n    requiredDocuments: DocumentDef[];\r\n    optionalDocuments: DocumentDef[];\r\n}\r\n\r\n// Step 5: Plot GACP Data Types\r\nexport interface SoilType {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n}\r\n\r\nexport interface SeedSource {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n}\r\n\r\nexport interface IPMMethod {\r\n    id: string;\r\n    nameTH: string;\r\n    nameEN: string;\r\n    description?: string;\r\n}\r\n\r\n/**\r\n * Hook to fetch GACP-specific data from API\r\n * Implements API-First principle for GACP standards\r\n */\r\nexport function useGACPData(stepNumber?: number) {\r\n    // Step 4 data\r\n    const [gacpCategories, setGacpCategories] = useState<GACPCategory[]>([]);\r\n    const [environmentChecklist, setEnvironmentChecklist] = useState<EnvironmentCheck[]>([]);\r\n    const [waterSources, setWaterSources] = useState<WaterSource[]>([]);\r\n    const [securityRequirements, setSecurityRequirements] = useState<SecurityRequirement[]>([]);\r\n    const [stepRequirements, setStepRequirements] = useState<StepRequirements | null>(null);\r\n\r\n    // Step 5 data\r\n    const [soilTypes, setSoilTypes] = useState<SoilType[]>([]);\r\n    const [seedSources, setSeedSources] = useState<SeedSource[]>([]);\r\n    const [ipmMethods, setIpmMethods] = useState<IPMMethod[]>([]);\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const fetchGACPCategories = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: GACPCategory[] }>('/master-data/gacp-categories');\r\n            if (response.success && response.data) {\r\n                setGacpCategories(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching categories:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchEnvironmentChecklist = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: EnvironmentCheck[] }>('/master-data/environment-checklist');\r\n            if (response.success && response.data) {\r\n                setEnvironmentChecklist(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching environment checklist:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchWaterSources = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: WaterSource[] }>('/master-data/water-sources');\r\n            if (response.success && response.data) {\r\n                setWaterSources(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching water sources:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchSecurityRequirements = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: SecurityRequirement[] }>('/master-data/security-requirements');\r\n            if (response.success && response.data) {\r\n                setSecurityRequirements(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching security requirements:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchStepRequirements = useCallback(async (step: number) => {\r\n        try {\r\n            const response = await api.get<{ data: StepRequirements }>(`/master-data/step-requirements/${step}`);\r\n            if (response.success && response.data) {\r\n                setStepRequirements(response.data.data || null);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching step requirements:', err);\r\n        }\r\n    }, []);\r\n\r\n    // Step 5 fetch functions\r\n    const fetchSoilTypes = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: SoilType[] }>('/master-data/soil-types');\r\n            if (response.success && response.data) {\r\n                setSoilTypes(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching soil types:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchSeedSources = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: SeedSource[] }>('/master-data/seed-sources');\r\n            if (response.success && response.data) {\r\n                setSeedSources(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching seed sources:', err);\r\n        }\r\n    }, []);\r\n\r\n    const fetchIPMMethods = useCallback(async () => {\r\n        try {\r\n            const response = await api.get<{ data: IPMMethod[] }>('/master-data/ipm-methods');\r\n            if (response.success && response.data) {\r\n                setIpmMethods(response.data.data || []);\r\n            }\r\n        } catch (err) {\r\n            console.error('[useGACPData] Error fetching IPM methods:', err);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const fetchAll = async () => {\r\n            setLoading(true);\r\n            try {\r\n                await Promise.all([\r\n                    fetchGACPCategories(),\r\n                    fetchEnvironmentChecklist(),\r\n                    fetchWaterSources(),\r\n                    fetchSecurityRequirements(),\r\n                    fetchSoilTypes(),\r\n                    fetchSeedSources(),\r\n                    fetchIPMMethods(),\r\n                ]);\r\n\r\n                if (stepNumber) {\r\n                    await fetchStepRequirements(stepNumber);\r\n                }\r\n            } catch (err) {\r\n                setError('ไม่สามารถโหลดข้อมูล GACP ได้');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchAll();\r\n    }, [fetchGACPCategories, fetchEnvironmentChecklist, fetchWaterSources, fetchSecurityRequirements, fetchSoilTypes, fetchSeedSources, fetchIPMMethods, fetchStepRequirements, stepNumber]);\r\n\r\n    // Fallback data for offline/error scenarios\r\n    const fallbackEnvironmentChecklist: EnvironmentCheck[] = [\r\n        { id: 'no_waste_dump', nameTH: 'พื้นที่ไม่เคยเป็นที่ทิ้งขยะ/สารเคมี', nameEN: 'Not former waste dump', required: true, gacpCategory: 2 },\r\n        { id: 'no_contamination', nameTH: 'ไม่อยู่ใกล้แหล่งปนเปื้อน', nameEN: 'Not near contamination', required: true, gacpCategory: 2 },\r\n        { id: 'no_chemicals_3y', nameTH: 'ไม่เคยใช้สารเคมีเข้มข้นในช่วง 3 ปี', nameEN: 'No chemicals last 3 years', required: false, gacpCategory: 2 },\r\n        { id: 'suitable_environment', nameTH: 'สภาพแวดล้อมเหมาะสม', nameEN: 'Suitable environment', required: true, gacpCategory: 2 },\r\n    ];\r\n\r\n    const fallbackWaterSources: WaterSource[] = [\r\n        { id: 'WELL', nameTH: 'บ่อบาดาล', nameEN: 'Well' },\r\n        { id: 'RAIN', nameTH: 'น้ำฝน', nameEN: 'Rainwater' },\r\n        { id: 'RIVER', nameTH: 'แม่น้ำ/ลำคลอง', nameEN: 'River' },\r\n        { id: 'TAP', nameTH: 'น้ำประปา', nameEN: 'Tap Water' },\r\n        { id: 'POND', nameTH: 'สระ/อ่างเก็บน้ำ', nameEN: 'Pond' },\r\n    ];\r\n\r\n    const fallbackSecurityRequirements: SecurityRequirement[] = [\r\n        { id: 'fence_2m', nameTH: 'รั้วรอบขอบชิด สูง 2 เมตร', nameEN: 'Fence 2m', category: 'perimeter' },\r\n        { id: 'cctv_entry', nameTH: 'กล้อง CCTV ทางเข้า-ออก', nameEN: 'CCTV Entry', category: 'surveillance' },\r\n        { id: 'cctv_plot', nameTH: 'กล้อง CCTV แปลงปลูก', nameEN: 'CCTV Plot', category: 'surveillance' },\r\n        { id: 'access_control', nameTH: 'ระบบควบคุมการเข้าออก', nameEN: 'Access Control', category: 'access' },\r\n        { id: 'access_log', nameTH: 'บันทึกการเข้าออก', nameEN: 'Access Log', category: 'access' },\r\n        { id: 'warning_signs', nameTH: 'ป้ายเตือน', nameEN: 'Warning Signs', category: 'signage' },\r\n    ];\r\n\r\n    const fallbackSoilTypes: SoilType[] = [\r\n        { id: 'clay', nameTH: 'ดินเหนียว', nameEN: 'Clay' },\r\n        { id: 'loam', nameTH: 'ดินร่วน', nameEN: 'Loam' },\r\n        { id: 'sandy', nameTH: 'ดินทราย', nameEN: 'Sandy' },\r\n    ];\r\n\r\n    const fallbackSeedSources: SeedSource[] = [\r\n        { id: 'own', nameTH: 'เพาะเอง', nameEN: 'Self-propagated' },\r\n        { id: 'certified', nameTH: 'ซื้อจากร้านพันธุ์พืชรับรอง', nameEN: 'Certified Seed Shop' },\r\n        { id: 'government', nameTH: 'จากหน่วยงานราชการ', nameEN: 'Government Agency' },\r\n    ];\r\n\r\n    const fallbackIPMMethods: IPMMethod[] = [\r\n        { id: 'biological', nameTH: 'การควบคุมทางชีวภาพ', nameEN: 'Biological Control' },\r\n        { id: 'cultural', nameTH: 'การจัดการทางเขตกรรม', nameEN: 'Cultural Control' },\r\n        { id: 'mechanical', nameTH: 'การควบคุมโดยกล', nameEN: 'Mechanical Control' },\r\n    ];\r\n\r\n    return {\r\n        // Step 4 Data with fallbacks\r\n        gacpCategories: gacpCategories.length > 0 ? gacpCategories : [],\r\n        environmentChecklist: environmentChecklist.length > 0 ? environmentChecklist : fallbackEnvironmentChecklist,\r\n        waterSources: waterSources.length > 0 ? waterSources : fallbackWaterSources,\r\n        securityRequirements: securityRequirements.length > 0 ? securityRequirements : fallbackSecurityRequirements,\r\n        stepRequirements,\r\n\r\n        // Step 5 Data with fallbacks\r\n        soilTypes: soilTypes.length > 0 ? soilTypes : fallbackSoilTypes,\r\n        seedSources: seedSources.length > 0 ? seedSources : fallbackSeedSources,\r\n        ipmMethods: ipmMethods.length > 0 ? ipmMethods : fallbackIPMMethods,\r\n\r\n        // State\r\n        loading,\r\n        error,\r\n\r\n        // Refetch functions\r\n        refetchStepRequirements: fetchStepRequirements,\r\n    };\r\n}\r\n\r\nexport default useGACPData;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useLogin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useMasterData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useRegistration.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4951,4954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4951,4954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8456,8459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8456,8459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8693,8696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8693,8696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { apiClient as api } from '@/lib/api';\r\n\r\n// Account types\r\nexport const ACCOUNT_TYPES = [\r\n    { type: \"INDIVIDUAL\", label: \"บุคคลธรรมดา\", subtitle: \"เกษตรกรรายย่อย\", idLabel: \"เลขบัตรประชาชน 13 หลัก\", idHint: \"X-XXXX-XXXXX-XX-X\" },\r\n    { type: \"JURISTIC\", label: \"นิติบุคคล\", subtitle: \"บริษัท / ห้างหุ้นส่วน\", idLabel: \"เลขทะเบียนนิติบุคคล\", idHint: \"0-1055-12345-67-8\" },\r\n    { type: \"COMMUNITY_ENTERPRISE\", label: \"วิสาหกิจชุมชน\", subtitle: \"กลุ่มเกษตรกร\", idLabel: \"เลขทะเบียนวิสาหกิจชุมชน\", idHint: \"XXXX-XXXX-XXX\" },\r\n];\r\n\r\nexport const STEPS = [\"ยินยอม PDPA\", \"ประเภทบัญชี\", \"ยืนยันตัวตน\", \"ข้อมูลส่วนตัว\", \"ตั้งรหัสผ่าน\"];\r\n\r\nexport interface RegistrationData {\r\n    accountType: string;\r\n    agreedPDPA: boolean;\r\n    identifier: string;\r\n    firstName: string;\r\n    lastName: string;\r\n    phoneNumber: string;\r\n    companyName: string;\r\n    communityName: string;\r\n    password: string;\r\n    confirmPassword: string;\r\n    // Optional fields\r\n    email?: string;\r\n    address?: string;\r\n    province?: string;\r\n}\r\n\r\nexport interface UseRegistrationReturn {\r\n    step: number;\r\n    data: RegistrationData;\r\n    errors: Record<string, string>;\r\n    isLoading: boolean;\r\n    isCheckingId: boolean;\r\n\r\n    setStep: (step: number) => void;\r\n    updateField: (field: keyof RegistrationData, value: string | boolean) => void;\r\n    validateField: (field: string, value: string) => Promise<string>;\r\n    canProceed: () => boolean;\r\n    handleSubmit: () => Promise<boolean>;\r\n    getPasswordStrength: (pwd: string) => { level: number; label: string; color: string };\r\n    validateThaiId: (id: string) => boolean;\r\n}\r\n\r\n/**\r\n * useRegistration Hook\r\n * 🍎 Apple Single Responsibility: All registration logic\r\n */\r\nexport function useRegistration(): UseRegistrationReturn {\r\n    const [step, setStep] = useState(0);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isCheckingId, setIsCheckingId] = useState(false);\r\n    const [errors, setErrors] = useState<Record<string, string>>({});\r\n    const [data, setData] = useState<RegistrationData>({\r\n        accountType: 'INDIVIDUAL',\r\n        agreedPDPA: false,\r\n        identifier: '',\r\n        firstName: '',\r\n        lastName: '',\r\n        phoneNumber: '',\r\n        companyName: '',\r\n        communityName: '',\r\n        password: '',\r\n        confirmPassword: '',\r\n    });\r\n\r\n    const updateField = useCallback((field: keyof RegistrationData, value: string | boolean) => {\r\n        setData(prev => ({ ...prev, [field]: value }));\r\n        // Clear error when field is updated\r\n        if (errors[field]) {\r\n            setErrors(prev => ({ ...prev, [field]: '' }));\r\n        }\r\n    }, [errors]);\r\n\r\n    /**\r\n     * Thai ID Checksum Validation (Modulo 11)\r\n     */\r\n    const validateThaiId = useCallback((id: string): boolean => {\r\n        const cleanId = id.replace(/-/g, '');\r\n        if (cleanId.length !== 13 || !/^\\d+$/.test(cleanId)) return false;\r\n\r\n        let sum = 0;\r\n        for (let i = 0; i < 12; i++) {\r\n            sum += parseInt(cleanId[i]) * (13 - i);\r\n        }\r\n        const checkDigit = (11 - (sum % 11)) % 10;\r\n        return parseInt(cleanId[12]) === checkDigit;\r\n    }, []);\r\n\r\n    /**\r\n     * Password Strength Calculator\r\n     */\r\n    const getPasswordStrength = useCallback((pwd: string) => {\r\n        let score = 0;\r\n        if (pwd.length >= 8) score++;\r\n        if (pwd.length >= 12) score++;\r\n        if (/[a-z]/.test(pwd) && /[A-Z]/.test(pwd)) score++;\r\n        if (/\\d/.test(pwd)) score++;\r\n        if (/[^a-zA-Z0-9]/.test(pwd)) score++;\r\n\r\n        const levels = [\r\n            { level: 0, label: \"อ่อนมาก\", color: \"#EF4444\" },\r\n            { level: 1, label: \"อ่อน\", color: \"#F97316\" },\r\n            { level: 2, label: \"ปานกลาง\", color: \"#EAB308\" },\r\n            { level: 3, label: \"แข็งแรง\", color: \"#22C55E\" },\r\n            { level: 4, label: \"แข็งแรงมาก\", color: \"#16A34A\" },\r\n        ];\r\n\r\n        return levels[Math.min(score, 4)];\r\n    }, []);\r\n\r\n    /**\r\n     * Field Validation with API check\r\n     */\r\n    const validateField = useCallback(async (field: string, value: string): Promise<string> => {\r\n        switch (field) {\r\n            case 'identifier':\r\n                const cleanId = value.replace(/-/g, '');\r\n                if (data.accountType !== 'COMMUNITY_ENTERPRISE') {\r\n                    if (cleanId.length !== 13) return 'ต้องมี 13 หลัก';\r\n                    if (data.accountType === 'INDIVIDUAL' && !validateThaiId(value)) {\r\n                        return 'เลขบัตรประชาชนไม่ถูกต้อง';\r\n                    }\r\n                }\r\n                // Check availability via API\r\n                setIsCheckingId(true);\r\n                try {\r\n                    const result = await api.post('/auth/check-identifier', {\r\n                        identifier: cleanId,\r\n                        accountType: data.accountType\r\n                    }) as any;\r\n                    if (result.success && !result.data?.available) {\r\n                        return result.data?.error || 'ข้อมูลนี้ถูกลงทะเบียนแล้ว';\r\n                    }\r\n                } catch {\r\n                    // Ignore API errors, continue with form\r\n                } finally {\r\n                    setIsCheckingId(false);\r\n                }\r\n                return '';\r\n\r\n            case 'phoneNumber':\r\n                if (!/^0\\d{9}$/.test(value.replace(/-/g, ''))) {\r\n                    return 'เบอร์โทรไม่ถูกต้อง (10 หลัก เริ่มด้วย 0)';\r\n                }\r\n                return '';\r\n\r\n            case 'password':\r\n                if (value.length < 8) return 'รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร';\r\n                if (!/[A-Z]/.test(value)) return 'ต้องมีตัวพิมพ์ใหญ่อย่างน้อย 1 ตัว';\r\n                if (!/[a-z]/.test(value)) return 'ต้องมีตัวพิมพ์เล็กอย่างน้อย 1 ตัว';\r\n                if (!/\\d/.test(value)) return 'ต้องมีตัวเลขอย่างน้อย 1 ตัว';\r\n                return '';\r\n\r\n            case 'confirmPassword':\r\n                if (value !== data.password) return 'รหัสผ่านไม่ตรงกัน';\r\n                return '';\r\n\r\n            default:\r\n                return '';\r\n        }\r\n    }, [data.accountType, data.password, validateThaiId]);\r\n\r\n    /**\r\n     * Check if current step can proceed\r\n     */\r\n    const canProceed = useCallback((): boolean => {\r\n        switch (step) {\r\n            case 0: return data.agreedPDPA;\r\n            case 1: return !!data.accountType;\r\n            case 2: return data.identifier.replace(/-/g, '').length >= 10 && !errors.identifier;\r\n            case 3:\r\n                if (data.accountType === 'INDIVIDUAL') {\r\n                    return !!data.firstName && !!data.lastName && !!data.phoneNumber;\r\n                } else if (data.accountType === 'JURISTIC') {\r\n                    return !!data.companyName && !!data.phoneNumber;\r\n                } else {\r\n                    return !!data.communityName && !!data.phoneNumber;\r\n                }\r\n            case 4:\r\n                return data.password.length >= 8 &&\r\n                    data.password === data.confirmPassword &&\r\n                    !errors.password;\r\n            default: return false;\r\n        }\r\n    }, [step, data, errors]);\r\n\r\n    /**\r\n     * Submit Registration\r\n     */\r\n    const handleSubmit = useCallback(async (): Promise<boolean> => {\r\n        setIsLoading(true);\r\n\r\n        // Sanitize inputs\r\n        const sanitize = (str: string) => str.replace(/[<>'\"&]/g, '');\r\n\r\n        const payload = {\r\n            accountType: data.accountType,\r\n            identifier: data.identifier.replace(/-/g, ''),\r\n            password: data.password,\r\n            phoneNumber: data.phoneNumber.replace(/-/g, ''),\r\n            ...(data.accountType === 'INDIVIDUAL' && {\r\n                firstName: sanitize(data.firstName),\r\n                lastName: sanitize(data.lastName),\r\n                idCard: data.identifier.replace(/-/g, ''),\r\n            }),\r\n            ...(data.accountType === 'JURISTIC' && {\r\n                companyName: sanitize(data.companyName),\r\n                taxId: data.identifier.replace(/-/g, ''),\r\n            }),\r\n            ...(data.accountType === 'COMMUNITY_ENTERPRISE' && {\r\n                communityName: sanitize(data.communityName),\r\n                communityRegistrationNo: data.identifier.replace(/-/g, ''),\r\n            }),\r\n        };\r\n\r\n        try {\r\n            const result = await api.post('/auth/register', payload) as any;\r\n            if (result.success) {\r\n                return true;\r\n            } else {\r\n                setErrors({ submit: result.error || 'เกิดข้อผิดพลาด' });\r\n                return false;\r\n            }\r\n        } catch (error: any) {\r\n            setErrors({ submit: error.message || 'ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์ได้' });\r\n            return false;\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [data]);\r\n\r\n    return {\r\n        step, data, errors, isLoading, isCheckingId,\r\n        setStep, updateField, validateField, canProceed,\r\n        handleSubmit, getPasswordStrength, validateThaiId,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\hooks\\useStaffDashboard.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3992,3995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3992,3995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":126,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":129,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4339,4342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4339,4342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4486,4489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4486,4489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5845,5848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5845,5848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { apiClient as api } from '@/lib/api';\r\n\r\n// Role labels\r\nexport const ROLE_LABELS: Record<string, { label: string; icon: string }> = {\r\n    REVIEWER_AUDITOR: { label: \"ผู้ตรวจเอกสาร/ตรวจประเมิน\", icon: \"📋\" },\r\n    SCHEDULER: { label: \"ผู้จัดตารางนัดหมาย\", icon: \"📆\" },\r\n    ACCOUNTANT: { label: \"เจ้าหน้าที่การเงิน\", icon: \"💰\" },\r\n    ADMIN: { label: \"ผู้ดูแลระบบ\", icon: \"⚙️\" },\r\n    SUPER_ADMIN: { label: \"ผู้ดูแลระบบสูงสุด\", icon: \"👑\" },\r\n    reviewer: { label: \"ผู้ตรวจสอบ\", icon: \"📋\" },\r\n    manager: { label: \"ผู้จัดการ\", icon: \"👔\" },\r\n    inspector: { label: \"ผู้ตรวจประเมิน\", icon: \"🔍\" },\r\n};\r\n\r\nexport interface StaffUser {\r\n    id: string;\r\n    email: string;\r\n    firstName?: string;\r\n    lastName?: string;\r\n    role: string;\r\n}\r\n\r\nexport interface PendingItem {\r\n    id: string;\r\n    applicantName: string;\r\n    plantType: string;\r\n    status: string;\r\n    submittedAt: string;\r\n    submissionCount?: number;\r\n    waitTime: string;\r\n}\r\n\r\nexport interface DashboardStats {\r\n    pendingReview: number;\r\n    pendingAudit: number;\r\n    pendingPayment: number;\r\n    completed: number;\r\n}\r\n\r\nexport interface UseStaffDashboardReturn {\r\n    user: StaffUser | null;\r\n    pendingItems: PendingItem[];\r\n    stats: DashboardStats;\r\n    isLoading: boolean;\r\n    error: string | null;\r\n\r\n    fetchData: () => Promise<void>;\r\n    handleLogout: () => Promise<void>;\r\n    getWaitTime: (submittedAt: string) => string;\r\n    getStatusBadge: (status: string) => { bg: string; text: string; label: string };\r\n}\r\n\r\n/**\r\n * useStaffDashboard Hook\r\n * 🍎 Apple Single Responsibility: Staff dashboard data management\r\n */\r\nexport function useStaffDashboard(): UseStaffDashboardReturn {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<StaffUser | null>(null);\r\n    const [pendingItems, setPendingItems] = useState<PendingItem[]>([]);\r\n    const [stats, setStats] = useState<DashboardStats>({\r\n        pendingReview: 0,\r\n        pendingAudit: 0,\r\n        pendingPayment: 0,\r\n        completed: 0,\r\n    });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    /**\r\n     * Calculate wait time from submission\r\n     */\r\n    const getWaitTime = useCallback((submittedAt: string): string => {\r\n        const submitted = new Date(submittedAt);\r\n        const now = new Date();\r\n        const days = Math.floor((now.getTime() - submitted.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n        if (days === 0) return \"วันนี้\";\r\n        if (days === 1) return \"1 วัน\";\r\n        if (days < 7) return `${days} วัน`;\r\n        if (days < 30) return `${Math.floor(days / 7)} สัปดาห์`;\r\n        return `${Math.floor(days / 30)} เดือน`;\r\n    }, []);\r\n\r\n    /**\r\n     * Get status badge styling\r\n     */\r\n    const getStatusBadge = useCallback((status: string) => {\r\n        const badges: Record<string, { bg: string; text: string; label: string }> = {\r\n            SUBMITTED: { bg: \"#FEF3C7\", text: \"#92400E\", label: \"รอตรวจสอบ\" },\r\n            UNDER_REVIEW: { bg: \"#DBEAFE\", text: \"#1E40AF\", label: \"กำลังตรวจ\" },\r\n            PENDING_PAYMENT: { bg: \"#FCE7F3\", text: \"#9D174D\", label: \"รอชำระเงิน\" },\r\n            PAID: { bg: \"#D1FAE5\", text: \"#065F46\", label: \"ชำระแล้ว\" },\r\n            PENDING_AUDIT: { bg: \"#FED7AA\", text: \"#9A3412\", label: \"รอตรวจประเมิน\" },\r\n            APPROVED: { bg: \"#D1FAE5\", text: \"#065F46\", label: \"อนุมัติ\" },\r\n            REJECTED: { bg: \"#FEE2E2\", text: \"#991B1B\", label: \"ไม่อนุมัติ\" },\r\n        };\r\n        return badges[status] || { bg: \"#F3F4F6\", text: \"#374151\", label: status };\r\n    }, []);\r\n\r\n    /**\r\n     * Fetch dashboard data\r\n     */\r\n    const fetchData = useCallback(async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            // Fetch staff profile\r\n            const userResult = await api.get('/dtam/me') as any;\r\n            if (!userResult.success) {\r\n                router.push('/staff/login');\r\n                return;\r\n            }\r\n            setUser(userResult.data?.user);\r\n\r\n            // Fetch pending applications\r\n            const appsResult = await api.get('/applications?status=SUBMITTED,UNDER_REVIEW,PENDING_PAYMENT,PENDING_AUDIT') as any;\r\n            if (appsResult.success && appsResult.data?.applications) {\r\n                const items = appsResult.data.applications.map((app: any) => ({\r\n                    id: app.applicationNumber || app.id,\r\n                    applicantName: app.farmer?.firstName\r\n                        ? `${app.farmer.firstName} ${app.farmer.lastName || ''}`\r\n                        : app.farmer?.companyName || 'ไม่ระบุ',\r\n                    plantType: app.formData?.plantType || 'กัญชง',\r\n                    status: app.status,\r\n                    submittedAt: app.createdAt,\r\n                    submissionCount: app.rejectCount ? app.rejectCount + 1 : 1,\r\n                    waitTime: getWaitTime(app.createdAt),\r\n                }));\r\n                setPendingItems(items);\r\n\r\n                // Calculate stats\r\n                const newStats = {\r\n                    pendingReview: items.filter((i: PendingItem) =>\r\n                        i.status === 'SUBMITTED' || i.status === 'UNDER_REVIEW'\r\n                    ).length,\r\n                    pendingAudit: items.filter((i: PendingItem) =>\r\n                        i.status === 'PENDING_AUDIT'\r\n                    ).length,\r\n                    pendingPayment: items.filter((i: PendingItem) =>\r\n                        i.status === 'PENDING_PAYMENT'\r\n                    ).length,\r\n                    completed: 0, // Would need separate query\r\n                };\r\n                setStats(newStats);\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to fetch data');\r\n            if (err.status === 401) {\r\n                router.push('/staff/login');\r\n            }\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [router, getWaitTime]);\r\n\r\n    /**\r\n     * Handle logout\r\n     */\r\n    const handleLogout = useCallback(async () => {\r\n        try {\r\n            await api.post('/dtam/logout', {});\r\n        } catch {\r\n            // Ignore logout errors\r\n        }\r\n        document.cookie = 'dtam_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';\r\n        router.push('/staff/login');\r\n    }, [router]);\r\n\r\n    // Initial data fetch\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [fetchData]);\r\n\r\n    return {\r\n        user, pendingItems, stats, isLoading, error,\r\n        fetchData, handleLogout, getWaitTime, getStatusBadge,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\api\\api-client.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeout' is assigned a value but never used.","line":190,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used.","line":190,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Client - Centralized HTTP Client with Auth Interceptor\r\n * \r\n * This client fixes \"Broken Chain\" by automatically attaching\r\n * Authorization headers to all requests.\r\n * \r\n * Usage:\r\n *   import { apiClient } from '@/lib/api/api-client';\r\n *   \r\n *   // GET request:\r\n *   const data = await apiClient.get('/api/users/me');\r\n *   \r\n *   // POST request:\r\n *   const result = await apiClient.post('/api/applications', { name: 'test' });\r\n */\r\n\r\nimport { AuthService } from '../services/auth-service';\r\n\r\n// Response types\r\nexport interface ApiResponse<T = unknown> {\r\n    success: boolean;\r\n    data?: T;\r\n    error?: string;\r\n    message?: string;\r\n}\r\n\r\n// Request options\r\ninterface RequestOptions extends Omit<RequestInit, 'body'> {\r\n    body?: unknown;\r\n    skipAuth?: boolean;\r\n    timeout?: number;\r\n}\r\n\r\nclass ApiClient {\r\n    private baseUrl: string;\r\n    private defaultTimeout: number;\r\n\r\n    constructor(baseUrl = '', timeout = 30000) {\r\n        this.baseUrl = baseUrl;\r\n        this.defaultTimeout = timeout;\r\n    }\r\n\r\n    /**\r\n     * Make HTTP request with automatic auth header injection\r\n     */\r\n    private async request<T>(\r\n        endpoint: string,\r\n        options: RequestOptions = {}\r\n    ): Promise<ApiResponse<T>> {\r\n        const { skipAuth = false, timeout = this.defaultTimeout, body, ...init } = options;\r\n\r\n        // Build headers\r\n        const headers: Record<string, string> = {\r\n            'Content-Type': 'application/json',\r\n            ...(init.headers as Record<string, string>),\r\n        };\r\n\r\n        // Fallback: Only attach Authorization header if no httpOnly cookie available\r\n        // Primary auth is via httpOnly cookie (credentials: 'include')\r\n        // This fallback is for mobile apps that don't use cookies\r\n        if (!skipAuth) {\r\n            const token = AuthService.getToken();\r\n            if (token) {\r\n                headers['Authorization'] = `Bearer ${token}`;\r\n            }\r\n        }\r\n\r\n        // Smart Path Handling: Auto-prefix with /api if needed\r\n        let fullEndpoint = endpoint;\r\n        if (!endpoint.startsWith('http')) {\r\n            if (!endpoint.startsWith('/api')) {\r\n                // Prefix with /api for all paths\r\n                fullEndpoint = `/api${endpoint.startsWith('/') ? endpoint : `/${endpoint}`}`;\r\n            }\r\n        }\r\n\r\n        // Build full URL\r\n        const url = fullEndpoint.startsWith('http') ? fullEndpoint : `${this.baseUrl}${fullEndpoint}`;\r\n\r\n        // Setup abort controller for timeout\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n        // Handle FormData (remove Content-Type to let browser set boundary)\r\n        if (body instanceof FormData) {\r\n            delete headers['Content-Type'];\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(url, {\r\n                ...init,\r\n                headers,\r\n                body: body ? (body instanceof FormData ? body : JSON.stringify(body)) : undefined,\r\n                signal: controller.signal,\r\n                credentials: 'include', // 🔐 Send httpOnly cookies automatically\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n\r\n            // Handle 401 Unauthorized - auto logout\r\n            if (response.status === 401) {\r\n                console.warn('[ApiClient] 401 Received - Session expired');\r\n                AuthService.clearSession();\r\n\r\n                // Redirect to login if in browser\r\n                if (typeof window !== 'undefined') {\r\n                    window.location.href = '/login?expired=true';\r\n                }\r\n\r\n                return {\r\n                    success: false,\r\n                    error: 'Session หมดอายุ กรุณาเข้าสู่ระบบใหม่',\r\n                };\r\n            }\r\n\r\n            // Parse JSON response\r\n            const data = await response.json();\r\n\r\n            // Handle API error responses\r\n            if (!response.ok) {\r\n                return {\r\n                    success: false,\r\n                    error: data.error || data.message || `HTTP Error: ${response.status}`,\r\n                };\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                data: data.data ?? data,\r\n            };\r\n        } catch (error) {\r\n            clearTimeout(timeoutId);\r\n\r\n            // Handle abort/timeout\r\n            if (error instanceof Error && error.name === 'AbortError') {\r\n                return {\r\n                    success: false,\r\n                    error: 'Request timeout - กรุณาลองใหม่',\r\n                };\r\n            }\r\n\r\n            // Handle network errors\r\n            console.error('[ApiClient] Request failed:', error);\r\n            return {\r\n                success: false,\r\n                error: 'ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์ได้',\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * GET request\r\n     */\r\n    async get<T>(endpoint: string, options?: RequestOptions): Promise<ApiResponse<T>> {\r\n        return this.request<T>(endpoint, { ...options, method: 'GET' });\r\n    }\r\n\r\n    /**\r\n     * POST request\r\n     */\r\n    async post<T>(endpoint: string, body?: unknown, options?: RequestOptions): Promise<ApiResponse<T>> {\r\n        return this.request<T>(endpoint, { ...options, method: 'POST', body });\r\n    }\r\n\r\n    /**\r\n     * PUT request\r\n     */\r\n    async put<T>(endpoint: string, body?: unknown, options?: RequestOptions): Promise<ApiResponse<T>> {\r\n        return this.request<T>(endpoint, { ...options, method: 'PUT', body });\r\n    }\r\n\r\n    /**\r\n     * PATCH request\r\n     */\r\n    async patch<T>(endpoint: string, body?: unknown, options?: RequestOptions): Promise<ApiResponse<T>> {\r\n        return this.request<T>(endpoint, { ...options, method: 'PATCH', body });\r\n    }\r\n\r\n    /**\r\n     * DELETE request\r\n     */\r\n    async delete<T>(endpoint: string, options?: RequestOptions): Promise<ApiResponse<T>> {\r\n        return this.request<T>(endpoint, { ...options, method: 'DELETE' });\r\n    }\r\n\r\n    /**\r\n     * GET Blob request (for file downloads)\r\n     */\r\n    async getBlob(endpoint: string, options?: RequestOptions): Promise<Blob | null> {\r\n        const { skipAuth = false, timeout = this.defaultTimeout, body, ...init } = options || {};\r\n\r\n        const headers: Record<string, string> = {\r\n            ...(init.headers as Record<string, string>),\r\n        };\r\n\r\n        if (!skipAuth) {\r\n            const token = AuthService.getToken();\r\n            if (token) {\r\n                headers['Authorization'] = `Bearer ${token}`;\r\n            }\r\n        }\r\n\r\n        let fullEndpoint = endpoint;\r\n        if (!endpoint.startsWith('http')) {\r\n            if (!endpoint.startsWith('/api')) {\r\n                fullEndpoint = `/api${endpoint.startsWith('/') ? endpoint : `/${endpoint}`}`;\r\n            }\r\n        }\r\n        const url = fullEndpoint.startsWith('http') ? fullEndpoint : `${this.baseUrl}${fullEndpoint}`;\r\n\r\n        try {\r\n            const response = await fetch(url, {\r\n                ...init,\r\n                method: 'GET',\r\n                headers,\r\n                credentials: 'include',\r\n            });\r\n\r\n            if (!response.ok) return null;\r\n            return await response.blob();\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Health check - for backwards compatibility\r\n     */\r\n    async health(): Promise<boolean> {\r\n        try {\r\n            const response = await this.get('/api/health', { skipAuth: true, timeout: 5000 });\r\n            return response.success;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const apiClient = new ApiClient();\r\n\r\n// Export class for testing or custom instances\r\nexport { ApiClient };\r\nexport const api = apiClient;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\calendar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\dal\\applications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\dal\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\dal\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\dal\\users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\design-tokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\i18n\\LanguageContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\i18n\\dictionaries\\en.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\i18n\\dictionaries\\th.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\i18n\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\roleUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\admin-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\application-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[923,926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[923,926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[949,952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[949,952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1374,1377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1374,1377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { apiClient } from \"@/lib/api/api-client\";\r\n\r\nexport interface Application {\r\n    _id: string;\r\n    applicationNumber?: string;\r\n    status: string;\r\n    createdAt: string;\r\n    updatedAt: string;\r\n    plantId?: string;\r\n    rejectCount?: number;\r\n    data?: {\r\n        applicantInfo?: { name: string };\r\n        formData?: { plantId: string };\r\n    };\r\n    scheduledDate?: string;\r\n    audit?: {\r\n        mode?: \"ONLINE\" | \"ONSITE\";\r\n        meetingUrl?: string;\r\n        location?: string;\r\n        scheduledDate?: string; // Legacy or redundant, keeping for safe measure\r\n    };\r\n    // [NEW] Expanded fields for UI\r\n    fees?: {\r\n        phase1?: { items: { description: string; amount: number }[] };\r\n        phase2?: { items: { description: string; amount: number }[] };\r\n    };\r\n    applicantData?: {\r\n        firstName?: string;\r\n        lastName?: string;\r\n        address?: string;\r\n        [key: string]: any;\r\n    };\r\n    items?: any[];\r\n}\r\n\r\nexport interface DashboardStats {\r\n    total: number;\r\n    pending: number;\r\n    approved: number;\r\n    todayChecked: number;\r\n}\r\n\r\nexport const ApplicationService = {\r\n    /**\r\n     * Get statistics for Staff Dashboard\r\n     */\r\n    /**\r\n     * Get statistics for Staff Dashboard\r\n     */\r\n    getStats: async () => {\r\n        // Updated to use the new Reports API\r\n        const response = await apiClient.get<any>(\"/reports/dashboard\");\r\n        if (response.success && response.data) {\r\n            return {\r\n                success: true,\r\n                data: {\r\n                    total: response.data.total,\r\n                    pending: response.data.pendingReview, // Map 'pendingReview' to 'pending'\r\n                    approved: response.data.approved,\r\n                    todayChecked: 0 // Not yet implemented in backend\r\n                }\r\n            };\r\n        }\r\n        return response;\r\n    },\r\n\r\n    /**\r\n     * Get applications for Farmer Dashboard\r\n     */\r\n    getMyApplications: async () => {\r\n        return apiClient.get<Application[]>(\"/applications/my\");\r\n    },\r\n\r\n    /**\r\n     * Get pending reviews for Staff (Document Review)\r\n     */\r\n    getPendingReviews: async () => {\r\n        return apiClient.get<Application[]>(\"/applications/pending-reviews\");\r\n    },\r\n\r\n    /**\r\n     * Get pending audits for Staff (Auditor)\r\n     */\r\n    getPendingAudits: async () => {\r\n        return apiClient.get<Application[]>(\"/applications/auditor/assignments\");\r\n    },\r\n\r\n    /**\r\n     * Get single application by ID\r\n     */\r\n    getMyCertificates: async () => {\r\n        return apiClient.get<Certificate[]>(\"/certificates/my\");\r\n    },\r\n\r\n    /**\r\n     * Download Certificate (Mock)\r\n     */\r\n    downloadCertificate: async (id: string) => {\r\n        // This would typically trigger a blob download\r\n        // For now, we return the URL to open in new tab\r\n        return {\r\n            success: true,\r\n            data: `/api/certificates/${id}/download`\r\n        };\r\n    }\r\n};\r\n\r\nexport interface Certificate {\r\n    _id: string;\r\n    certificateNumber: string;\r\n    siteName: string; // Farm Name\r\n    plantType: string;\r\n    issuedDate: string;\r\n    expiryDate: string;\r\n    status: string;\r\n    qrCode: string;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\auth-provider.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_vStatus' is assigned a value but never used.","line":47,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\auth-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":187,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":187,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * AuthService - Enterprise-Grade Authentication Service for Next.js\r\n * \r\n * Features:\r\n * - Centralized token + user storage (fixes State Amnesia)\r\n * - JWT decode & expiry checking\r\n * - Auto token refresh before expiry\r\n * - Cross-tab synchronization (logout syncs all tabs)\r\n * - Session timeout after inactivity\r\n * - Auth event system for reactive updates\r\n * - Cookie sync for middleware compatibility\r\n * \r\n * @version 2.0.0\r\n */\r\n\r\nimport { apiClient } from '../api/api-client';\r\n\r\n// Storage keys - centralized to prevent typos\r\nconst STORAGE_KEYS = {\r\n    ACCESS_TOKEN: 'accessToken',\r\n    REFRESH_TOKEN: 'refreshToken',\r\n    USER: 'user',\r\n    REMEMBER_LOGIN: 'remember_login',\r\n    LAST_ACTIVITY: 'lastActivity',\r\n} as const;\r\n\r\n// Event types for auth state changes\r\nexport type AuthEventType = 'login' | 'logout' | 'token_refresh' | 'session_expired' | 'tab_sync';\r\n\r\nexport type AuthEventCallback = (event: AuthEventType, data?: unknown) => void;\r\n\r\n// User type definition\r\nexport interface AuthUser {\r\n    id: string;\r\n    uuid?: string;\r\n    email?: string;\r\n    firstName?: string;\r\n    lastName?: string;\r\n    accountType?: string;\r\n    userType?: string;\r\n    role?: string;\r\n    status?: string;\r\n    verificationStatus?: string;\r\n    verificationNote?: string;\r\n    verificationSubmittedAt?: string;\r\n    taxId?: string;\r\n    laserCode?: string;\r\n    idCard?: string;\r\n    address?: string;\r\n    province?: string;\r\n    companyName?: string;\r\n    phone?: string;\r\n    applicantType?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\n// JWT Payload type\r\ninterface JWTPayload {\r\n    exp?: number;\r\n    iat?: number;\r\n    userId?: string;\r\n    email?: string;\r\n    role?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\n// Session data from API response\r\nexport interface SessionData {\r\n    token?: string;\r\n    accessToken?: string;\r\n    refreshToken?: string;\r\n    user?: AuthUser;\r\n    tokens?: {\r\n        accessToken?: string;\r\n        refreshToken?: string;\r\n    };\r\n}\r\n\r\n// Configuration options\r\ninterface AuthConfig {\r\n    sessionTimeoutMinutes: number;\r\n    tokenRefreshBufferMinutes: number;\r\n    enableCrossTabSync: boolean;\r\n    enableSessionTimeout: boolean;\r\n    onAuthEvent?: AuthEventCallback;\r\n}\r\n\r\nconst DEFAULT_CONFIG: AuthConfig = {\r\n    sessionTimeoutMinutes: 30,\r\n    tokenRefreshBufferMinutes: 5,\r\n    enableCrossTabSync: true,\r\n    enableSessionTimeout: true,\r\n};\r\n\r\nclass AuthServiceClass {\r\n    private config: AuthConfig;\r\n    private refreshTimer: ReturnType<typeof setTimeout> | null = null;\r\n    private activityTimer: ReturnType<typeof setTimeout> | null = null;\r\n    private eventListeners: AuthEventCallback[] = [];\r\n    private initialized = false;\r\n\r\n    constructor(config: Partial<AuthConfig> = {}) {\r\n        this.config = { ...DEFAULT_CONFIG, ...config };\r\n    }\r\n\r\n    // ==================== API ACTIONS ====================\r\n\r\n    /**\r\n     * Login with centralized API client\r\n     */\r\n    async login(credentials: { identifier: string; password: string; accountType?: string }): Promise<{ success: boolean; error?: string }> {\r\n        try {\r\n            const response = await apiClient.post<SessionData>('/auth-farmer/login', credentials);\r\n\r\n            if (!response.success || !response.data) {\r\n                return {\r\n                    success: false,\r\n                    error: response.error || 'ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง'\r\n                };\r\n            }\r\n\r\n            const data = response.data;\r\n            const token = data.tokens?.accessToken || data.token || data.accessToken;\r\n\r\n            if (!token) {\r\n                return { success: false, error: 'ไม่ได้รับ Token จากระบบ' };\r\n            }\r\n\r\n            // Auto-save session\r\n            this.saveSession({\r\n                ...data,\r\n                token\r\n            });\r\n\r\n            return { success: true };\r\n        } catch (error) {\r\n            console.error('[AuthService] Login failed:', error);\r\n            return { success: false, error: 'เกิดข้อผิดพลาดในการเชื่อมต่อ' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register new farmer\r\n     */\r\n    async register(data: unknown): Promise<{ success: boolean; error?: string; data?: unknown }> {\r\n        try {\r\n            const response = await apiClient.post<{ user: AuthUser }>('/auth-farmer/register', data);\r\n\r\n            if (!response.success) {\r\n                return { success: false, error: response.error };\r\n            }\r\n\r\n            return { success: true, data: response.data };\r\n        } catch (error) {\r\n            console.error('[AuthService] Register failed:', error);\r\n            return { success: false, error: 'เกิดข้อผิดพลาดในการเชื่อมต่อ' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if identifier exists\r\n     */\r\n    async checkIdentifier(identifier: string, accountType: string): Promise<{ available: boolean; error?: string }> {\r\n        try {\r\n            const response = await apiClient.post<{ available: boolean; error?: string }>('/auth-farmer/check-identifier', {\r\n                identifier,\r\n                accountType\r\n            });\r\n\r\n            if (!response.success) {\r\n                return { available: false, error: response.error };\r\n            }\r\n\r\n            // API returns success: true even if available: false\r\n            // The available flag is inside data if success is true?\r\n            // Checking api-client wrapper response structure vs controller response\r\n            // Controller returns: { success: true, available: false, error: \"...\" }\r\n            // ApiClient returns: { success: true, data: { available, error } }\r\n\r\n            const result = response.data;\r\n            if (!result) return { available: false, error: 'No data' };\r\n\r\n            return {\r\n                available: !!result.available,\r\n                error: result.error\r\n            };\r\n        } catch (error) {\r\n            return { available: false, error: 'Connection Error' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize auth service (call once in app layout/provider)\r\n     */\r\n    initialize(): void {\r\n        if (this.initialized || !this.isBrowser()) return;\r\n\r\n        this.initialized = true;\r\n\r\n        // Setup cross-tab synchronization\r\n        if (this.config.enableCrossTabSync) {\r\n            this.setupCrossTabSync();\r\n        }\r\n\r\n        // Setup session timeout tracking\r\n        if (this.config.enableSessionTimeout) {\r\n            this.setupActivityTracking();\r\n        }\r\n\r\n        // Schedule token refresh if authenticated\r\n        if (this.isAuthenticated()) {\r\n            this.scheduleTokenRefresh();\r\n        }\r\n\r\n        console.log('[AuthService] Initialized with config:', {\r\n            sessionTimeout: this.config.sessionTimeoutMinutes,\r\n            crossTabSync: this.config.enableCrossTabSync,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if running in browser environment\r\n     */\r\n    private isBrowser(): boolean {\r\n        return typeof window !== 'undefined';\r\n    }\r\n\r\n    /**\r\n     * Emit auth event to all listeners\r\n     */\r\n    private emit(event: AuthEventType, data?: unknown): void {\r\n        this.eventListeners.forEach(cb => cb(event, data));\r\n        this.config.onAuthEvent?.(event, data);\r\n    }\r\n\r\n    /**\r\n     * Subscribe to auth events\r\n     */\r\n    onAuthChange(callback: AuthEventCallback): () => void {\r\n        this.eventListeners.push(callback);\r\n        return () => {\r\n            this.eventListeners = this.eventListeners.filter(cb => cb !== callback);\r\n        };\r\n    }\r\n\r\n    // ==================== JWT UTILITIES ====================\r\n\r\n    /**\r\n     * Decode JWT token without verification (client-side only)\r\n     */\r\n    decodeToken(token?: string): JWTPayload | null {\r\n        const t = token || this.getToken();\r\n        if (!t) return null;\r\n\r\n        try {\r\n            const parts = t.split('.');\r\n            if (parts.length !== 3) return null;\r\n\r\n            const payload = parts[1];\r\n            const decoded = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\r\n            return JSON.parse(decoded);\r\n        } catch {\r\n            console.error('[AuthService] Failed to decode JWT');\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get token expiration timestamp (ms)\r\n     */\r\n    getTokenExpiry(): number | null {\r\n        const payload = this.decodeToken();\r\n        if (!payload?.exp) return null;\r\n        return payload.exp * 1000; // Convert to milliseconds\r\n    }\r\n\r\n    /**\r\n     * Check if token is expired\r\n     */\r\n    isTokenExpired(): boolean {\r\n        const expiry = this.getTokenExpiry();\r\n        if (!expiry) return true;\r\n        return Date.now() >= expiry;\r\n    }\r\n\r\n    /**\r\n     * Get time until token expires (ms)\r\n     */\r\n    getTimeUntilExpiry(): number {\r\n        const expiry = this.getTokenExpiry();\r\n        if (!expiry) return 0;\r\n        return Math.max(0, expiry - Date.now());\r\n    }\r\n\r\n    // ==================== SESSION MANAGEMENT ====================\r\n\r\n    /**\r\n     * Save complete auth session (token + user)\r\n     */\r\n    saveSession(data: SessionData): void {\r\n        if (!this.isBrowser()) return;\r\n\r\n        const accessToken = data.tokens?.accessToken || data.accessToken || data.token;\r\n        const refreshToken = data.tokens?.refreshToken || data.refreshToken;\r\n\r\n        if (accessToken) {\r\n            localStorage.setItem(STORAGE_KEYS.ACCESS_TOKEN, accessToken);\r\n            // Sync cookie for middleware\r\n            const isSecure = window.location.protocol === 'https:';\r\n            document.cookie = `auth_token=${accessToken}; path=/; max-age=${60 * 60 * 24 * 7}; SameSite=Lax${isSecure ? '; Secure' : ''}`;\r\n        }\r\n\r\n        if (refreshToken) {\r\n            localStorage.setItem(STORAGE_KEYS.REFRESH_TOKEN, refreshToken);\r\n        }\r\n\r\n        if (data.user) {\r\n            localStorage.setItem(STORAGE_KEYS.USER, JSON.stringify(data.user));\r\n        }\r\n\r\n        // Update last activity\r\n        this.updateLastActivity();\r\n\r\n        // Schedule token refresh\r\n        this.scheduleTokenRefresh();\r\n\r\n        // Emit login event\r\n        this.emit('login', { user: data.user });\r\n\r\n        console.log('[AuthService] Session saved:', {\r\n            hasAccessToken: !!accessToken,\r\n            hasRefreshToken: !!refreshToken,\r\n            expiresIn: this.getTimeUntilExpiry(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get access token\r\n     */\r\n    getToken(): string | null {\r\n        if (!this.isBrowser()) return null;\r\n        return localStorage.getItem(STORAGE_KEYS.ACCESS_TOKEN);\r\n    }\r\n\r\n    /**\r\n     * Get refresh token\r\n     */\r\n    getRefreshToken(): string | null {\r\n        if (!this.isBrowser()) return null;\r\n        return localStorage.getItem(STORAGE_KEYS.REFRESH_TOKEN);\r\n    }\r\n\r\n    /**\r\n     * Get current user data\r\n     */\r\n    getUser(): AuthUser | null {\r\n        if (!this.isBrowser()) return null;\r\n\r\n        const userStr = localStorage.getItem(STORAGE_KEYS.USER);\r\n        if (!userStr) return null;\r\n\r\n        try {\r\n            return JSON.parse(userStr) as AuthUser;\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update user data without changing token\r\n     */\r\n    updateUser(user: AuthUser): void {\r\n        if (!this.isBrowser()) return;\r\n        localStorage.setItem(STORAGE_KEYS.USER, JSON.stringify(user));\r\n    }\r\n\r\n    /**\r\n     * Check if user is authenticated (token exists and not expired)\r\n     */\r\n    isAuthenticated(): boolean {\r\n        const token = this.getToken();\r\n        const user = this.getUser();\r\n\r\n        if (!token || !user?.id) return false;\r\n\r\n        // Check token expiry\r\n        if (this.isTokenExpired()) {\r\n            console.log('[AuthService] Token expired');\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Clear all auth data (logout)\r\n     */\r\n    clearSession(): void {\r\n        if (!this.isBrowser()) return;\r\n\r\n        // Clear timers\r\n        if (this.refreshTimer) {\r\n            clearTimeout(this.refreshTimer);\r\n            this.refreshTimer = null;\r\n        }\r\n\r\n        localStorage.removeItem(STORAGE_KEYS.ACCESS_TOKEN);\r\n        localStorage.removeItem(STORAGE_KEYS.REFRESH_TOKEN);\r\n        localStorage.removeItem(STORAGE_KEYS.USER);\r\n        localStorage.removeItem(STORAGE_KEYS.LAST_ACTIVITY);\r\n\r\n        // Clear auth cookie\r\n        document.cookie = 'auth_token=; path=/; max-age=0';\r\n\r\n        // Emit logout event\r\n        this.emit('logout');\r\n\r\n        console.log('[AuthService] Session cleared');\r\n    }\r\n\r\n    // ==================== TOKEN REFRESH ====================\r\n\r\n    /**\r\n     * Schedule automatic token refresh\r\n     */\r\n    private scheduleTokenRefresh(): void {\r\n        if (!this.isBrowser()) return;\r\n\r\n        // Clear existing timer\r\n        if (this.refreshTimer) {\r\n            clearTimeout(this.refreshTimer);\r\n        }\r\n\r\n        const timeUntilExpiry = this.getTimeUntilExpiry();\r\n        if (timeUntilExpiry <= 0) return;\r\n\r\n        // Refresh 5 minutes before expiry\r\n        const bufferMs = this.config.tokenRefreshBufferMinutes * 60 * 1000;\r\n        const refreshIn = Math.max(0, timeUntilExpiry - bufferMs);\r\n\r\n        if (refreshIn > 0) {\r\n            this.refreshTimer = setTimeout(() => {\r\n                this.refreshToken();\r\n            }, refreshIn);\r\n\r\n            console.log('[AuthService] Token refresh scheduled in', Math.round(refreshIn / 1000 / 60), 'minutes');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh the access token using refresh token\r\n     */\r\n    async refreshToken(): Promise<boolean> {\r\n        const refreshToken = this.getRefreshToken();\r\n        if (!refreshToken) {\r\n            console.log('[AuthService] No refresh token available');\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/api/auth/refresh', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ refreshToken }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Refresh failed');\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.success && data.data?.accessToken) {\r\n                localStorage.setItem(STORAGE_KEYS.ACCESS_TOKEN, data.data.accessToken);\r\n                const isSecure = window.location.protocol === 'https:';\r\n                document.cookie = `auth_token=${data.data.accessToken}; path=/; max-age=${60 * 60 * 24 * 7}; SameSite=Lax${isSecure ? '; Secure' : ''}`;\r\n\r\n                // Schedule next refresh\r\n                this.scheduleTokenRefresh();\r\n\r\n                this.emit('token_refresh');\r\n                console.log('[AuthService] Token refreshed successfully');\r\n                return true;\r\n            }\r\n\r\n            throw new Error('Invalid refresh response');\r\n        } catch (error) {\r\n            console.error('[AuthService] Token refresh failed:', error);\r\n            // Clear session on refresh failure\r\n            this.clearSession();\r\n            this.emit('session_expired');\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // ==================== CROSS-TAB SYNC ====================\r\n\r\n    /**\r\n     * Setup cross-tab synchronization\r\n     */\r\n    private setupCrossTabSync(): void {\r\n        if (!this.isBrowser()) return;\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            // Logout synced across tabs\r\n            if (e.key === STORAGE_KEYS.ACCESS_TOKEN && !e.newValue) {\r\n                console.log('[AuthService] Logout detected from another tab');\r\n                this.emit('tab_sync', { action: 'logout' });\r\n\r\n                // Redirect to login\r\n                if (window.location.pathname !== '/login') {\r\n                    window.location.href = '/login';\r\n                }\r\n            }\r\n\r\n            // Login synced across tabs\r\n            if (e.key === STORAGE_KEYS.ACCESS_TOKEN && e.newValue && !e.oldValue) {\r\n                console.log('[AuthService] Login detected from another tab');\r\n                this.emit('tab_sync', { action: 'login' });\r\n            }\r\n        });\r\n    }\r\n\r\n    // ==================== SESSION TIMEOUT ====================\r\n\r\n    /**\r\n     * Update last activity timestamp\r\n     */\r\n    updateLastActivity(): void {\r\n        if (!this.isBrowser()) return;\r\n        localStorage.setItem(STORAGE_KEYS.LAST_ACTIVITY, Date.now().toString());\r\n        this.resetActivityTimer();\r\n    }\r\n\r\n    /**\r\n     * Get last activity timestamp\r\n     */\r\n    private getLastActivity(): number {\r\n        const stored = localStorage.getItem(STORAGE_KEYS.LAST_ACTIVITY);\r\n        return stored ? parseInt(stored, 10) : Date.now();\r\n    }\r\n\r\n    /**\r\n     * Check if session has timed out due to inactivity\r\n     */\r\n    isSessionTimedOut(): boolean {\r\n        const lastActivity = this.getLastActivity();\r\n        const timeoutMs = this.config.sessionTimeoutMinutes * 60 * 1000;\r\n        return Date.now() - lastActivity > timeoutMs;\r\n    }\r\n\r\n    /**\r\n     * Setup activity tracking for session timeout\r\n     */\r\n    private setupActivityTracking(): void {\r\n        if (!this.isBrowser()) return;\r\n\r\n        const activityEvents = ['mousedown', 'keydown', 'touchstart', 'scroll'];\r\n\r\n        const handleActivity = () => {\r\n            if (this.isAuthenticated()) {\r\n                this.updateLastActivity();\r\n            }\r\n        };\r\n\r\n        // Throttle activity updates\r\n        let lastUpdate = 0;\r\n        const throttledHandler = () => {\r\n            const now = Date.now();\r\n            if (now - lastUpdate > 60000) { // Update max once per minute\r\n                lastUpdate = now;\r\n                handleActivity();\r\n            }\r\n        };\r\n\r\n        activityEvents.forEach(event => {\r\n            window.addEventListener(event, throttledHandler, { passive: true });\r\n        });\r\n\r\n        // Initial activity timer\r\n        this.resetActivityTimer();\r\n    }\r\n\r\n    /**\r\n     * Reset activity timer\r\n     */\r\n    private resetActivityTimer(): void {\r\n        if (this.activityTimer) {\r\n            clearTimeout(this.activityTimer);\r\n        }\r\n\r\n        if (!this.isAuthenticated()) return;\r\n\r\n        const timeoutMs = this.config.sessionTimeoutMinutes * 60 * 1000;\r\n\r\n        this.activityTimer = setTimeout(() => {\r\n            if (this.isSessionTimedOut()) {\r\n                console.log('[AuthService] Session timed out due to inactivity');\r\n                this.logout(false);\r\n                this.emit('session_expired');\r\n                window.location.href = '/login?timeout=true';\r\n            }\r\n        }, timeoutMs);\r\n    }\r\n\r\n    // ==================== REMEMBER ME ====================\r\n\r\n    saveRememberMe(accountType: string, identifier: string): void {\r\n        if (!this.isBrowser()) return;\r\n        localStorage.setItem(STORAGE_KEYS.REMEMBER_LOGIN, JSON.stringify({ accountType, identifier }));\r\n    }\r\n\r\n    getRememberMe(): { accountType: string; identifier: string } | null {\r\n        if (!this.isBrowser()) return null;\r\n        const data = localStorage.getItem(STORAGE_KEYS.REMEMBER_LOGIN);\r\n        if (!data) return null;\r\n        try {\r\n            return JSON.parse(data);\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    clearRememberMe(): void {\r\n        if (!this.isBrowser()) return;\r\n        localStorage.removeItem(STORAGE_KEYS.REMEMBER_LOGIN);\r\n    }\r\n\r\n    // ==================== LOGOUT ====================\r\n\r\n    /**\r\n     * Logout - clear session and optionally call logout API\r\n     */\r\n    async logout(callApi = true): Promise<void> {\r\n        if (callApi) {\r\n            try {\r\n                await fetch('/api/auth/logout', { method: 'POST' });\r\n            } catch {\r\n                // Ignore API errors during logout\r\n            }\r\n        }\r\n        this.clearSession();\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const AuthService = new AuthServiceClass();\r\n\r\n// Export class for custom instances\r\nexport { AuthServiceClass };\r\n\r\n// Export config type for customization\r\nexport type { AuthConfig };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\services\\payment-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAuthRoute' is assigned a value but never used.","line":93,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n// 🍎 Zero-Crash Security Middleware\r\n\r\n// Routes that require farmer authentication\r\n// Routes that require farmer authentication\r\nconst protectedFarmerRoutes = [\r\n    '/farmer', // Protects all /farmer/* routes\r\n];\r\n\r\n// Routes that require staff authentication\r\nconst protectedStaffRoutes = [\r\n    '/staff/dashboard',\r\n    '/staff/applications',\r\n    '/staff/audits',\r\n    '/staff/accounting',\r\n    '/staff/calendar',\r\n    '/staff/analytics',\r\n    '/admin',\r\n];\r\n\r\n// Routes that are only for unauthenticated users\r\nconst authRoutes = ['/login', '/register', '/forgot-password'];\r\nconst staffAuthRoutes = ['/staff/login'];\r\n\r\n// 🛡️ Enhanced Security Headers (OWASP + Apple Standards)\r\nconst securityHeaders = {\r\n    'X-Frame-Options': 'DENY',\r\n    'X-Content-Type-Options': 'nosniff',\r\n    'X-XSS-Protection': '1; mode=block',\r\n    'Referrer-Policy': 'strict-origin-when-cross-origin',\r\n    'Permissions-Policy': 'camera=(), microphone=(), geolocation=()',\r\n    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload',\r\n    'Content-Security-Policy': [\r\n        \"default-src 'self'\",\r\n        \"script-src 'self' 'unsafe-inline' 'unsafe-eval'\",\r\n        \"style-src 'self' 'unsafe-inline'\",\r\n        \"img-src 'self' data: blob: https:\",\r\n        \"font-src 'self' data:\",\r\n        \"connect-src 'self' http://47.129.167.71 http://localhost:* https:\",\r\n        \"frame-src 'self' https://*.openstreetmap.org\",\r\n        \"frame-ancestors 'none'\",\r\n        \"base-uri 'self'\",\r\n        \"form-action 'self'\",\r\n    ].join('; '),\r\n};\r\n\r\nexport function middleware(request: NextRequest) {\r\n    const { pathname } = request.nextUrl;\r\n\r\n    // ========================================\r\n    // 🛡️ CVE-2025-29927 Protection\r\n    // Block x-middleware-subrequest header bypass attack\r\n    // ========================================\r\n    const subrequestHeader = request.headers.get('x-middleware-subrequest');\r\n    if (subrequestHeader) {\r\n        console.warn(`[SECURITY] Blocked middleware bypass attempt: ${subrequestHeader}`);\r\n        return new NextResponse('Forbidden', { status: 403 });\r\n    }\r\n\r\n    // Loading page at / handles redirect to /login itself\r\n    // No middleware redirect needed for root\r\n\r\n    const response = NextResponse.next();\r\n\r\n    // ========================================\r\n    // 🔒 EARLY EXIT: Apply Security Headers\r\n    // ========================================\r\n    Object.entries(securityHeaders).forEach(([key, value]) => {\r\n        response.headers.set(key, value);\r\n    });\r\n\r\n    // ========================================\r\n    // 🔒 EARLY EXIT: Block suspicious patterns\r\n    // ========================================\r\n    const suspiciousPatterns = [\r\n        /\\.\\.\\//,           // Path traversal\r\n        /<script/i,         // XSS attempt\r\n        /javascript:/i,     // JS injection\r\n        /\\x00/,             // Null byte\r\n    ];\r\n\r\n    if (suspiciousPatterns.some(pattern => pattern.test(pathname))) {\r\n        return new NextResponse('Forbidden', { status: 403 });\r\n    }\r\n\r\n    // ========================================\r\n    // 🔐 Farmer Route Protection\r\n    // ========================================\r\n    const token = request.cookies.get('auth_token')?.value;\r\n    const isProtectedFarmerRoute = protectedFarmerRoutes.some(route => pathname.startsWith(route));\r\n    const isAuthRoute = authRoutes.some(route => pathname.startsWith(route));\r\n\r\n    if (isProtectedFarmerRoute && !token) {\r\n        const loginUrl = new URL('/login', request.url);\r\n        loginUrl.searchParams.set('redirect', pathname);\r\n        return NextResponse.redirect(loginUrl);\r\n    }\r\n\r\n    // NOTE: Disabled to prevent redirect loop when cookie exists but localStorage empty\r\n    // if (isAuthRoute && token) {\r\n    //     return NextResponse.redirect(new URL('/farmer/dashboard', request.url));\r\n    // }\r\n\r\n    // ========================================\r\n    // 🔐 Staff Route Protection\r\n    // ========================================\r\n    const staffToken = request.cookies.get('staff_token')?.value;\r\n    const isProtectedStaffRoute = protectedStaffRoutes.some(route => pathname.startsWith(route));\r\n    const isStaffAuthRoute = staffAuthRoutes.some(route => pathname.startsWith(route));\r\n\r\n    if (isProtectedStaffRoute && !staffToken) {\r\n        const loginUrl = new URL('/staff/login', request.url);\r\n        loginUrl.searchParams.set('redirect', pathname);\r\n        return NextResponse.redirect(loginUrl);\r\n    }\r\n\r\n    if (isStaffAuthRoute && staffToken) {\r\n        return NextResponse.redirect(new URL('/staff/dashboard', request.url));\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        /*\r\n         * Match all request paths except for:\r\n         * - api (API routes)\r\n         * - _next/static (static files)\r\n         * - _next/image (image optimization files)\r\n         * - favicon.ico (favicon file)\r\n         * - public assets\r\n         */\r\n        '/((?!api|_next/static|_next/image|favicon.ico|images|.*\\\\.png$|.*\\\\.jpg$).*)',\r\n    ],\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\styles\\design-system.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\types\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\__tests__\\error-translator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\__tests__\\thai-id-validator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\api-mapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\error-translator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\thai-date.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\thai-id-validator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\usEr\\Desktop\\GACP-Certification-Application\\apps\\web-app\\src\\utils\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]