# Subscription & Feature Access Guide

**Document Version**: 1.0.0
**Date**: 2025-10-28
**Purpose**: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö Subscription ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

---

## Executive Summary

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ:

1. **‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô**: ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ **‡∏ü‡∏£‡∏µ** (Free Tier)
2. **‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï**: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö **Subscription/Premium** ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

**‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö**:

- ‚úÖ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå IoT (Phase 2) ‡πÄ‡∏õ‡πá‡∏ô **optional** - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ
- ‚úÖ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå AI (Phase 3) ‡πÄ‡∏õ‡πá‡∏ô **optional** - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ
- ‚úÖ ‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏°‡∏µ IoT ‡∏ó‡∏∏‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏° - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ IoT
- ‚úÖ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö monetization ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

---

## Subscription Tiers

### 1. Free Tier (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô - ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏£‡∏µ) üÜì

**‡∏£‡∏≤‡∏Ñ‡∏≤**: 0 THB/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå**:

- ‚úÖ Farm Management (GACP Compliance)
- ‚úÖ Crop Tracking
- ‚úÖ Certification Management
- ‚úÖ **IoT Monitoring** (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ü‡∏£‡∏µ - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô premium ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
  - Max 5 devices
  - Max 10 alerts
- ‚úÖ **AI Recommendations** (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ü‡∏£‡∏µ - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô premium ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
  - Fertilizer recommendations
  - Irrigation scheduling
  - Disease prediction
  - Yield forecasting
  - Max 100 AI requests/month

**‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**:

- ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢
- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (< 10 ‡πÑ‡∏£‡πà)
- ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

---

### 2. Basic Plan (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï) üíº

**‡∏£‡∏≤‡∏Ñ‡∏≤**: 500 THB/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Free +**:

- ‚úÖ IoT Monitoring ‡∏Ç‡∏¢‡∏≤‡∏¢
  - Max 20 devices
  - Max 50 alerts
- ‚úÖ AI Recommendations ‡∏Ç‡∏¢‡∏≤‡∏¢
  - Max 500 AI requests/month
- ‚úÖ Email Support

**‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**:

- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á (10-50 ‡πÑ‡∏£‡πà)
- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ IoT ‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î

---

### 3. Premium Plan (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï) üíé

**‡∏£‡∏≤‡∏Ñ‡∏≤**: 2,000 THB/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Basic +**:

- ‚úÖ Advanced Analytics
- ‚úÖ Custom Reports
- ‚úÖ Priority Support
- ‚úÖ IoT Monitoring ‡∏Ç‡∏¢‡∏≤‡∏¢
  - Max 100 devices
  - Max 500 alerts
- ‚úÖ AI Recommendations ‡∏Ç‡∏¢‡∏≤‡∏¢
  - Max 5,000 AI requests/month

**‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**:

- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà (50-200 ‡πÑ‡∏£‡πà)
- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ analytics ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å

---

### 4. Enterprise Plan (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï) üè¢

**‡∏£‡∏≤‡∏Ñ‡∏≤**: 10,000 THB/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Premium +**:

- ‚úÖ **Unlimited** IoT devices
- ‚úÖ **Unlimited** AI requests
- ‚úÖ API Access
- ‚úÖ White Label
- ‚úÖ Dedicated Support
- ‚úÖ Custom Development

**‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**:

- ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å (200+ ‡πÑ‡∏£‡πà)
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏Å‡∏©‡∏ï‡∏£
- ‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ integrate ‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô

---

## Farm Schema - Subscription Fields

```javascript
{
  // === Membership & Feature Access Control ===
  subscription: {
    tier: {
      type: String,
      enum: ['free', 'basic', 'premium', 'enterprise'],
      default: 'free'  // ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏õ‡πá‡∏ô free
    },
    startDate: Date,
    expiryDate: Date,
    autoRenew: Boolean,
    paymentStatus: Enum['active', 'pending', 'overdue', 'cancelled']
  },

  featureAccess: {
    // IoT Features
    iotMonitoring: {
      enabled: Boolean,          // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      availableInTier: 'free',   // ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ü‡∏£‡∏µ
      activatedAt: Date
    },

    // AI Features
    aiRecommendations: {
      enabled: Boolean,
      availableInTier: 'free',   // ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ü‡∏£‡∏µ
      activatedAt: Date,
      features: {
        fertilizer: Boolean,
        irrigation: Boolean,
        diseasePrediction: Boolean,
        yieldPrediction: Boolean
      }
    },

    // Advanced Analytics (Future - Premium only)
    advancedAnalytics: {
      enabled: Boolean,
      availableInTier: 'premium'  // ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÄ‡∏õ‡πá‡∏ô premium ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    }
  }
}
```

---

## Feature Access Middleware

### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Middleware

**‡πÑ‡∏ü‡∏•‡πå**: `apps/backend/middleware/feature-access.middleware.js`

#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```javascript
const { checkFeatureAccess } = require('../middleware/feature-access.middleware');

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ IoT Monitoring ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
router.get('/farms/:farmId/iot/devices', checkFeatureAccess('iotMonitoring'), (req, res) => {
  // ‡∏ñ‡πâ‡∏≤ pass middleware ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
  const farm = req.farm; // Middleware ‡∏à‡∏∞‡πÉ‡∏™‡πà farm object ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡πâ
  // ... logic
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ AI Recommendations ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
router.post(
  '/farms/:farmId/ai/fertilizer-recommendation',
  checkFeatureAccess('aiRecommendations'),
  (req, res) => {
    // ... logic
  }
);
```

**Response ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå**:

```json
{
  "success": false,
  "message": "This feature is not available in your current plan (free)",
  "code": "FEATURE_NOT_AVAILABLE",
  "currentTier": "free",
  "requiredTier": "premium",
  "upgradeUrl": "/api/subscriptions/upgrade"
}
```

#### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```javascript
const {
  checkFeatureAccess,
  requireFeatureEnabled
} = require('../middleware/feature-access.middleware');

// ‡πÉ‡∏ä‡πâ 2 middleware ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
router.post(
  '/farms/:farmId/ai/fertilizer-recommendation',
  checkFeatureAccess('aiRecommendations'), // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  requireFeatureEnabled('aiRecommendations'), // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  (req, res) => {
    // Pass ‡∏ó‡∏±‡πâ‡∏á 2 middleware ‡πÅ‡∏•‡πâ‡∏ß
    // 1. ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (based on subscription)
    // 2. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß (enabled = true)
    // ... logic
  }
);
```

**Response ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ**:

```json
{
  "success": false,
  "message": "Feature 'aiRecommendations' is not enabled for this farm",
  "code": "FEATURE_NOT_ENABLED",
  "hint": "Please enable this feature in farm settings first"
}
```

---

## Helper Functions

### 1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

```javascript
const { enableFeature } = require('../middleware/feature-access.middleware');

// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô IoT Monitoring
await enableFeature(farmId, 'iotMonitoring');

// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI Recommendations
await enableFeature(farmId, 'aiRecommendations');

// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏¢‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á AI
await enableFeature(farmId, 'aiRecommendations.features.fertilizer');
```

### 2. ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

```javascript
const { disableFeature } = require('../middleware/feature-access.middleware');

await disableFeature(farmId, 'iotMonitoring');
```

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Usage Limit

```javascript
const { checkUsageLimit } = require('../middleware/feature-access.middleware');

const iotLimit = checkUsageLimit(farm, 'maxDevices');
console.log(iotLimit);
// {
//   allowed: true,
//   limit: 5,
//   current: 3,
//   remaining: 2
// }

const aiLimit = checkUsageLimit(farm, 'aiRequestsPerMonth');
// {
//   allowed: true,
//   limit: 100,
//   current: 45,
//   remaining: 55
// }
```

---

## API Endpoints ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Subscription Management

### 1. ‡∏î‡∏π Subscription ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

```
GET /api/farms/:farmId/subscription
```

**Response**:

```json
{
  "success": true,
  "data": {
    "tier": "free",
    "startDate": null,
    "expiryDate": null,
    "paymentStatus": "active",
    "features": {
      "iotMonitoring": {
        "enabled": true,
        "availableInTier": "free",
        "limits": {
          "maxDevices": 5,
          "maxAlerts": 10
        }
      },
      "aiRecommendations": {
        "enabled": true,
        "availableInTier": "free",
        "limits": {
          "aiRequestsPerMonth": 100
        }
      }
    }
  }
}
```

### 2. ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î Subscription (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

```
POST /api/farms/:farmId/subscription/upgrade
```

**Request**:

```json
{
  "tier": "premium",
  "paymentMethod": "credit_card",
  "autoRenew": true
}
```

**Response**:

```json
{
  "success": true,
  "message": "Subscription upgraded to premium",
  "data": {
    "tier": "premium",
    "startDate": "2025-10-28",
    "expiryDate": "2025-11-28",
    "paymentStatus": "active",
    "invoice": {
      "id": "INV-001",
      "amount": 2000,
      "currency": "THB"
    }
  }
}
```

### 3. ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

```
POST /api/farms/:farmId/features/enable
```

**Request**:

```json
{
  "feature": "iotMonitoring"
}
```

**Response**:

```json
{
  "success": true,
  "message": "Feature 'iotMonitoring' enabled successfully",
  "data": {
    "feature": "iotMonitoring",
    "enabled": true,
    "activatedAt": "2025-10-28T10:30:00Z"
  }
}
```

---

## Frontend Integration Examples

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```javascript
// React Component
import { useFarm } from '@/hooks/useFarm';

function IoTDashboard() {
  const { farm, loading } = useFarm();

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô IoT ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const canUseIoT =
    farm?.featureAccess?.iotMonitoring?.enabled && farm?.subscription?.tier !== 'expired';

  if (!canUseIoT) {
    return (
      <div className="feature-locked">
        <h3>IoT Monitoring ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
        <p>‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ü‡∏£‡∏µ! ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        <button onClick={handleEnableFeature}>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô IoT</button>
      </div>
    );
  }

  return <IoTDashboardContent farm={farm} />;
}
```

### 2. ‡πÅ‡∏™‡∏î‡∏á Upgrade Prompt

```javascript
function FeatureUpgradePrompt({ currentTier, requiredTier }) {
  return (
    <div className="upgrade-prompt">
      <h3>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°?</h3>
      <p>
        ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ <strong>{currentTier}</strong> plan
      </p>
      <p>
        ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô <strong>{requiredTier}</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
      </p>
      <Link href="/subscription/upgrade">
        <button>‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î ‚Üí</button>
      </Link>
    </div>
  );
}
```

### 3. ‡πÅ‡∏™‡∏î‡∏á Usage Limits

```javascript
function UsageWidget({ farm }) {
  const iotUsage = farm.usage?.iotDevices || 0;
  const iotLimit = farm.subscription?.limits?.maxDevices || 5;
  const percentage = (iotUsage / iotLimit) * 100;

  return (
    <div className="usage-widget">
      <h4>IoT Devices</h4>
      <div className="progress-bar">
        <div className="progress" style={{ width: `${percentage}%` }} />
      </div>
      <p>
        {iotUsage} / {iotLimit} devices
      </p>
      {percentage > 80 && <p className="warning">‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î! ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î</p>}
    </div>
  );
}
```

---

## Migration Strategy

### Phase 1: ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏£‡∏µ

- ‚úÖ ‡∏ó‡∏∏‡∏Å farm ‡πÄ‡∏õ‡πá‡∏ô `tier: 'free'` ‡πÇ‡∏î‡∏¢ default
- ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå `availableInTier: 'free'`
- ‚úÖ Middleware ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á allow ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
- ‚úÖ Frontend ‡πÅ‡∏™‡∏î‡∏á feature toggles ‡πÑ‡∏î‡πâ

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**:

- ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô

---

### Phase 2: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° (3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚è≥ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Premium Features

- ‚è≥ ‡πÄ‡∏û‡∏¥‡πà‡∏° Payment Gateway (Stripe, Omise, PromptPay)
- ‚è≥ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Subscription Management
- ‚è≥ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Usage (devices, AI requests)
- ‚è≥ Email notifications (subscription expiry)

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**:

- Free tier ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ option ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
- Early adopter discounts

---

### Phase 3: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß Subscription (6-12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚è≥ ‡πÄ‡∏£‡∏¥‡πà‡∏° Monetization

- ‚è≥ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô advanced features ‡πÄ‡∏õ‡πá‡∏ô premium
  - Advanced Analytics ‚Üí Premium only
  - Unlimited devices ‚Üí Premium/Enterprise
  - API Access ‚Üí Enterprise only
- ‚è≥ Free tier ‡∏à‡∏≥‡∏Å‡∏±‡∏î limits ‡∏•‡∏á
  - Max 5 devices
  - Max 100 AI requests/month

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**:

- ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà Free tier
- ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏î‡πâ grandfather discount
- Upgrade path ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

---

## Best Practices

### 1. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Backend Developers

**DO**:

- ‚úÖ ‡πÉ‡∏ä‡πâ `checkFeatureAccess()` middleware ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á premium features
- ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ `featureAccess.*.enabled` ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- ‚úÖ Return error codes ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô (`FEATURE_NOT_AVAILABLE`, `FEATURE_NOT_ENABLED`)
- ‚úÖ Log feature usage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö analytics

**DON'T**:

- ‚ùå Hard-code feature checks
- ‚ùå ‡∏•‡∏∑‡∏°‡πÄ‡∏ä‡πá‡∏Ñ subscription expiry
- ‚ùå Block ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ö‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•

### 2. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Frontend Developers

**DO**:

- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á feature locks ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API (‡∏•‡∏î wasted requests)
- ‚úÖ Provide upgrade paths ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á usage limits ‡πÅ‡∏•‡∏∞ warnings
- ‚úÖ Cache subscription status

**DON'T**:

- ‚ùå ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
- ‚ùå ‡∏ã‡πà‡∏≠‡∏ô upgrade options
- ‚ùå ‡∏ó‡∏≥‡πÉ‡∏´‡πâ user ‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

### 3. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Product/Business

**DO**:

- ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö metrics: feature adoption, usage patterns
- ‚úÖ A/B test pricing tiers
- ‚úÖ Survey users ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß premium
- ‚úÖ Grandfather ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÄ‡∏Å‡πà‡∏≤

**DON'T**:

- ‚ùå ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô pricing ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
- ‚ùå Block ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚ùå ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Free tier ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á

---

## Summary

**‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ** (Phase 1):

- ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏£‡∏µ
- ‚úÖ IoT ‡πÅ‡∏•‡∏∞ AI ‡πÄ‡∏õ‡πá‡∏ô optional (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
- ‚úÖ Middleware ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏ï‡πà allow ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
- ‚úÖ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

**‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï** (Phase 2-3):

- ‚è≥ Subscription tiers
- ‚è≥ Usage limits
- ‚è≥ Payment integration
- ‚è≥ Premium features

**‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå**:

1. **‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£**: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
2. **Platform**: ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
3. **Scalable**: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

---

**Document Owner**: Product & Engineering Team
**Status**: Ready for Phase 1 Implementation
**Next Review**: ‡∏ó‡∏∏‡∏Å 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
